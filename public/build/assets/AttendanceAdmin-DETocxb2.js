import{r as a,j as e,d as D,R as pe,H as xe,a as T}from"./app-B8QYX9Px.js";import{u as ie,B as l,T as $,x as G,G as le}from"./logo-BoX8pchB.js";import{P as ue}from"./PageHeader-XJFWVm9P.js";import{S as fe}from"./StatsCards-DEVVTSBN.js";import{u as W,F as q,s as J,T as ge,I as be,c as X,e as je,b as K,a as ee,B as ye,A as we}from"./App-DkF9RL3Y.js";import{d as i}from"./dayjs.min-BHuFkWn-.js";import{F as B}from"./UserIcon-D9_80nkG.js";import{s as ve}from"./chunk-TLYTI3QM-rNm1AEt9.js";import{C as te}from"./CardHeader-Bhq2T4qN.js";import{C as Z}from"./CardContent-B5B4Qw18.js";import{S as Ne}from"./Stack-DJbibjmc.js";import{R as ke}from"./Refresh-Bsi53kqA.js";import{t as Me,a as _e,b as $e,c as Fe,d as Re,e as S}from"./chunk-F3UDT23P-Hrzl6yhk.js";import{t as se}from"./chunk-BOOVDPB6-CftkAAhs.js";import{u as re}from"./chunk-S574QCAN-CoPQlLbo.js";import{F as Ae}from"./ExclamationTriangleIcon-CPu9A391.js";import{F as Pe}from"./XCircleIcon-CVN-tgoC.js";import{F as Se}from"./CheckCircleIcon-z54E82w1.js";import{F as Ye}from"./CheckCircleIcon-B90VRiLI.js";import{F as Ce}from"./XCircleIcon-tcb-l3UC.js";import{F as Ee}from"./ExclamationTriangleIcon-BW32ASrn.js";import{F as Le}from"./ChartBarIcon-BBONCpWc.js";import{G as Te}from"./Grow-DP1KP2ex.js";import{T as ae}from"./TextField-BAa6JqDO.js";import{I as oe}from"./InputAdornment-Cc_eLtv_.js";import{F as We}from"./MagnifyingGlassIcon-DMoaGO85.js";import{P as Be}from"./Pagination-BR8K4mGl.js";import{F as ne}from"./DocumentArrowDownIcon-JzXafcAn.js";import{F as He}from"./PresentationChartLineIcon-fF9RAVuy.js";import"./create-visual-element-4S4I33NB.js";import"./chunk-D5XJWRAV-zQzkTunB.js";import"./EnvelopeIcon-B1M8vjD_.js";import"./ShieldCheckIcon-RZqgNGJW.js";import"./useHasTabbableChild-CrUAHYqA.js";import"./index-Dxlg9OmP.js";import"./Select-8HD_0XQO.js";import"./InputLabel-CehJzubO.js";import"./LastPage-CQjI2zs7.js";function Ie({title:u,titleId:c,...p},f){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},p),u?a.createElement("title",{id:c},u):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Y=a.forwardRef(Ie);function Ue({title:u,titleId:c,...p},f){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},p),u?a.createElement("title",{id:c},u):null,a.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const ze=a.forwardRef(Ue),Oe=({loading:u,attendanceData:c,currentYear:p,currentMonth:f,leaveTypes:y,leaveCounts:_,onRefresh:C})=>{const F=ie(),E=W("(min-width: 1025px)");W("(min-width: 641px) and (max-width: 1024px)");const H=W("(max-width: 640px)"),R=i(`${p}-${f}-01`).daysInMonth(),I={"âˆš":{icon:Se,color:"text-success",bg:"bg-success-100",label:"âˆš",short:"P"},"â–¼":{icon:Pe,color:"text-danger",bg:"bg-danger-100",label:"â–¼",short:"A"},"#":{icon:Ae,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:ze,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},U=a.useMemo(()=>[{label:"No.",key:"sl",icon:Y,width:60},{label:"Employee",key:"name",icon:B,width:200},...Array.from({length:R},(t,x)=>{const w=x+1,N=i(`${p}-${f}-${w}`);return{label:`${w}`,sublabel:N.format("ddd"),key:`day-${w}`,width:40,isWeekend:N.day()===0||N.day()===6}}),...y?y.map(t=>({label:t.type,key:t.type,icon:q,width:80})):[]],[R,p,f,y]),L=t=>I[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},z=({data:t,index:x,daysInMonth:w,currentMonth:N,currentYear:j,leaveTypes:h,leaveCounts:v})=>e.jsx(le,{className:"mb-4",shadow:"sm",children:e.jsxs(Z,{children:[e.jsx(l,{className:"flex items-center gap-3 mb-4",children:e.jsx(re,{avatarProps:{radius:"lg",size:"md",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:e.jsx($,{variant:"body1",fontWeight:"medium",children:t.name||"Unknown"}),description:e.jsxs($,{variant:"caption",color:"textSecondary",children:["Employee #",x+1]})})}),e.jsx(D,{className:"my-3"}),e.jsx(l,{className:"grid grid-cols-7 sm:grid-cols-7 xs:grid-cols-4 grid-cols-3 gap-1 mb-4",children:Array.from({length:w},(r,d)=>{const g=d+1,s=i(`${j}-${N}-${g}`).format("YYYY-MM-DD"),n=t[s],O=i(s).day()===0||i(s).day()===6,A=typeof n=="object"&&(n==null?void 0:n.status)||"â–¼",M=L(A);return e.jsx(se,{placement:"top",content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",A]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(n==null?void 0:n.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(n==null?void 0:n.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(n==null?void 0:n.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(n==null?void 0:n.remarks)||"N/A"]})]}),className:"z-99999",children:e.jsxs(l,{className:`
                                        flex flex-col items-center justify-center p-1 rounded text-xs cursor-pointer
                                        ${O?"bg-default-100":"bg-default-50"}
                                        ${M.bg}
                                    `,children:[e.jsx("span",{className:"font-medium",children:g}),e.jsx("span",{children:M.icon?e.jsx(M.icon,{className:`w-3 h-3 ${M.color}`}):e.jsx("span",{className:M.color,children:A})})]})},g)})}),(h==null?void 0:h.length)>0&&e.jsx(l,{className:"flex flex-wrap gap-2",children:h.map(r=>{var g;const d=((g=v==null?void 0:v[t.user_id])==null?void 0:g[r.type])||0;return e.jsxs(X,{size:"sm",variant:"flat",color:d>0?"warning":"default",startContent:e.jsx(q,{className:"w-3 h-3"}),children:[r.type,": ",d]},r.type)})})]})});return u?e.jsx(l,{className:"flex justify-center items-center h-64",children:e.jsx(ve,{className:"w-full h-full rounded-lg"})}):!c||c.length===0?e.jsxs(l,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx($,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):H?e.jsxs(e.Fragment,{children:[e.jsx(te,{title:e.jsxs(l,{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsx($,{variant:"h6",component:"h1",children:"Attendance Report"})]})}),e.jsx(D,{}),e.jsx(Z,{sx:{p:0},children:e.jsx(J,{className:"max-h-[70vh]",children:c.map((t,x)=>e.jsx(z,{data:t,index:x,daysInMonth:R,currentMonth:f,currentYear:p,leaveTypes:y,leaveCounts:_},t.user_id||x))})})]}):e.jsxs(l,{children:[e.jsx(te,{title:e.jsxs(l,{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsxs($,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",i(`${p}-${f}-01`).format("MMMM YYYY")]})]}),action:e.jsx(Ne,{direction:"row",spacing:1,children:C&&e.jsx(ge,{title:"Refresh Data",children:e.jsx(be,{onClick:C,disabled:u,sx:{background:G(F.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${G(F.palette.primary.main,.2)}`,"&:hover":{background:G(F.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e.jsx(ke,{color:"primary"})})})}),sx:{padding:"24px"}}),e.jsx(D,{}),e.jsx(Z,{children:e.jsx(l,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e.jsx(J,{className:"max-h-[70vh]",children:e.jsxs(Me,{isCompact:!E,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e.jsx(_e,{columns:U,children:t=>e.jsx($e,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:e.jsxs(l,{className:"flex flex-col items-center gap-1",children:[e.jsxs(l,{className:"flex items-center gap-1",children:[t.icon&&e.jsx(t.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e.jsx("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e.jsx(Fe,{items:c,emptyContent:e.jsxs(l,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx($,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e.jsx(Re,{children:x=>{var N;const w=c.findIndex(j=>(j.user_id||j.id)===(t.user_id||t.id));switch(x){case"sl":return e.jsx(S,{className:"text-center font-medium",children:w+1});case"name":return e.jsx(S,{className:"whitespace-nowrap",children:e.jsx(re,{avatarProps:{radius:"lg",size:E?"md":"sm",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(x.startsWith("day-")){const h=parseInt(x.split("-")[1]),v=i(`${p}-${f}-${h}`).format("YYYY-MM-DD"),r=t[v],d=i(v).day()===0||i(v).day()===6,g=typeof r=="object"&&(r==null?void 0:r.status)||"â–¼",s=L(g);return e.jsx(S,{className:`text-center ${d?"bg-default-50":""}`,children:e.jsx(se,{content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",g]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(r==null?void 0:r.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(r==null?void 0:r.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(r==null?void 0:r.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(r==null?void 0:r.remarks)||"N/A"]})]}),placement:"top",className:"z-99999",children:e.jsx(l,{className:"flex items-center justify-center cursor-help",children:s.icon?e.jsx(s.icon,{className:`w-4 h-4 ${s.color}`}):e.jsx("span",{className:`text-xs ${s.color}`,children:g})})})})}const j=y==null?void 0:y.find(h=>h.type===x);if(j){const h=((N=_==null?void 0:_[t.user_id])==null?void 0:N[j.type])||0;return e.jsx(S,{className:"text-center",children:e.jsx(X,{size:"sm",variant:h>0?"flat":"bordered",color:h>0?"warning":"default",className:"min-w-8",children:h})})}return e.jsx(S,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},De=pe.memo(({title:u})=>{const c=ie(),p=W(c.breakpoints.down("sm")),[f,y]=a.useState(!1),[_,C]=a.useState([]),[F,E]=a.useState([]),[H,R]=a.useState([]),[I,U]=a.useState(0),[L,z]=a.useState(0),[t,x]=a.useState(""),[w,N]=a.useState(30),[j,h]=a.useState(1),[v,r]=a.useState(""),[d,g]=a.useState({currentMonth:i().format("YYYY-MM")}),[s,n]=a.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null}),O=a.useCallback((o,k)=>{g(b=>({...b,[o]:k}))},[]),A=async(o=1,k=30,b)=>{y(!0);try{const m=b.currentMonth?i(b.currentMonth).format("MM"):i().format("MM"),Q=b.currentMonth?i(b.currentMonth).year():i().year(),P=await T.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:k,employee:t,currentYear:Q,currentMonth:m}});C(P.data.data),U(P.data.total),z(P.data.last_page),R(P.data.leaveTypes),E(P.data.leaveCounts);const V=await T.get(route("attendance.monthlyStats"),{params:{currentYear:Q,currentMonth:m}});V.data.success&&n(V.data.data)}catch(m){console.error(m),ye.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}})}finally{y(!1)}},M=o=>{const k=o.target.value.toLowerCase();x(k)};a.useEffect(()=>{A(j,w,d).then(o=>"")},[j,w,d,t]);const ce=o=>{h(o)},de=async()=>{r("excel");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),k=await T.get(route("attendance.exportAdminExcel"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([k.data])),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.xlsx`,document.body.appendChild(m),m.click(),r(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("Download failed:",o),r(""),alert("Failed to download attendance sheet.")}},me=async()=>{r("pdf");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),k=await T.get(route("attendance.exportAdminPdf"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([k.data],{type:"application/pdf"})),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.pdf`,document.body.appendChild(m),m.click(),r(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("PDF download failed:",o),r(""),alert("Failed to download attendance PDF.")}},he=a.useMemo(()=>[{title:"Total Employees",value:s.totalEmployees,icon:e.jsx(je,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:s.totalWorkingDays,icon:e.jsx(K,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${s.month})`},{title:"Present Today",value:s.presentToday,icon:e.jsx(Ye,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:s.presentToday>0?`${(s.presentToday/s.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:s.absentToday,icon:e.jsx(Ce,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:s.absentToday>0?`${(s.absentToday/s.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:s.lateToday,icon:e.jsx(Ee,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${s.attendancePercentage}%`,icon:e.jsx(Le,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${s.averageWorkHours}h`,icon:e.jsx(ee,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${s.overtimeHours}h`,icon:e.jsx(ee,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:s.totalLeaveDays,icon:e.jsx(B,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[s.totalEmployees,s.totalWorkingDays,s.month,s.presentToday,s.absentToday,s.lateToday,s.attendancePercentage,s.averageWorkHours,s.overtimeHours,s.totalLeaveDays]);return e.jsxs(l,{children:[e.jsx(xe,{title:u}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(Te,{in:!0,children:e.jsx(le,{children:e.jsx(ue,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e.jsx(He,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e.jsx(ne,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:de,isLoading:v==="excel",className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e.jsx(ne,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:me,isLoading:v==="pdf",className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:e.jsxs("div",{className:"p-6",children:[e.jsx(fe,{stats:he,className:"mb-6"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(ae,{label:"Search Employee",type:"text",value:t,onChange:M,placeholder:"Enter employee name...",variant:"outlined",fullWidth:!0,size:p?"small":"medium",InputProps:{startAdornment:e.jsx(oe,{position:"start",children:e.jsx(We,{className:"w-4 h-4"})}),style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px"}}})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(ae,{label:"Month/Year",type:"month",value:d.currentMonth,onChange:o=>O("currentMonth",o.target.value),variant:"outlined",fullWidth:!0,size:p?"small":"medium",InputLabelProps:{shrink:!0},InputProps:{startAdornment:e.jsx(oe,{position:"start",children:e.jsx(K,{className:"w-4 h-4"})}),style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px"}}})})]})}),e.jsxs(l,{children:[e.jsx(Oe,{attendanceData:_,currentYear:d.currentYear,currentMonth:d.currentMonth,leaveTypes:H,leaveCounts:F,loading:f}),I>=30&&e.jsx("div",{className:"py-4 px-2 flex justify-center items-center",children:e.jsx(Be,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:j,total:L,onChange:ce,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}})})]})]})})})})})]})});De.layout=u=>e.jsx(we,{children:u});export{De as default};
