import{J as ve,r as l,a as J,j as a,Q as xe,b as be,F as V,c as L,d as P,e as ye}from"./app-CFOXYWdD.js";import{d as W}from"./dayjs.min-DTClqbqG.js";import{u as je,G as _e}from"./logo-AMLCgbkx.js";import{u as X,B as z,h as S,s as we,A as Ce}from"./App-D44H3aE5.js";import{P as Ne}from"./PageHeader-DIUdhN7v.js";import{L as Z,D as ke,B as Me,a as Le,b as Pe}from"./BulkDeleteModal-DVJUTEKb.js";import{F as K}from"./ChartBarIcon-COx860cq.js";import{F as Se}from"./XCircleIcon-BKBoDII1.js";import{F as Fe}from"./PlusIcon-xxvwdGLu.js";import{F as Te}from"./PresentationChartLineIcon-BYTkVXBR.js";import{c as Ye}from"./chunk-D5XJWRAV-Bs0mRdwq.js";import"./create-visual-element-DL7V4SzU.js";import"./EnvelopeIcon-DJsx2AYc.js";import"./UserIcon-B8KaJTnW.js";import"./ShieldCheckIcon-DfAiaKpT.js";import"./chunk-SSA7SXE4-B38lyIff.js";import"./ExclamationTriangleIcon-Kx82ewut.js";import"./TrashIcon-DmAagIVq.js";import"./PencilIcon-BxC4n9WJ.js";import"./EllipsisVerticalIcon-C5p9jyC7.js";import"./CheckCircleIcon-CutA81AR.js";import"./ClockIcon-DU4Nz-xo.js";import"./ExclamationTriangleIcon-BgutF-yh.js";import"./createLucideIcon-U2MVd2gI.js";import"./HeartIcon-Bo9q8bqL.js";import"./chunk-F3UDT23P-DfyL8aGa.js";import"./index-CaGcrq76.js";import"./useHasTabbableChild-Bti5CcwH.js";import"./chunk-S574QCAN-C6iBC3Hs.js";import"./chunk-JOT4BT4P-DD-bNesh.js";import"./chunk-EAPQ7RWQ-CTPnoxCw.js";import"./index-CokAva9Y.js";import"./chunk-YRZGWF2W-CVS3z9wo.js";import"./chunk-TSPNSPCL-CDimUInN.js";import"./GlassDialog-CB1Z5Bs0.js";import"./InformationCircleIcon-CWXmBAdb.js";import"./XCircleIcon-CXS-JZ21.js";import"./CheckCircleIcon-WfVI_0Z3.js";import"./x-CPfZajGW.js";const Be=({title:D,allUsers:p})=>{const{auth:C}=ve().props;je(!1,"OCEAN");const N=X("(max-width: 640px)"),U=X("(min-width: 641px) and (max-width: 1024px)"),[g,F]=l.useState(0),[O,T]=l.useState(0),[$,Ie]=l.useState(!1),[j,m]=l.useState([]),[b,_]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[H,h]=l.useState(!1),[G,E]=l.useState(""),[o,A]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[n,ee]=l.useState({employee:"",selectedMonth:W().format("YYYY-MM"),year:new Date().getFullYear()}),u=l.useCallback(e=>{e&&(F(e.total||0),T(e.last_page||1),A(s=>({...s,total:e.total||0,lastPage:e.last_page||1})))},[]),f=l.useCallback(async()=>{var e,s,t;h(!0);try{const{page:r,perPage:i}=o,{year:c}=n,x=await J.get(route("leaves.paginate"),{params:{page:r,perPage:i,year:c,user_id:C.user.id},timeout:1e4});if(x.status===200){const{leaves:v,leavesData:fe}=x.data;v.data&&Array.isArray(v.data)?(m(v.data),u({total:v.total||v.data.length,last_page:v.last_page||1,current_page:v.current_page||1,per_page:v.per_page||o.perPage})):Array.isArray(v)?(m(v),u({total:v.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",v),m([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})),_(fe),E("")}}catch(r){if(console.error("Error fetching leaves:",r),((e=r.response)==null?void 0:e.status)===404){const{leavesData:i}=r.response.data;_(i),E(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else{E("Error retrieving leaves data. Please try again.");const i=Promise.reject("Failed to load leave data. Please try again.");z.promise(i,{error:{render(){return a.jsx("div",{children:"Failed to load leave data. Please try again."})},icon:"❌"}})}m([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{h(!1)}},[o.page,o.perPage,n,C.user.id,u]),Y=l.useCallback((e,s,t)=>{const{page:r,perPage:i}=o;e.length>=i||r<O||f()},[o,O,f]),ae=l.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(s,t)=>{const r=1900+t;return{key:r.toString(),label:r.toString(),value:r}}).reverse()},[]),Q=l.useCallback((e,s)=>{if(e==="year"){const t=Number(s);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}ee(t=>({...t,[e]:s})),e==="year"&&A(t=>({...t,page:1}))},[]),[y,B]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1});l.useCallback((e,s=null)=>{B(t=>({...t,[e]:!0}))},[]);const M=l.useCallback(()=>{B({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1})},[]),I=l.useCallback(e=>{B(s=>({...s,[e]:!0}))},[]),te=l.useCallback((e,s)=>{q({id:e}),B(t=>({...t,[s]:!0}))},[]),[R,q]=l.useState(null),[se,re]=l.useState([]),le=l.useCallback(e=>{q(e)},[]),oe=l.useCallback(e=>{re(e),I("bulk_delete")},[I]),d=l.useCallback(async()=>{try{const e=await J.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:s,leaveCounts:t}=e.data;t&&_(r=>({...r,leaveCountsByUser:{...r.leaveCountsByUser,[C.user.id]:t}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,C.user.id]),ne=l.useCallback(e=>{e!==o.page&&A(s=>({...s,page:e}))},[o.page]);l.useEffect(()=>{f()},[f]),l.useEffect(()=>{d()},[d]);const ie=l.useMemo(()=>b.leaveCountsByUser[C.user.id]||[],[b.leaveCountsByUser,C.user.id]),k=l.useCallback(e=>[...e].sort((s,t)=>new Date(s.from_date)-new Date(t.from_date)),[]),w=l.useCallback(e=>{const s=new Date(e.from_date).getFullYear();if(n.year&&s!==n.year)return!1;if(n.employee){const t=p==null?void 0:p.find(i=>String(i.id)===String(e.user_id)),r=n.employee.trim().toLowerCase();if(t){if(String(t.id)!==r&&!(t.name&&t.name.trim().toLowerCase().includes(r)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&W(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const t=p==null?void 0:p.find(r=>String(r.id)===String(e.user_id));if(!t||String(t.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,p]);l.useMemo(()=>j||[],[j]);const ce=l.useCallback(e=>{w(e)&&(h(!0),m(s=>{const t=[...s,e];return k(t).slice(0,o.perPage)}),u({total:g+1,last_page:Math.ceil((g+1)/o.perPage),current_page:o.page,per_page:o.perPage}),h(!1),o.page!==1&&f(),d())},[w,k,o,g,u,f,d]),de=l.useCallback(e=>{var i;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}e.leavesData&&_(e.leavesData);const s=e.created_leaves||[];if(s.length===0){d();return}const t=s.filter(c=>w(c));if(t.length===0){d();return}h(!0),m(c=>{const x=[...c,...t];return k(x).slice(0,o.perPage)});const r=((i=e.summary)==null?void 0:i.successful)||s.length;u({total:g+r,last_page:Math.ceil((g+r)/o.perPage),current_page:o.page,per_page:o.perPage}),h(!1),o.page!==1&&f(),d()},[w,k,o,g,u,f,d]),ue=l.useCallback(e=>{const s=j.some(r=>r.id===e.id);if(h(!0),!w(e)&&s){m(i=>i.filter(c=>c.id!==e.id));const r=Promise.resolve();z.promise(r,{success:{render(){return a.jsx("div",{children:"Leave removed from filtered view."})},icon:"ℹ️"}}),h(!1);return}if(!s&&!w(e)){h(!1);return}m(r=>{const i=r.some(x=>x.id===e.id);let c;return i?c=r.map(x=>x.id===e.id?e:x):c=[...r,e],k(c).slice(0,o.perPage)});const t=Promise.resolve();z.promise(t,{success:{render(){return a.jsx("div",{children:"Leave updated!"})},icon:"✅"}}),h(!1),o.page!==1&&f(),d()},[w,k,j,o,f,d]),me=l.useCallback(e=>{m(t=>{const r=t.filter(c=>c.id!==e),i=Math.max(0,g-1);return Y(r,i,"delete"),r});const s=Math.max(0,g-1);u({total:s,last_page:Math.max(1,Math.ceil(s/o.perPage)),current_page:o.page,per_page:o.perPage}),d()},[d,g,o,u,Y]),pe=l.useCallback(e=>{if(!e||!e.success){console.error("Invalid bulk delete response data:",e);return}e.leavesData&&_(e.leavesData);const s=e.deleted_leaves||[],t=s.map(c=>c.id);if(t.length===0){d();return}h(!0),m(c=>c.filter(x=>!t.includes(x.id)));const r=e.deleted_count||s.length,i=Math.max(0,g-r);u({total:i,last_page:Math.max(1,Math.ceil(i/o.perPage)),current_page:o.page,per_page:o.perPage}),h(!1),Y(j.filter(c=>!t.includes(c.id)),i,"delete"),d()},[u,o,g,j,Y,d]),ge=()=>b.leaveTypes.length?a.jsx("div",{className:`grid gap-4 ${N?"grid-cols-1":U?"grid-cols-2":"grid-cols-4"}`,children:b.leaveTypes.map(({type:e})=>{const s=ie.find(c=>c.leave_type===e)||{},t=s.days_used||0,r=s.remaining_days||0,i=t+r;return a.jsxs(L,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a.jsx(Ye,{className:"pb-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{className:"w-5 h-5"}),a.jsx(Typography,{variant:N?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a.jsx(P,{className:"pt-0",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(Typography,{variant:"caption",color:"textSecondary",children:"Used"}),a.jsx(Typography,{variant:N?"h6":"h5",className:"font-bold text-red-400",children:t})]}),a.jsx(ye,{orientation:"vertical",className:"h-8"}),a.jsxs("div",{className:"text-center",children:[a.jsx(Typography,{variant:"caption",color:"textSecondary",children:"Remaining"}),a.jsx(Typography,{variant:N?"h6":"h5",className:"font-bold text-green-400",children:r})]})]}),i>0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-linear-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${t/i*100}%`}})})]})})]},e)})}):a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-8",children:[a.jsx(K,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a.jsx(Typography,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),he=l.useRef(null);return a.jsxs(a.Fragment,{children:[a.jsx(xe,{title:D}),y.add_leave&&a.jsx(Z,{open:y.add_leave,closeModal:()=>M(),leavesData:b,setLeavesData:_,currentLeave:null,allUsers:p,setTotalRows:F,setLastPage:T,setLeaves:m,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:ce,updatePaginationMetadata:u,fetchLeavesStats:d}),y.edit_leave&&a.jsx(Z,{open:y.edit_leave,closeModal:()=>M(),leavesData:b,setLeavesData:_,currentLeave:R,allUsers:p,setTotalRows:F,setLastPage:T,setLeaves:m,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:ue,updatePaginationMetadata:u,fetchLeavesStats:d}),y.delete_leave&&a.jsx(ke,{open:y.delete_leave,closeModal:()=>M(),leaveId:R==null?void 0:R.id,setLeaves:m,setTotalRows:F,setLastPage:T,deleteLeaveOptimized:me,updatePaginationMetadata:u,fetchLeavesStats:d}),y.bulk_leave&&a.jsx(Me,{open:y.bulk_leave,onClose:()=>M(),onSuccess:e=>{de(e)},allUsers:p,leavesData:b,isAdmin:!1,existingLeaves:j||[],publicHolidays:(b==null?void 0:b.publicHolidays)||[]}),y.bulk_delete&&a.jsx(Le,{open:y.bulk_delete,onClose:()=>M(),onSuccess:e=>{pe(e)},selectedLeaves:se,allUsers:p}),a.jsxs(Box,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a.jsx(Grow,{in:!0,children:a.jsx(_e,{children:a.jsx(Ne,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a.jsx(Te,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a.jsx(Fe,{className:"w-4 h-4"}),onPress:()=>I("add_leave"),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a.jsx(S,{className:"w-4 h-4"}),onPress:()=>Q("year",new Date().getFullYear()),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a.jsx(V,{className:"w-4 h-4"}),onPress:f,className:"bg-linear-to-r from-[rgba(var(--theme-success-rgb),0.8)] to-[rgba(var(--theme-success-rgb),1)] text-white font-medium hover:opacity-90"}],children:a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a.jsxs(FormControl,{size:N?"small":"medium",sx:{minWidth:200,width:"100%"},children:[a.jsxs(InputLabel,{sx:{color:"rgba(255, 255, 255, 0.7)",display:"flex",alignItems:"center",gap:1},children:[a.jsx(S,{className:"w-4 h-4"}),"Select Year"]}),a.jsx(we,{value:String(n.year),onChange:e=>Q("year",Number(e.target.value)),label:"Select Year",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(16px)",borderRadius:"12px","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)",backgroundColor:"rgba(255, 255, 255, 0.15)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(59, 130, 246, 0.5)"},"& .MuiSelect-select":{color:"rgba(255, 255, 255, 0.9)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"}},MenuProps:{PaperProps:{sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(16px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px","& .MuiMenuItem-root":{color:"rgba(255, 255, 255, 0.9)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)"},"&.Mui-selected":{backgroundColor:"rgba(59, 130, 246, 0.3)"}}}}},children:ae.map(e=>a.jsx(MenuItem,{value:e.value,children:e.label},e.key))})]})}),a.jsx("div",{className:"flex gap-2",children:a.jsx(be,{variant:"flat",color:"primary",size:N?"sm":"md",onPress:f,isLoading:$,startContent:!$&&!H&&a.jsx(V,{className:"w-4 h-4"}),children:"Refresh"})})]})}),a.jsxs("div",{className:"mb-6",children:[a.jsxs(Typography,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(K,{className:"w-5 h-5"}),"Leave Balance Summary"]}),ge()]}),a.jsxs("div",{className:"min-h-96",children:[a.jsxs(Typography,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(S,{className:"w-5 h-5"}),"Leave History"]}),H?a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(CircularProgress,{size:40}),a.jsx(Typography,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):G?a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(Se,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a.jsx(Typography,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a.jsx(Typography,{color:"textSecondary",children:G})]})}):j.length>0?a.jsx("div",{className:"overflow-hidden rounded-lg",children:a.jsx(Pe,{ref:he,leaves:j,allUsers:p||[],handleClickOpen:te,setCurrentLeave:le,openModal:I,setLeaves:m,setCurrentPage:ne,currentPage:o.page,totalRows:g,lastPage:O,perPage:o.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:d,updatePaginationMetadata:u,onBulkDelete:oe,canDeleteLeaves:!0})}):a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(S,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a.jsx(Typography,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),a.jsxs(Typography,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};Be.layout=D=>a.jsx(Ce,{children:D});export{Be as default};
