import{h as Re,r as a,k as xe,ao as Te,g as Le,j as e,R as X,u as De,c as M,f as ye,b as ne,s as le,d as ce,J as be,a as Y,ap as Ae,aq as $e,Q as Pe}from"./app-1wDtHJfv.js";import{T as Me}from"./TimeSheetTable-Cyx9oGGW.js";import{L as Oe,M as We,N as Ue,x as we,p as ae,F as de,O as ze,Q as He,h as me,J as Ge,P as Be,k as Ve,c as Ze,e as qe,f as Je,g as Ke,A as Ye}from"./Dashboard-DAH0WTtA.js";import{S as Xe}from"./StatsCards-DjVEPKG4.js";import{M as Qe,T as et,u as je,L as K}from"./leaflet-yQspOXjy.js";import"./leaflet-routing-machine-DO_BTOh9.js";import{m as O}from"./proxy-gSCNGD6s.js";import{c as he}from"./createLucideIcon-2yXPV9aY.js";import{U as tt}from"./users-tdaEYANz.js";import{M as rt}from"./map-pin-DJfXvz-t.js";import{c as fe}from"./chunk-D5XJWRAV-D9B8eKHA.js";import{d as z}from"./dayjs.min-CB5aPOb8.js";import{i as st}from"./isBetween-Do1ay8wf.js";import{F as te}from"./ExclamationTriangleIcon-BNzDyZlC.js";import{F as B}from"./ClockIcon-go4BFxdq.js";import{F as Ne}from"./UserGroupIcon-DWIGy9_q.js";import{F as at}from"./SunIcon-mPqptfiv.js";import{F as Fe}from"./InformationCircleIcon-Di8rfW6n.js";import{F as ge}from"./UserIcon-C0zK6YZ8.js";import{F as nt}from"./XCircleIcon-C9Uwmwpq.js";import{F as pe}from"./CheckCircleIcon-DxtX0hHm.js";import{s as ue}from"./chunk-TLYTI3QM-DLc-6b8G.js";import{c as J}from"./chunk-IHOGUXIG--xwDCpLC.js";import{F as ot}from"./ClipboardDocumentListIcon-BMZyRMdA.js";import{B as G}from"./react-toastify.esm-DxP-_4Mw.js";import{a as Q,F as it}from"./MapPinIcon-BayS-kgA.js";import{F as lt}from"./ShieldCheckIcon-ClK_nS3-.js";import{F as ct}from"./GlobeAltIcon-Br4-oCbm.js";import{m as dt}from"./chunk-O5MCAK4F-CYBHZL2o.js";import{t as ie}from"./XMarkIcon-COO2Zh6A.js";import"./PageHeader-9nikL3YR.js";import"./MagnifyingGlassIcon-Cq7i1gc0.js";import"./UserPlusIcon-DrQXYg-u.js";import"./chunk-SSA7SXE4-BCD6fJ-v.js";import"./DocumentArrowDownIcon-BsF64EPX.js";import"./chunk-JOT4BT4P-C8Yn9rqw.js";import"./chunk-Y2AYO5NJ-D3udvIa2.js";import"./chunk-F3UDT23P-Ddk_NhTJ.js";import"./chunk-XJ2YRSUP-D9xMI4St.js";import"./useToggleState-ryUbPf2n.js";import"./chunk-YRZGWF2W-GPQtuccW.js";import"./chunk-EAPQ7RWQ-C-NuR2Jr.js";import"./chunk-S574QCAN-Btindt9I.js";import"./EnvelopeIcon-CD6s87Wn.js";import"./KeyIcon-TrMOO77X.js";import"./index-2e9fqbYw.js";import"./logo-Pwvcz7fP.js";import"./features-animation-XmBiLvPP.js";import"./create-visual-element-CS80Zc6Z.js";function mt(s={}){const{as:t,ref:c,max:l=5,total:o,size:h,color:u,radius:d,children:g,isBordered:I,isDisabled:w,isGrid:j,renderCount:A,className:_,classNames:R,...v}=s,f=Re(c),n=t||"div",m=a.useMemo(()=>({size:h,color:u,radius:d,isGrid:j,isBordered:I,isDisabled:w}),[h,u,d,j,I,w]),p=a.useMemo(()=>Oe({className:_,isGrid:j}),[_,j]),N=We(g),k=l?N.slice(0,l):N,C=o||(l!=null?N.length-l:-1),$=k.map((r,i)=>{const F=i===0,x=i===k.length-1,b={className:xe(F?"ms-0":j?"":"-ms-2",x&&C<1?"hover:-translate-x-0":"")};return a.cloneElement(r,Te(b))});return{Component:n,context:m,remainingCount:C,clones:$,renderCount:A,getAvatarGroupProps:()=>({ref:f,className:p.base({class:xe(R==null?void 0:R.base,_)}),role:"group",...v}),getAvatarGroupCountProps:()=>({className:p.count({class:R==null?void 0:R.count})})}}var ke=Le((s,t)=>{const{Component:c,clones:l,context:o,remainingCount:h,getAvatarGroupCountProps:u,getAvatarGroupProps:d,renderCount:g=I=>e.jsx(we,{...u(),name:`+${I}`})}=mt({...s,ref:t});return e.jsx(c,{...d(),children:e.jsxs(Ue,{value:o,children:[l,h>0&&g(h)]})})});ke.displayName="HeroUI.AvatarGroup";var ut=ke;function ht({title:s,titleId:t,...c},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},c),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const ft=a.forwardRef(ht);function pt({title:s,titleId:t,...c},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},c),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const xt=a.forwardRef(pt);function gt({title:s,titleId:t,...c},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},c),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const vt=a.forwardRef(gt);function yt({title:s,titleId:t,...c},l){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":t},c),s?a.createElement("title",{id:t},s):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))}const bt=a.forwardRef(yt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],jt=he("clock-4",wt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],ve=he("map",Nt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],kt=he("refresh-cw",Ft);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(s){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=s,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(s){L.DomEvent.stopPropagation(s),L.DomEvent.preventDefault(s),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(s){var t=this.getContainer();this.isFullscreen()?s&&s.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):s&&s.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(s){L.DomUtil.addClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(s){L.DomUtil.removeClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(s){this._isFullscreen=s;var t=this.getContainer();s?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(s){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var s;if("onfullscreenchange"in document?s="fullscreenchange":"onmozfullscreenchange"in document?s="mozfullscreenchange":"onwebkitfullscreenchange"in document?s="webkitfullscreenchange":"onmsfullscreenchange"in document&&(s="MSFullscreenChange"),s){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,s,t)}),this.on("unload",function(){L.DomEvent.off(document,s,t)})}});L.control.fullscreen=function(s){return new L.Control.Fullscreen(s)};const q=(s,t)=>{if(s.startsWith("var("))return`color-mix(in srgb, ${s} ${t*100}%, transparent)`;if(s.startsWith("#")){const c=s.replace("#",""),l=parseInt(c.substr(0,2),16),o=parseInt(c.substr(2,2),16),h=parseInt(c.substr(4,2),16);return`rgba(${l}, ${o}, ${h}, ${t})`}return s.replace(/[\d.]+\)$/g,`${t})`)},Ct=()=>{var l;const t=((l=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:l.trim())||"12px",c=parseInt(t);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},H={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:300},ee={primary:{lat:23.879132,lng:90.502617},route:{start:{lat:23.987057,lng:90.361908,name:"Route Start"},end:{lat:23.690618,lng:90.546729,name:"Route End"}}},Ce=X.memo(({startLocation:s,endLocation:t,theme:c})=>{const l=je();return a.useEffect(()=>{var h;if(!l||!s||!t)return;const o=K.Routing.control({waypoints:[K.latLng(s.lat,s.lng),K.latLng(t.lat,t.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((h=c==null?void 0:c.customColors)==null?void 0:h.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(l);return()=>{l&&o&&l.removeControl(o)}},[l,s,t,c]),null});Ce.displayName="RoutingMachine";const _e=X.memo(({selectedDate:s,onUsersLoad:t,theme:c,lastUpdate:l,users:o,setUsers:h,setLoading:u,setError:d})=>{const g=je(),I=a.useRef([]),w=a.useCallback(async()=>{if(!s){u(!1),h([]),t==null||t([]);return}u(!0),d(null);try{const n=route("getUserLocationsForDate",{date:s,_t:Date.now()}),p=(await axios.get(n)).data;if(!p.success||!Array.isArray(p.locations))throw new Error("Unexpected response format from server.");const N=p.locations;JSON.stringify(N)!==JSON.stringify(I.current)&&(h(N),I.current=N),t==null||t(N)}catch(n){let m="Error fetching user locations.";n.response?(m+=` Server error (${n.response.status}): ${n.response.statusText}`,typeof n.response.data=="object"&&(m+=`
Details: ${JSON.stringify(n.response.data)}`)):n.request?m+=" No response received from server.":n.message&&(m+=` ${n.message}`),console.error(m,n),d(m),h([]),t==null||t([])}finally{u(!1)}},[s,t,l]);a.useEffect(()=>{w()},[w]);const j=a.useCallback((n,m)=>{const p=H.OFFSET_MULTIPLIER*m;return{lat:n.lat+p,lng:n.lng+p}},[]),A=a.useCallback((n,m)=>Math.abs(n.lat-m.lat)<H.POSITION_THRESHOLD&&Math.abs(n.lng-m.lng)<H.POSITION_THRESHOLD,[]),_=a.useCallback(n=>{if(!n)return null;if(typeof n=="object"&&n.lat&&n.lng){const m=parseFloat(n.lat),p=parseFloat(n.lng);return isNaN(m)||isNaN(p)?null:{lat:m,lng:p}}if(typeof n=="string")try{const m=JSON.parse(n);if(m.lat&&m.lng){const p=parseFloat(m.lat),N=parseFloat(m.lng);return isNaN(p)||isNaN(N)?null:{lat:p,lng:N}}}catch{const p=n.split(",");if(p.length>=2){const N=parseFloat(p[0].trim()),k=parseFloat(p[1].trim());return isNaN(N)||isNaN(k)?null:{lat:N,lng:k}}}return null},[]),R=a.useCallback(n=>{if(!n)return"Not recorded";try{let m;return n.includes("T")?m=new Date(n):m=new Date(`${s}T${n}`),isNaN(m.getTime())?"Invalid time":m.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(m){return console.warn("Error formatting time:",m),n}},[s]),v=a.useCallback(n=>{var k,C,$,P;const m="var(--theme-primary, #3b82f6)",N=`
            <div style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${m}, var(--theme-secondary, #8b5cf6));
                border: 3px solid white;
                box-shadow: 0 4px 12px ${q(m,.4)};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${n.profile_image_url||n.profile_image?`<img src="${n.profile_image_url||n.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((C=(k=n.name)==null?void 0:k.charAt(0))==null?void 0:C.toUpperCase())||"?"}';" />`:((P=($=n.name)==null?void 0:$.charAt(0))==null?void 0:P.toUpperCase())||"?"}
            </div>
        `;return K.divIcon({html:N,className:"user-marker-icon",iconSize:H.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),f=a.useCallback(n=>{var P,W,r,i;const m=n.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",p="var(--theme-primary, #3b82f6)",N="var(--theme-secondary, #8b5cf6)",k="var(--theme-content1, #ffffff)",C="var(--theme-foreground, #1f2937)",$="var(--theme-content3, #6b7280)";return`
            <div style="
                min-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, ${q(k,.95)}, ${q(p,.05)});
                border-radius: 12px;
                border: 1px solid ${q(p,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            ">
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                    <div style="
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${p}, ${N});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        margin-right: 12px;
                    ">
                        ${n.profile_image_url||n.profile_image?`<img src="${n.profile_image_url||n.profile_image}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((W=(P=n.name)==null?void 0:P.charAt(0))==null?void 0:W.toUpperCase())||"?"}';" />`:((i=(r=n.name)==null?void 0:r.charAt(0))==null?void 0:i.toUpperCase())||"?"}
                    </div>
                    <div>
                        <div style="font-weight: 600; color: ${C}; font-size: 16px;">
                            ${n.name||"Unknown User"}
                        </div>
                        <div style="color: ${$}; font-size: 12px;">
                            ${n.designation||"No designation"}
                        </div>
                    </div>
                </div>
                <div style="
                    display: inline-block;
                    padding: 4px 8px;
                    background: ${q(m,.1)};
                    color: ${m};
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid ${q(m,.2)};
                ">
                    ${n.punchout_time?"‚úì Completed":"‚è± Active"}
                </div>
                <div style="space-y: 8px;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="color: var(--theme-success, #10b981); margin-right: 8px;">üìç</span>
                        <span style="color: ${$}; font-size: 13px;">
                            Check In: ${R(n.punchin_time)}
                        </span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <span style="color: var(--theme-danger, #ef4444); margin-right: 8px;">üìç</span>
                        <span style="color: ${$}; font-size: 13px;">
                            Check Out: ${R(n.punchout_time)}
                        </span>
                    </div>
                </div>
            </div>
        `},[R]);return a.useEffect(()=>{if(!g||!o.length)return;g.eachLayer(m=>{m instanceof K.Marker&&m.options.userData&&g.removeLayer(m)});const n=[];o.forEach((m,p)=>{const N=_(m.punchout_location||m.punchin_location);if(!N)return;let k={...N},C=0;const $=10;for(;C<$&&n.some(r=>A(k,r));)k=j(N,C+1),C++;n.push(k);const P=K.marker([k.lat,k.lng],{icon:v(m),userData:!0});P.bindPopup(f(m),{maxWidth:H.POPUP_MAX_WIDTH,className:"custom-popup"}),P.addTo(g)})},[g,o,c,_,A,j,v,f]),null});_e.displayName="UserMarkers";const _t=s=>a.useMemo(()=>{const t=s.reduce((u,d)=>{const g=d.user_id;return u[g]||(u[g]=[]),u[g].push(d),u},{}),c=Object.keys(t),l=c.length;let o=0,h=0;return c.forEach(u=>{const d=t[u];d.sort((w,j)=>w.punchin_time?j.punchin_time?w.punchin_time.localeCompare(j.punchin_time):-1:1);const g=d[d.length-1];d.some(w=>w.punchin_time)&&(g.punchout_time?h++:o++)}),{checkedIn:o,completed:h,total:l}},[s]),St=X.memo(({updateMap:s,selectedDate:t})=>{const{themeSettings:c}=De(),l=ae("(min-width: 1025px)"),o=ae("(min-width: 641px) and (max-width: 1024px)"),[h,u]=a.useState([]),[d,g]=a.useState(!0),[I,w]=a.useState(null),[j,A]=a.useState(!1),[_,R]=a.useState(null),[v,f]=a.useState(!0),[n,m]=a.useState(0),p=window.innerWidth<640,[N,k]=a.useState(new Date),C=a.useRef([]),$=a.useRef(null),P=a.useCallback(async()=>{g(!0);try{const b=route("getUserLocationsForDate",{date:t,_t:Date.now()});if(!t){u([]),C.current=[],m(T=>T+1),k(new Date),R(new Date);return}const S=await fetch(b);if(!S.ok)throw new Error(`HTTP ${S.status}: Failed to refresh user locations`);const U=await S.json(),y=Array.isArray(U.locations)?U.locations:[];u(y),C.current=y,m(T=>T+1),k(new Date),R(new Date)}catch(b){console.error("Error refreshing map:",b),u([]),C.current=[]}finally{g(!1)}},[t]),W=a.useMemo(()=>{if(!t)return"Invalid Date";try{return new Date(t).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[t]),r=_t(h),i=a.useCallback(async()=>{if(!t){g(!1);return}try{const b=route("check-user-locations-updates",{date:t.split("T")[0]}),S=await fetch(b);if(!S.ok)throw new Error(`HTTP ${S.status}: Failed to check for updates`);const U=await S.json();U.success&&U.last_updated!==$.current&&U.last_updated&&($.current=U.last_updated,P(),R(new Date)),k(new Date)}catch(b){console.error("Error checking for updates:",b),g(!1)}},[t,P]);a.useEffect(()=>{if(!v)return;i();const b=setInterval(i,5e3);return()=>clearInterval(b)},[v,i]),a.useEffect(()=>{h.length===0&&d&&j&&g(!1)},[h,d,j]),a.useEffect(()=>{if(d){const b=setTimeout(()=>{d&&(console.log("Loading timeout reached, forcing loading to false"),g(!1))},1e4);return()=>clearTimeout(b)}},[d]);const F=a.useMemo(()=>N?N.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[N]),x=a.useCallback(b=>{const S=Array.isArray(b)?b:[];JSON.stringify(S)!==JSON.stringify(C.current)&&(u(S),C.current=S),A(!0),g(!1)},[]);return e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(M,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(fe,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${l?"p-6":o?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${l?"p-3":o?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(ve,{className:`
                                                    ${l?"w-8 h-8":o?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${l?"text-2xl":o?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${l?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${l?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${l?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:W})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:F&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",F]})})]})})})}),e.jsx(ye,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(ne,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(Xe,{className:"mb-6",stats:[{title:"Total",value:r.total,icon:e.jsx(tt,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:r.checkedIn,icon:e.jsx(jt,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:r.completed,icon:e.jsx(rt,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:p})}),e.jsx("div",{className:"p-6 pt-0",children:h.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(Qe,{center:[ee.primary.lat,ee.primary.lng],zoom:H.DEFAULT_ZOOM,minZoom:H.MIN_ZOOM,maxZoom:H.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(et,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:H.MAX_ZOOM,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ce,{startLocation:ee.route.start,endLocation:ee.route.end,theme:c}),e.jsx(_e,{users:h,setUsers:u,setLoading:g,setError:w,lastUpdate:_,selectedDate:t,onUsersLoad:x,theme:c})]},`${s}-${n}`)]}):d?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ve,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",W,".",t&&new Date(t)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(ce,{variant:"bordered",color:"primary",size:"md",radius:Ct(),onPress:P,startContent:e.jsx(kt,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})})})});z.extend(st);const re=()=>{var l;if(typeof window>"u")return"lg";const t=((l=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:l.trim())||"12px",c=parseInt(t);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},se=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),It=({title:s,items:t,users:c,icon:l,color:o})=>{var v;const[h,u]=a.useState(null),[d,g]=a.useState(null),I=(f,n)=>{u(f.currentTarget),g(n)},w=()=>{u(null),g(null)},j=!!h,A=j?"leave-details-popover":void 0,_=f=>{switch(f==null?void 0:f.toLowerCase()){case"approved":return e.jsx(pe,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(nt,{className:"w-4 h-4 text-danger"});default:return e.jsx(B,{className:"w-4 h-4 text-warning"})}},R=f=>{switch(f==null?void 0:f.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(M,{className:"h-full flex flex-col",radius:re(),style:se(),onMouseEnter:f=>{f.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${o} 50%, transparent)`,f.currentTarget.style.borderRadius="var(--borderRadius, 12px)",f.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",f.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(fe,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${o} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${o} 25%, transparent)`},children:e.jsx(l,{className:"w-6 h-6 stroke-2",style:{color:o},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s})]})}),e.jsx(ne,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:t.map((f,n)=>e.jsxs(X.Fragment,{children:[e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.text}),f.leaves&&f.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ne,{className:"w-3 h-3"}),f.leaves.length," employee",f.leaves.length>1?"s":""]})]}),f.leaves&&(()=>{const m=f.leaves.filter(p=>p.leave_type===f.type);return m.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(ut,{max:4,isBordered:!0,size:"sm",children:m.map((p,N)=>{const k=c.find(C=>String(C.id)===String(p.user_id));return k&&e.jsx(we,{src:k.profile_image_url,name:`${k.name} - on leave`,onClick:C=>I(C,p),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e.jsx(ge,{className:"w-4 h-4"})},N)})})})})()]}),n<t.length-1&&e.jsx(ye,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},n))}),e.jsx(ze,{id:A,open:j,anchorEl:h,onClose:w,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(He,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:d&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(me,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((v=c.find(f=>String(f.id)===String(d.user_id)))==null?void 0:v.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:d.from_date!==d.to_date?`${new Date(d.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(d.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(d.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:d.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_(d.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(J,{label:d.status||"Pending",variant:"flat",color:R(d.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},Et=()=>{const{auth:s}=be().props,t=ae("(min-width: 1025px)"),c=ae("(min-width: 641px) and (max-width: 1024px)"),[l,o]=a.useState(!0),[h,u]=a.useState(null),[d,g]=a.useState([]),[I,w]=a.useState([]),[j,A]=a.useState([]),[_,R]=a.useState(null);a.useEffect(()=>{let r=!0;const i=new AbortController;return(async()=>{try{o(!0),u(null);const x=await Y.get(route("updates"),{signal:i.signal,timeout:1e4});r&&x.data&&(g(x.data.users||[]),w(x.data.todayLeaves||[]),A(x.data.upcomingLeaves||[]),R(x.data.upcomingHoliday||null))}catch(x){r&&!i.signal.aborted&&(console.error("Failed to fetch updates:",x),u(x.message),g([]),w([]),A([]),R(null))}finally{r&&o(!1)}})(),()=>{r=!1,i.abort()}},[]);const v=(r,i)=>{let F=i;const x=y=>i.some(E=>String(E.user_id)===String(s.user.id)&&E.leave_type===y)?(F=i.filter(E=>String(E.user_id)!==String(s.user.id)),`You ${r==="today"?"are":"will be"} on ${y} leave.`):null,b=i.reduce((y,T)=>{const E=x(T.leave_type);return E&&!y.some(V=>V.type===T.leave_type)&&y.push({text:E,type:T.leave_type}),y},[]),S=F.reduce((y,T)=>(y[T.leave_type]=(y[T.leave_type]||0)+1,y),{}),U=Object.entries(S).map(([y,T])=>({text:`${T} person${T>1?"s":""} ${r==="today"?"is":"will be"} on ${y} leave`,type:y,leaves:F.filter(E=>E.leave_type===y)}));return[...b,...U]},f=z(),n=f.add(1,"day"),m=n.add(7,"day"),p=I.filter(r=>z(f).isBetween(z(r.from_date),z(r.to_date),"day","[]")),N=j.filter(r=>z(n).isBetween(z(r.from_date),z(r.to_date),"day","[]")),k=j.filter(r=>(z(r.from_date).isBetween(n,m,"day","[]")||z(r.to_date).isBetween(n,m,"day","[]"))&&!/week/i.test(r.leave_type)),C=v("today",p),$=v("tomorrow",N),P=v("nextSevenDays",k);C.length===0&&C.push({text:"No one is away today."}),$.length===0&&$.push({text:"No one is away tomorrow."}),P.length===0&&P.push({text:"No one is going to be away in the next seven days."});const W=[{title:"Today",items:C,icon:de,color:"#3b82f6"},{title:"Tomorrow",items:$,icon:B,color:"#10b981"},{title:"Next Seven Days",items:P,icon:Ne,color:"#f59e0b"}];return l?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((r,i)=>e.jsx("div",{children:e.jsxs(M,{className:"w-full h-full",radius:re(),style:se(),children:[e.jsx(ue,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(ue,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},i))})}):h?e.jsx("div",{className:`${t?"p-6":c?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(M,{radius:re(),style:{...se(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",h]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:W.map((r,i)=>e.jsx("div",{className:"flex",children:e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(It,{title:r.title,items:r.items,users:d,icon:r.icon,color:r.color})})})},r.title))}),_&&e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(M,{radius:re(),style:se(),onMouseEnter:r=>{r.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",r.currentTarget.style.borderRadius="var(--borderRadius, 12px)",r.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:r=>{r.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",r.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(fe,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(at,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(ne,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Fe,{className:"w-4 h-4"}),_.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(de,{className:"w-4 h-4"}),new Date(_.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(_.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ft,{className:"w-4 h-4"}),_.description]})]})})})]})})})]})},Rt=({title:s,value:t,icon:c,color:l,isLoaded:o,testId:h})=>e.jsx(O.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(M,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:u=>{u.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${l} 50%, transparent)`,u.currentTarget.style.borderRadius="var(--borderRadius, 12px)",u.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:u=>{u.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",u.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(ue,{className:"rounded-lg",isLoaded:o,"data-testid":h,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${s} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${l} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${l} 25%, transparent)`},children:e.jsx(c,{className:"w-6 h-6 stroke-2",style:{color:l},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof t=="number"?t.toLocaleString():t})})]})})})})}),Tt=()=>{const[s,t]=a.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[c,l]=a.useState(!0),[o,h]=a.useState(null);a.useEffect(()=>{let d=!0;const g=new AbortController;return(async()=>{var w;try{l(!0),h(null);const j=await Y.get(route("stats"),{signal:g.signal,timeout:1e4});if(d&&((w=j.data)!=null&&w.statistics))t(j.data.statistics);else throw new Error("Invalid response structure")}catch(j){d&&!g.signal.aborted&&(console.error("Failed to fetch statistics:",j),h(j.message),t({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{d&&l(!1)}})(),()=>{d=!1,g.abort()}},[]);const u=[{id:"total-daily-works",title:"Total Daily Works",value:s.total,icon:ot,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:s.completed,icon:pe,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:s.pending,icon:B,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:s.rfi_submissions,icon:me,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return o?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(M,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",o]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:u.map((d,g)=>e.jsx("div",{className:"w-full",children:e.jsx(Rt,{title:d.title,value:d.value,icon:d.icon,color:d.color,isLoaded:!c,testId:d.testId})},d.id))})})})},Lt=(s,t)=>{let c;return function(...o){const h=()=>{clearTimeout(c),s(...o)};clearTimeout(c),c=setTimeout(h,t)}},Dt=()=>{const[s,t]=a.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),c=a.useCallback(()=>{const l=window.innerWidth,o={isMobile:l<=768,isTablet:l>768&&l<=1024,isDesktop:l>1024};t(h=>JSON.stringify(h)!==JSON.stringify(o)?o:h)},[]);return a.useEffect(()=>{c();const l=Lt(c,150);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[c]),s},D={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Se=X.memo(()=>{var W;const{auth:s}=be().props,t=s.user,{isMobile:c,isTablet:l}=Dt(),[o,h]=a.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[u,d]=a.useState({status:D.CHECKING,coordinates:null,error:null,lastUpdate:null}),[g,I]=a.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[w,j]=a.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),A=a.useCallback(()=>new Promise((r,i)=>{if(!navigator.geolocation){i(new Error("Geolocation is not supported by this browser"));return}const F={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(x=>{const b={latitude:x.coords.latitude,longitude:x.coords.longitude,accuracy:x.coords.accuracy,timestamp:new Date(x.timestamp)};r(b)},x=>{let b="Location unavailable";switch(x.code){case 1:b="Location access denied. Please allow location permission in your browser settings.";break;case 2:b="Location unavailable. Please ensure GPS is enabled.";break;case 3:b="Location request timed out. Please try again.";break;default:b="Unable to retrieve location. Please try again."}i(new Error(b))},F)}),[]),_=a.useCallback(async()=>{d(r=>({...r,status:D.CHECKING,error:null}));try{const r=await A();d({status:D.ACTIVE,coordinates:r,error:null,lastUpdate:new Date})}catch(r){const i=r.message.includes("denied")||r.message.includes("Permission");d({status:i?D.DENIED:D.INACTIVE,coordinates:null,error:r.message,lastUpdate:new Date})}},[A]),R=a.useCallback(async()=>{if(u.status===D.DENIED)try{d(i=>({...i,status:D.CHECKING,error:null}));const r=await A();d({status:D.ACTIVE,coordinates:r,error:null,lastUpdate:new Date}),G.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{d(i=>({...i,status:D.DENIED,error:"Location access still denied. Please check your browser settings."})),G.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[u.status,A]),v=a.useMemo(()=>{if(o.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(te,{className:"w-4 h-4"})};switch(o.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(xt,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(vt,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(B,{className:"w-4 h-4"})}}},[o.currentStatus,o.userOnLeave]),f=a.useMemo(()=>({sessionsToday:o.todayPunches.length,averageSessionTime:o.todayPunches.length>0?Math.round(parseFloat(o.realtimeWorkTime.split(":")[0])/o.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(o.realtimeWorkTime.split(":")[0])/8*100)}),[o.todayPunches,o.realtimeWorkTime]),n=a.useMemo(()=>{var r;switch(u.status){case D.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case D.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (¬±${Math.round(((r=u.coordinates)==null?void 0:r.accuracy)||0)}m)`};case D.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case D.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[u.status,(W=u.coordinates)==null?void 0:W.accuracy]),m=a.useCallback(()=>{const r=new Date;let i=0,F=!1;if(o.todayPunches.forEach(y=>{if(y.punchin_time){let T;try{if(T=new Date(y.punchin_time),isNaN(T.getTime())||typeof y.punchin_time=="string"&&y.punchin_time.includes(":")&&!y.punchin_time.includes("T")){const E=new Date,[V,Z,oe]=y.punchin_time.split(":");T=new Date(E.getFullYear(),E.getMonth(),E.getDate(),parseInt(V),parseInt(Z),parseInt(oe||0))}}catch{console.warn("Invalid punch in time format:",y.punchin_time);return}if(isNaN(T.getTime()))return;if(y.punchout_time){let E;try{if(E=new Date(y.punchout_time),isNaN(E.getTime())||typeof y.punchout_time=="string"&&y.punchout_time.includes(":")&&!y.punchout_time.includes("T")){const Z=new Date,[oe,Ie,Ee]=y.punchout_time.split(":");E=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate(),parseInt(oe),parseInt(Ie),parseInt(Ee||0))}}catch{console.warn("Invalid punch out time format:",y.punchout_time);return}if(isNaN(E.getTime()))return;const V=Math.floor((E-T)/1e3);V>0&&(i+=V)}else{F=!0;const E=Math.floor((r-T)/1e3);E>0&&(i+=E)}}}),!F&&o.totalWorkTime&&o.totalWorkTime!=="00:00:00"){h(y=>({...y,realtimeWorkTime:o.totalWorkTime}));return}(isNaN(i)||i<0)&&(i=0);const x=Math.floor(i/3600),b=Math.floor(i%3600/60),S=i%60,U=`${x.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`;h(y=>({...y,realtimeWorkTime:U}))},[o.todayPunches,o.totalWorkTime]),p=a.useCallback(async()=>{try{const i=(await Y.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;h(F=>({...F,todayPunches:i.punches||[],totalWorkTime:i.total_production_time||"00:00:00",realtimeWorkTime:i.total_production_time||"00:00:00",userOnLeave:i.isUserOnLeave,lastRefresh:new Date,currentStatus:i.punches&&i.punches.length>0?i.punches[i.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(r){console.error("Error fetching current status:",r),G.error("Failed to fetch attendance status")}},[]),N=a.useCallback(()=>{const r=document.createElement("canvas"),i=r.getContext("2d");return i.textBaseline="top",i.font="14px Arial",i.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:r.toDataURL(),timestamp:Date.now()}},[]),k=a.useCallback(async()=>{if(o.userOnLeave){G.warning("You are on leave today. Cannot punch in/out.");return}if(u.status!==D.ACTIVE){G.error("Location access required for attendance. Please enable GPS and try again.");return}h(r=>({...r,loading:!0}));try{const r=await A(),i=N();let F="Unknown";try{F=(await Y.get(route("getClientIp"))).data.ip}catch(S){console.warn("Could not fetch IP address:",S)}j(S=>({...S,sessionInfo:{ip:F,accuracy:r.accuracy?`${Math.round(r.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const x={lat:r.latitude,lng:r.longitude,accuracy:r.accuracy,ip:F,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(i),user_agent:navigator.userAgent,timestamp:new Date().toISOString()},b=await Y.post(route("attendance.punch"),x);b.data.status==="success"?(I(S=>({...S,sessionDialogOpen:!0})),setTimeout(()=>{p()},500)):G.error(b.data.message)}catch(r){console.error("Punch operation failed:",r);const i=r.response.data.message||"Unable to record attendance. Please try again.";G.error(i,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{h(r=>({...r,loading:!1}))}},[o.userOnLeave,u.status,A,N,p]),C=a.useCallback(()=>{n.clickable&&(u.status===D.DENIED?R():u.status===D.INACTIVE&&_())},[n.clickable,u.status,R,_]),$=a.useCallback(r=>{if(!r)return"--:--";try{let i;if(typeof r=="string"&&r.includes(":")&&!r.includes("T")){const F=new Date,[x,b,S]=r.split(":");i=new Date(F.getFullYear(),F.getMonth(),F.getDate(),parseInt(x),parseInt(b),parseInt(S||0))}else i=new Date(r);return isNaN(i.getTime())?"--:--":i.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),P=a.useCallback(r=>{var i,F;if(!r)return"Location not available";try{if(typeof r=="object"&&r.lat&&r.lng)return(i=r.address)!=null&&i.trim()?r.address.substring(0,30):`${r.lat.toFixed(4)}, ${r.lng.toFixed(4)}`;if(typeof r=="string")try{const x=JSON.parse(r);if(x.lat&&x.lng)return(F=x.address)!=null&&F.trim()?x.address.substring(0,30):`${x.lat.toFixed(4)}, ${x.lng.toFixed(4)}`}catch{return r.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return a.useEffect(()=>{const r=setInterval(()=>{j(i=>({...i,currentTime:new Date})),o.currentStatus==="punched_in"&&o.todayPunches.length>0&&m()},1e3);return()=>clearInterval(r)},[o.currentStatus,o.todayPunches.length,m]),a.useEffect(()=>{p(),_();const r=()=>{j(x=>({...x,connectionStatus:{...x.connectionStatus,network:!0}})),p()},i=()=>{j(x=>({...x,connectionStatus:{...x.connectionStatus,network:!1}}))},F=()=>{p(),_()};return window.addEventListener("online",r),window.addEventListener("offline",i),window.addEventListener("focus",F),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",i),window.removeEventListener("focus",F)}},[p,_]),a.useEffect(()=>{const r=setInterval(()=>{p()},3e4);return()=>clearInterval(r)},[p]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(M,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(ne,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(Ge,{content:"",color:v.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(Be,{src:(t==null?void 0:t.profile_image_url)||(t==null?void 0:t.profile_image),name:t==null?void 0:t.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate",style:{color:"var(--theme-foreground)"},children:t==null?void 0:t.name}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:["ID: ",(t==null?void 0:t.employee_id)||(t==null?void 0:t.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:w.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:w.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(J,{color:v.color,variant:"flat",startContent:v.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:v.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(M,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(B,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:o.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(M,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Ve,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:f.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(ce,{color:v.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:k,isDisabled:o.loading||o.userOnLeave||u.status!==D.ACTIVE,isLoading:o.loading,startContent:!o.loading&&v.icon,className:"mb-4 font-semibold",style:{background:o.userOnLeave||u.status!==D.ACTIVE?"var(--theme-default, #71717A)":v.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":v.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":v.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading||o.userOnLeave||u.status!==D.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:o.loading?"Processing...":v.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(ie,{content:n.tooltip,children:e.jsx(J,{size:"sm",variant:n.variant,color:n.color,startContent:u.status===D.CHECKING?e.jsx(le,{size:"sm",className:"w-3 h-3"}):e.jsx(Q,{className:"w-3 h-3"}),className:`text-xs transition-all ${n.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:n.clickable?C:void 0,children:n.text})}),e.jsx(ie,{content:`Network: ${w.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(J,{size:"sm",variant:"flat",color:w.connectionStatus.network?"success":"default",startContent:e.jsx(bt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(ie,{content:"Device Security",children:e.jsx(J,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(lt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),u.error&&u.status!==D.ACTIVE&&e.jsx(M,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:u.error})]})}),o.userOnLeave&&e.jsx(M,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",o.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(o.userOnLeave.from_date).toLocaleDateString()," - ",new Date(o.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(Ae,{children:e.jsx($e,{"aria-label":"Today's Activity",startContent:e.jsx(it,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[f.sessionsToday," sessions ‚Ä¢ ",o.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:o.todayPunches.length>0?o.todayPunches.map((r,i)=>e.jsx(M,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:$(r.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Q,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:P(r.punchin_location)})]})]})]}),r.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:$(r.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Q,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:P(r.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(B,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),r.duration&&e.jsx(J,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:r.duration})]})},i)):e.jsxs(M,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Fe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(Ze,{isOpen:g.sessionDialogOpen,onOpenChange:r=>I(i=>({...i,sessionDialogOpen:r})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(qe,{children:r=>e.jsxs(e.Fragment,{children:[e.jsxs(Je,{className:"flex flex-col gap-1 text-center",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Ke,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(M,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ct,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:w.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(M,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Q,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:w.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(M,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",w.sessionInfo.timestamp]})]})})]}),e.jsx(dt,{children:e.jsx(ce,{color:"primary",variant:"shadow",fullWidth:!0,onPress:r,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})})]})});Se.displayName="PunchStatusCard";function At({auth:s}){const[t,c]=a.useState(!1),[l,o]=a.useState(!1),[h,u]=a.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),d={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},g={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},I={hidden:{opacity:0,y:30,scale:.9},visible:v=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:v*.15,ease:"easeOut"}})},w=v=>s.permissions&&s.permissions.includes(v),j=v=>v.some(f=>w(f)),A=v=>v.every(f=>w(f)),_=()=>{c(v=>!v),o(v=>!v)},R=v=>{const f=v.target.value;u(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(f))),o(n=>!n),c(n=>!n)};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"Dashboard"}),e.jsx(O.div,{variants:d,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(O.div,{variants:g,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[A(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(O.div,{variants:I,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Se,{handlePunchSuccess:_})},"punch-status-card")},"punch-status-grid"),w("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(O.div,{variants:I,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Tt,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),j(["attendance.view","employees.view"])&&e.jsxs(O.div,{variants:d,initial:"hidden",animate:"visible",children:[e.jsx(O.div,{variants:I,custom:2,children:e.jsx(Me,{selectedDate:h,handleDateChange:R,updateTimeSheet:l})},"timesheet-section"),e.jsx(O.div,{variants:I,custom:3,children:e.jsx(St,{selectedDate:h,updateMap:t})},"user-locations-section")]}),w("core.updates.view")&&e.jsx(O.div,{variants:I,custom:4,initial:"hidden",animate:"visible",children:e.jsx(Et,{})},"updates-section")]})})]})}At.layout=s=>e.jsx(Ye,{children:s});export{At as default};
