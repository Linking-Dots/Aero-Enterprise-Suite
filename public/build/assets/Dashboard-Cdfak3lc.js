import{l as Je,r,n as Ie,ar as Xe,k as Ye,j as e,R as ce,a as Qe,c as Z,i as We,d as ye,s as we,f as ae,u as Ue,b as le,t as et,v as tt,F as Pe,H as rt}from"./app-C4YbM0cY.js";import{T as at}from"./TimeSheetTable-BSjOTKIA.js";import{I as st,J as nt,K as ot,w as ze,p as ge,F as je,L as it,M as lt,h as Ne,N as ct,P as dt,k as ut,c as Re,e as Ee,f as Le,g as Te,A as mt}from"./Dashboard-DNnRqyii.js";import{S as ht}from"./StatsCards-2DajQPXQ.js";import{M as pt,T as ft,u as Ce,L as O}from"./leaflet-C7UR-zul.js";import"./leaflet-routing-machine-CcEEmJXT.js";import{m as K}from"./proxy-Bxc3-vSH.js";import{c as _e}from"./createLucideIcon-CEOsjYPm.js";import{U as gt}from"./users-8me-tHe5.js";import{M as xt}from"./map-pin-HQRyi6SQ.js";import{c as Se}from"./chunk-D5XJWRAV-BSxR7J2f.js";import{d as ee}from"./dayjs.min--UtnRPtn.js";import{i as yt}from"./isBetween-DJPlkhx-.js";import{F as he}from"./ExclamationTriangleIcon-Be9HgShS.js";import{F as se}from"./ClockIcon-DJjegmaw.js";import{F as Be}from"./UserGroupIcon-ChPrGxyW.js";import{F as vt}from"./SunIcon-DnwJK3Iw.js";import{F as Fe}from"./InformationCircleIcon-4GwuQSuf.js";import{F as $e}from"./UserIcon-DNNIiygE.js";import{F as bt}from"./XCircleIcon-BDXVJ45C.js";import{F as xe}from"./CheckCircleIcon-CuTslx_W.js";import{s as ke}from"./chunk-TLYTI3QM-zjNCnlua.js";import{c as ie}from"./chunk-IHOGUXIG-BeDIbgAV.js";import{F as wt}from"./ClipboardDocumentListIcon-BChHbR_A.js";import{B as X}from"./react-toastify.esm-93-yPS2R.js";import{a as me,F as jt}from"./MapPinIcon-BJIAvbnu.js";import{F as Nt}from"./WifiIcon-H2NBOykC.js";import{F as Ft}from"./ShieldCheckIcon-S2KchRHG.js";import{t as be,F as kt}from"./XMarkIcon-D7WQrQEO.js";import{m as De}from"./chunk-O5MCAK4F-CNxiP6Me.js";import"./PageHeader-vz-bE3eI.js";import"./MagnifyingGlassIcon-CcSZ7eOY.js";import"./UserPlusIcon-030qwkDz.js";import"./chunk-SSA7SXE4-DT25SwRj.js";import"./DocumentArrowDownIcon-C0r0RmI6.js";import"./chunk-JOT4BT4P-DsA5KBKO.js";import"./chunk-Y2AYO5NJ-DDorzfY7.js";import"./chunk-F3UDT23P-BO2Le-zd.js";import"./chunk-XJ2YRSUP-DeAeOtef.js";import"./useToggleState-B09K58Gv.js";import"./chunk-YRZGWF2W-CieaW2nn.js";import"./chunk-APIAPHLK-D-NB9IVL.js";import"./chunk-S574QCAN-Hp7YwJKa.js";import"./EnvelopeIcon-CsCf303n.js";import"./KeyIcon-CBqi7GR8.js";import"./index-w-nm4fre.js";import"./logo-Pwvcz7fP.js";import"./create-visual-element-lu0LZd4h.js";function Ct(a={}){const{as:t,ref:d,max:u=5,total:n,size:h,color:m,radius:f,children:N,isBordered:w,isDisabled:F,isGrid:k,renderCount:j,className:P,classNames:T,...b}=a,p=Je(d),y=t||"div",s=r.useMemo(()=>({size:h,color:m,radius:f,isGrid:k,isBordered:w,isDisabled:F}),[h,m,f,k,w,F]),l=r.useMemo(()=>st({className:P,isGrid:k}),[P,k]),i=nt(N),C=u?i.slice(0,u):i,v=n||(u!=null?i.length-u:-1),D=C.map((g,I)=>{const R=I===0,E=I===C.length-1,B={className:Ie(R?"ms-0":k?"":"-ms-2",E&&v<1?"hover:-translate-x-0":"")};return r.cloneElement(g,Xe(B))});return{Component:y,context:s,remainingCount:v,clones:D,renderCount:j,getAvatarGroupProps:()=>({ref:p,className:l.base({class:Ie(T==null?void 0:T.base,P)}),role:"group",...b}),getAvatarGroupCountProps:()=>({className:l.count({class:T==null?void 0:T.count})})}}var He=Ye((a,t)=>{const{Component:d,clones:u,context:n,remainingCount:h,getAvatarGroupCountProps:m,getAvatarGroupProps:f,renderCount:N=w=>e.jsx(ze,{...m(),name:`+${w}`})}=Ct({...a,ref:t});return e.jsx(d,{...f(),children:e.jsxs(ot,{value:n,children:[u,h>0&&N(h)]})})});He.displayName="HeroUI.AvatarGroup";var _t=He;function St({title:a,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const It=r.forwardRef(St);function Pt({title:a,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const Ae=r.forwardRef(Pt);function Rt({title:a,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const Et=r.forwardRef(Rt);function Lt({title:a,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const Tt=r.forwardRef(Lt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Dt=_e("clock-4",$t);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Me=_e("map",At);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ot=_e("refresh-cw",Mt);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(a){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=a,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(a){L.DomEvent.stopPropagation(a),L.DomEvent.preventDefault(a),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(a){var t=this.getContainer();this.isFullscreen()?a&&a.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):a&&a.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(a){L.DomUtil.addClass(a,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(a){L.DomUtil.removeClass(a,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(a){this._isFullscreen=a;var t=this.getContainer();a?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(a){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var a;if("onfullscreenchange"in document?a="fullscreenchange":"onmozfullscreenchange"in document?a="mozfullscreenchange":"onwebkitfullscreenchange"in document?a="webkitfullscreenchange":"onmsfullscreenchange"in document&&(a="MSFullscreenChange"),a){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,a,t)}),this.on("unload",function(){L.DomEvent.off(document,a,t)})}});L.control.fullscreen=function(a){return new L.Control.Fullscreen(a)};const Y=(a,t)=>{if(a.startsWith("var("))return`color-mix(in srgb, ${a} ${t*100}%, transparent)`;if(a.startsWith("#")){const d=a.replace("#",""),u=parseInt(d.substr(0,2),16),n=parseInt(d.substr(2,2),16),h=parseInt(d.substr(4,2),16);return`rgba(${u}, ${n}, ${h}, ${t})`}return a.replace(/[\d.]+\)$/g,`${t})`)},Wt=()=>{var u;const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},q={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:300},Oe={lat:23.8103,lng:90.4125},Ge=ce.memo(({attendanceTypeConfigs:a,theme:t})=>{const d=Ce(),u=r.useRef([]);return r.useEffect(()=>{if(!d||!(a!=null&&a.length))return;d.eachLayer(h=>{h.options&&(h.options.isAttendanceBoundary||h.options.isPolygon||h.options.isRoute)&&d.removeLayer(h)}),u.current.forEach(h=>{try{d.removeControl(h)}catch(m){console.warn("Error removing routing control:",m)}}),u.current=[],d.getContainer().querySelectorAll(".leaflet-routing-container").forEach(h=>h.remove());const n=[];if(a.forEach((h,m)=>{var j;const{base_slug:f,config:N,name:w}=h;(j=t==null?void 0:t.customColors)!=null&&j.primary;const F=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],k=F[m%F.length];if(f==="geo_polygon"&&N){const P=N.polygon||[],T=N.polygons||[];if(P.length>=3){const b=P.filter(p=>p.lat&&p.lng);if(b.length>=3){const p=b.map(s=>[parseFloat(s.lat),parseFloat(s.lng)]),y=O.polygon(p,{color:k,fillColor:k,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);y.bindPopup(`
                            <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                <strong style="color: ${k};">${w}</strong><br>
                                <small>Geofence Zone</small><br>
                                <small>Points: ${b.length}</small>
                            </div>
                        `),n.push(y.getBounds())}}T.forEach((b,p)=>{const y=b.points||[];if(y.length>=3){const s=y.filter(l=>l.lat&&l.lng);if(s.length>=3){const l=s.map(C=>[parseFloat(C.lat),parseFloat(C.lng)]),i=O.polygon(l,{color:k,fillColor:k,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);i.bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${k};">${w}</strong><br>
                                    <small>${b.name||`Zone ${p+1}`}</small>
                                </div>
                            `),n.push(i.getBounds())}}})}if(f==="route_waypoint"&&N){const P=N.waypoints||[],T=N.routes||[];if(P.length>=2){const b=P.filter(p=>p.lat&&p.lng);if(b.length>=2){const p=b.map(y=>O.latLng(parseFloat(y.lat),parseFloat(y.lng)));b.forEach((y,s)=>{const l=s===0,i=s===b.length-1,C=`
                                <div style="
                                    width: 24px;
                                    height: 24px;
                                    border-radius: 50%;
                                    background: ${l?"#10b981":i?"#ef4444":k};
                                    border: 2px solid white;
                                    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-weight: bold;
                                    font-size: 11px;
                                ">
                                    ${s+1}
                                </div>
                            `;O.marker([parseFloat(y.lat),parseFloat(y.lng)],{icon:O.divIcon({html:C,className:"route-waypoint-marker",iconSize:[24,24],iconAnchor:[12,12]}),isAttendanceBoundary:!0}).addTo(d).bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${k};">${w}</strong><br>
                                    <small>Waypoint ${s+1}${y.name?`: ${y.name}`:""}</small>
                                </div>
                            `)});try{const y=O.Routing.control({waypoints:p,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:k,weight:4,opacity:.7,dashArray:"8, 4"}],extendToWaypoints:!0,missingRouteTolerance:0},show:!1,fitSelectedRoutes:!1,router:O.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);u.current.push(y);const s=O.latLngBounds(p);n.push(s)}catch(y){console.warn("Error creating route:",y);const s=O.polyline(p,{color:k,weight:3,opacity:.6,dashArray:"10, 10",isAttendanceBoundary:!0,isRoute:!0}).addTo(d);n.push(s.getBounds())}}}T.forEach((b,p)=>{const y=b.waypoints||[];if(y.length>=2){const s=y.filter(l=>l.lat&&l.lng);if(s.length>=2){const l=s.map(i=>O.latLng(parseFloat(i.lat),parseFloat(i.lng)));try{const i=O.Routing.control({waypoints:l,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:k,weight:4,opacity:.7,dashArray:"8, 4"}]},show:!1,fitSelectedRoutes:!1,router:O.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);u.current.push(i),n.push(O.latLngBounds(l))}catch(i){console.warn("Error creating route:",i)}}}})}}),n.length>0){const h=n.reduce((m,f)=>m?m.extend(f):f,null);h&&h.isValid()&&setTimeout(()=>{d.fitBounds(h,{padding:[50,50],maxZoom:14})},500)}return()=>{u.current.forEach(h=>{try{d.removeControl(h)}catch{}}),u.current=[]}},[d,a,t]),null});Ge.displayName="AttendanceTypeBoundaries";const Ut=ce.memo(({startLocation:a,endLocation:t,theme:d})=>{const u=Ce();return r.useEffect(()=>{var h;if(!u||!a||!t)return;const n=O.Routing.control({waypoints:[O.latLng(a.lat,a.lng),O.latLng(t.lat,t.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((h=d==null?void 0:d.customColors)==null?void 0:h.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(u);return()=>{u&&n&&u.removeControl(n)}},[u,a,t,d]),null});Ut.displayName="RoutingMachine";const Ve=ce.memo(({selectedDate:a,onUsersLoad:t,theme:d,lastUpdate:u,users:n,setUsers:h,setLoading:m,setError:f,setAttendanceTypeConfigs:N})=>{const w=Ce(),F=r.useRef([]),k=r.useCallback(async()=>{if(!a){m(!1),h([]),N==null||N([]),t==null||t([]);return}m(!0),f(null);try{const s=route("getUserLocationsForDate",{date:a,_t:Date.now()}),i=(await axios.get(s)).data;if(!i.success||!Array.isArray(i.locations))throw new Error("Unexpected response format from server.");const C=i.locations,v=i.attendance_type_configs||[];JSON.stringify(C)!==JSON.stringify(F.current)&&(h(C),F.current=C),N==null||N(v),t==null||t(C)}catch(s){let l="Error fetching user locations.";s.response?(l+=` Server error (${s.response.status}): ${s.response.statusText}`,typeof s.response.data=="object"&&(l+=`
Details: ${JSON.stringify(s.response.data)}`)):s.request?l+=" No response received from server.":s.message&&(l+=` ${s.message}`),console.error(l,s),f(l),h([]),t==null||t([])}finally{m(!1)}},[a,t,u]);r.useEffect(()=>{k()},[k]);const j=r.useCallback((s,l)=>{const i=q.OFFSET_MULTIPLIER*l;return{lat:s.lat+i,lng:s.lng+i}},[]),P=r.useCallback((s,l)=>Math.abs(s.lat-l.lat)<q.POSITION_THRESHOLD&&Math.abs(s.lng-l.lng)<q.POSITION_THRESHOLD,[]),T=r.useCallback(s=>{if(!s)return null;if(typeof s=="object"&&s.lat&&s.lng){const l=parseFloat(s.lat),i=parseFloat(s.lng);return isNaN(l)||isNaN(i)?null:{lat:l,lng:i}}if(typeof s=="string")try{const l=JSON.parse(s);if(l.lat&&l.lng){const i=parseFloat(l.lat),C=parseFloat(l.lng);return isNaN(i)||isNaN(C)?null:{lat:i,lng:C}}}catch{const i=s.split(",");if(i.length>=2){const C=parseFloat(i[0].trim()),v=parseFloat(i[1].trim());return isNaN(C)||isNaN(v)?null:{lat:C,lng:v}}}return null},[]),b=r.useCallback(s=>{if(!s)return"Not recorded";try{let l;return s.includes("T")?l=new Date(s):l=new Date(`${a}T${s}`),isNaN(l.getTime())?"Invalid time":l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(l){return console.warn("Error formatting time:",l),s}},[a]),p=r.useCallback((s,l="default")=>{var R,E,B,G;const i="var(--theme-primary, #3b82f6)",C="var(--theme-secondary, #8b5cf6)",v="var(--theme-success, #17C964)",D="var(--theme-danger, #ef4444)";let _,A,g="";l==="punchin"?(_=`${v}, #059669`,A=Y(v,.4),g='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚ñ∂</span>'):l==="punchout"?(_=`${D}, #dc2626`,A=Y(D,.4),g='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚óº</span>'):(_=`${i}, ${C}`,A=Y(i,.4));const I=`
            <div style="
                position: relative;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${_});
                border: 3px solid white;
                box-shadow: 0 4px 12px ${A};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${s.profile_image_url||s.profile_image?`<img src="${s.profile_image_url||s.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((E=(R=s.name)==null?void 0:R.charAt(0))==null?void 0:E.toUpperCase())||"?"}';" />`:((G=(B=s.name)==null?void 0:B.charAt(0))==null?void 0:G.toUpperCase())||"?"}
                ${g}
            </div>
        `;return O.divIcon({html:I,className:"user-marker-icon",iconSize:q.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),y=r.useCallback((s,l="combined")=>{var U,V,te,re;const i=s.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",C="var(--theme-primary, #3b82f6)",v="var(--theme-secondary, #8b5cf6)",D="var(--theme-success, #17C964)",_="var(--theme-danger, #ef4444)",A="var(--theme-content1, #ffffff)",g="var(--theme-foreground, #1f2937)",I="var(--theme-content3, #6b7280)";let R=null,E="";l==="punchin"&&s.punchin_photo_url?(R=s.punchin_photo_url,E="Check In Photo"):l==="punchout"&&s.punchout_photo_url&&(R=s.punchout_photo_url,E="Check Out Photo");const B=R?`
            <div style="margin-top: 12px; margin-bottom: 12px;">
                <div style="color: ${I}; font-size: 11px; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">
                    ${E}
                </div>
                <img 
                    src="${R}" 
                    style="
                        width: 100%; 
                        height: auto;
                        object-fit: contain; 
                        border-radius: 8px;
                        border: 1px solid ${Y(C,.2)};
                        background: rgba(0,0,0,0.02);
                    " 
                    onerror="this.style.display='none';"
                />
            </div>
        `:"";let G="",W=C;l==="punchin"?(G=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Y(D,.1)};
                    color: ${D};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Y(D,.2)};
                ">CHECK IN</div>
            `,W=D):l==="punchout"&&(G=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Y(_,.1)};
                    color: ${_};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Y(_,.2)};
                ">CHECK OUT</div>
            `,W=_);let $="";return l==="punchin"?$=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${D}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Time: ${b(s.punchin_time)}
                    </span>
                </div>
            `:l==="punchout"?$=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${_}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Time: ${b(s.punchout_time)}
                    </span>
                </div>
            `:$=`
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="color: ${D}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Check In: ${b(s.punchin_time)}
                    </span>
                </div>
                <div style="display: flex; align-items: center;">
                    <span style="color: ${_}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Check Out: ${b(s.punchout_time)}
                    </span>
                </div>
            `,`
            <div style="
                min-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, ${Y(A,.95)}, ${Y(W,.05)});
                border-radius: 12px;
                border: 1px solid ${Y(W,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            ">
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                    <div style="
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${l==="punchin"?D:l==="punchout"?_:C}, ${v});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        margin-right: 12px;
                    ">
                        ${s.profile_image_url||s.profile_image?`<img src="${s.profile_image_url||s.profile_image}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((V=(U=s.name)==null?void 0:U.charAt(0))==null?void 0:V.toUpperCase())||"?"}';" />`:((re=(te=s.name)==null?void 0:te.charAt(0))==null?void 0:re.toUpperCase())||"?"}
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center;">
                            <span style="font-weight: 600; color: ${g}; font-size: 16px;">
                                ${s.name||"Unknown User"}
                            </span>
                            ${G}
                        </div>
                        <div style="color: ${I}; font-size: 12px;">
                            ${s.designation||"No designation"}
                        </div>
                    </div>
                </div>
                ${l==="combined"?`
                <div style="
                    display: inline-block;
                    padding: 4px 8px;
                    background: ${Y(i,.1)};
                    color: ${i};
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid ${Y(i,.2)};
                ">
                    ${s.punchout_time?"‚úì Completed":"‚è± Active"}
                </div>`:""}
                ${B}
                <div style="space-y: 8px;">
                    ${$}
                </div>
            </div>
        `},[b]);return r.useEffect(()=>{if(!w||!n.length)return;w.eachLayer(i=>{(i instanceof O.Marker&&i.options.userData||i instanceof O.Polyline&&i.options.userRoute)&&w.removeLayer(i)});const s=[],l=i=>{let C={...i},v=0;const D=10;for(;v<D&&s.some(A=>P(C,A));)C=j(i,v+1),v++;return s.push(C),C};n.forEach(i=>{const C=i.cycles||[];if(C.length>0)C.forEach((v,D)=>{const _=T(v.punchin_location),A=T(v.punchout_location);if(!_&&!A)return;const g=_&&A&&v.is_complete,I={...i,punchin_time:v.punchin_time,punchout_time:v.punchout_time,punchin_photo_url:v.punchin_photo_url,punchout_photo_url:v.punchout_photo_url};if(g){const R=l(_),E=l(A),B=O.marker([R.lat,R.lng],{icon:p(i,"punchin"),userData:!0});B.bindPopup(y(I,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),B.addTo(w);const G=O.marker([E.lat,E.lng],{icon:p(i,"punchout"),userData:!0});G.bindPopup(y(I,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),G.addTo(w),O.polyline([[R.lat,R.lng],[E.lat,E.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const E=l(_||A),B=_?"punchin":"punchout",G=O.marker([E.lat,E.lng],{icon:p(i,B),userData:!0});G.bindPopup(y(I,B),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),G.addTo(w)}});else{const v=T(i.punchin_location),D=T(i.punchout_location);if(!v&&!D)return;if(v&&D&&i.punchout_time){const A=l(v),g=l(D),I=O.marker([A.lat,A.lng],{icon:p(i,"punchin"),userData:!0});I.bindPopup(y(i,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),I.addTo(w);const R=O.marker([g.lat,g.lng],{icon:p(i,"punchout"),userData:!0});R.bindPopup(y(i,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(w),O.polyline([[A.lat,A.lng],[g.lat,g.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const g=l(v||D),I=v?"punchin":"punchout",R=O.marker([g.lat,g.lng],{icon:p(i,I),userData:!0});R.bindPopup(y(i,I),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(w)}}})},[w,n,d,T,P,j,p,y]),null});Ve.displayName="UserMarkers";const zt=a=>r.useMemo(()=>{const t=a.reduce((m,f)=>{const N=f.user_id;return m[N]||(m[N]=[]),m[N].push(f),m},{}),d=Object.keys(t),u=d.length;let n=0,h=0;return d.forEach(m=>{const f=t[m];f.sort((F,k)=>F.punchin_time?k.punchin_time?F.punchin_time.localeCompare(k.punchin_time):-1:1);const N=f[f.length-1];f.some(F=>F.punchin_time)&&(N.punchout_time?h++:n++)}),{checkedIn:n,completed:h,total:u}},[a]),Bt=ce.memo(({updateMap:a,selectedDate:t})=>{const{themeSettings:d}=Qe(),u=ge("(min-width: 1025px)"),n=ge("(min-width: 641px) and (max-width: 1024px)"),[h,m]=r.useState([]),[f,N]=r.useState([]),[w,F]=r.useState(!0),[k,j]=r.useState(null),[P,T]=r.useState(!1),[b,p]=r.useState(null),[y,s]=r.useState(!0),[l,i]=r.useState(0),C=window.innerWidth<640,[v,D]=r.useState(new Date),_=r.useRef([]),A=r.useRef(null),g=r.useCallback(async()=>{F(!0);try{const W=route("getUserLocationsForDate",{date:t,_t:Date.now()});if(!t){m([]),N([]),_.current=[],i(re=>re+1),D(new Date),p(new Date);return}const $=await fetch(W);if(!$.ok)throw new Error(`HTTP ${$.status}: Failed to refresh user locations`);const U=await $.json(),V=Array.isArray(U.locations)?U.locations:[],te=Array.isArray(U.attendance_type_configs)?U.attendance_type_configs:[];m(V),N(te),_.current=V,i(re=>re+1),D(new Date),p(new Date)}catch(W){console.error("Error refreshing map:",W),m([]),N([]),_.current=[]}finally{F(!1)}},[t]),I=r.useMemo(()=>{if(!t)return"Invalid Date";try{return new Date(t).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[t]),R=zt(h),E=r.useCallback(async()=>{if(!t){F(!1);return}try{const W=route("check-user-locations-updates",{date:t.split("T")[0]}),$=await fetch(W);if(!$.ok)throw new Error(`HTTP ${$.status}: Failed to check for updates`);const U=await $.json();U.success&&U.last_updated!==A.current&&U.last_updated&&(A.current=U.last_updated,g(),p(new Date)),D(new Date)}catch(W){console.error("Error checking for updates:",W),F(!1)}},[t,g]);r.useEffect(()=>{if(!y)return;E();const W=setInterval(E,5e3);return()=>clearInterval(W)},[y,E]),r.useEffect(()=>{h.length===0&&w&&P&&F(!1)},[h,w,P]),r.useEffect(()=>{if(w){const W=setTimeout(()=>{w&&(console.log("Loading timeout reached, forcing loading to false"),F(!1))},1e4);return()=>clearTimeout(W)}},[w]);const B=r.useMemo(()=>v?v.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[v]),G=r.useCallback(W=>{const $=Array.isArray(W)?W:[];JSON.stringify($)!==JSON.stringify(_.current)&&(m($),_.current=$),T(!0),F(!1)},[]);return e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(Z,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Se,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${u?"p-6":n?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${u?"p-3":n?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(Me,{className:`
                                                    ${u?"w-8 h-8":n?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${u?"text-2xl":n?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${u?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:I})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:B&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",B]})})]})})})}),e.jsx(We,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(ye,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(ht,{className:"mb-6",stats:[{title:"Total",value:R.total,icon:e.jsx(gt,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:R.checkedIn,icon:e.jsx(Dt,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:R.completed,icon:e.jsx(xt,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:C})}),e.jsx("div",{className:"p-6 pt-0",children:h.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(pt,{center:[Oe.lat,Oe.lng],zoom:q.DEFAULT_ZOOM,minZoom:q.MIN_ZOOM,maxZoom:q.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(ft,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:q.MAX_ZOOM,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ge,{attendanceTypeConfigs:f,theme:d}),e.jsx(Ve,{users:h,setUsers:m,setLoading:F,setError:j,setAttendanceTypeConfigs:N,lastUpdate:b,selectedDate:t,onUsersLoad:G,theme:d})]},`${a}-${l}`)]}):w?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Me,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",I,".",t&&new Date(t)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(ae,{variant:"bordered",color:"primary",size:"md",radius:Wt(),onPress:g,startContent:e.jsx(Ot,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})})})});ee.extend(yt);const pe=()=>{var u;if(typeof window>"u")return"lg";const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},fe=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),Ht=({title:a,items:t,users:d,icon:u,color:n})=>{var b;const[h,m]=r.useState(null),[f,N]=r.useState(null),w=(p,y)=>{m(p.currentTarget),N(y)},F=()=>{m(null),N(null)},k=!!h,j=k?"leave-details-popover":void 0,P=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return e.jsx(xe,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(bt,{className:"w-4 h-4 text-danger"});default:return e.jsx(se,{className:"w-4 h-4 text-warning"})}},T=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(Z,{className:"h-full flex flex-col",radius:pe(),style:fe(),onMouseEnter:p=>{p.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${n} 50%, transparent)`,p.currentTarget.style.borderRadius="var(--borderRadius, 12px)",p.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:p=>{p.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",p.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Se,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${n} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${n} 25%, transparent)`},children:e.jsx(u,{className:"w-6 h-6 stroke-2",style:{color:n},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:a})]})}),e.jsx(ye,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:t.map((p,y)=>e.jsxs(ce.Fragment,{children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:y*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:p.text}),p.leaves&&p.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Be,{className:"w-3 h-3"}),p.leaves.length," employee",p.leaves.length>1?"s":""]})]}),p.leaves&&(()=>{const s=p.leaves.filter(l=>l.leave_type===p.type);return s.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(_t,{max:4,isBordered:!0,size:"sm",children:s.map((l,i)=>{const C=d.find(v=>String(v.id)===String(l.user_id));return C&&e.jsx(ze,{src:C.profile_image_url,name:`${C.name} - on leave`,onClick:v=>w(v,l),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e.jsx($e,{className:"w-4 h-4"})},i)})})})})()]}),y<t.length-1&&e.jsx(We,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},y))}),e.jsx(it,{id:j,open:k,anchorEl:h,onClose:F,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(lt,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:f&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((b=d.find(p=>String(p.id)===String(f.user_id)))==null?void 0:b.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.from_date!==f.to_date?`${new Date(f.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(f.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(f.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P(f.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(ie,{label:f.status||"Pending",variant:"flat",color:T(f.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},Gt=()=>{const{auth:a}=Ue().props,t=ge("(min-width: 1025px)"),d=ge("(min-width: 641px) and (max-width: 1024px)"),[u,n]=r.useState(!0),[h,m]=r.useState(null),[f,N]=r.useState([]),[w,F]=r.useState([]),[k,j]=r.useState([]),[P,T]=r.useState(null);r.useEffect(()=>{let g=!0;const I=new AbortController;return(async()=>{try{n(!0),m(null);const E=await le.get(route("updates"),{signal:I.signal,timeout:1e4});g&&E.data&&(N(E.data.users||[]),F(E.data.todayLeaves||[]),j(E.data.upcomingLeaves||[]),T(E.data.upcomingHoliday||null))}catch(E){g&&!I.signal.aborted&&(console.error("Failed to fetch updates:",E),m(E.message),N([]),F([]),j([]),T(null))}finally{g&&n(!1)}})(),()=>{g=!1,I.abort()}},[]);const b=(g,I)=>{let R=I;const E=$=>I.some(V=>String(V.user_id)===String(a.user.id)&&V.leave_type===$)?(R=I.filter(V=>String(V.user_id)!==String(a.user.id)),`You ${g==="today"?"are":"will be"} on ${$} leave.`):null,B=I.reduce(($,U)=>{const V=E(U.leave_type);return V&&!$.some(te=>te.type===U.leave_type)&&$.push({text:V,type:U.leave_type}),$},[]),G=R.reduce(($,U)=>($[U.leave_type]=($[U.leave_type]||0)+1,$),{}),W=Object.entries(G).map(([$,U])=>({text:`${U} person${U>1?"s":""} ${g==="today"?"is":"will be"} on ${$} leave`,type:$,leaves:R.filter(V=>V.leave_type===$)}));return[...B,...W]},p=ee(),y=p.add(1,"day"),s=y.add(7,"day"),l=w.filter(g=>ee(p).isBetween(ee(g.from_date),ee(g.to_date),"day","[]")),i=k.filter(g=>ee(y).isBetween(ee(g.from_date),ee(g.to_date),"day","[]")),C=k.filter(g=>(ee(g.from_date).isBetween(y,s,"day","[]")||ee(g.to_date).isBetween(y,s,"day","[]"))&&!/week/i.test(g.leave_type)),v=b("today",l),D=b("tomorrow",i),_=b("nextSevenDays",C);v.length===0&&v.push({text:"No one is away today."}),D.length===0&&D.push({text:"No one is away tomorrow."}),_.length===0&&_.push({text:"No one is going to be away in the next seven days."});const A=[{title:"Today",items:v,icon:je,color:"#3b82f6"},{title:"Tomorrow",items:D,icon:se,color:"#10b981"},{title:"Next Seven Days",items:_,icon:Be,color:"#f59e0b"}];return u?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((g,I)=>e.jsx("div",{children:e.jsxs(Z,{className:"w-full h-full",radius:pe(),style:fe(),children:[e.jsx(ke,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(ke,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},I))})}):h?e.jsx("div",{className:`${t?"p-6":d?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(Z,{radius:pe(),style:{...fe(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",h]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:A.map((g,I)=>e.jsx("div",{className:"flex",children:e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:I*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(Ht,{title:g.title,items:g.items,users:f,icon:g.icon,color:g.color})})})},g.title))}),P&&e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(Z,{radius:pe(),style:fe(),onMouseEnter:g=>{g.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",g.currentTarget.style.borderRadius="var(--borderRadius, 12px)",g.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:g=>{g.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",g.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Se,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(vt,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(ye,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Fe,{className:"w-4 h-4"}),P.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(je,{className:"w-4 h-4"}),new Date(P.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(P.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(It,{className:"w-4 h-4"}),P.description]})]})})})]})})})]})},Vt=({title:a,value:t,icon:d,color:u,isLoaded:n,testId:h})=>e.jsx(K.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(Z,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:m=>{m.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${u} 50%, transparent)`,m.currentTarget.style.borderRadius="var(--borderRadius, 12px)",m.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:m=>{m.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",m.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(ke,{className:"rounded-lg",isLoaded:n,"data-testid":h,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${a} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:a}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${u} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${u} 25%, transparent)`},children:e.jsx(d,{className:"w-6 h-6 stroke-2",style:{color:u},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof t=="number"?t.toLocaleString():t})})]})})})})}),Zt=()=>{const[a,t]=r.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[d,u]=r.useState(!0),[n,h]=r.useState(null);r.useEffect(()=>{let f=!0;const N=new AbortController;return(async()=>{var F;try{u(!0),h(null);const k=await le.get(route("stats"),{signal:N.signal,timeout:1e4});if(f&&((F=k.data)!=null&&F.statistics))t(k.data.statistics);else throw new Error("Invalid response structure")}catch(k){f&&!N.signal.aborted&&(console.error("Failed to fetch statistics:",k),h(k.message),t({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{f&&u(!1)}})(),()=>{f=!1,N.abort()}},[]);const m=[{id:"total-daily-works",title:"Total Daily Works",value:a.total,icon:wt,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:a.completed,icon:xe,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:a.pending,icon:se,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:a.rfi_submissions,icon:Ne,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return n?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(Z,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",n]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:m.map((f,N)=>e.jsx("div",{className:"w-full",children:e.jsx(Vt,{title:f.title,value:f.value,icon:f.icon,color:f.color,isLoaded:!d,testId:f.testId})},f.id))})})})},qt=(a,t)=>{let d;return function(...n){const h=()=>{clearTimeout(d),a(...n)};clearTimeout(d),d=setTimeout(h,t)}},Kt=()=>{const[a,t]=r.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),d=r.useCallback(()=>{const u=window.innerWidth,n={isMobile:u<=768,isTablet:u>768&&u<=1024,isDesktop:u>1024};t(h=>JSON.stringify(h)!==JSON.stringify(n)?n:h)},[]);return r.useEffect(()=>{d();const u=qt(d,150);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[d]),a},z={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Ze=ce.memo(()=>{var re;const{auth:a}=Ue().props,t=a.user,{isMobile:d,isTablet:u}=Kt(),[n,h]=r.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[m,f]=r.useState({status:z.CHECKING,coordinates:null,error:null,lastUpdate:null}),[N,w]=r.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[F,k]=r.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),[j,P]=r.useState({isOpen:!1,capturedPhoto:null,isCapturing:!1,stream:null,pendingPunchData:null,facingMode:"user",isSwitching:!1}),T=r.useRef(null),b=r.useRef(null),p=r.useMemo(()=>{const o=t==null?void 0:t.attendance_type;if(!(o!=null&&o.slug))return!1;const c=o.slug.replace(/_\d+$/,"");return["geo_polygon","route_waypoint"].includes(c)},[t==null?void 0:t.attendance_type]),y=r.useCallback(()=>new Promise((o,c)=>{if(!navigator.geolocation){c(new Error("Geolocation is not supported by this browser"));return}const x={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(S=>{const H={latitude:S.coords.latitude,longitude:S.coords.longitude,accuracy:S.coords.accuracy,timestamp:new Date(S.timestamp)};o(H)},S=>{let H="Location unavailable";switch(S.code){case 1:H="Location access denied. Please allow location permission in your browser settings.";break;case 2:H="Location unavailable. Please ensure GPS is enabled.";break;case 3:H="Location request timed out. Please try again.";break;default:H="Unable to retrieve location. Please try again."}c(new Error(H))},x)}),[]),s=r.useCallback(async()=>{f(o=>({...o,status:z.CHECKING,error:null}));try{const o=await y();f({status:z.ACTIVE,coordinates:o,error:null,lastUpdate:new Date})}catch(o){const c=o.message.includes("denied")||o.message.includes("Permission");f({status:c?z.DENIED:z.INACTIVE,coordinates:null,error:o.message,lastUpdate:new Date})}},[y]),l=r.useCallback(async()=>{if(m.status===z.DENIED)try{f(c=>({...c,status:z.CHECKING,error:null}));const o=await y();f({status:z.ACTIVE,coordinates:o,error:null,lastUpdate:new Date}),X.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{f(c=>({...c,status:z.DENIED,error:"Location access still denied. Please check your browser settings."})),X.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[m.status,y]),i=r.useMemo(()=>{if(n.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(he,{className:"w-4 h-4"})};switch(n.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(Et,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(Tt,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(se,{className:"w-4 h-4"})}}},[n.currentStatus,n.userOnLeave]),C=r.useMemo(()=>({sessionsToday:n.todayPunches.length,averageSessionTime:n.todayPunches.length>0?Math.round(parseFloat(n.realtimeWorkTime.split(":")[0])/n.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(n.realtimeWorkTime.split(":")[0])/8*100)}),[n.todayPunches,n.realtimeWorkTime]),v=r.useMemo(()=>{var o;switch(m.status){case z.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case z.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (¬±${Math.round(((o=m.coordinates)==null?void 0:o.accuracy)||0)}m)`};case z.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case z.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[m.status,(re=m.coordinates)==null?void 0:re.accuracy]),D=r.useCallback(()=>{const o=new Date;let c=0,x=!1;if(n.todayPunches.forEach(M=>{if(M.punchin_time){let ne;try{if(ne=new Date(M.punchin_time),isNaN(ne.getTime())||typeof M.punchin_time=="string"&&M.punchin_time.includes(":")&&!M.punchin_time.includes("T")){const J=new Date,[ue,oe,ve]=M.punchin_time.split(":");ne=new Date(J.getFullYear(),J.getMonth(),J.getDate(),parseInt(ue),parseInt(oe),parseInt(ve||0))}}catch{console.warn("Invalid punch in time format:",M.punchin_time);return}if(isNaN(ne.getTime()))return;if(M.punchout_time){let J;try{if(J=new Date(M.punchout_time),isNaN(J.getTime())||typeof M.punchout_time=="string"&&M.punchout_time.includes(":")&&!M.punchout_time.includes("T")){const oe=new Date,[ve,qe,Ke]=M.punchout_time.split(":");J=new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),parseInt(ve),parseInt(qe),parseInt(Ke||0))}}catch{console.warn("Invalid punch out time format:",M.punchout_time);return}if(isNaN(J.getTime()))return;const ue=Math.floor((J-ne)/1e3);ue>0&&(c+=ue)}else{x=!0;const J=Math.floor((o-ne)/1e3);J>0&&(c+=J)}}}),!x&&n.totalWorkTime&&n.totalWorkTime!=="00:00:00"){h(M=>({...M,realtimeWorkTime:n.totalWorkTime}));return}(isNaN(c)||c<0)&&(c=0);const S=Math.floor(c/3600),H=Math.floor(c%3600/60),Q=c%60,de=`${S.toString().padStart(2,"0")}:${H.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`;h(M=>({...M,realtimeWorkTime:de}))},[n.todayPunches,n.totalWorkTime]),_=r.useCallback(async()=>{try{const c=(await le.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;h(x=>({...x,todayPunches:c.punches||[],totalWorkTime:c.total_production_time||"00:00:00",realtimeWorkTime:c.total_production_time||"00:00:00",userOnLeave:c.isUserOnLeave,lastRefresh:new Date,currentStatus:c.punches&&c.punches.length>0?c.punches[c.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(o){console.error("Error fetching current status:",o),X.error("Failed to fetch attendance status")}},[]),A=r.useCallback(()=>{const o=document.createElement("canvas"),c=o.getContext("2d");return c.textBaseline="top",c.font="14px Arial",c.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:o.toDataURL(),timestamp:Date.now()}},[]),g=r.useCallback(async(o="user")=>{try{j.stream&&j.stream.getTracks().forEach(x=>x.stop());const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:o,width:{ideal:1280},height:{ideal:720}}});T.current&&(T.current.srcObject=c,await T.current.play()),P(x=>({...x,stream:c,isCapturing:!1,isSwitching:!1,facingMode:o}))}catch(c){console.error("Camera access error:",c);try{const x=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});T.current&&(T.current.srcObject=x,await T.current.play()),P(S=>({...S,stream:x,isCapturing:!1,isSwitching:!1}))}catch{X.error("Unable to access camera. Please check permissions."),P(S=>({...S,isOpen:!1,isSwitching:!1}))}}},[j.stream]),I=r.useCallback(async()=>{const o=j.facingMode==="environment"?"user":"environment";P(c=>({...c,isSwitching:!0})),await g(o)},[j.facingMode,g]),R=r.useCallback(()=>{j.stream&&j.stream.getTracks().forEach(o=>o.stop()),P(o=>({...o,stream:null,isOpen:!1,capturedPhoto:null,facingMode:"user",isSwitching:!1}))},[j.stream]),E=r.useCallback(async()=>{if(!(!T.current||!b.current)){P(o=>({...o,isCapturing:!0}));try{const o=T.current,c=b.current,x=c.getContext("2d");c.width=o.videoWidth,c.height=o.videoHeight,x.drawImage(o,0,0);const S=m.coordinates;if(S){const Q=`üìç ${S.latitude.toFixed(6)}, ${S.longitude.toFixed(6)} | ${new Date().toLocaleString()}`;x.fillStyle="rgba(0, 0, 0, 0.7)",x.fillRect(0,c.height-40,c.width,40),x.fillStyle="#ffffff",x.font="bold 16px Arial",x.textBaseline="middle",x.fillText(Q,10,c.height-20)}const H=c.toDataURL("image/jpeg",.85);P(Q=>({...Q,capturedPhoto:H,isCapturing:!1})),X.success("Photo captured successfully!")}catch(o){console.error("Photo capture error:",o),X.error("Failed to capture photo. Please try again."),P(c=>({...c,isCapturing:!1}))}}},[m.coordinates]),B=r.useCallback(()=>{P(o=>({...o,capturedPhoto:null}))},[]),G=r.useCallback(async()=>{var o,c;if(!j.capturedPhoto||!j.pendingPunchData){X.error("Please capture a photo first.");return}h(x=>({...x,loading:!0})),R();try{const x={...j.pendingPunchData,photo:j.capturedPhoto},S=await le.post(route("attendance.punch"),x);S.data.status==="success"?(w(H=>({...H,sessionDialogOpen:!0})),setTimeout(()=>{_()},500)):X.error(S.data.message)}catch(x){console.error("Punch operation failed:",x);const S=((c=(o=x.response)==null?void 0:o.data)==null?void 0:c.message)||"Unable to record attendance. Please try again.";X.error(S)}finally{h(x=>({...x,loading:!1})),P(x=>({...x,pendingPunchData:null,capturedPhoto:null}))}},[j.capturedPhoto,j.pendingPunchData,R,_]),W=r.useCallback(async o=>{P(c=>({...c,isOpen:!0,pendingPunchData:o,capturedPhoto:null})),setTimeout(()=>g(),300)},[g]),$=r.useCallback(async()=>{var o,c;if(n.userOnLeave){X.warning("You are on leave today. Cannot punch in/out.");return}if(m.status!==z.ACTIVE){X.error("Location access required for attendance. Please enable GPS and try again.");return}h(x=>({...x,loading:!0}));try{const x=await y(),S=A();let H="Unknown";try{H=(await le.get(route("getClientIp"))).data.ip}catch(M){console.warn("Could not fetch IP address:",M)}k(M=>({...M,sessionInfo:{ip:H,accuracy:x.accuracy?`${Math.round(x.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const Q={lat:x.latitude,lng:x.longitude,accuracy:x.accuracy,ip:H,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(S),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};if(p){h(M=>({...M,loading:!1})),W(Q);return}const de=await le.post(route("attendance.punch"),Q);de.data.status==="success"?(w(M=>({...M,sessionDialogOpen:!0})),setTimeout(()=>{_()},500)):X.error(de.data.message)}catch(x){console.error("Punch operation failed:",x);const S=((c=(o=x.response)==null?void 0:o.data)==null?void 0:c.message)||"Unable to record attendance. Please try again.";X.error(S,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{h(x=>({...x,loading:!1}))}},[n.userOnLeave,m.status,y,A,_,p,W]),U=r.useCallback(()=>{v.clickable&&(m.status===z.DENIED?l():m.status===z.INACTIVE&&s())},[v.clickable,m.status,l,s]),V=r.useCallback(o=>{if(!o)return"--:--";try{let c;if(typeof o=="string"&&o.includes(":")&&!o.includes("T")){const x=new Date,[S,H,Q]=o.split(":");c=new Date(x.getFullYear(),x.getMonth(),x.getDate(),parseInt(S),parseInt(H),parseInt(Q||0))}else c=new Date(o);return isNaN(c.getTime())?"--:--":c.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),te=r.useCallback(o=>{var c,x;if(!o)return"Location not available";try{if(typeof o=="object"&&o.lat&&o.lng)return(c=o.address)!=null&&c.trim()?o.address.substring(0,30):`${o.lat.toFixed(4)}, ${o.lng.toFixed(4)}`;if(typeof o=="string")try{const S=JSON.parse(o);if(S.lat&&S.lng)return(x=S.address)!=null&&x.trim()?S.address.substring(0,30):`${S.lat.toFixed(4)}, ${S.lng.toFixed(4)}`}catch{return o.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return r.useEffect(()=>{const o=setInterval(()=>{k(c=>({...c,currentTime:new Date})),n.currentStatus==="punched_in"&&n.todayPunches.length>0&&D()},1e3);return()=>clearInterval(o)},[n.currentStatus,n.todayPunches.length,D]),r.useEffect(()=>{_(),s();const o=()=>{k(S=>({...S,connectionStatus:{...S.connectionStatus,network:!0}})),_()},c=()=>{k(S=>({...S,connectionStatus:{...S.connectionStatus,network:!1}}))},x=()=>{_(),s()};return window.addEventListener("online",o),window.addEventListener("offline",c),window.addEventListener("focus",x),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",c),window.removeEventListener("focus",x)}},[_,s]),r.useEffect(()=>{const o=setInterval(()=>{_()},3e4);return()=>clearInterval(o)},[_]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(Z,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:n.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(ye,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(ct,{content:"",color:i.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(dt,{src:(t==null?void 0:t.profile_image_url)||(t==null?void 0:t.profile_image),name:t==null?void 0:t.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate notranslate",style:{color:"var(--theme-foreground)"},"data-name":"true",children:t==null?void 0:t.name}),e.jsxs("p",{className:"text-xs notranslate",style:{color:"var(--theme-foreground-600)"},"data-no-translate":"true",children:["ID: ",(t==null?void 0:t.employee_id)||(t==null?void 0:t.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:F.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:F.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ie,{color:i.color,variant:"flat",startContent:i.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:i.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(se,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:n.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ut,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:C.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(ae,{color:i.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:$,isDisabled:n.loading||n.userOnLeave||m.status!==z.ACTIVE,isLoading:n.loading,startContent:!n.loading&&i.icon,className:"mb-4 font-semibold",style:{background:n.userOnLeave||m.status!==z.ACTIVE?"var(--theme-default, #71717A)":i.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":i.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":i.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:n.loading||n.userOnLeave||m.status!==z.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:n.loading?"Processing...":i.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(be,{content:v.tooltip,children:e.jsx(ie,{size:"sm",variant:v.variant,color:v.color,startContent:m.status===z.CHECKING?e.jsx(we,{size:"sm",className:"w-3 h-3"}):e.jsx(me,{className:"w-3 h-3"}),className:`text-xs transition-all ${v.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:v.clickable?U:void 0,children:v.text})}),e.jsx(be,{content:`Network: ${F.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(ie,{size:"sm",variant:"flat",color:F.connectionStatus.network?"success":"default",startContent:e.jsx(Nt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(be,{content:"Device Security",children:e.jsx(ie,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(Ft,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),m.error&&m.status!==z.ACTIVE&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:m.error})]})}),n.userOnLeave&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",n.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(n.userOnLeave.from_date).toLocaleDateString()," - ",new Date(n.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(et,{children:e.jsx(tt,{"aria-label":"Today's Activity",startContent:e.jsx(jt,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[C.sessionsToday," sessions ‚Ä¢ ",n.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:n.todayPunches.length>0?n.todayPunches.map((o,c)=>e.jsx(Z,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:V(o.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:te(o.punchin_location)})]})]})]}),o.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:V(o.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:te(o.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(se,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),o.duration&&e.jsx(ie,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:o.duration})]})},c)):e.jsxs(Z,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Fe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(Re,{isOpen:N.sessionDialogOpen,onOpenChange:o=>w(c=>({...c,sessionDialogOpen:o})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(Ee,{children:o=>e.jsxs(e.Fragment,{children:[e.jsxs(Le,{className:"flex flex-col gap-1 text-center",children:[e.jsx(xe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Te,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(kt,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:F.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(me,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:F.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(Z,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",F.sessionInfo.timestamp]})]})})]}),e.jsx(De,{children:e.jsx(ae,{color:"primary",variant:"shadow",fullWidth:!0,onPress:o,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})}),e.jsx(Re,{isOpen:j.isOpen,onClose:R,size:"lg",classNames:{backdrop:"bg-black/80",base:"bg-content1"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs(Ee,{children:[e.jsxs(Le,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Capture Attendance Photo"})]}),e.jsx("p",{className:"text-sm text-default-500 font-normal",children:"Take a photo for verification. Location coordinates will be added automatically."})]}),e.jsxs(Te,{className:"p-4",children:[e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black",children:[j.capturedPhoto?e.jsx("img",{src:j.capturedPhoto,alt:"Captured",className:"w-full h-auto max-h-[400px] object-contain"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:T,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-[400px] object-contain",style:{transform:j.facingMode==="user"?"scaleX(-1)":"none"}}),e.jsx(ae,{isIconOnly:!0,size:"sm",variant:"flat",className:"absolute top-3 right-3 bg-black/50 text-white hover:bg-black/70",onPress:I,isLoading:j.isSwitching,isDisabled:!j.stream||j.isSwitching,style:{borderRadius:"50%"},children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 rounded-full text-xs text-white bg-black/50",children:j.facingMode==="user"?"ü§≥ Front":"üì∑ Back"})]}),e.jsx("canvas",{ref:b,className:"hidden"}),m.coordinates&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white text-xs",style:{background:"rgba(0,0,0,0.7)"},children:["üìç ",m.coordinates.latitude.toFixed(6),", ",m.coordinates.longitude.toFixed(6)]})]}),e.jsx("div",{className:"mt-3 p-3 rounded-lg text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),j.capturedPhoto?"Review your photo. You can retake if needed.":"Position yourself clearly in the frame and capture the photo."]})})]}),e.jsxs(De,{className:"flex gap-2",children:[e.jsx(ae,{color:"danger",variant:"light",onPress:R,style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Cancel"}),j.capturedPhoto?e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",variant:"flat",onPress:B,startContent:e.jsx(Pe,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Retake"}),e.jsxs(ae,{color:"success",variant:"shadow",onPress:G,isLoading:n.loading,startContent:!n.loading&&e.jsx(xe,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:["Confirm & ",i.action]})]}):e.jsx(ae,{color:"primary",variant:"shadow",onPress:E,isLoading:j.isCapturing,isDisabled:!j.stream,startContent:!j.isCapturing&&e.jsx(Ae,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Capture Photo"})]})]})})]})});Ze.displayName="PunchStatusCard";function Jt({auth:a}){const[t,d]=r.useState(!1),[u,n]=r.useState(!1),[h,m]=r.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),f={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},N={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},w={hidden:{opacity:0,y:30,scale:.9},visible:b=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:b*.15,ease:"easeOut"}})},F=b=>a.permissions&&a.permissions.includes(b),k=b=>b.some(p=>F(p)),j=b=>b.every(p=>F(p)),P=()=>{d(b=>!b),n(b=>!b)},T=b=>{const p=b.target.value;m(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(p))),n(y=>!y),d(y=>!y)};return e.jsxs(e.Fragment,{children:[e.jsx(rt,{title:"Dashboard"}),e.jsx(K.div,{variants:f,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(K.div,{variants:N,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[j(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Ze,{handlePunchSuccess:P})},"punch-status-card")},"punch-status-grid"),F("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Zt,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),k(["attendance.view","employees.view"])&&e.jsxs(K.div,{variants:f,initial:"hidden",animate:"visible",children:[e.jsx(K.div,{variants:w,custom:2,children:e.jsx(at,{selectedDate:h,handleDateChange:T,updateTimeSheet:u})},"timesheet-section"),e.jsx(K.div,{variants:w,custom:3,children:e.jsx(Bt,{selectedDate:h,updateMap:t})},"user-locations-section")]}),F("core.updates.view")&&e.jsx(K.div,{variants:w,custom:4,initial:"hidden",animate:"visible",children:e.jsx(Gt,{})},"updates-section")]})})]})}Jt.layout=a=>e.jsx(mt,{children:a});export{Jt as default};
