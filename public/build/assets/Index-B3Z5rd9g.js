import{J as G,r as n,j as e,Q as X,c as F,d as x,S as p,b as k,a as f}from"./app-CunAKQks.js";import{e as Z,f as ee,g as se,m as h,h as te,i as re,j as ae,k as oe,A as ie}from"./Dashboard-DmW5oclz.js";import{S as ne}from"./StatsCards-BDB4Dta9.js";import{s as a}from"./toastUtils-BK2NpL64.js";import{d as le}from"./dayjs.min-D48AkWBs.js";import{u as de}from"./index-C13Zmoxe.js";import{m as ce}from"./chunk-O5MCAK4F-Sb4AMWxp.js";import{F as R}from"./ClipboardDocumentListIcon-ZNzD2sfb.js";import{F as me}from"./CheckCircleIcon-Cy6gi0vH.js";import{F as ue}from"./XCircleIcon-D_zs9zwp.js";import{m as pe}from"./proxy-DRy-WR0b.js";import{F as xe}from"./ArrowLeftIcon-BARuny3g.js";import{F as fe}from"./DocumentArrowDownIcon-BX5oMTyN.js";import{F as he}from"./MagnifyingGlassIcon-DhIntHcP.js";import{F as je}from"./EllipsisVerticalIcon-DJh7X2bo.js";import{F as ge}from"./PrinterIcon-D31LF74Z.js";import{c as ve}from"./chunk-D5XJWRAV-ByvVzgUI.js";import{i as we}from"./chunk-SSA7SXE4-wCvXFnPT.js";import{t as ye,a as be,b as _e,c}from"./chunk-F3UDT23P-D61eN9jh.js";import{t as Re,a as m}from"./chunk-YRZGWF2W-IT5uTgMZ.js";import{c as v}from"./chunk-IHOGUXIG-C_bLR0nR.js";import{p as Ne}from"./chunk-EAPQ7RWQ-Bxh7K0DI.js";import{t as Se}from"./chunk-QESP63UR-CvrJFaWn.js";import"./MapPinIcon-Bi9q1I6j.js";import"./EnvelopeIcon-CQvioidX.js";import"./UserGroupIcon-CQwDioMm.js";import"./ClockIcon-CoHQWpb9.js";import"./UserIcon-B6hgVS7X.js";import"./ShieldCheckIcon-DiFAxQSH.js";import"./XMarkIcon-DMNCgV--.js";import"./KeyIcon-DENQhbGY.js";import"./index-Cf_bSFXg.js";import"./chunk-Y2AYO5NJ-D2YXd1v6.js";import"./logo-Pwvcz7fP.js";import"./features-animation-BbHHului.js";import"./create-visual-element-HVGPC22Q.js";import"./ExclamationTriangleIcon-D4zuogrU.js";import"./chunk-TLYTI3QM-0sLAzwpw.js";import"./chunk-XJ2YRSUP-CeY_Lt9F.js";import"./useToggleState-zhVATHJg.js";const Ce=({event:t,registrations:E})=>{var P;const{auth:Pe}=G().props,[l,Fe]=n.useState(E),[u,w]=n.useState(new Set([])),[j,A]=n.useState(""),{isOpen:T,onOpen:N,onClose:g}=de(),[y,b]=n.useState(""),[S,C]=n.useState(""),[z,M]=n.useState(null),B=n.useMemo(()=>{var s,d,o;return[{title:"Total",value:l.total||0,icon:e.jsx(R,{}),color:"text-primary",iconBg:"bg-primary/20",description:"Total registrations"},{title:"Approved",value:((s=l.data)==null?void 0:s.filter(i=>i.status==="approved").length)||0,icon:e.jsx(me,{}),color:"text-success",iconBg:"bg-success/20",description:"Confirmed attendees"},{title:"Pending",value:((d=l.data)==null?void 0:d.filter(i=>i.status==="pending").length)||0,icon:e.jsx(R,{}),color:"text-warning",iconBg:"bg-warning/20",description:"Awaiting approval"},{title:"Rejected",value:((o=l.data)==null?void 0:o.filter(i=>i.status==="rejected").length)||0,icon:e.jsx(ue,{}),color:"text-danger",iconBg:"bg-danger/20",description:"Not approved"}]},[l]),r=()=>{var i;if(typeof window>"u")return"lg";const d=((i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:i.trim())||"12px",o=parseInt(d);return o===0?"none":o<=4?"sm":o<=8?"md":o<=16?"lg":"full"},[_,L]=n.useState(!1),[ke,V]=n.useState(!1);n.useEffect(()=>{const s=()=>{L(window.innerWidth<640),V(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const $=async s=>{try{await f.post(route("events.registrations.approve",[t.id,s.id])),a.success("Registration approved successfully"),p.reload()}catch{a.error("Failed to approve registration")}},I=s=>{M(s),C("reject"),N()},O=async()=>{try{await f.post(route("events.registrations.reject",[t.id,z.id]),{rejection_reason:y}),a.success("Registration rejected"),g(),b(""),p.reload()}catch{a.error("Failed to reject registration")}},D=async s=>{try{await f.post(route("events.registrations.verify-payment",[t.id,s.id])),a.success("Payment verified successfully"),p.reload()}catch{a.error("Failed to verify payment")}},Y=async()=>{if(u.size===0){a.warning("Please select registrations to approve");return}try{await f.post(route("events.registrations.bulk-approve",t.id),{registration_ids:Array.from(u)}),a.success("Registrations approved successfully"),w(new Set([])),p.reload()}catch{a.error("Failed to approve registrations")}},Q=()=>{if(u.size===0){a.warning("Please select registrations to reject");return}C("bulkReject"),N()},K=async()=>{try{await f.post(route("events.registrations.bulk-reject",t.id),{registration_ids:Array.from(u),rejection_reason:y}),a.success("Registrations rejected"),w(new Set([])),g(),b(""),p.reload()}catch{a.error("Failed to reject registrations")}},U=()=>{window.location.href=route("events.registrations.export-csv",t.id)},W=s=>{window.open(route("events.registrations.print-token",[t.id,s.id]),"_blank")},H=s=>{switch(s){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";case"cancelled":return"default";default:return"default"}},J=(P=l.data)==null?void 0:P.filter(s=>s.name.toLowerCase().includes(j.toLowerCase())||s.email.toLowerCase().includes(j.toLowerCase())||s.token.toLowerCase().includes(j.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(X,{title:`Registrations - ${t.title}`}),e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-[1600px] mx-auto",children:e.jsx("div",{className:"p-6",children:e.jsx(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(F,{className:"bg-content1/50 backdrop-blur-md border border-divider/30",style:{borderRadius:"var(--borderRadius, 12px)"},children:[e.jsx(ve,{className:"pb-0",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-6 pb-2",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/20",children:e.jsx(R,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Event Registrations"}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:t.title})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{variant:"flat",onPress:()=>p.get(route("events.show",t.id)),startContent:e.jsx(xe,{className:"w-5 h-5"}),radius:r(),size:_?"sm":"md",children:!_&&"Back to Event"}),e.jsx(x,{color:"primary",variant:"flat",onPress:U,startContent:e.jsx(fe,{className:"w-5 h-5"}),radius:r(),size:_?"sm":"md",children:"Export CSV"})]})]})})}),e.jsxs(k,{className:"p-6",children:[e.jsx(ne,{stats:B,className:"mb-6"}),e.jsx(F,{className:"bg-content2/50",style:{borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(k,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-6",children:[e.jsx(we,{placeholder:"Search by name, email, or token...",value:j,onChange:s=>A(s.target.value),startContent:e.jsx(he,{className:"w-4 h-4"}),className:"max-w-md",radius:r()}),u.size>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{color:"success",variant:"flat",onPress:Y,radius:r(),children:["Approve Selected (",u.size,")"]}),e.jsxs(x,{color:"danger",variant:"flat",onPress:Q,radius:r(),children:["Reject Selected (",u.size,")"]})]})]}),e.jsxs(ye,{"aria-label":"Event registrations table",selectionMode:"multiple",selectedKeys:u,onSelectionChange:w,children:[e.jsxs(Re,{children:[e.jsx(m,{children:"TOKEN"}),e.jsx(m,{children:"NAME"}),e.jsx(m,{children:"EMAIL"}),e.jsx(m,{children:"PHONE"}),e.jsx(m,{children:"SUB-EVENTS"}),e.jsx(m,{children:"STATUS"}),e.jsx(m,{children:"PAYMENT"}),e.jsx(m,{children:"DATE"}),e.jsx(m,{children:"ACTIONS"})]}),e.jsx(be,{items:J||[],children:s=>{var d,o;return e.jsxs(_e,{children:[e.jsx(c,{children:e.jsx("span",{className:"font-mono text-sm",children:s.token})}),e.jsx(c,{children:s.name}),e.jsx(c,{children:s.email}),e.jsx(c,{children:s.phone}),e.jsx(c,{children:e.jsxs("div",{className:"text-xs",children:[(d=s.sub_events)==null?void 0:d.slice(0,2).map((i,q)=>e.jsx("div",{children:i.title},q)),((o=s.sub_events)==null?void 0:o.length)>2&&e.jsxs("div",{className:"text-default-400",children:["+",s.sub_events.length-2," more"]})]})}),e.jsx(c,{children:e.jsx(v,{size:"sm",color:H(s.status),variant:"flat",radius:r(),children:s.status})}),e.jsx(c,{children:s.payment_verified?e.jsx(v,{size:"sm",color:"success",variant:"flat",radius:r(),children:"Verified"}):s.payment_proof?e.jsx(v,{size:"sm",color:"warning",variant:"flat",radius:r(),children:"Pending"}):e.jsx(v,{size:"sm",color:"default",variant:"flat",radius:r(),children:"No Proof"})}),e.jsx(c,{children:le(s.created_at).format("MMM DD, YYYY")}),e.jsx(c,{children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(x,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(je,{className:"w-5 h-5"})})}),e.jsxs(se,{"aria-label":"Actions",children:[e.jsx(h,{onPress:()=>p.get(route("events.registrations.show",[t.id,s.id])),children:"View Details"},"view"),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"success",onPress:()=>$(s),children:"Approve"},"approve"),e.jsx(h,{color:"danger",onPress:()=>I(s),children:"Reject"},"reject")]}),s.payment_proof&&!s.payment_verified&&e.jsx(h,{color:"primary",onPress:()=>D(s),children:"Verify Payment"},"verify-payment"),e.jsx(h,{startContent:e.jsx(ge,{className:"w-4 h-4"}),onPress:()=>W(s),children:"Print Token"},"print")]})]})})]},s.id)}})]}),l.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(Ne,{total:l.last_page,page:l.current_page,onChange:s=>p.get(route("events.registrations.index",t.id),{page:s}),showControls:!0,radius:r()})})]})})]})]})})})})}),e.jsx(te,{isOpen:T,onClose:g,radius:r(),children:e.jsxs(re,{children:[e.jsx(ae,{children:S==="bulkReject"?"Reject Selected Registrations":"Reject Registration"}),e.jsx(oe,{children:e.jsx(Se,{label:"Rejection Reason (Optional)",placeholder:"Enter reason for rejection",value:y,onChange:s=>b(s.target.value),rows:4,radius:r()})}),e.jsxs(ce,{children:[e.jsx(x,{variant:"flat",onPress:g,radius:r(),children:"Cancel"}),e.jsx(x,{color:"danger",onPress:S==="bulkReject"?K:O,radius:r(),children:"Reject"})]})]})})]})};Ce.layout=t=>e.jsx(ie,{children:t});export{Ce as default};
