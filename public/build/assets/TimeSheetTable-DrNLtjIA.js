import{R as Xe,r as a,j as e,s as qe,A as Ge,d as Z,C as Ze,J as Ce,a as q,c as ne,f as ke,b as Re}from"./app-1wQt--nt.js";import{d as x}from"./dayjs.min-TwBzSM1t.js";import{a as u,h as le,z as et,F as G,u as Ie,j as Me,c as tt,e as st,B as at}from"./App-CJ72I6-H.js";import{P as rt}from"./PageHeader-DGqqRxlD.js";import{F as U}from"./CheckCircleIcon-Bp6SHwqJ.js";import{F as $e}from"./XCircleIcon-BRfJHDwL.js";import{m as We}from"./proxy-FaoYfrPs.js";import{F as A}from"./ExclamationTriangleIcon-CmB-OXVM.js";import{F as nt}from"./UserPlusIcon-3nilONmb.js";import{i as oe}from"./chunk-SSA7SXE4-DjN6Ae7g.js";import{F as lt}from"./UserIcon-22PyUsQI.js";import{F as Pe}from"./DocumentArrowDownIcon-CaZXJQsD.js";import{l as ot}from"./chunk-JOT4BT4P-DC4V1P_k.js";import{s as Le}from"./chunk-TLYTI3QM-8nwDK7H4.js";import{t as Se,a as Ye,b as Ee,c as w}from"./chunk-F3UDT23P-B9VGgRxL.js";import{t as Te,a as Ae}from"./chunk-YRZGWF2W-B74zE2_z.js";import{p as Ue}from"./chunk-EAPQ7RWQ-EFkfDWsO.js";import{u as it}from"./chunk-S574QCAN-DT8GJkWP.js";const ct=Xe.memo(({absentUsers:I,selectedDate:o,getUserLeave:M,isLoaded:_=!1,onMarkAsPresent:C})=>{const[W,S]=a.useState(5),[c,i]=a.useState(""),F=()=>{var P;const l=((P=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:P.trim())||"12px",d=parseInt(l);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},v=a.useMemo(()=>{if(!c.trim())return I;const r=c.toLowerCase();return I.filter(l=>{var p,se,j,Y;const d=((p=l.name)==null?void 0:p.toLowerCase())||"",P=((se=l.employee_id)==null?void 0:se.toString().toLowerCase())||"",H=((j=l.email)==null?void 0:j.toLowerCase())||"",te=((Y=l.phone)==null?void 0:Y.toString().toLowerCase())||"";return d.includes(r)||P.includes(r)||H.includes(r)||te.includes(r)})},[I,c]),B=()=>{S(r=>r+5)},ee=r=>{i(r.target.value),S(5)},k=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return e.jsx(U,{className:"w-4 h-4",style:{color:"var(--theme-success)"}});case"rejected":return e.jsx($e,{className:"w-4 h-4",style:{color:"var(--theme-danger)"}});case"pending":return e.jsx(u,{className:"w-4 h-4",style:{color:"var(--theme-warning)"}});default:return e.jsx(u,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}})}},b=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return"var(--theme-success)";case"rejected":return"var(--theme-danger)";case"pending":return"var(--theme-warning)";default:return"var(--theme-primary)"}},$=v.length;return _?_&&I.length===0?e.jsxs("div",{className:"h-full",children:[e.jsx(rt,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${x(o).format("MMMM D, YYYY")}`,icon:e.jsx(U,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e.jsx(U,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),e.jsxs("div",{role:"region","aria-label":"No absent employees today",className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-success) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--theme-success)"}}),e.jsx("p",{className:"mb-2 text-sm font-medium",style:{color:"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:"Perfect Attendance!"}),e.jsx("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No employees are absent today."}),e.jsx("p",{className:"text-default-500 mt-1 block text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"All employees are either present or on approved leave."})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx($e,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),"Absent Employees (",$,")"]})}),e.jsx("div",{className:"mb-3 flex-shrink-0",children:e.jsx(oe,{type:"text",placeholder:"Search absent employees...",value:c,onChange:ee,startContent:e.jsx(le,{className:"w-4 h-4 text-default-400"}),variant:"bordered",size:"sm",radius:F(),"aria-label":"Search absent employees",classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),c&&e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[v.length," of ",I.length," employees found"]})}),c&&v.length===0&&e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(le,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:['No employees found matching "',c,'"']})]}),e.jsxs("div",{role:"region","aria-label":"Absent employees list",className:"flex-1 overflow-y-auto min-h-0",style:{maxHeight:"calc(100vh - 400px)"},children:[e.jsx(Ge,{children:v.slice(0,W).map(r=>{const l=M(r.id);return e.jsx(We.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"p-3 mb-3 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},onMouseEnter:d=>{d.currentTarget.style.background="color-mix(in srgb, var(--theme-content2) 60%, transparent)"},onMouseLeave:d=>{d.currentTarget.style.background="color-mix(in srgb, var(--theme-content1) 80%, transparent)"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(et,{src:r.profile_image_url||r.profile_image,name:r.name,isBordered:!0,size:"sm",showFallback:!0,radius:F()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r.name}),r.employee_id&&e.jsxs("p",{className:"block text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["ID: ",r.employee_id]}),l?e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(G,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:l.from_date===l.to_date?l.from_date:`${l.from_date} - ${l.to_date}`})]}),e.jsxs("p",{className:"flex items-center gap-1 text-xs",style:{color:b(l.status),fontFamily:'var(--fontFamily, "Inter")'},children:[k(l.status),e.jsxs("span",{className:"truncate",children:[l.leave_type," Leave"]})]})]}):e.jsxs("p",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(A,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:"Absent without leave"})]})]})]}),l&&e.jsx("div",{className:"px-1.5 py-0.5 ml-2 flex-shrink-0",style:{background:`color-mix(in srgb, ${b(l.status)} 15%, transparent)`,borderColor:`color-mix(in srgb, ${b(l.status)} 30%, transparent)`,borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 6px)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[k(l.status),e.jsx("span",{className:"font-semibold text-xs",style:{color:b(l.status),fontFamily:'var(--fontFamily, "Inter")'},children:l.status})]})})]}),C&&!l&&e.jsx("div",{className:"flex justify-end",children:e.jsx(Z,{color:"primary",variant:"flat",size:"sm",radius:F(),startContent:e.jsx(nt,{className:"w-3 h-3"}),onPress:()=>C(r,o),style:{fontFamily:'var(--fontFamily, "Inter")'},className:"text-xs",children:"Mark Present"})})]})},r.id)})}),W<v.length&&e.jsx("div",{className:"text-center mt-4 pb-4 flex-shrink-0",children:e.jsxs(Z,{variant:"bordered",onPress:B,startContent:e.jsx(Ze,{className:"w-4 h-4"}),size:"sm",color:"warning",radius:F(),fullWidth:!0,style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Show More (",v.length-W," remaining)"]})})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-default)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(u,{className:"w-5 h-5",style:{color:"var(--theme-default)"}}),"Loading Attendance Data..."]})}),e.jsxs("div",{className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 5%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(qe,{size:"lg",className:"mb-4",style:{color:"var(--theme-primary)"}}),e.jsx("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Checking attendance records..."})]})]})}),$t=({handleDateChange:I,selectedDate:o,updateTimeSheet:M,externalFilterData:_,externalEmployee:C,onMarkAsPresent:W})=>{var be,Ne,we;const{auth:S}=Ce().props,{url:c}=Ce(),i=Ie("(min-width: 1025px)"),F=Ie("(min-width: 641px) and (max-width: 1024px)"),[v,B]=a.useState([]),[ee,k]=a.useState([]),[b,$]=a.useState([]),[r,l]=a.useState(""),[d,P]=a.useState(0),[H,te]=a.useState(0),[p,se]=a.useState(10),[j,Y]=a.useState(1),[N,ie]=a.useState(C||""),[D,L]=a.useState(!1),[V,dt]=a.useState(0),[mt,ce]=a.useState(null),[de,xt]=a.useState(!0),[ae,me]=a.useState(new Date),[K,E]=a.useState(""),xe=a.useRef(null),f=a.useRef({currentMonth:x().format("YYYY-MM"),employee:C||"",filterData:_||{currentMonth:x().format("YYYY-MM")},selectedDate:o,perPage:10,updateTimeSheet:M,refreshKey:0,currentPage:1}),R=()=>{var h;if(typeof window>"u")return"lg";const n=((h=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:h.trim())||"12px",s=parseInt(n);return s===0?"none":s<=4?"sm":s<=8?"md":s<=16?"lg":"full"},[y,ue]=a.useState(_||{currentMonth:x().format("YYYY-MM")}),J=a.useCallback(async()=>{try{return L(!1),await fe(o,j,p,N,y,!0),c!=="/attendance-employee"&&await pe(o,N),me(new Date),!0}catch(t){return console.error("Error refreshing timesheet:",t),!1}finally{L(!0)}},[o,j,p,N,y,c]),re=a.useCallback(async()=>{if(o)try{const t=route("check-timesheet-updates",{date:x(o).format("YYYY-MM-DD"),month:y.currentMonth}),n=await fetch(t);if(!n.ok){const h=await n.json().catch(()=>({}));throw new Error(`HTTP ${n.status}: ${h.message||"Failed to check for updates"}`)}const s=await n.json();s.success&&s.last_updated!==xe.current&&s.last_updated&&(xe.current=s.last_updated,await J(),ce(new Date)),me(new Date)}catch(t){console.error("Error checking for timesheet updates:",t)}},[o,y.currentMonth,J]),he=a.useMemo(()=>ae?ae.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[ae]),fe=async(t,n,s,h,m,Q=!1)=>{var z,O;if(!t){L(!0),l("No date selected");return}const X=c!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{L(!1),l("");const g=await q.get(X,{params:{page:n,perPage:s,employee:h,date:x(t).format("YYYY-MM-DD"),currentYear:m!=null&&m.currentMonth?x(m.currentMonth).year():"",currentMonth:m!=null&&m.currentMonth?x(m.currentMonth).format("MM"):"",_t:Q?Date.now():void 0}});g.status===200?(B(g.data.attendances||[]),P(g.data.total||0),te(g.data.last_page||1),Y(g.data.current_page||1),ce(new Date),l("")):l(`Unexpected response: ${g.status}`)}catch(g){console.error("Error fetching attendance data:",g),l(((O=(z=g.response)==null?void 0:z.data)==null?void 0:O.message)||"An error occurred while retrieving attendance data."),B([]),P(0)}finally{L(!0)}},pe=async(t,n)=>{if(c==="/attendance-employee"){$([]),k([]);return}if(!t){$([]),k([]);return}try{const s=await q.get(route("admin.getAbsentUsersForDate"),{params:{date:x(t).format("YYYY-MM-DD"),employee:n||"",_t:Date.now()}});s.status===200?($(s.data.absent_users||[]),k(s.data.leaves||[])):(console.warn("Unexpected response getting absent users:",s.status),$([]),k([]))}catch(s){console.error("Error fetching absent users:",s),$([]),k([])}},ye=t=>{Y(t)};a.useCallback((t,n)=>{ue(s=>({...s,[t]:n}))},[]);const De=t=>ee.find(n=>String(n.user_id)===String(t)),ge=(t,n)=>{if(!t)return null;try{let s;if(typeof t=="string"){const h=x(n).format("YYYY-MM-DD");if(t.match(/^\d{2}:\d{2}:\d{2}$/)){const m=`${h}T${t}`;s=new Date(m)}else if(t.includes("T")||t.includes(" "))s=new Date(t);else if(t.match(/^\d{2}:\d{2}$/)){const m=`${h}T${t}:00`;s=new Date(m)}else s=new Date(`${h}T${t}`)}else s=new Date(t);return isNaN(s.getTime())?(console.warn("Invalid time data:",t),"Invalid time"):s.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(s){return console.warn("Error formatting time:",{timeString:t,date:n,error:s}),"Invalid time"}},T=((be=S.permissions)==null?void 0:be.includes("attendance.view"))||!1,ze=((Ne=S.permissions)==null?void 0:Ne.includes("attendance.manage"))||!1,Oe=((we=S.permissions)==null?void 0:we.includes("attendance.export"))||ze||!1;a.useMemo(()=>b,[b]);const ve=[...!T||c==="/attendance-employee"?[{name:"Date",uid:"date",icon:G,ariaLabel:"Attendance date"}]:[],...T&&c!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:lt,ariaLabel:"Employee name and information"}]:[],{name:"Clock In",uid:"clockin_time",icon:u,ariaLabel:"First punch in time"},{name:"Clock Out",uid:"clockout_time",icon:u,ariaLabel:"Last punch out time"},{name:"Work Hours",uid:"production_time",icon:u,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:u,ariaLabel:"Number of time punches recorded"}],je=(t,n)=>{var m,Q,X,z,O,g,Fe;const s="text-xs sm:text-sm md:text-base whitespace-nowrap",h=x(t.date).isSame(x(),"day");switch(n){case"date":return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:x(t.date).format("MMM D, YYYY")})})]})});case"employee":return e.jsx(w,{className:"whitespace-nowrap",children:e.jsx(it,{avatarProps:{radius:"lg",size:"sm",src:((m=t.user)==null?void 0:m.profile_image_url)||((Q=t.user)==null?void 0:Q.profile_image),showFallback:!0,name:((X=t.user)==null?void 0:X.name)||"Unnamed User",isBordered:!0},description:(z=t.user)!=null&&z.phone?e.jsx(ot,{href:`tel:${(O=t.user)==null?void 0:O.phone}`,size:"sm",className:"text-xs hover:underline",style:{color:"var(--theme-primary)"},children:(g=t.user)==null?void 0:g.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-default-400 italic",children:[e.jsx(at,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:((Fe=t.user)==null?void 0:Fe.name)||"Unnamed User"})})});case"clockin_time":return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-success"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.punchin_time?ge(t.punchin_time,t.date)||"Invalid time":"Not clocked in"}),t.punchin_time&&e.jsx("span",{className:"text-xs text-default-500",children:"First punch"})]})]})});case"clockout_time":return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:t.punchout_time?ge(t.punchout_time,t.date)||"Invalid time":t.punchin_time?h?"Currently working":"Missing punch-out":"Not started"}),t.punchout_time&&e.jsx("span",{className:"text-xs text-default-500",children:"Last punch"})]})]})});case"production_time":const Ve=t.total_work_minutes>0,_e=t.has_incomplete_punch,Ke=t.punchin_time&&!t.punchout_time&&h;if(Ve){const Je=Math.floor(t.total_work_minutes/60),Qe=Math.floor(t.total_work_minutes%60);return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:`w-4 h-4 ${_e?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${Je}h ${Qe}m`}),e.jsx("span",{className:"text-xs text-default-500",children:_e?"Partial data - in progress":"Total worked time"})]})]})})}else{if(Ke)return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(t.punchin_time&&!t.punchout_time&&!h)return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(w,{className:`${s}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]}),t.complete_punches===t.punch_count&&t.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(w,{className:`${s}`,children:"N/A"})}},Be=a.useCallback(async()=>{E("excel");try{const t=await q.get(route("attendance.exportExcel"),{params:{date:o},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=n,s.setAttribute("download",`Daily_Timesheet_${x(o).format("YYYY_MM_DD")}.xlsx`),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n),E("")}catch(t){console.error("Error downloading Excel:",t),alert("Failed to download attendance excel."),E("")}},[o]),He=a.useCallback(async()=>{E("pdf");try{const t=await q.get(route("attendance.exportPdf"),{params:{date:o},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=n,s.setAttribute("download",`Daily_Timesheet_${x(o).format("YYYY_MM_DD")}.pdf`),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n),E("")}catch(t){console.error("Error downloading PDF:",t),alert("Failed to download attendance pdf."),E("")}},[o]);return a.useEffect(()=>{if(o){if((N!==f.current.employee||y!==f.current.filterData||o!==f.current.selectedDate||p!==f.current.perPage||M!==f.current.updateTimeSheet||V!==f.current.refreshKey)&&j!==1){f.current={...f.current,employee:N,filterData:y,selectedDate:o,perPage:p,updateTimeSheet:M,refreshKey:V},Y(1);return}(async()=>{L(!1);try{await Promise.all([fe(o,j,p,N,y),c!=="/attendance-employee"?pe(o,N):Promise.resolve()])}catch(s){console.error("Error updating attendance data:",s)}finally{L(!0)}})(),f.current={...f.current,employee:N,filterData:y,selectedDate:o,perPage:p,updateTimeSheet:M,refreshKey:V,currentPage:j}}},[o,j,p,N,y,M,V]),a.useEffect(()=>{_&&ue(_)},[_]),a.useEffect(()=>{C!==void 0&&ie(C)},[C]),a.useEffect(()=>{JSON.stringify(y)!==JSON.stringify(f.current.filterData)&&(f.current={...f.current,filterData:{...y}},J())},[y,J]),a.useEffect(()=>{if(!de||!o)return;re();const t=setInterval(re,5e3);return()=>{clearInterval(t)}},[de,re,o]),c==="/attendance-employee"?e.jsx("div",{role:"region","aria-label":"Attendance data table",className:"w-full",children:r?e.jsx(ne,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:r})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{orientation:"horizontal",className:"overflow-y-hidden",children:e.jsx(Le,{className:"rounded-lg",isLoaded:D,children:e.jsxs(Se,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:R(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Te,{columns:ve,children:t=>e.jsx(Ae,{align:"start","aria-label":t.ariaLabel||t.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e.jsx(Ye,{items:v,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(u,{className:"w-16 h-16 text-default-300 mb-4"}),e.jsx("h6",{className:"text-lg font-semibold mb-2",children:"No Attendance Records"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found for the selected date"})]}),children:t=>e.jsx(Ee,{children:n=>je(t,n)},t.id||t.user_id)})]})})}),d>p&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(Ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:R(),page:j,total:H,onChange:ye,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Timesheet Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(We.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(ne,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                    var(--theme-content1, #FAFAFA) 20%, 
                                    var(--theme-content2, #F4F4F5) 10%, 
                                    var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(tt,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                        color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                        color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${i?"p-6":F?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                            ${i?"p-3":F?"p-2.5":"p-2"} 
                                                            rounded-xl flex items-center justify-center
                                                        `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(u,{className:`
                                                                ${i?"w-8 h-8":F?"w-6 h-6":"w-5 h-5"}
                                                            `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                ${i?"text-2xl":F?"text-xl":"text-lg"}
                                                                font-bold text-foreground
                                                                ${i?"":"truncate"}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Daily Timesheet"}),e.jsx("p",{className:`
                                                                ${i?"text-sm":"text-xs"} 
                                                                text-default-500
                                                                ${i?"":"truncate"}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(o).toLocaleString("en-US",{month:i?"long":"short",day:"numeric",year:i?"numeric":void 0})})]})]}),"                                                ",e.jsxs("div",{className:"flex items-center gap-4",children:[he&&e.jsxs("span",{className:"text-xs text-default-500",children:["Updated: ",he]}),e.jsx("div",{className:"flex items-center gap-2",children:Oe&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{color:"success",variant:"flat",size:i?"md":"sm",radius:R(),startContent:e.jsx(Pe,{className:`
                                                                            ${i?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),onPress:Be,isDisabled:!D||v.length===0||K!=="",isLoading:K==="excel",style:{fontFamily:'var(--fontFamily, "Inter")'},children:i?"Excel":"XLS"}),e.jsx(Z,{color:"danger",variant:"flat",size:i?"md":"sm",radius:R(),startContent:e.jsx(Pe,{className:`
                                                                            ${i?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),onPress:He,isDisabled:!D||v.length===0||K!=="",isLoading:K==="pdf",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"PDF"})]})})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Present: ",d]})]}),T&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-warning"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Absent: ",b.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",d+b.length]})]})]})]})})}),e.jsx(ke,{}),e.jsx(Re,{children:e.jsx("div",{role:"search","aria-label":"Timesheet filters",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:e.jsx(oe,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:N,onChange:t=>ie(t.target.value),variant:"bordered",size:"sm",radius:R(),startContent:e.jsx(le,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Search employees"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(oe,{label:"Select Date",type:"date",variant:"bordered",onChange:I,value:new Date(o).toISOString().slice(0,10)||"",size:"sm",radius:R(),startContent:e.jsx(G,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select date for timesheet"})})]})})})}),e.jsx(ke,{}),e.jsx(Re,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsx("div",{className:`${T?"lg:flex-1 lg:w-0":"w-full"} min-h-0`,children:r?e.jsx(ne,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:r})]})}):e.jsxs("div",{role:"region","aria-label":"Present employees attendance table",className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h6",{className:"text-lg font-semibold text-foreground flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(U,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Present Employees (",d,")"]})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(Me,{orientation:"horizontal",className:"overflow-y-hidden flex-1",children:e.jsx(Le,{className:"rounded-lg",isLoaded:D,children:e.jsxs(Se,{isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:R(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Te,{columns:ve,children:t=>e.jsx(Ae,{align:"start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e.jsx(Ye,{items:v,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(u,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found"})]}),children:t=>e.jsx(Ee,{children:n=>je(t,n)},t.id||t.user_id)})]})})}),d>p&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(Ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:R(),page:j,total:H,onChange:ye,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})]})}),T&&e.jsx("div",{className:"lg:w-80 lg:flex-shrink-0 h-full",children:e.jsx(ct,{absentUsers:b,selectedDate:o,getUserLeave:De,isLoaded:D,onMarkAsPresent:W})})]})})]})})})})})};export{$t as T};
