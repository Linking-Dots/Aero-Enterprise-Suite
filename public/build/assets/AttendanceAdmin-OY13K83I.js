import{r,j as e,d as D,R as he,H as pe,a as T}from"./app-CmFfjWsP.js";import{u as ne,B as l,T as $,G as ie}from"./logo-Bb-VUmpc.js";import{P as xe}from"./PageHeader-VPvENNef.js";import{S as ue}from"./StatsCards-DlhJAGRq.js";import{u as W,F as q,s as J,S as fe,T as ge,I as be,c as X,e as je,b as K,a as ee,G as ye,B as we,A as ve}from"./App-DKNf4kbj.js";import{d as i}from"./dayjs.min-Yb-mO8Jg.js";import{F as B}from"./UserIcon-C42ICOt3.js";import{s as Ne}from"./chunk-TLYTI3QM-Bq2UBdf7.js";import{C as te}from"./CardHeader-DQhWvFvf.js";import{C as G}from"./CardContent-Cjk6s5Uk.js";import{R as ke}from"./Refresh-mZtgj_92.js";import{t as Me,a as _e,b as $e,c as Fe,d as Re,e as A}from"./chunk-F3UDT23P-DZAw_N80.js";import{t as se}from"./chunk-BOOVDPB6-DSWITBr2.js";import{u as ae}from"./chunk-S574QCAN-WXP3Hn5v.js";import{F as Se}from"./ExclamationTriangleIcon-B3ukLrRt.js";import{F as Ye}from"./XCircleIcon-BDKkub3n.js";import{F as Ae}from"./CheckCircleIcon-B5WT3CBF.js";import{a as Z}from"./colorManipulator-Cwo1EpZz.js";import{F as Ce}from"./CheckCircleIcon-DcAHPOOH.js";import{F as Pe}from"./XCircleIcon-DRvI_4Zc.js";import{F as Ee}from"./ExclamationTriangleIcon-DVI7Fufz.js";import{F as Le}from"./ChartBarIcon-CxG4so3Y.js";import{F as Te}from"./MagnifyingGlassIcon-DTp_6cmV.js";import{p as We}from"./chunk-EAPQ7RWQ-DgLMMHg6.js";import{F as re}from"./DocumentArrowDownIcon-Cat9IkTU.js";import{F as Be}from"./PresentationChartLineIcon-5WMSZMJj.js";import{i as oe}from"./chunk-SSA7SXE4-DCTIi96t.js";import"./create-visual-element-CNNoQd8i.js";import"./chunk-D5XJWRAV-D-wO4tV2.js";import"./EnvelopeIcon-B03bj0NI.js";import"./ShieldCheckIcon-B_1qhU2x.js";import"./useHasTabbableChild-mvVqOm0Y.js";import"./index-8-ppjCsZ.js";import"./index-CokAva9Y.js";function He({title:u,titleId:c,...p},f){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},p),u?r.createElement("title",{id:c},u):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const C=r.forwardRef(He);function Ie({title:u,titleId:c,...p},f){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":c},p),u?r.createElement("title",{id:c},u):null,r.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const Ue=r.forwardRef(Ie),ze=({loading:u,attendanceData:c,currentYear:p,currentMonth:f,leaveTypes:y,leaveCounts:_,onRefresh:P})=>{const F=ne(),E=W("(min-width: 1025px)");W("(min-width: 641px) and (max-width: 1024px)");const H=W("(max-width: 640px)"),R=i(`${p}-${f}-01`).daysInMonth(),I={"âˆš":{icon:Ae,color:"text-success",bg:"bg-success-100",label:"âˆš",short:"P"},"â–¼":{icon:Ye,color:"text-danger",bg:"bg-danger-100",label:"â–¼",short:"A"},"#":{icon:Se,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:Ue,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},U=r.useMemo(()=>[{label:"No.",key:"sl",icon:C,width:60},{label:"Employee",key:"name",icon:B,width:200},...Array.from({length:R},(t,x)=>{const w=x+1,N=i(`${p}-${f}-${w}`);return{label:`${w}`,sublabel:N.format("ddd"),key:`day-${w}`,width:40,isWeekend:N.day()===0||N.day()===6}}),...y?y.map(t=>({label:t.type,key:t.type,icon:q,width:80})):[]],[R,p,f,y]),L=t=>I[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},z=({data:t,index:x,daysInMonth:w,currentMonth:N,currentYear:j,leaveTypes:h,leaveCounts:v})=>e.jsx(ie,{className:"mb-4",shadow:"sm",children:e.jsxs(G,{children:[e.jsx(l,{className:"flex items-center gap-3 mb-4",children:e.jsx(ae,{avatarProps:{radius:"lg",size:"md",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:e.jsx($,{variant:"body1",fontWeight:"medium",children:t.name||"Unknown"}),description:e.jsxs($,{variant:"caption",color:"textSecondary",children:["Employee #",x+1]})})}),e.jsx(D,{className:"my-3"}),e.jsx(l,{className:"grid grid-cols-7 sm:grid-cols-7 xs:grid-cols-4 grid-cols-3 gap-1 mb-4",children:Array.from({length:w},(a,d)=>{const g=d+1,s=i(`${j}-${N}-${g}`).format("YYYY-MM-DD"),n=t[s],O=i(s).day()===0||i(s).day()===6,S=typeof n=="object"&&(n==null?void 0:n.status)||"â–¼",M=L(S);return e.jsx(se,{placement:"top",content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",S]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(n==null?void 0:n.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(n==null?void 0:n.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(n==null?void 0:n.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(n==null?void 0:n.remarks)||"N/A"]})]}),className:"z-99999",children:e.jsxs(l,{className:`
                                        flex flex-col items-center justify-center p-1 rounded text-xs cursor-pointer
                                        ${O?"bg-default-100":"bg-default-50"}
                                        ${M.bg}
                                    `,children:[e.jsx("span",{className:"font-medium",children:g}),e.jsx("span",{children:M.icon?e.jsx(M.icon,{className:`w-3 h-3 ${M.color}`}):e.jsx("span",{className:M.color,children:S})})]})},g)})}),(h==null?void 0:h.length)>0&&e.jsx(l,{className:"flex flex-wrap gap-2",children:h.map(a=>{var g;const d=((g=v==null?void 0:v[t.user_id])==null?void 0:g[a.type])||0;return e.jsxs(X,{size:"sm",variant:"flat",color:d>0?"warning":"default",startContent:e.jsx(q,{className:"w-3 h-3"}),children:[a.type,": ",d]},a.type)})})]})});return u?e.jsx(l,{className:"flex justify-center items-center h-64",children:e.jsx(Ne,{className:"w-full h-full rounded-lg"})}):!c||c.length===0?e.jsxs(l,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx($,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):H?e.jsxs(e.Fragment,{children:[e.jsx(te,{title:e.jsxs(l,{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-6 h-6 text-primary"}),e.jsx($,{variant:"h6",component:"h1",children:"Attendance Report"})]})}),e.jsx(D,{}),e.jsx(G,{sx:{p:0},children:e.jsx(J,{className:"max-h-[70vh]",children:c.map((t,x)=>e.jsx(z,{data:t,index:x,daysInMonth:R,currentMonth:f,currentYear:p,leaveTypes:y,leaveCounts:_},t.user_id||x))})})]}):e.jsxs(l,{children:[e.jsx(te,{title:e.jsxs(l,{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-6 h-6 text-primary"}),e.jsxs($,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",i(`${p}-${f}-01`).format("MMMM YYYY")]})]}),action:e.jsx(fe,{direction:"row",spacing:1,children:P&&e.jsx(ge,{title:"Refresh Data",children:e.jsx(be,{onClick:P,disabled:u,sx:{background:Z(F.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${Z(F.palette.primary.main,.2)}`,"&:hover":{background:Z(F.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e.jsx(ke,{color:"primary"})})})}),sx:{padding:"24px"}}),e.jsx(D,{}),e.jsx(G,{children:e.jsx(l,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e.jsx(J,{className:"max-h-[70vh]",children:e.jsxs(Me,{isCompact:!E,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e.jsx(_e,{columns:U,children:t=>e.jsx($e,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:e.jsxs(l,{className:"flex flex-col items-center gap-1",children:[e.jsxs(l,{className:"flex items-center gap-1",children:[t.icon&&e.jsx(t.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e.jsx("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e.jsx(Fe,{items:c,emptyContent:e.jsxs(l,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx($,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e.jsx(Re,{children:x=>{var N;const w=c.findIndex(j=>(j.user_id||j.id)===(t.user_id||t.id));switch(x){case"sl":return e.jsx(A,{className:"text-center font-medium",children:w+1});case"name":return e.jsx(A,{className:"whitespace-nowrap",children:e.jsx(ae,{avatarProps:{radius:"lg",size:E?"md":"sm",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(x.startsWith("day-")){const h=parseInt(x.split("-")[1]),v=i(`${p}-${f}-${h}`).format("YYYY-MM-DD"),a=t[v],d=i(v).day()===0||i(v).day()===6,g=typeof a=="object"&&(a==null?void 0:a.status)||"â–¼",s=L(g);return e.jsx(A,{className:`text-center ${d?"bg-default-50":""}`,children:e.jsx(se,{content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",g]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(a==null?void 0:a.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(a==null?void 0:a.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(a==null?void 0:a.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(a==null?void 0:a.remarks)||"N/A"]})]}),placement:"top",className:"z-99999",children:e.jsx(l,{className:"flex items-center justify-center cursor-help",children:s.icon?e.jsx(s.icon,{className:`w-4 h-4 ${s.color}`}):e.jsx("span",{className:`text-xs ${s.color}`,children:g})})})})}const j=y==null?void 0:y.find(h=>h.type===x);if(j){const h=((N=_==null?void 0:_[t.user_id])==null?void 0:N[j.type])||0;return e.jsx(A,{className:"text-center",children:e.jsx(X,{size:"sm",variant:h>0?"flat":"bordered",color:h>0?"warning":"default",className:"min-w-8",children:h})})}return e.jsx(A,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Oe=he.memo(({title:u})=>{const c=ne(),p=W(c.breakpoints.down("sm")),[f,y]=r.useState(!1),[_,P]=r.useState([]),[F,E]=r.useState([]),[H,R]=r.useState([]),[I,U]=r.useState(0),[L,z]=r.useState(0),[t,x]=r.useState(""),[w,N]=r.useState(30),[j,h]=r.useState(1),[v,a]=r.useState(""),[d,g]=r.useState({currentMonth:i().format("YYYY-MM")}),[s,n]=r.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null}),O=r.useCallback((o,k)=>{g(b=>({...b,[o]:k}))},[]),S=async(o=1,k=30,b)=>{y(!0);try{const m=b.currentMonth?i(b.currentMonth).format("MM"):i().format("MM"),Q=b.currentMonth?i(b.currentMonth).year():i().year(),Y=await T.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:k,employee:t,currentYear:Q,currentMonth:m}});P(Y.data.data),U(Y.data.total),z(Y.data.last_page),R(Y.data.leaveTypes),E(Y.data.leaveCounts);const V=await T.get(route("attendance.monthlyStats"),{params:{currentYear:Q,currentMonth:m}});V.data.success&&n(V.data.data)}catch(m){console.error(m),we.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}})}finally{y(!1)}},M=o=>{const k=o.target.value.toLowerCase();x(k)};r.useEffect(()=>{S(j,w,d).then(o=>"")},[j,w,d,t]);const le=o=>{h(o)},ce=async()=>{a("excel");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),k=await T.get(route("attendance.exportAdminExcel"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([k.data])),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.xlsx`,document.body.appendChild(m),m.click(),a(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("Download failed:",o),a(""),alert("Failed to download attendance sheet.")}},de=async()=>{a("pdf");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),k=await T.get(route("attendance.exportAdminPdf"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([k.data],{type:"application/pdf"})),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.pdf`,document.body.appendChild(m),m.click(),a(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("PDF download failed:",o),a(""),alert("Failed to download attendance PDF.")}},me=r.useMemo(()=>[{title:"Total Employees",value:s.totalEmployees,icon:e.jsx(je,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:s.totalWorkingDays,icon:e.jsx(K,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${s.month})`},{title:"Present Today",value:s.presentToday,icon:e.jsx(Ce,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:s.presentToday>0?`${(s.presentToday/s.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:s.absentToday,icon:e.jsx(Pe,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:s.absentToday>0?`${(s.absentToday/s.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:s.lateToday,icon:e.jsx(Ee,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${s.attendancePercentage}%`,icon:e.jsx(Le,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${s.averageWorkHours}h`,icon:e.jsx(ee,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${s.overtimeHours}h`,icon:e.jsx(ee,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:s.totalLeaveDays,icon:e.jsx(B,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[s.totalEmployees,s.totalWorkingDays,s.month,s.presentToday,s.absentToday,s.lateToday,s.attendancePercentage,s.averageWorkHours,s.overtimeHours,s.totalLeaveDays]);return e.jsxs(l,{children:[e.jsx(pe,{title:u}),e.jsx(l,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(ye,{in:!0,children:e.jsx(ie,{children:e.jsx(xe,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e.jsx(Be,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e.jsx(re,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:ce,isLoading:v==="excel",className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e.jsx(re,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:de,isLoading:v==="pdf",className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:e.jsxs("div",{className:"p-6",children:[e.jsx(ue,{stats:me,className:"mb-6"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(oe,{label:"Search Employee",type:"text",value:t,onChange:M,placeholder:"Enter employee name...",startContent:e.jsx(Te,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:p?"sm":"md"})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(oe,{label:"Month/Year",type:"month",value:d.currentMonth,onChange:o=>O("currentMonth",o.target.value),startContent:e.jsx(K,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:p?"sm":"md"})})]})}),e.jsxs(l,{children:[e.jsx(ze,{attendanceData:_,currentYear:d.currentYear,currentMonth:d.currentMonth,leaveTypes:H,leaveCounts:F,loading:f}),I>=30&&e.jsx("div",{className:"py-4 px-2 flex justify-center items-center",children:e.jsx(We,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:j,total:L,onChange:le,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}})})]})]})})})})})]})});Oe.layout=u=>e.jsx(ve,{children:u});export{Oe as default};
