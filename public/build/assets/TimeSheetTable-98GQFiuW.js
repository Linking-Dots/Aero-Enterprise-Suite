import{R as Xe,r as a,j as e,s as qe,A as Ge,d as se,C as Ze,J as Re,a as Z,c as oe,f as Ie,b as Me}from"./app-P0jeSTbo.js";import{d as h}from"./dayjs.min-BHeaE5Vb.js";import{g as ie,y as es,F as ee,u as $e,i as Pe,c as ss,d as ts,z as as}from"./App-BIkHU9Vu.js";import{P as rs}from"./PageHeader-B7oTX85o.js";import{F as f}from"./react-toastify.esm-Mw1k_TUi.js";import{F as W}from"./CheckCircleIcon-B7bakAHb.js";import{F as Se}from"./XCircleIcon-D7kvpL-8.js";import{m as ze}from"./proxy-UyM1ZIn1.js";import{F as U}from"./ExclamationTriangleIcon-BKP2sSt9.js";import{F as ns}from"./UserPlusIcon-DTEPc4Ii.js";import{i as ce}from"./chunk-SSA7SXE4-uTPPhFUW.js";import{F as ls}from"./UserIcon-CNOCXkP_.js";import{F as Ye}from"./DocumentArrowDownIcon-BobWDuP6.js";import{l as os}from"./chunk-JOT4BT4P-B1s-gjZ_.js";import{s as Le}from"./chunk-TLYTI3QM-DDU5kgVG.js";import{t as Ae,a as Ee,b as Te,c as F}from"./chunk-F3UDT23P-C7U5wOuZ.js";import{t as Ue,a as We}from"./chunk-YRZGWF2W-5Iub4StA.js";import{p as De}from"./chunk-EAPQ7RWQ-6z8f_DOO.js";import{u as is}from"./chunk-S574QCAN-CDhT1cXs.js";const cs=Xe.memo(({absentUsers:M,selectedDate:o,getUserLeave:$,isLoaded:k=!1,onMarkAsPresent:C})=>{const[D,L]=a.useState(5),[d,c]=a.useState(""),_=()=>{var S;const l=((S=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:S.trim())||"12px",m=parseInt(l);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},j=a.useMemo(()=>{if(!d.trim())return M;const r=d.toLowerCase();return M.filter(l=>{var y,re,b,A;const m=((y=l.name)==null?void 0:y.toLowerCase())||"",S=((re=l.employee_id)==null?void 0:re.toString().toLowerCase())||"",K=((b=l.email)==null?void 0:b.toLowerCase())||"",ae=((A=l.phone)==null?void 0:A.toString().toLowerCase())||"";return m.includes(r)||S.includes(r)||K.includes(r)||ae.includes(r)})},[M,d]),V=()=>{L(r=>r+5)},te=r=>{c(r.target.value),L(5)},R=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return e.jsx(W,{className:"w-4 h-4",style:{color:"var(--theme-success)"}});case"rejected":return e.jsx(Se,{className:"w-4 h-4",style:{color:"var(--theme-danger)"}});case"pending":return e.jsx(f,{className:"w-4 h-4",style:{color:"var(--theme-warning)"}});default:return e.jsx(f,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}})}},N=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return"var(--theme-success)";case"rejected":return"var(--theme-danger)";case"pending":return"var(--theme-warning)";default:return"var(--theme-primary)"}},P=j.length;return k?k&&M.length===0?e.jsxs("div",{className:"h-full",children:[e.jsx(rs,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${h(o).format("MMMM D, YYYY")}`,icon:e.jsx(W,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e.jsx(W,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),e.jsxs("div",{role:"region","aria-label":"No absent employees today",className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-success) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--theme-success)"}}),e.jsx("p",{className:"mb-2 text-sm font-medium",style:{color:"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:"Perfect Attendance!"}),e.jsx("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No employees are absent today."}),e.jsx("p",{className:"text-default-500 mt-1 block text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"All employees are either present or on approved leave."})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Se,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),"Absent Employees (",P,")"]})}),e.jsx("div",{className:"mb-3 flex-shrink-0",children:e.jsx(ce,{type:"text",placeholder:"Search absent employees...",value:d,onChange:te,startContent:e.jsx(ie,{className:"w-4 h-4 text-default-400"}),variant:"bordered",size:"sm",radius:_(),"aria-label":"Search absent employees",classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),d&&e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[j.length," of ",M.length," employees found"]})}),d&&j.length===0&&e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ie,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:['No employees found matching "',d,'"']})]}),e.jsxs("div",{role:"region","aria-label":"Absent employees list",className:"flex-1 overflow-y-auto min-h-0",style:{maxHeight:"calc(100vh - 400px)"},children:[e.jsx(Ge,{children:j.slice(0,D).map(r=>{const l=$(r.id);return e.jsx(ze.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"p-3 mb-3 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},onMouseEnter:m=>{m.currentTarget.style.background="color-mix(in srgb, var(--theme-content2) 60%, transparent)"},onMouseLeave:m=>{m.currentTarget.style.background="color-mix(in srgb, var(--theme-content1) 80%, transparent)"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(es,{src:r.profile_image_url||r.profile_image,name:r.name,isBordered:!0,size:"sm",showFallback:!0,radius:_()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r.name}),r.employee_id&&e.jsxs("p",{className:"block text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["ID: ",r.employee_id]}),l?e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ee,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:l.from_date===l.to_date?l.from_date:`${l.from_date} - ${l.to_date}`})]}),e.jsxs("p",{className:"flex items-center gap-1 text-xs",style:{color:N(l.status),fontFamily:'var(--fontFamily, "Inter")'},children:[R(l.status),e.jsxs("span",{className:"truncate",children:[l.leave_type," Leave"]})]})]}):e.jsxs("p",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:"Absent without leave"})]})]})]}),l&&e.jsx("div",{className:"px-1.5 py-0.5 ml-2 flex-shrink-0",style:{background:`color-mix(in srgb, ${N(l.status)} 15%, transparent)`,borderColor:`color-mix(in srgb, ${N(l.status)} 30%, transparent)`,borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 6px)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[R(l.status),e.jsx("span",{className:"font-semibold text-xs",style:{color:N(l.status),fontFamily:'var(--fontFamily, "Inter")'},children:l.status})]})})]}),C&&!l&&e.jsx("div",{className:"flex justify-end",children:e.jsx(se,{color:"primary",variant:"flat",size:"sm",radius:_(),startContent:e.jsx(ns,{className:"w-3 h-3"}),onPress:()=>C(r,o),style:{fontFamily:'var(--fontFamily, "Inter")'},className:"text-xs",children:"Mark Present"})})]})},r.id)})}),D<j.length&&e.jsx("div",{className:"text-center mt-4 pb-4 flex-shrink-0",children:e.jsxs(se,{variant:"bordered",onPress:V,startContent:e.jsx(Ze,{className:"w-4 h-4"}),size:"sm",color:"warning",radius:_(),fullWidth:!0,style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Show More (",j.length-D," remaining)"]})})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-default)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(f,{className:"w-5 h-5",style:{color:"var(--theme-default)"}}),"Loading Attendance Data..."]})}),e.jsxs("div",{className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 5%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(qe,{size:"lg",className:"mb-4",style:{color:"var(--theme-primary)"}}),e.jsx("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Checking attendance records..."})]})]})}),Ps=({handleDateChange:M,selectedDate:o,updateTimeSheet:$,externalFilterData:k,externalEmployee:C,onMarkAsPresent:D})=>{var we,Fe,_e;const{auth:L}=Re().props,{url:d}=Re(),c=$e("(min-width: 1025px)"),_=$e("(min-width: 641px) and (max-width: 1024px)"),[j,V]=a.useState([]),[te,R]=a.useState([]),[N,P]=a.useState([]),[r,l]=a.useState(""),[m,S]=a.useState(0),[K,ae]=a.useState(0),[y,re]=a.useState(10),[b,A]=a.useState(1),[w,de]=a.useState(C||""),[z,Y]=a.useState(!1),[J,ds]=a.useState(0),[ms,me]=a.useState(null),[ue,us]=a.useState(!0),[ne,xe]=a.useState(new Date),[Q,E]=a.useState(""),he=a.useRef(null),p=a.useRef({currentMonth:h().format("YYYY-MM"),employee:C||"",filterData:k||{currentMonth:h().format("YYYY-MM")},selectedDate:o,perPage:10,updateTimeSheet:$,refreshKey:0,currentPage:1}),I=()=>{var u;if(typeof window>"u")return"lg";const n=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",t=parseInt(n);return t===0?"none":t<=4?"sm":t<=8?"md":t<=16?"lg":"full"},[g,fe]=a.useState(k||{currentMonth:h().format("YYYY-MM")}),X=a.useCallback(async()=>{try{return Y(!1),await ye(o,b,y,w,g,!0),d!=="/attendance-employee"&&await ge(o,w),xe(new Date),!0}catch(s){return console.error("Error refreshing timesheet:",s),!1}finally{Y(!0)}},[o,b,y,w,g,d]),le=a.useCallback(async()=>{if(o)try{const s=route("check-timesheet-updates",{date:h(o).format("YYYY-MM-DD"),month:g.currentMonth}),n=await fetch(s);if(!n.ok){const u=await n.json().catch(()=>({}));throw new Error(`HTTP ${n.status}: ${u.message||"Failed to check for updates"}`)}const t=await n.json();t.success&&t.last_updated!==he.current&&t.last_updated&&(he.current=t.last_updated,await X(),me(new Date)),xe(new Date)}catch(s){console.error("Error checking for timesheet updates:",s)}},[o,g.currentMonth,X]),pe=a.useMemo(()=>ne?ne.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[ne]),ye=async(s,n,t,u,x,q=!1)=>{var O,B;if(!s){Y(!0),l("No date selected");return}const G=d!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{Y(!1),l("");const v=await Z.get(G,{params:{page:n,perPage:t,employee:u,date:h(s).format("YYYY-MM-DD"),currentYear:x!=null&&x.currentMonth?h(x.currentMonth).year():"",currentMonth:x!=null&&x.currentMonth?h(x.currentMonth).format("MM"):"",_t:q?Date.now():void 0}});v.status===200?(V(v.data.attendances||[]),S(v.data.total||0),ae(v.data.last_page||1),A(v.data.current_page||1),me(new Date),l("")):l(`Unexpected response: ${v.status}`)}catch(v){console.error("Error fetching attendance data:",v),l(((B=(O=v.response)==null?void 0:O.data)==null?void 0:B.message)||"An error occurred while retrieving attendance data."),V([]),S(0)}finally{Y(!0)}},ge=async(s,n)=>{if(d==="/attendance-employee"){P([]),R([]);return}if(!s){P([]),R([]);return}try{const t=await Z.get(route("admin.getAbsentUsersForDate"),{params:{date:h(s).format("YYYY-MM-DD"),employee:n||"",_t:Date.now()}});t.status===200?(P(t.data.absent_users||[]),R(t.data.leaves||[])):(console.warn("Unexpected response getting absent users:",t.status),P([]),R([]))}catch(t){console.error("Error fetching absent users:",t),P([]),R([])}},ve=s=>{A(s)};a.useCallback((s,n)=>{fe(t=>({...t,[s]:n}))},[]);const Oe=s=>te.find(n=>String(n.user_id)===String(s)),je=(s,n)=>{if(!s)return null;try{let t;if(typeof s=="string"){const u=h(n).format("YYYY-MM-DD");if(s.match(/^\d{2}:\d{2}:\d{2}$/)){const x=`${u}T${s}`;t=new Date(x)}else if(s.includes("T")||s.includes(" "))t=new Date(s);else if(s.match(/^\d{2}:\d{2}$/)){const x=`${u}T${s}:00`;t=new Date(x)}else t=new Date(`${u}T${s}`)}else t=new Date(s);return isNaN(t.getTime())?(console.warn("Invalid time data:",s),"Invalid time"):t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(t){return console.warn("Error formatting time:",{timeString:s,date:n,error:t}),"Invalid time"}},T=((we=L.permissions)==null?void 0:we.includes("attendance.view"))||!1,Be=((Fe=L.permissions)==null?void 0:Fe.includes("attendance.manage"))||!1,He=((_e=L.permissions)==null?void 0:_e.includes("attendance.export"))||Be||!1;a.useMemo(()=>N,[N]);const be=[...!T||d==="/attendance-employee"?[{name:"Date",uid:"date",icon:ee,ariaLabel:"Attendance date"}]:[],...T&&d!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:ls,ariaLabel:"Employee name and information"}]:[],{name:"Clock In",uid:"clockin_time",icon:f,ariaLabel:"All clock in times"},{name:"Clock Out",uid:"clockout_time",icon:f,ariaLabel:"All clock out times"},{name:"Work Hours",uid:"production_time",icon:f,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:f,ariaLabel:"Number of time punches recorded"}],Ne=(s,n)=>{var x,q,G,O,B,v,ke;const t="text-xs sm:text-sm md:text-base whitespace-nowrap",u=h(s.date).isSame(h(),"day");switch(n){case"date":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:h(s.date).format("MMM D, YYYY")})})]})});case"employee":return e.jsx(F,{className:"whitespace-nowrap",children:e.jsx(is,{avatarProps:{radius:"lg",size:"sm",src:((x=s.user)==null?void 0:x.profile_image_url)||((q=s.user)==null?void 0:q.profile_image),showFallback:!0,name:((G=s.user)==null?void 0:G.name)||"Unnamed User",isBordered:!0},description:(O=s.user)!=null&&O.phone?e.jsx(os,{href:`tel:${(B=s.user)==null?void 0:B.phone}`,size:"sm",className:"text-xs hover:underline",style:{color:"var(--theme-primary)"},children:(v=s.user)==null?void 0:v.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-default-400 italic",children:[e.jsx(as,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:((ke=s.user)==null?void 0:ke.name)||"Unnamed User"})})});case"clockin_time":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4 text-success"}),e.jsxs("div",{className:"flex flex-col",children:[s.punches&&s.punches.length>0?s.punches.filter(i=>i.punch_in).map((i,H)=>e.jsx("span",{className:"block",children:je(i.punch_in,s.date)||"Invalid time"},H)):e.jsx("span",{children:"Not clocked in"}),s.punches&&s.punches.filter(i=>i.punch_in).length>0&&e.jsxs("span",{className:"text-xs text-default-500",children:[s.punches.filter(i=>i.punch_in).length," punch",s.punches.filter(i=>i.punch_in).length!==1?"es":""]})]})]})});case"clockout_time":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[s.punches&&s.punches.length>0?s.punches.filter(i=>i.punch_out).map((i,H)=>e.jsx("span",{className:"block",children:je(i.punch_out,s.date)||"Invalid time"},H)):s.punchin_time?e.jsx("span",{children:u?"Currently working":"Missing punch-out"}):e.jsx("span",{children:"Not started"}),s.punches&&s.punches.filter(i=>i.punch_out).length>0&&e.jsxs("span",{className:"text-xs text-default-500",children:[s.punches.filter(i=>i.punch_out).length," punch",s.punches.filter(i=>i.punch_out).length!==1?"es":""]}),s.punches&&s.punches.filter(i=>i.punch_out).length===0&&s.punchin_time&&e.jsx("span",{className:"text-xs text-default-500",children:u?"Currently working":"Missing punch-out"})]})]})});case"production_time":const Je=s.total_work_minutes>0,Ce=s.has_incomplete_punch,Qe=s.punchin_time&&!s.punchout_time&&u;if(Je){const i=Math.floor(s.total_work_minutes/60),H=Math.floor(s.total_work_minutes%60);return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:`w-4 h-4 ${Ce?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${i}h ${H}m`}),e.jsx("span",{className:"text-xs text-default-500",children:Ce?"Partial data - in progress":"Total worked time"})]})]})})}else{if(Qe)return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(s.punchin_time&&!s.punchout_time&&!u)return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[s.punch_count||0," punch",(s.punch_count||0)!==1?"es":""]}),s.complete_punches!==s.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[s.complete_punches," complete"]}),s.complete_punches===s.punch_count&&s.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(F,{className:`${t}`,children:"N/A"})}},Ve=a.useCallback(async()=>{E("excel");try{const s=await Z.get(route("attendance.exportExcel"),{params:{date:o},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=n,t.setAttribute("download",`Daily_Timesheet_${h(o).format("YYYY_MM_DD")}.xlsx`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),E("")}catch(s){console.error("Error downloading Excel:",s),alert("Failed to download attendance excel."),E("")}},[o]),Ke=a.useCallback(async()=>{E("pdf");try{const s=await Z.get(route("attendance.exportPdf"),{params:{date:o},responseType:"blob"}),n=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=n,t.setAttribute("download",`Daily_Timesheet_${h(o).format("YYYY_MM_DD")}.pdf`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(n),E("")}catch(s){console.error("Error downloading PDF:",s),alert("Failed to download attendance pdf."),E("")}},[o]);return a.useEffect(()=>{if(o){if((w!==p.current.employee||g!==p.current.filterData||o!==p.current.selectedDate||y!==p.current.perPage||$!==p.current.updateTimeSheet||J!==p.current.refreshKey)&&b!==1){p.current={...p.current,employee:w,filterData:g,selectedDate:o,perPage:y,updateTimeSheet:$,refreshKey:J},A(1);return}(async()=>{Y(!1);try{await Promise.all([ye(o,b,y,w,g),d!=="/attendance-employee"?ge(o,w):Promise.resolve()])}catch(t){console.error("Error updating attendance data:",t)}finally{Y(!0)}})(),p.current={...p.current,employee:w,filterData:g,selectedDate:o,perPage:y,updateTimeSheet:$,refreshKey:J,currentPage:b}}},[o,b,y,w,g,$,J]),a.useEffect(()=>{k&&fe(k)},[k]),a.useEffect(()=>{C!==void 0&&de(C)},[C]),a.useEffect(()=>{JSON.stringify(g)!==JSON.stringify(p.current.filterData)&&(p.current={...p.current,filterData:{...g}},X())},[g,X]),a.useEffect(()=>{if(!ue||!o)return;le();const s=setInterval(le,5e3);return()=>{clearInterval(s)}},[ue,le,o]),d==="/attendance-employee"?e.jsx("div",{role:"region","aria-label":"Attendance data table",className:"w-full",children:r?e.jsx(oe,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:r})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{orientation:"horizontal",className:"overflow-y-hidden",children:e.jsx(Le,{className:"rounded-lg",isLoaded:z,children:e.jsxs(Ae,{selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:I(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ue,{columns:be,children:s=>e.jsx(We,{align:"start","aria-label":s.ariaLabel||s.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]})},s.uid)}),e.jsx(Ee,{items:j,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(f,{className:"w-16 h-16 text-default-300 mb-4"}),e.jsx("h6",{className:"text-lg font-semibold mb-2",children:"No Attendance Records"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found for the selected date"})]}),children:s=>e.jsx(Te,{children:n=>Ne(s,n)},s.id||s.user_id)})]})})}),m>y&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(De,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:I(),page:b,total:K,onChange:ve,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Timesheet Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(ze.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(oe,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                    var(--theme-content1, #FAFAFA) 20%, 
                                    var(--theme-content2, #F4F4F5) 10%, 
                                    var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(ss,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                        color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                        color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${c?"p-6":_?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                            ${c?"p-3":_?"p-2.5":"p-2"} 
                                                            rounded-xl flex items-center justify-center
                                                        `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(f,{className:`
                                                                ${c?"w-8 h-8":_?"w-6 h-6":"w-5 h-5"}
                                                            `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                ${c?"text-2xl":_?"text-xl":"text-lg"}
                                                                font-bold text-foreground
                                                                ${c?"":"truncate"}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Daily Timesheet"}),e.jsx("p",{className:`
                                                                ${c?"text-sm":"text-xs"} 
                                                                text-default-500
                                                                ${c?"":"truncate"}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(o).toLocaleString("en-US",{month:c?"long":"short",day:"numeric",year:c?"numeric":void 0})})]})]}),"                                                ",e.jsxs("div",{className:"flex items-center gap-4",children:[pe&&e.jsxs("span",{className:"text-xs text-default-500",children:["Updated: ",pe]}),e.jsx("div",{className:"flex items-center gap-2",children:He&&e.jsxs(e.Fragment,{children:[e.jsx(se,{color:"success",variant:"flat",size:c?"md":"sm",radius:I(),startContent:e.jsx(Ye,{className:`
                                                                            ${c?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),onPress:Ve,isDisabled:!z||j.length===0||Q!=="",isLoading:Q==="excel",style:{fontFamily:'var(--fontFamily, "Inter")'},children:c?"Excel":"XLS"}),e.jsx(se,{color:"danger",variant:"flat",size:c?"md":"sm",radius:I(),startContent:e.jsx(Ye,{className:`
                                                                            ${c?"w-4 h-4":"w-3.5 h-3.5"}
                                                                        `}),onPress:Ke,isDisabled:!z||j.length===0||Q!=="",isLoading:Q==="pdf",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"PDF"})]})})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Present: ",m]})]}),T&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-warning"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Absent: ",N.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",m+N.length]})]})]})]})})}),e.jsx(Ie,{}),e.jsx(Me,{children:e.jsx("div",{role:"search","aria-label":"Timesheet filters",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:T&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:e.jsx(ce,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:w,onChange:s=>de(s.target.value),variant:"bordered",size:"sm",radius:I(),startContent:e.jsx(ie,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Search employees"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(ce,{label:"Select Date",type:"date",variant:"bordered",onChange:M,value:new Date(o).toISOString().slice(0,10)||"",size:"sm",radius:I(),startContent:e.jsx(ee,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select date for timesheet"})})]})})})}),e.jsx(Ie,{}),e.jsx(Me,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsx("div",{className:`${T?"lg:flex-1 lg:w-0":"w-full"} min-h-0`,children:r?e.jsx(oe,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:r})]})}):e.jsxs("div",{role:"region","aria-label":"Present employees attendance table",className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h6",{className:"text-lg font-semibold text-foreground flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(W,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Present Employees (",m,")"]})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(Pe,{orientation:"horizontal",className:"overflow-y-hidden flex-1",children:e.jsx(Le,{className:"rounded-lg",isLoaded:z,children:e.jsxs(Ae,{isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:I(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ue,{columns:be,children:s=>e.jsx(We,{align:"start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]})},s.uid)}),e.jsx(Ee,{items:j,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found"})]}),children:s=>e.jsx(Te,{children:n=>Ne(s,n)},s.id||s.user_id)})]})})}),m>y&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(De,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:I(),page:b,total:K,onChange:ve,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})]})}),T&&e.jsx("div",{className:"lg:w-80 lg:flex-shrink-0 h-full",children:e.jsx(cs,{absentUsers:N,selectedDate:o,getUserLeave:Oe,isLoaded:z,onMarkAsPresent:D})})]})})]})})})})})};export{Ps as T};
