import{r as a,R as ve,u as He,j as e,c as fe,a as ue,d as Ve}from"./app-CmFfjWsP.js";import{u as Me,B as V,T as mt,D as Ge,E as Ke,H as Ze,J as Ee,F as ie,s as Je,d as _e,a as Be,c as De,at as ht,W as ft,S as gt,l as Ne,g as ze,h as Qe,C as re,I as Ce,k as ae,au as yt,N as bt,O as jt}from"./App-DKNf4kbj.js";import{u as pe,T as m,G as ct,B as f,t as Xe}from"./logo-Bb-VUmpc.js";import{F as we}from"./TrashIcon-BNDxSKX0.js";import{F as et}from"./PencilIcon-G8jhViOO.js";import{F as tt}from"./EllipsisVerticalIcon-DYnqK8rG.js";import{F as vt}from"./XCircleIcon-BDKkub3n.js";import{F as wt}from"./CheckCircleIcon-B5WT3CBF.js";import{F as Ct}from"./ClockIcon-BQhZqSV8.js";import{F as kt}from"./ExclamationTriangleIcon-B3ukLrRt.js";import{F as Le}from"./UserIcon-C42ICOt3.js";import{F as _t,I as st}from"./InputAdornment-BP2MBWnf.js";import{C as Fe}from"./CardContent-Cjk6s5Uk.js";import{a as Se}from"./colorManipulator-Cwo1EpZz.js";import{e as ce,t as St,a as Dt,b as Nt,c as Ft,d as $t}from"./chunk-F3UDT23P-DZAw_N80.js";import{t as rt}from"./chunk-BOOVDPB6-DSWITBr2.js";import{u as at}from"./chunk-S574QCAN-WXP3Hn5v.js";import{l as nt}from"./chunk-JOT4BT4P-q5jZEdSI.js";import{p as ot}from"./chunk-EAPQ7RWQ-DgLMMHg6.js";import{C as Ye}from"./Clear-DHv5tnIK.js";import{G as Pe}from"./GlassDialog-C5_CkNH7.js";import{D as Ie}from"./DialogTitle-JICgBhou.js";import{D as Re,a as We}from"./DialogContent-RSy4PdMH.js";import{I as $e,T as le,F as ut}from"./TextField-CZkJRVYj.js";import{S as Te,M as se}from"./Select-D2ehSAHQ.js";import{L as ge}from"./LoadingButton-B6iBg8R1.js";import{C as ye}from"./CircularProgress-BjwqTAiA.js";import{D as Tt}from"./DialogContentText-C16qrWWs.js";import{B as qe}from"./Button-CPbP042r.js";import{A as Pt}from"./Avatar-DwP7JS7S.js";import{C as Ae}from"./CardHeader-DQhWvFvf.js";import{F as lt}from"./InformationCircleIcon-DR8HcnxA.js";import{F as It}from"./XCircleIcon-DRvI_4Zc.js";import{F as Ue}from"./ExclamationTriangleIcon-DVI7Fufz.js";import{F as Oe}from"./CheckCircleIcon-DcAHPOOH.js";import{b as Rt}from"./Popover-BA5NTheW.js";import{L as Wt,a as Mt}from"./ListItemText-BA3HGqMp.js";import{D as Et}from"./Divider-BqW5YimP.js";function Bt({title:n,titleId:h,...w},g){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":h},w),n?a.createElement("title",{id:h},n):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const zt=a.forwardRef(Bt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lt=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),qt=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(h,w,g)=>g?g.toUpperCase():w.toLowerCase()),it=n=>{const h=qt(n);return h.charAt(0).toUpperCase()+h.slice(1)},pt=(...n)=>n.filter((h,w,g)=>!!h&&h.trim()!==""&&g.indexOf(h)===w).join(" ").trim(),At=n=>{for(const h in n)if(h.startsWith("aria-")||h==="role"||h==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ht={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=a.forwardRef(({color:n="currentColor",size:h=24,strokeWidth:w=2,absoluteStrokeWidth:g,className:u="",children:x,iconNode:T,...P},y)=>a.createElement("svg",{ref:y,...Ht,width:h,height:h,stroke:n,strokeWidth:g?Number(w)*24/Number(h):w,className:pt("lucide",u),...!x&&!At(P)&&{"aria-hidden":"true"},...P},[...T.map(([k,i])=>a.createElement(k,i)),...Array.isArray(x)?x:[x]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=(n,h)=>{const w=a.forwardRef(({className:g,...u},x)=>a.createElement(Yt,{ref:x,iconNode:h,className:pt(`lucide-${Lt(it(n))}`,`lucide-${n}`,g),...u}));return w.displayName=it(n),w};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],dt=Ut("phone-off",Ot),Vt=ve.forwardRef(({leaves:n,allUsers:h,handleClickOpen:w,setCurrentLeave:g,openModal:u,setLeaves:x,setCurrentPage:T,currentPage:P,totalRows:y,lastPage:k,perPage:i,selectedMonth:_,employee:q,isAdminView:F=!1,onBulkApprove:N,onBulkReject:b,onBulkDelete:v,canApproveLeaves:d=!1,canEditLeaves:R=!1,canDeleteLeaves:D=!1,fetchLeavesStats:Z},Q)=>{var he,de;const{auth:X}=He().props,$=pe(),E=Me("(min-width: 1025px)"),H=Me("(min-width: 641px) and (max-width: 1024px)"),ne=Me("(max-width: 640px)"),[Y,te]=a.useState(!1),[l,C]=a.useState(null),[S,p]=a.useState(new Set);ve.useMemo(()=>Array.from(S).join(", ").replaceAll("_"," "),[S]);const W=ve.useMemo(()=>{const t=S==="all",s=t||S.size>0,r=t?n.length:S.size;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between gap-3 items-end",children:e.jsx("div",{className:"flex gap-3",children:s&&v&&e.jsxs(fe,{color:"danger",variant:"flat",startContent:e.jsx(we,{className:"w-4 h-4"}),onPress:()=>{const c=t?n:n.filter(o=>S.has(o.id.toString()));v(c)},children:["Delete ",r," selected"]})})}),s&&e.jsxs("span",{className:"text-default-400 text-small",children:[r," of ",n.length," selected"]})]})},[S,n,v]);(he=X.permissions)!=null&&he.includes("leaves.view"),(de=X.permissions)!=null&&de.includes("leave.own.view");const I={New:{color:"primary",icon:kt,bgColor:Se($.palette.primary.main,.1),textColor:$.palette.primary.main},Pending:{color:"warning",icon:Ct,bgColor:Se($.palette.warning.main,.1),textColor:$.palette.warning.main},Approved:{color:"success",icon:wt,bgColor:Se($.palette.success.main,.1),textColor:$.palette.success.main},Declined:{color:"danger",icon:vt,bgColor:Se($.palette.error.main,.1),textColor:$.palette.error.main}},z=t=>{switch(t==null?void 0:t.toLowerCase()){case"casual":return e.jsx(ft,{className:"w-3 h-3 text-blue-500"});case"weekend":return e.jsx(ht,{className:"w-3 h-3 text-yellow-500"});case"sick":return e.jsx(_t,{className:"w-3 h-3 text-red-500"});case"earned":return e.jsx(Be,{className:"w-3 h-3 text-green-500"});default:return e.jsx(_e,{className:"w-3 h-3 text-primary"})}},G=a.useCallback(t=>{T&&T(t)},[T]),U=a.useCallback(async(t,s)=>{if(t.status===s)return V.info(`Leave is already ${s}.`),Promise.resolve(`The leave status is already updated to ${s}`);const r=`${t.id}-${s}`;if(l===r)return;C(r);const c=new Promise(async(o,j)=>{var K,B,oe,be;try{const L=await ue.post(route("leave-update-status"),{id:t.id,status:s});L.status===200?(x(je=>je.map(ee=>ee.id===t.id?{...ee,status:s}:ee)),Z(),o(L.data.message||"Leave status updated successfully")):j(((K=L.data)==null?void 0:K.message)||"Failed to update leave status")}catch(L){const je=((oe=(B=L.response)==null?void 0:B.data)==null?void 0:oe.message)||((be=L.response)==null?void 0:be.statusText)||"Failed to update leave status";j(je)}finally{C(null)}});return V.promise(c,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),c},[x,l,Z]),J=t=>{const s=I[t]||I.New,r=s.icon;return e.jsx(De,{size:"sm",variant:"flat",color:s.color,startContent:e.jsx(r,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:t})},O=(t,s)=>{const r=new Date(t),c=new Date(s),o=Math.abs(c-r),j=Math.ceil(o/(1e3*60*60*24))+1;return j===1?"1 day":`${j} days`},M=t=>new Date(t).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),A=t=>(h==null?void 0:h.find(s=>String(s.id)===String(t)))||{name:"Unknown User",phone:""},xe=({leave:t,updatingLeave:s,setCurrentLeave:r,openModal:c,handleClickOpen:o,updateLeaveStatus:j,canEditLeaves:K,canDeleteLeaves:B,canApproveLeaves:oe,isAdminView:be})=>{const L=A(t.user_id),je=O(t.from_date,t.to_date);return I[t.status]||I.New,e.jsx(ct,{className:"mb-2",shadow:"sm",children:e.jsxs(Fe,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:be&&e.jsx(at,{avatarProps:{radius:"lg",size:"sm",src:(L==null?void 0:L.profile_image_url)||(L==null?void 0:L.profile_image),showFallback:!0,name:(L==null?void 0:L.name)||"Unnamed User",isBordered:!0},description:L!=null&&L.phone?e.jsx(nt,{href:`tel:${L==null?void 0:L.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:L==null?void 0:L.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(dt,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(L==null?void 0:L.name)||"Unnamed User"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[J(t.status),(K||B)&&e.jsxs(Ge,{children:[e.jsx(Ke,{children:e.jsx(fe,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e.jsx(tt,{className:"w-4 h-4"})})}),e.jsxs(Ze,{"aria-label":"Leave actions",children:[K&&e.jsx(Ee,{startContent:e.jsx(et,{className:"w-4 h-4"}),onPress:()=>{r(t),c("edit_leave")},children:"Edit Leave"},"edit"),B&&e.jsx(Ee,{className:"text-danger",color:"danger",startContent:e.jsx(we,{className:"w-4 h-4"}),onPress:()=>o(t.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e.jsx(Ve,{className:"my-3"}),e.jsxs(gt,{spacing:2,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4 text-primary"}),e.jsx(m,{variant:"body2",fontWeight:"medium",children:t.leave_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-default-500"}),e.jsxs(m,{variant:"body2",color:"textSecondary",children:[M(t.from_date)," - ",M(t.to_date)]}),e.jsx(De,{size:"sm",variant:"bordered",color:"default",children:je})]}),t.reason&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-default-500 mt-0.5"}),e.jsx(m,{variant:"body2",color:"textSecondary",className:"flex-1",children:t.reason})]})]}),be&&oe&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"my-3"}),e.jsx("div",{className:"flex gap-2",children:["Approved","Declined"].map(ee=>e.jsx(fe,{size:"sm",variant:t.status===ee?"solid":"bordered",color:I[ee].color,isLoading:s===`${t.id}-${ee}`,onPress:()=>{s!==`${t.id}-${ee}`&&j(t,ee)},startContent:s!==`${t.id}-${ee}`?ve.createElement(I[ee].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:ee},ee))})]})]})})},me=a.useCallback((t,s)=>{const r=A(t.user_id);switch(s){case"employee":return e.jsx(ce,{className:"whitespace-nowrap",children:e.jsx(at,{avatarProps:{radius:"lg",size:"sm",src:(r==null?void 0:r.profile_image_url)||(r==null?void 0:r.profile_image),showFallback:!0,name:(r==null?void 0:r.name)||"Unnamed User",isBordered:!0},description:r!=null&&r.phone?e.jsx(nt,{href:`tel:${r==null?void 0:r.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:r==null?void 0:r.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(dt,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(r==null?void 0:r.name)||"Unnamed User"})})});case"leave_type":return e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[z(t.leave_type),e.jsx(m,{variant:"body2",className:"text-sm font-medium capitalize",children:t.leave_type})]})});case"from_date":case"to_date":return e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"w-3 h-3 text-default-500"}),e.jsxs("div",{children:[e.jsx(m,{variant:"body2",className:"text-sm",children:M(t[s])}),s==="from_date"&&e.jsx(m,{variant:"caption",className:"text-xs",color:"textSecondary",children:O(t.from_date,t.to_date)})]})]})});case"status":return e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[J(t.status),F&&d&&e.jsxs(Ge,{children:[e.jsx(Ke,{children:e.jsx(fe,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:l&&l.startsWith(`${t.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e.jsx(tt,{className:"w-4 h-4"})})}),e.jsx(Ze,{"aria-label":"Status actions",onAction:c=>U(t,c),children:Object.keys(I).map(c=>{const o=I[c],j=o.icon;return e.jsx(Ee,{startContent:e.jsx(j,{className:"w-4 h-4"}),color:o.color,children:c},c)})})]})]})});case"reason":return e.jsx(ce,{children:e.jsx(mt,{title:t.reason||"No reason provided",children:e.jsx(m,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:t.reason||"No reason provided"})})});case"actions":return e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[R&&e.jsx(rt,{content:"Edit Leave",children:e.jsx(fe,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:l&&l.startsWith(`${t.id}-`),onPress:()=>{l&&l.startsWith(`${t.id}-`)||(g(t),u("edit_leave"))},className:"min-w-8 h-8",children:e.jsx(et,{className:"w-4 h-4"})})}),D&&e.jsx(rt,{content:"Delete Leave",color:"danger",children:e.jsx(fe,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:l&&l.startsWith(`${t.id}-`),onPress:()=>{l&&l.startsWith(`${t.id}-`)||(g(t),w(t.id,"delete_leave"))},className:"min-w-8 h-8",children:e.jsx(we,{className:"w-4 h-4"})})})]})});default:return e.jsx(ce,{children:t[s]})}},[F,d,E,l,$,g,u,w,U]),ke=[...F?[{name:"Employee",uid:"employee",icon:Le}]:[],{name:"Leave Type",uid:"leave_type",icon:_e},{name:"From Date",uid:"from_date",icon:ie},{name:"To Date",uid:"to_date",icon:ie},{name:"Status",uid:"status",icon:Be},{name:"Reason",uid:"reason",icon:_e},...F?[{name:"Actions",uid:"actions"}]:[]];return ne?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Je,{className:"max-h-[70vh]",children:n.map(t=>e.jsx(xe,{leave:t,updatingLeave:l,setCurrentLeave:g,openModal:u,handleClickOpen:w,updateLeaveStatus:U,canEditLeaves:R,canDeleteLeaves:D,canApproveLeaves:d,isAdminView:F},t.id))}),y>i&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(ot,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:k,onChange:G,size:"sm"})})]}):e.jsxs("div",{className:"max-h-[84vh] overflow-y-auto",children:[e.jsx(Je,{className:"max-h-[70vh]",children:e.jsxs(St,{isStriped:!0,selectionMode:"multiple",selectedKeys:S,onSelectionChange:p,topContent:W,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e.jsx(Dt,{columns:ke,children:t=>e.jsx(Nt,{align:t.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t.icon&&e.jsx(t.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-semibold",children:t.name})]})},t.uid)}),e.jsx(Ft,{items:n,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(ie,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx(m,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e.jsx(m,{variant:"body2",color:"textSecondary",children:q?`No leaves found for "${q}"`:"No leave requests for the selected period"})]}),children:t=>e.jsx($t,{children:s=>me(t,s)},t.id)})]})}),y>i&&e.jsxs("div",{className:"py-4 flex justify-center",children:[e.jsx(ot,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:k,onChange:G,size:H?"sm":"md"}),e.jsxs("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",P," of ",k," (Total: ",y," records)"]})]})]})});Vt.displayName="LeaveEmployeeTable";const xt=({selectedDepartmentId:n,selectedEmployeeId:h,onDepartmentChange:w,onEmployeeChange:g,allUsers:u=[],departments:x=[],showSearch:T=!0,variant:P="outlined",size:y="medium",disabled:k=!1,required:i=!1,error:_={},label:q={department:"Department",employee:"Employee"},showAllOption:F=!0,autoSelectFirstDepartment:N=!0,className:b="",theme:v})=>{var te,l,C,S;const[d,R]=a.useState(""),[D,Z]=a.useState(""),[Q,X]=a.useState(!1);a.useEffect(()=>{if(N&&x.length>0&&!n){const p=x[0];p&&w(p.id)}},[x,n,w,N]);const $=a.useMemo(()=>d.trim()?x.filter(p=>p.name.toLowerCase().includes(d.toLowerCase())||p.id.toString().includes(d)):x,[x,d]),E=a.useMemo(()=>n?u.filter(p=>String(p.department_id)===String(n)):F?u:[],[u,n,F]),H=a.useMemo(()=>D.trim()?E.filter(p=>{var W,I;return p.name.toLowerCase().includes(D.toLowerCase())||((W=p.email)==null?void 0:W.toLowerCase().includes(D.toLowerCase()))||p.id.toString().includes(D)||((I=p.designation)==null?void 0:I.toLowerCase().includes(D.toLowerCase()))}):E,[E,D]);a.useEffect(()=>{n&&h&&(E.some(W=>String(W.id)===String(h))||g(""))},[n,h,E,g]);const ne=a.useCallback(p=>{const W=p.target.value;w(W===""?"":parseInt(W)),h&&g(""),R(""),Z("")},[w,g,h]),Y=a.useCallback(p=>{const W=p.target.value;g(W===""?"":parseInt(W)),Z("")},[g]);return e.jsxs(f,{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${b}`,children:[e.jsxs(Ne,{variant:P,size:y,error:!!_.department_id,disabled:k,required:i,fullWidth:!0,children:[e.jsx($e,{id:"department-select-label",children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4"}),q.department]})}),e.jsxs(Te,{labelId:"department-select-label",value:n?String(n):"",onChange:ne,label:q.department,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:((te=v==null?void 0:v.glassCard)==null?void 0:te.background)||"rgba(255, 255, 255, 0.1)",border:((l=v==null?void 0:v.glassCard)==null?void 0:l.border)||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,maxHeight:400}},disableAutoFocusItem:!0},children:[T&&e.jsx(se,{disableRipple:!0,sx:{py:1,borderBottom:"1px solid rgba(255, 255, 255, 0.1)","&:hover":{backgroundColor:"transparent"},cursor:"default"},onKeyDown:p=>p.stopPropagation(),children:e.jsx(le,{placeholder:"Search departments...",value:d,onChange:p=>{p.stopPropagation(),R(p.target.value)},size:"small",fullWidth:!0,variant:"outlined",autoFocus:!1,InputProps:{startAdornment:e.jsx(st,{position:"start",children:e.jsx(Qe,{className:"w-4 h-4 text-gray-400"})})},onClick:p=>p.stopPropagation(),onMouseDown:p=>p.stopPropagation(),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"}}}})}),F&&e.jsx(se,{value:"",children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx(m,{children:"All Departments"})]})}),$.map(p=>e.jsx(se,{value:String(p.id),children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx(m,{children:p.name}),e.jsx(re,{label:u.filter(W=>W.department_id===p.id).length,size:"small",variant:"outlined",sx:{ml:"auto",fontSize:"0.7rem"}})]})},p.id)),$.length===0&&d&&e.jsx(se,{disabled:!0,children:e.jsxs(m,{variant:"body2",color:"text.secondary",children:['No departments found matching "',d,'"']})})]}),_.department_id&&e.jsx(m,{variant:"caption",color:"error",sx:{mt:.5},children:_.department_id})]}),e.jsxs(Ne,{variant:P,size:y,error:!!_.user_id,disabled:k||Q||!n&&!F,required:i,fullWidth:!0,children:[e.jsx($e,{id:"employee-select-label",children:e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4"}),q.employee,!n&&!F&&e.jsx(m,{variant:"caption",color:"text.secondary",children:"(Select department first)"})]})}),e.jsxs(Te,{labelId:"employee-select-label",value:h?String(h):"",onChange:Y,label:q.employee,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:((C=v==null?void 0:v.glassCard)==null?void 0:C.background)||"rgba(255, 255, 255, 0.1)",border:((S=v==null?void 0:v.glassCard)==null?void 0:S.border)||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,maxHeight:400}},disableAutoFocusItem:!0},children:[T&&e.jsx(se,{disableRipple:!0,sx:{py:1,borderBottom:"1px solid rgba(255, 255, 255, 0.1)","&:hover":{backgroundColor:"transparent"},cursor:"default"},onKeyDown:p=>p.stopPropagation(),children:e.jsx(le,{placeholder:"Search employees...",value:D,onChange:p=>{p.stopPropagation(),Z(p.target.value)},size:"small",fullWidth:!0,variant:"outlined",autoFocus:!1,InputProps:{startAdornment:e.jsx(st,{position:"start",children:e.jsx(Qe,{className:"w-4 h-4 text-gray-400"})})},onClick:p=>p.stopPropagation(),onMouseDown:p=>p.stopPropagation(),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"}}}})}),F&&e.jsx(se,{value:"",children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Le,{className:"w-4 h-4"}),e.jsx(m,{children:n?"All Employees in Department":"Select Department First"})]})}),H.map(p=>{var W,I;return e.jsx(se,{value:String(p.id),children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e.jsx(Pt,{src:p.profile_image_url||p.profile_image,sx:{width:24,height:24},children:(I=(W=p.name)==null?void 0:W.charAt(0))==null?void 0:I.toUpperCase()}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",flex:1},children:[e.jsx(m,{variant:"body2",sx:{fontWeight:500},children:p.name}),p.designation&&e.jsx(m,{variant:"caption",color:"text.secondary",children:p.designation})]}),p.department&&e.jsx(re,{label:p.department,size:"small",variant:"outlined",sx:{fontSize:"0.6rem",height:"20px"}})]})},p.id)}),H.length===0&&e.jsx(se,{disabled:!0,children:e.jsx(m,{variant:"body2",color:"text.secondary",children:n?"No employees found in selected department":"No employees found"})})]}),_.user_id&&e.jsx(m,{variant:"caption",color:"error",sx:{mt:.5},children:_.user_id})]})]})},Rs=({open:n,closeModal:h,leavesData:w,setLeavesData:g,currentLeave:u,allUsers:x,departments:T=[],setTotalRows:P,setLastPage:y,setLeaves:k,handleMonthChange:i,employee:_,selectedMonth:q,addLeaveOptimized:F,updateLeaveOptimized:N,fetchLeavesStats:b})=>{var t;const{auth:v}=He().props,d=pe(),[R,D]=a.useState((u==null?void 0:u.user_id)||v.user.id),Z=()=>{var s;if(u!=null&&u.user_id){const r=x==null?void 0:x.find(c=>c.id===u.user_id);return(r==null?void 0:r.department_id)||null}return((s=v==null?void 0:v.user)==null?void 0:s.department_id)||null},[Q,X]=a.useState(Z()),[$,E]=a.useState((w==null?void 0:w.leaveTypes)||[]),[H,ne]=a.useState([]),[Y,te]=a.useState((u==null?void 0:u.leave_type)||""),l=s=>{if(!s)return new Date().toISOString().split("T")[0];if(typeof s=="string"&&s.match(/^\d{4}-\d{2}-\d{2}$/))return s;if(typeof s=="string"&&s.includes("T")){if(s.includes("T18:00:00")){const c=s.split("T")[0].split("-"),o=parseInt(c[0]),j=parseInt(c[1]),K=parseInt(c[2])+1;return new Date(o,j-1,K).toISOString().split("T")[0]}return s.split("T")[0]}try{const r=new Date(s);if(isNaN(r.getTime()))return new Date().toISOString().split("T")[0];const c=r.getFullYear(),o=String(r.getMonth()+1).padStart(2,"0"),j=String(r.getDate()).padStart(2,"0");return`${c}-${o}-${j}`}catch(r){return console.error("Error formatting date:",r),new Date().toISOString().split("T")[0]}},[C,S]=a.useState(u!=null&&u.from_date?l(u.from_date):""),[p,W]=a.useState(u!=null&&u.to_date?l(u.to_date):""),[I,z]=a.useState((u==null?void 0:u.no_of_days)||""),[G,U]=a.useState(""),[J,O]=a.useState((u==null?void 0:u.reason)||""),[M,A]=a.useState({}),[xe,me]=a.useState(!1),[ke,he]=a.useState("");a.useEffect(()=>{var s,r;if(w){E(w.leaveTypes||[]);const c=((s=w.leaveCountsByUser)==null?void 0:s[R])||[];if(ne(c),$.length>0&&!Y&&!u&&te($[0].type),u&&!Y){const o=(r=w.leaveTypes)==null?void 0:r.find(j=>j.id===u.leave_type);o&&te(o.type)}}},[w,R,u]),a.useEffect(()=>{if(u){D(u.user_id);const s=x==null?void 0:x.find(r=>r.id===u.user_id);s!=null&&s.department_id&&X(s.department_id)}},[u,x]),a.useEffect(()=>{if(!Y||!H||!$)return;const s=H.find(o=>o.leave_type===Y),r=(s==null?void 0:s.days_used)||0;he(r);const c=$.find(o=>o.type===Y);if(c){const o=c.days-r;U(o),u&&I>o&&z(o)}},[Y,H,$,u,I]),a.useEffect(()=>{z(((r,c)=>{if(!r||!c)return"";const o=new Date(r),j=new Date(c);if(o>j)return"";const K=j.getTime()-o.getTime();return Math.ceil(K/(1e3*3600*24))+1})(C,p))},[C,p]);const de=async s=>{s.preventDefault(),me(!0);const r=new Promise(async(c,o)=>{try{const j={route:route().current(),user_id:R,leaveType:Y,fromDate:C,toDate:p,daysCount:I,leaveReason:J,employee:_,month:q},K=u?route("leave-update"):route("leave-add");u&&(j.id=u.id);const B=await axios.post(K,j);B.status===200||B.status===201?(g(B.data.leavesData),u&&N&&B.data.leave?(N(B.data.leave),b()):F&&B.data.leave?(F(B.data.leave),b(),B.data.pagination&&(P(B.data.pagination.total),y(B.data.pagination.lastPage))):(console.log("Using fallback data update mode"),B.data.leaves&&(k(B.data.leaves.data),P(B.data.leaves.total),y(B.data.leaves.last_page)),B.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(B.data.leavesData)),h(),c([B.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",B.status),o(`Unexpected response status: ${B.status}`))}catch(j){console.error("Full error object:",j),j.response?(console.error("Error response status:",j.response.status),console.error("Error response data:",j.response.data),j.response.status===422?(A(j.response.data.errors||{}),o(j.response.data.error||"Failed to submit leave application")):o(`HTTP Error ${j.response.status}: ${j.response.data.message||"An unexpected error occurred. Please try again later."}`)):j.request?(console.error("No response received:",j.request),o("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",j.message),o("An error occurred while setting up the request."))}finally{me(!1)}});V.promise(r,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}},success:{render({data:c}){return e.jsx(e.Fragment,{children:c.map((o,j)=>e.jsx("div",{children:o},j))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}},error:{render({data:c}){return e.jsx(e.Fragment,{children:c})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,color:d.palette.text.primary}}})};return e.jsxs(Pe,{open:n,onClose:h,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(Ie,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{variant:"h6",component:"h2",children:u?"Edit Leave":"Add Leave"}),e.jsx(Ce,{onClick:h,sx:{position:"absolute",top:8,right:16},children:e.jsx(Ye,{})})]}),e.jsxs("form",{onSubmit:de,children:[e.jsx(Re,{children:e.jsxs(ae,{container:!0,spacing:2,children:[e.jsx(ae,{item:!0,xs:12,md:6,children:e.jsxs(Ne,{fullWidth:!0,children:[e.jsx($e,{id:"leave-type-label",children:"Leave Type"}),e.jsxs(Te,{labelId:"leave-type-label",value:Y||"",onChange:s=>te(s.target.value),label:"Leave Type",error:!!M.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:d.glassCard.background,border:d.glassCard.border,borderRadius:2,boxShadow:d.glassCard.boxShadow,maxHeight:300}}},children:[e.jsx(se,{value:"",disabled:!0,children:"Select Leave Type"}),$.map(s=>{const r=H==null?void 0:H.find(j=>j.leave_type===s.type),o=(r?s.days-r.days_used:s.days)<=0;return e.jsx(se,{value:s.type,disabled:o,title:o?"No remaining leaves available":"",children:e.jsxs(f,{display:"flex",justifyContent:"space-between",width:"100%",children:[e.jsx("span",{children:s.type}),e.jsx("span",{children:r?`${r.days_used} / ${s.days} days`:`${s.days} days`})]})},s.id)})]}),e.jsx(ut,{children:M.leaveType})]})}),e.jsx(ae,{item:!0,xs:12,md:6,children:e.jsx(le,{label:"From",type:"date",fullWidth:!0,value:C,onChange:s=>S(s.target.value),InputLabelProps:{shrink:!0},error:!!M.fromDate,helperText:M.fromDate})}),e.jsx(ae,{item:!0,xs:12,md:6,children:e.jsx(le,{label:"To",type:"date",fullWidth:!0,value:p,onChange:s=>W(s.target.value),InputLabelProps:{shrink:!0},error:!!M.toDate,helperText:M.toDate})}),e.jsx(ae,{item:!0,xs:12,md:6,children:e.jsx(le,{label:"Number of days",type:"text",fullWidth:!0,value:I,InputProps:{readOnly:!0},error:!!M.daysCount,helperText:M.daysCount})}),e.jsx(ae,{item:!0,xs:12,md:6,children:e.jsx(le,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${G} day${G!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:e.jsxs(m,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",((t=$.find(s=>s.type===Y))==null?void 0:t.days)||0," total"]})},error:!!M.remainingLeaves,helperText:M.remainingLeaves})}),route().current()==="leaves"&&e.jsx(ae,{item:!0,xs:12,children:e.jsx(xt,{selectedDepartmentId:Q,selectedEmployeeId:R,onDepartmentChange:X,onEmployeeChange:D,allUsers:x,departments:T,showSearch:!0,error:M,theme:d,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e.jsx(ae,{item:!0,xs:12,children:e.jsx(le,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:J,onChange:s=>O(s.target.value),error:!!M.leaveReason,helperText:M.leaveReason})})]})}),e.jsx(We,{sx:{padding:"16px",justifyContent:"center"},children:e.jsx(ge,{type:"submit",variant:"outlined",color:"primary",loading:xe,disabled:xe,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ws=({open:n,closeModal:h,leaveId:w,setLeavesData:g,setLeaves:u,setTotalRows:x,setLastPage:T,setError:P,deleteLeaveOptimized:y,fetchLeavesStats:k})=>{const i=pe(),[_,q]=a.useState(!1),F=()=>{if(!w){const b=Promise.reject(new Error("Invalid leave ID"));V.promise(b,{error:"Invalid leave ID provided"});return}q(!0);const N=new Promise(async(b,v)=>{var d,R,D,Z,Q,X,$;try{const E=await ue.delete(route("leave-delete",{id:w,route:route().current()}));E.status===200&&(y?(y(w),x(H=>Math.max(0,H-1)),k&&k()):(g&&g(E.data.leavesData),x&&x(E.data.leaves.total),T&&T(E.data.leaves.last_page),u&&u(E.data.leaves.data),P&&P(!1),k&&k()),b("Leave application deleted successfully"))}catch(E){if(console.error("Error deleting leave:",E),((d=E.response)==null?void 0:d.status)===404){const{leavesData:H}=E.response.data||{};g&&H&&g(H),P&&P(((D=(R=E.response)==null?void 0:R.data)==null?void 0:D.message)||"Leave not found."),v("Leave not found or already deleted")}else((Z=E.response)==null?void 0:Z.status)===403?v("You do not have permission to delete this leave"):((Q=E.response)==null?void 0:Q.status)===422?v("Cannot delete leave with current status"):v((($=(X=E.response)==null?void 0:X.data)==null?void 0:$.error)||"Failed to delete leave application")}finally{q(!1),h()}});V.promise(N,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}},success:{render({data:b}){return e.jsx(e.Fragment,{children:b})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}},error:{render({data:b}){return e.jsx(e.Fragment,{children:b})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}}})};return e.jsxs(Pe,{open:n,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(Ie,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(Re,{children:e.jsx(Tt,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),e.jsxs(We,{children:[e.jsx(qe,{onClick:h,color:"primary",disabled:_,children:"Cancel"}),e.jsx(qe,{loading:_,disabled:_,onClick:F,color:"error",autoFocus:!0,children:"Delete"})]})]})},Gt=({selectedDates:n=[],onDatesChange:h,existingLeaves:w=[],publicHolidays:g=[],minDate:u=null,maxDate:x=null,userId:T=null,fetchFromAPI:P=!1})=>{const y=pe(),[k,i]=a.useState(new Date),[_,q]=a.useState({existingLeaves:w,publicHolidays:g}),[F,N]=a.useState(!1),[b,v]=a.useState(null),d=a.useCallback(async l=>{if(!(!P||!T)&&b!==l){N(!0);try{const C=await ue.get(route("leaves.bulk.calendar-data"),{params:{user_id:T,year:l}});C.data.success&&(q({existingLeaves:C.data.data.existingLeaves||[],publicHolidays:C.data.data.publicHolidays||[]}),v(l))}catch(C){console.error("Failed to fetch calendar data:",C)}finally{N(!1)}}},[P,T,b]);a.useEffect(()=>{const l=k.getFullYear();d(l)},[d,k.getFullYear()]),a.useEffect(()=>{P&&T&&v(null)},[T,P]);const R=P?_.existingLeaves:w,D=P?_.publicHolidays:g,Z=a.useMemo(()=>{const l=k.getFullYear(),C=k.getMonth(),S=new Date(l,C,1),W=new Date(l,C+1,0).getDate(),I=S.getDay(),z=new Date(l,C,0).getDate(),G=[];for(let A=I-1;A>=0;A--)G.push({date:z-A,isCurrentMonth:!1,fullDate:new Date(l,C-1,z-A)});const U=[];for(let A=1;A<=W;A++)U.push({date:A,isCurrentMonth:!0,fullDate:new Date(l,C,A)});const O=42-(G.length+U.length),M=[];for(let A=1;A<=O;A++)M.push({date:A,isCurrentMonth:!1,fullDate:new Date(l,C+1,A)});return[...G,...U,...M]},[k]),Q=a.useCallback(()=>{i(l=>new Date(l.getFullYear(),l.getMonth()-1,1))},[]),X=a.useCallback(()=>{i(l=>new Date(l.getFullYear(),l.getMonth()+1,1))},[]),$=a.useCallback(()=>{i(new Date)},[]),E=a.useCallback(l=>{if(!l.isCurrentMonth||F)return;const C=l.fullDate.getFullYear()+"-"+String(l.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(l.fullDate.getDate()).padStart(2,"0"),S=R.some(z=>{if(!z.from_date||!z.to_date)return!1;const G=z.from_date.split("T")[0],U=z.to_date.split("T")[0];return C>=G&&C<=U}),p=D.includes(C);if(S||p||u&&l.fullDate<new Date(u)||x&&l.fullDate>new Date(x))return;const W=n.includes(C);let I;W?I=n.filter(z=>z!==C):I=[...n,C],h(I.sort())},[n,h,u,x,F,R,D]),H=a.useCallback(l=>{if(!l.isCurrentMonth)return{selectable:!1};const C=l.fullDate.getFullYear()+"-"+String(l.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(l.fullDate.getDate()).padStart(2,"0"),S=n.includes(C),p=l.fullDate.toDateString()===new Date().toDateString(),W=l.fullDate<new Date().setHours(0,0,0,0),I=l.fullDate.getDay()===0||l.fullDate.getDay()===6,z=R.some(J=>{if(!J.from_date||!J.to_date)return!1;const O=J.from_date.split("T")[0],M=J.to_date.split("T")[0];return C>=O&&C<=M}),G=D.includes(C),U=!F&&!z&&!G&&(!u||l.fullDate>=new Date(u))&&(!x||l.fullDate<=new Date(x));return{isSelected:S,isToday:p,isPast:W,isWeekend:I,hasExistingLeave:z,isPublicHoliday:G,selectable:U}},[n,R,D,u,x,F]),ne=a.useCallback((l,C)=>l.isCurrentMonth?F?{color:y.palette.text.disabled,cursor:"not-allowed",backgroundColor:y.palette.action.disabledBackground,opacity:.5,pointerEvents:"none"}:C.isSelected?{backgroundColor:y.palette.primary.main,color:y.palette.primary.contrastText,fontWeight:"bold",border:`2px solid ${y.palette.primary.dark}`,boxShadow:`0 0 0 3px ${y.palette.primary.main}30`,transform:"scale(1.05)",zIndex:10}:C.hasExistingLeave?{backgroundColor:y.palette.error.main,color:y.palette.error.contrastText,border:`2px solid ${y.palette.error.dark}`,fontWeight:500,cursor:"not-allowed"}:C.isPublicHoliday?{backgroundColor:y.palette.warning.main,color:y.palette.warning.contrastText,border:`2px solid ${y.palette.warning.dark}`,fontWeight:500,cursor:"not-allowed"}:C.isToday?{backgroundColor:y.palette.secondary.light,color:y.palette.secondary.contrastText,fontWeight:600,border:`2px solid ${y.palette.secondary.main}`,boxShadow:`0 0 0 2px ${y.palette.secondary.main}40`,"&:hover":{backgroundColor:y.palette.secondary.main,transform:"scale(1.02)"}}:C.isWeekend?{color:y.palette.text.secondary,backgroundColor:y.palette.action.hover,border:`1px solid ${y.palette.divider}`,opacity:.7,"&:hover":{backgroundColor:y.palette.action.selected,opacity:.9}}:C.selectable?{color:y.palette.text.primary,border:"1px solid transparent","&:hover":{backgroundColor:y.palette.primary.main+"15",color:y.palette.primary.main,border:`1px solid ${y.palette.primary.main}30`,transform:"scale(1.02)"}}:{color:y.palette.text.disabled,cursor:"not-allowed",backgroundColor:y.palette.action.disabledBackground,opacity:.6}:{color:y.palette.text.disabled,cursor:"not-allowed",opacity:.3},[y,F]),Y=k.toLocaleDateString("en-US",{month:"long",year:"numeric"}),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs(ct,{variant:"outlined",sx:{width:"100%"},children:[e.jsx(Ae,{title:e.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{style:{width:20,height:20,color:y.palette.primary.main}}),e.jsx(m,{variant:"h6",component:"h3",children:Y}),P&&b&&e.jsx(re,{size:"small",variant:"outlined",color:"primary",label:`Data: ${b}`,sx:{ml:1,fontSize:"0.7rem"}})]}),e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ce,{size:"small",onClick:Q,sx:{color:"text.secondary"},disabled:F,children:e.jsx(zt,{style:{width:16,height:16}})}),e.jsx(qe,{variant:"text",size:"small",onClick:$,sx:{minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem",textTransform:"none"},disabled:F,children:"Today"}),e.jsx(Ce,{size:"small",onClick:X,sx:{color:"text.secondary"},disabled:F,children:e.jsx(yt,{style:{width:16,height:16}})})]})]}),sx:{pb:2}}),e.jsxs(Fe,{sx:{pt:0},children:[F&&e.jsxs(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,backgroundColor:y.palette.action.hover,borderRadius:2,mb:3},children:[e.jsx(ye,{size:24}),e.jsxs(m,{variant:"body2",sx:{ml:2},children:["Loading calendar data for ",k.getFullYear(),"..."]})]}),e.jsxs(f,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:[e.jsx(re,{size:"small",variant:"filled",color:"primary",label:"Selected",sx:{fontWeight:600}}),e.jsx(re,{size:"small",variant:"filled",color:"error",label:"Existing Leave",sx:{opacity:.9}}),e.jsx(re,{size:"small",variant:"filled",color:"warning",label:"Holiday",sx:{opacity:.9}}),e.jsx(re,{size:"small",variant:"filled",color:"secondary",label:"Today",sx:{fontWeight:600}}),e.jsx(re,{size:"small",variant:"outlined",color:"default",label:"Weekend",sx:{opacity:.7}})]}),e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:1},children:te.map(l=>e.jsx(f,{sx:{textAlign:"center",py:1,fontSize:"0.875rem",fontWeight:"medium",color:"text.secondary"},children:l},l))}),e.jsx(f,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5},children:Z.map((l,C)=>{const S=H(l),p=ne(l,S);return e.jsxs(f,{onClick:()=>E(l),sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,minHeight:40,cursor:S.selectable?"pointer":"not-allowed",borderRadius:1.5,transition:"all 0.2s ease-in-out",fontSize:"0.875rem",userSelect:"none",...p},role:"button",tabIndex:S.selectable?0:-1,title:S.hasExistingLeave?"Existing leave - cannot select":S.isPublicHoliday?"Public holiday - cannot select":S.selectable?"":"Not selectable","aria-label":`${l.fullDate.toDateString()}${S.isSelected?" (selected)":""}${S.hasExistingLeave?" (existing leave)":""}${S.isPublicHoliday?" (public holiday)":""}`,onKeyDown:W=>{(W.key==="Enter"||W.key===" ")&&(W.preventDefault(),E(l))},children:[l.date,S.isWeekend&&!S.isSelected&&!S.hasExistingLeave&&!S.isPublicHoliday&&e.jsx(f,{sx:{position:"absolute",top:2,right:2,width:4,height:4,borderRadius:"50%",bgcolor:"text.secondary",opacity:.5}})]},C)})}),n.length>0&&e.jsxs(f,{sx:{mt:3,p:2.5,borderRadius:2,background:`linear-gradient(135deg, ${y.palette.primary.light}20, ${y.palette.primary.main}10)`,border:`1px solid ${y.palette.primary.main}30`,backdropFilter:"blur(8px)",position:"relative",overflow:"hidden"},children:[e.jsxs(f,{sx:{position:"relative",zIndex:1},children:[e.jsxs(m,{variant:"body2",color:"primary.main",fontWeight:"600",sx:{mb:1},children:["📅 ",n.length," date",n.length!==1?"s":""," selected"]}),e.jsxs(f,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[n.slice(0,12).map(l=>e.jsx(re,{size:"small",variant:"filled",color:"primary",label:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"}),sx:{fontWeight:500,fontSize:"0.75rem"}},l)),n.length>12&&e.jsx(re,{size:"small",variant:"outlined",color:"primary",label:`+${n.length-12} more`,sx:{fontWeight:500}})]})]}),e.jsx(f,{sx:{position:"absolute",top:-10,right:-10,width:60,height:60,borderRadius:"50%",background:`linear-gradient(45deg, ${y.palette.primary.main}15, transparent)`,opacity:.3}})]})]})]})},Kt=({validationResults:n=[],balanceImpact:h=null,isValidating:w=!1})=>{const g=pe();if(n.length===0&&!w)return null;const u=n.filter(i=>i.status==="valid").length,x=n.filter(i=>i.status==="warning").length,T=n.filter(i=>i.status==="conflict").length;n.length;const P=i=>{const _={style:{width:16,height:16}};switch(i){case"valid":return e.jsx(Oe,{..._,style:{..._.style,color:g.palette.success.main}});case"warning":return e.jsx(Ue,{..._,style:{..._.style,color:g.palette.warning.main}});case"conflict":return e.jsx(It,{..._,style:{..._.style,color:g.palette.error.main}});default:return e.jsx(lt,{..._,style:{..._.style,color:g.palette.text.disabled}})}},y=i=>{switch(i){case"valid":return"success";case"warning":return"warning";case"conflict":return"error";default:return"default"}},k=i=>new Date(i).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(Xe,{variant:"outlined",children:[e.jsx(Ae,{title:e.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx(m,{variant:"h6",children:"Validation Results"}),w&&e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ye,{size:16}),e.jsx(m,{variant:"body2",color:"text.secondary",children:"Validating..."})]})]})}),e.jsxs(Fe,{sx:{pt:0},children:[e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mb:2},children:[e.jsxs(f,{sx:{textAlign:"center"},children:[e.jsx(m,{variant:"h4",color:"success.main",fontWeight:"bold",children:u}),e.jsx(m,{variant:"body2",color:"success.main",children:"Valid"})]}),e.jsxs(f,{sx:{textAlign:"center"},children:[e.jsx(m,{variant:"h4",color:"warning.main",fontWeight:"bold",children:x}),e.jsx(m,{variant:"body2",color:"warning.main",children:"Warnings"})]}),e.jsxs(f,{sx:{textAlign:"center"},children:[e.jsx(m,{variant:"h4",color:"error.main",fontWeight:"bold",children:T}),e.jsx(m,{variant:"body2",color:"error.main",children:"Conflicts"})]})]}),h&&e.jsxs(f,{sx:{p:2,borderRadius:2,background:g.palette.background.paper,border:`1px solid ${g.palette.divider}`},children:[e.jsxs(m,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e.jsx(lt,{style:{width:16,height:16,color:g.palette.primary.main}}),"Leave Balance Impact"]}),e.jsxs(f,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[e.jsxs(f,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",component:"span",children:"Leave Type:"}),e.jsx(m,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:h.leave_type})]}),e.jsxs(f,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",component:"span",children:"Current Balance:"}),e.jsxs(m,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[h.current_balance," days"]})]}),e.jsxs(f,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",component:"span",children:"Requested Days:"}),e.jsxs(m,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[h.requested_days," days"]})]}),e.jsxs(f,{children:[e.jsx(m,{variant:"body2",color:"text.secondary",component:"span",children:"Remaining Balance:"}),e.jsxs(m,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1,color:h.remaining_balance<0?"error.main":"success.main"},children:[h.remaining_balance," days"]})]})]}),h.remaining_balance<0&&e.jsx(f,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"error.light",border:1,borderColor:"error.main"},children:e.jsxs(m,{variant:"body2",color:"error.main",children:["⚠️ This request exceeds your available leave balance by ",Math.abs(h.remaining_balance)," days."]})})]})]})]}),n.length>0&&e.jsxs(Xe,{variant:"outlined",children:[e.jsx(Ae,{title:e.jsx(m,{variant:"h6",children:"Date-by-Date Results"})}),e.jsx(Fe,{children:e.jsx(f,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:240,overflowY:"auto"},children:n.map((i,_)=>e.jsxs(f,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2,borderRadius:2,border:1,borderColor:"divider","&:hover":{borderColor:"text.secondary"},transition:"border-color 0.2s"},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2},children:[P(i.status),e.jsxs(f,{children:[e.jsx(m,{variant:"body2",fontWeight:"medium",children:k(i.date)}),e.jsx(m,{variant:"caption",color:"text.secondary",children:i.date})]})]}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e.jsx(re,{size:"small",variant:"outlined",color:y(i.status),label:i.status,sx:{textTransform:"capitalize"}}),i.errors&&i.errors.length>0&&e.jsx(f,{sx:{textAlign:"right"},children:i.errors.map((q,F)=>e.jsx(m,{variant:"caption",color:"error.main",children:q},F))}),i.warnings&&i.warnings.length>0&&e.jsx(f,{sx:{textAlign:"right"},children:i.warnings.map((q,F)=>e.jsx(m,{variant:"caption",color:"warning.main",children:q},F))})]})]},_))})})]})]})},Ms=({open:n,onClose:h,onSuccess:w,allUsers:g=[],departments:u=[],leavesData:x={leaveTypes:[],leaveCountsByUser:{}},isAdmin:T=!1,existingLeaves:P=[],publicHolidays:y=[]})=>{var de;const{auth:k}=He().props,i=pe(),[_,q]=a.useState([]),[F,N]=a.useState(null),[b,v]=a.useState(null),[d,R]=a.useState(""),[D,Z]=a.useState(""),[Q,X]=a.useState(!1),[$,E]=a.useState([]),[H,ne]=a.useState(!1),[Y,te]=a.useState([]),[l,C]=a.useState(null),[S,p]=a.useState(!1),[W,I]=a.useState(!1),[z,G]=a.useState(!1),[U,J]=a.useState({});a.useMemo(()=>!P||P.length===0?[]:P.filter(t=>t.user_id===parseInt(b)),[P,b]);const O=a.useMemo(()=>$.length>0?$:(x==null?void 0:x.leaveTypes)||[],[$,x]),M=a.useMemo(()=>{var t;return $.length>0?$.map(s=>({leave_type:s.type,days_used:s.used,total_days:s.days,remaining_days:s.remaining})):((t=x==null?void 0:x.leaveCountsByUser)==null?void 0:t[b])||[]},[$,x,b]),A=a.useCallback(async t=>{if(t){ne(!0);try{const s=await ue.get(route("leaves.bulk.leave-types"),{params:{user_id:t,year:new Date().getFullYear()}});s.data.success&&E(s.data.leave_types)}catch(s){console.error("Failed to fetch user leave types:",s),E([])}finally{ne(!1)}}},[]);a.useEffect(()=>{(n&&b&&T||n&&b&&!T)&&A(b)},[b,n,T,A]),a.useEffect(()=>{if(n&&(k!=null&&k.user)){const t=g==null?void 0:g.find(s=>s.id===k.user.id);(t&&t.department_id&&!T||T&&!F&&!b&&t&&t.department_id)&&(N(t.department_id),v(k.user.id))}},[n,k==null?void 0:k.user,g,T,F,b]),a.useEffect(()=>{var t;n||(q([]),N(null),v(((t=k==null?void 0:k.user)==null?void 0:t.id)||null),R(""),Z(""),X(!1),te([]),C(null),I(!1),J({}),E([]))},[n,(de=k==null?void 0:k.user)==null?void 0:de.id]),a.useEffect(()=>{if(O.length>0&&!d&&n&&b){const t=O.find(s=>{if($.length>0)return s.remaining>0;const r=M==null?void 0:M.find(o=>o.leave_type===s.type);return(r?s.days-r.days_used:s.days)>0});t&&R(t.type)}},[O,M,$,d,n,b]);const xe=a.useCallback(async()=>{var t,s,r;if(_.length===0){const c=Promise.reject(new Error("No dates selected"));V.promise(c,{error:"Please select at least one date"});return}if(!d){const c=Promise.reject(new Error("No leave type selected"));V.promise(c,{error:"Please select a leave type"});return}if(!D.trim()||D.trim().length<5){const c=new Promise((o,j)=>{j("Please provide a reason for leave (at least 5 characters)")});V.promise(c,{error:{render({data:o}){return e.jsx(e.Fragment,{children:o})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}}});return}p(!0),J({});try{const c=O.find(j=>j.type===d),o=await ue.post(route("leaves.bulk.validate"),{user_id:parseInt(b),dates:_,leave_type_id:c==null?void 0:c.id,reason:D.trim()});if(o.data.success){te(o.data.validation_results),C(o.data.estimated_balance_impact),I(!0);const j=o.data.validation_results.filter(oe=>oe.status==="conflict").length,K=o.data.validation_results.filter(oe=>oe.status==="warning").length,B=Promise.resolve();j>0?V.promise(B,{success:`${j} date(s) have conflicts. Please review before submitting.`}):K>0?V.promise(B,{success:`${K} date(s) have warnings. You may proceed if acceptable.`}):V.promise(B,{success:"All dates validated successfully!"})}}catch(c){console.error("Validation error:",c),((t=c.response)==null?void 0:t.status)===422&&J(c.response.data.errors||{});const o=Promise.reject(c);V.promise(o,{error:((r=(s=c.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to validate dates"})}finally{p(!1)}},[_,d,D,b,O]),me=a.useCallback(async()=>{if(!W){const r=Promise.reject(new Error("Not validated"));V.promise(r,{error:"Please validate dates before submitting"});return}if(Y.filter(r=>r.status==="conflict").length>0&&!Q){const r=new Promise((c,o)=>{o("Please resolve conflicts or enable partial success mode")});V.promise(r,{error:{render({data:c}){return e.jsx(e.Fragment,{children:c})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}}});return}G(!0);const s=new Promise(async(r,c)=>{try{const o=O.find(K=>K.type===d),j=await ue.post(route("leaves.bulk.store"),{user_id:parseInt(b),dates:_,leave_type_id:o==null?void 0:o.id,reason:D.trim(),allow_partial_success:Q});j.status===200||j.status===201?(w==null||w(j.data),h(),r([j.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",j.status),c(`Unexpected response status: ${j.status}`))}catch(o){console.error("Full error object:",o),o.response?(console.error("Error response status:",o.response.status),console.error("Error response data:",o.response.data),o.response.status===422?(J(o.response.data.errors||{}),c(o.response.data.error||"Failed to submit bulk leave requests")):c(`HTTP Error ${o.response.status}: ${o.response.data.message||"An unexpected error occurred. Please try again later."}`)):o.request?(console.error("No response received:",o.request),c("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",o.message),c("An error occurred while setting up the request."))}finally{G(!1)}});V.promise(s,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}},success:{render({data:r}){return e.jsx(e.Fragment,{children:r.map((c,o)=>e.jsx("div",{children:c},o))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}},error:{render({data:r}){return e.jsx(e.Fragment,{children:r})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}}})},[W,Y,Q,b,_,d,D,w,h,O,i]),ke=_.length>0&&d&&D.trim().length>=5,he=W&&(Y.filter(t=>t.status==="conflict").length===0||Q);return e.jsxs(Pe,{open:n,onClose:h,fullWidth:!0,maxWidth:"lg",children:[e.jsxs(Ie,{sx:{display:"flex",alignItems:"center",pb:1},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e.jsx(ie,{style:{width:24,height:24,color:i.palette.primary.main}}),e.jsxs(f,{children:[e.jsx(m,{variant:"h6",component:"h2",children:"Add Bulk Leave"}),e.jsx(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Select multiple dates and create leave requests in batch"})]})]}),e.jsx(Ce,{onClick:h,sx:{position:"absolute",top:8,right:16},disabled:z,children:e.jsx(Ye,{})})]}),e.jsx(Re,{sx:{py:3},children:e.jsxs(ae,{container:!0,spacing:3,children:[e.jsx(ae,{item:!0,xs:12,lg:6,children:e.jsxs(f,{sx:{position:"sticky",top:0},children:[e.jsxs(m,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{style:{width:20,height:20}}),"Select Dates"]}),e.jsx(Gt,{selectedDates:_,onDatesChange:t=>{q(t),I(!1)},userId:b,fetchFromAPI:!0})]})}),e.jsx(ae,{item:!0,xs:12,lg:6,children:e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(f,{children:[e.jsx(m,{variant:"h6",gutterBottom:!0,children:"Leave Details"}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",gap:2},children:[T&&g.length>0&&e.jsx(xt,{selectedDepartmentId:F,selectedEmployeeId:b,onDepartmentChange:N,onEmployeeChange:t=>{v(t),R(""),I(!1),E([])},allUsers:g,departments:u,showSearch:!0,error:U,theme:i,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:z||S}),e.jsxs(Ne,{fullWidth:!0,error:!!U.leave_type_id,children:[e.jsx($e,{id:"bulk-leave-type-label",children:"Leave Type"}),e.jsxs(Te,{labelId:"bulk-leave-type-label",value:d||"",onChange:t=>{R(t.target.value),I(!1)},label:"Leave Type",disabled:z||S||H,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,borderRadius:2,boxShadow:i.glassCard.boxShadow,maxHeight:300}}},children:[e.jsx(se,{value:"",disabled:!0,children:H?"Loading leave types...":"Select Leave Type"}),O.map(t=>{let s,r;if($.length>0)s=t.remaining,r=s<=0;else{const c=M==null?void 0:M.find(o=>o.leave_type===t.type);s=c?t.days-c.days_used:t.days,r=s<=0}return e.jsx(se,{value:t.type,disabled:r,title:r?"No remaining leaves available":"",children:e.jsxs(f,{display:"flex",justifyContent:"space-between",width:"100%",children:[e.jsx("span",{children:t.type}),e.jsxs("span",{children:["(",s," remaining)"]})]})},t.id)})]}),e.jsx(ut,{children:U.leave_type_id})]}),d&&e.jsx(le,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:(()=>{const t=O.find(r=>r.type===d);let s;if($.length>0&&t)s=t.remaining,t.days;else{const r=M==null?void 0:M.find(c=>c.leave_type===d);s=r?(t==null?void 0:t.days)-r.days_used:t==null?void 0:t.days,t==null||t.days}return`${s||0} remaining`})(),InputProps:{readOnly:!0,endAdornment:e.jsxs(m,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",(()=>{const t=O.find(s=>s.type===d);return $.length>0,t==null?void 0:t.days})()," total"]})}}),e.jsx(le,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:D,onChange:t=>{Z(t.target.value),I(!1)},multiline:!0,rows:3,fullWidth:!0,required:!0,error:!!U.reason||D.length>0&&D.length<5,helperText:U.reason||(D.length>0&&D.length<5?"Reason must be at least 5 characters":`${D.length}/500 characters`),inputProps:{maxLength:500},disabled:z||S}),e.jsx(bt,{control:e.jsx(jt,{checked:Q,onChange:t=>X(t.target.checked),size:"small",disabled:z||S}),label:e.jsxs(f,{children:[e.jsx(m,{variant:"body2",children:"Allow partial success"}),e.jsx(m,{variant:"caption",color:"text.secondary",children:"Valid dates will be processed even if some dates fail validation"})]})})]})]}),_.length>0&&e.jsxs(f,{sx:{p:2,borderRadius:2,background:i.palette.background.paper,border:`1px solid ${i.palette.divider}`},children:[e.jsx(m,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Selected Dates Summary"}),e.jsxs(m,{variant:"body1",children:[e.jsx("strong",{children:_.length})," date",_.length!==1?"s":""," selected"]}),d&&e.jsxs(m,{variant:"body2",color:"text.secondary",children:["Leave type: ",d]})]}),e.jsx(Kt,{validationResults:Y,balanceImpact:l,isValidating:S})]})})]})}),e.jsxs(We,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e.jsx(ge,{variant:"outlined",onClick:h,disabled:z,sx:{borderRadius:"50px"},children:"Cancel"}),e.jsxs(f,{sx:{display:"flex",gap:1},children:[e.jsx(ge,{variant:"outlined",color:"primary",onClick:xe,loading:S,disabled:!ke||z,startIcon:!S&&e.jsx(Ue,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:S?"Validating...":"Validate Dates"}),e.jsx(ge,{variant:"contained",color:"primary",onClick:me,loading:z,disabled:!he||S,startIcon:!z&&e.jsx(Oe,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:z?"Creating...":`Create ${_.length} Leave Request${_.length!==1?"s":""}`})]})]})]})},Es=({open:n,onClose:h,onSuccess:w,selectedLeaves:g=[],allUsers:u=[]})=>{const x=pe(),[T,P]=a.useState(!1),[y,k]=a.useState({}),i=a.useCallback(N=>{const b=u.find(v=>v.id===N);return(b==null?void 0:b.name)||`User ID: ${N}`},[u]),_=g.filter(N=>N.status&&N.status.toLowerCase()==="approved"),q=_.length===0,F=a.useCallback(async()=>{if(!q){const b=Promise.reject("Cannot delete approved leaves");V.promise(b,{error:"Cannot delete approved leave requests"});return}if(g.length===0){const b=Promise.reject("No leaves selected");V.promise(b,{error:"No leave requests selected for deletion"});return}P(!0);const N=new Promise(async(b,v)=>{try{const d=g.map(D=>D.id),R=await ue.delete(route("leaves.bulk.delete"),{data:{leave_ids:d}});R.status===200&&R.data.success?(w==null||w(R.data),h(),b([R.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",R.status),v(`Unexpected response status: ${R.status}`))}catch(d){console.error("Full error object:",d),d.response?(console.error("Error response status:",d.response.status),console.error("Error response data:",d.response.data),d.response.status===422?(k(d.response.data.errors||{}),v(d.response.data.error||"Failed to delete leave requests")):d.response.status===403?v(d.response.data.error||"You are not authorized to delete these leave requests"):d.response.status===404?v(d.response.data.error||"Some leave requests were not found"):v(`HTTP Error ${d.response.status}: ${d.response.data.message||"An unexpected error occurred. Please try again later."}`)):d.request?(console.error("No response received:",d.request),v("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",d.message),v("An error occurred while setting up the request."))}finally{P(!1)}});V.promise(N,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},success:{render({data:b}){return e.jsx(e.Fragment,{children:b.map((v,d)=>e.jsx("div",{children:v},d))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},error:{render({data:b}){return e.jsx(e.Fragment,{children:b})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}}})},[g,q,w,h,x]);return e.jsxs(Pe,{open:n,onClose:h,fullWidth:!0,maxWidth:"md",children:[e.jsxs(Ie,{sx:{display:"flex",alignItems:"center",pb:1},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e.jsx(we,{style:{width:24,height:24,color:x.palette.error.main}}),e.jsxs(f,{children:[e.jsx(m,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),e.jsxs(m,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",g.length," leave request",g.length!==1?"s":""]})]})]}),e.jsx(Ce,{onClick:h,sx:{position:"absolute",top:8,right:16},disabled:T,children:e.jsx(Ye,{})})]}),e.jsxs(Re,{sx:{py:3},children:[!q&&e.jsxs(f,{sx:{p:2,mb:3,borderRadius:2,background:x.palette.error.main+"20",border:`1px solid ${x.palette.error.main}40`},children:[e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Ue,{style:{width:20,height:20,color:x.palette.error.main}}),e.jsx(m,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),e.jsxs(m,{variant:"body2",color:"error",children:[_.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),e.jsxs(m,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Oe,{style:{width:20,height:20}}),"Selected Leave Requests (",g.length,")"]}),e.jsx(Rt,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${x.palette.divider}`,borderRadius:2,backgroundColor:x.palette.background.paper},children:g.map((N,b)=>{var d,R,D;const v=N.status&&N.status.toLowerCase()==="approved";return e.jsxs(ve.Fragment,{children:[e.jsx(Wt,{sx:{py:2,opacity:v?.6:1,backgroundColor:v?x.palette.error.main+"10":"transparent"},children:e.jsx(Mt,{primary:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(m,{variant:"subtitle2",children:i(N.user_id)}),e.jsx(De,{size:"sm",variant:"flat",color:((d=N.status)==null?void 0:d.toLowerCase())==="approved"?"success":((R=N.status)==null?void 0:R.toLowerCase())==="pending"?"warning":((D=N.status)==null?void 0:D.toLowerCase())==="rejected"?"danger":"default",children:N.status||"Unknown"}),v&&e.jsx(De,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:e.jsxs(f,{children:[e.jsxs(m,{variant:"body2",color:"text.secondary",children:[N.leave_type," - ",N.from_date," to ",N.to_date]}),e.jsxs(m,{variant:"body2",color:"text.secondary",children:[N.no_of_days," day",N.no_of_days!==1?"s":""," - ",N.reason]})]})})}),b<g.length-1&&e.jsx(Et,{})]},N.id)})}),q&&e.jsx(f,{sx:{mt:3,p:2,borderRadius:2,background:x.palette.warning.main+"20",border:`1px solid ${x.palette.warning.main}40`},children:e.jsx(m,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"⚠️ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),e.jsxs(We,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e.jsx(ge,{variant:"outlined",onClick:h,disabled:T,sx:{borderRadius:"50px"},children:"Cancel"}),e.jsx(ge,{variant:"contained",color:"error",onClick:F,loading:T,disabled:!q||T||g.length===0,startIcon:!T&&e.jsx(we,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:T?"Deleting...":`Delete ${g.length} Request${g.length!==1?"s":""}`})]})]})};export{Ms as B,Ws as D,Rs as L,Es as a,Vt as b};
