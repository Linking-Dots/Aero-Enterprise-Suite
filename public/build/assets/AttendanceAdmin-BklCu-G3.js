import{r,j as e,e as z,d as le,R as ce,Q as de,a as P}from"./app-CFOXYWdD.js";import{u as me,G as ae,m as he}from"./logo-AMLCgbkx.js";import{P as xe}from"./PageHeader-DIUdhN7v.js";import{S as pe}from"./StatsCards-GNCJc6Af.js";import{u as U,f as V,r as Z,t as G,d as q,F as ue,h as J,g as X,B as fe,A as ge}from"./App-D44H3aE5.js";import{d as i}from"./dayjs.min-DTClqbqG.js";import{F as B}from"./UserIcon-B8KaJTnW.js";import{s as be}from"./chunk-TLYTI3QM-CvGR7vge.js";import{t as ye}from"./chunk-YRZGWF2W-CVS3z9wo.js";import{t as je,a as we,b as ve,c as A}from"./chunk-F3UDT23P-DfyL8aGa.js";import{t as Ne}from"./chunk-TSPNSPCL-CDimUInN.js";import{u as K}from"./chunk-S574QCAN-C6iBC3Hs.js";import{F as ke}from"./ExclamationTriangleIcon-BgutF-yh.js";import{F as Me}from"./XCircleIcon-BKBoDII1.js";import{F as _e}from"./CheckCircleIcon-CutA81AR.js";import{c as ee}from"./chunk-D5XJWRAV-Bs0mRdwq.js";import{F as $e}from"./CheckCircleIcon-WfVI_0Z3.js";import{F as Fe}from"./XCircleIcon-CXS-JZ21.js";import{F as Re}from"./ExclamationTriangleIcon-Kx82ewut.js";import{F as Ae}from"./ChartBarIcon-COx860cq.js";import{F as Ye}from"./MagnifyingGlassIcon-CNyzq9X-.js";import{p as Se}from"./chunk-EAPQ7RWQ-CTPnoxCw.js";import{F as te}from"./DocumentArrowDownIcon-CebuwUHN.js";import{F as Ce}from"./PresentationChartLineIcon-BYTkVXBR.js";import{i as se}from"./chunk-SSA7SXE4-B38lyIff.js";import"./create-visual-element-DL7V4SzU.js";import"./EnvelopeIcon-DJsx2AYc.js";import"./ShieldCheckIcon-DfAiaKpT.js";import"./index-CaGcrq76.js";import"./useHasTabbableChild-Bti5CcwH.js";import"./index-CokAva9Y.js";function Ee({title:h,titleId:l,...c},x){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":l},c),h?r.createElement("title",{id:l},h):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const Y=r.forwardRef(Ee);function Pe({title:h,titleId:l,...c},x){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":l},c),h?r.createElement("title",{id:l},h):null,r.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const Be=r.forwardRef(Pe),O=(h,l)=>{const c=h.replace("#",""),x=parseInt(c.substring(0,2),16),f=parseInt(c.substring(2,4),16),k=parseInt(c.substring(4,6),16);return`rgba(${x}, ${f}, ${k}, ${l})`},Le=({loading:h,attendanceData:l,currentYear:c,currentMonth:x,leaveTypes:f,leaveCounts:k,onRefresh:S})=>{const _=me(!1,"OCEAN"),C=U("(min-width: 1025px)");U("(min-width: 641px) and (max-width: 1024px)");const L=U("(max-width: 640px)"),$=i(`${c}-${x}-01`).daysInMonth(),T={"√":{icon:_e,color:"text-success",bg:"bg-success-100",label:"√",short:"P"},"▼":{icon:Me,color:"text-danger",bg:"bg-danger-100",label:"▼",short:"A"},"#":{icon:ke,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:Be,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},W=r.useMemo(()=>[{label:"No.",key:"sl",icon:Y,width:60},{label:"Employee",key:"name",icon:B,width:200},...Array.from({length:$},(t,u)=>{const j=u+1,v=i(`${c}-${x}-${j}`);return{label:`${j}`,sublabel:v.format("ddd"),key:`day-${j}`,width:40,isWeekend:v.day()===0||v.day()===6}}),...f?f.map(t=>({label:t.type,key:t.type,icon:V,width:80})):[]],[$,c,x,f]),E=t=>T[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},I=({data:t,index:u,daysInMonth:j,currentMonth:v,currentYear:y,leaveTypes:p,leaveCounts:w})=>e.jsx(ae,{className:"mb-4",shadow:"sm",children:e.jsxs(le,{children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsx(K,{avatarProps:{radius:"lg",size:"md",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:e.jsx("span",{className:"text-sm font-medium",children:t.name||"Unknown"}),description:e.jsxs("span",{className:"text-xs text-default-500",children:["Employee #",u+1]})})}),e.jsx(z,{className:"my-3"}),e.jsx("div",{className:"grid grid-cols-7 sm:grid-cols-7 xs:grid-cols-4 grid-cols-3 gap-1 mb-4",children:Array.from({length:j},(a,d)=>{const g=d+1,s=i(`${y}-${v}-${g}`).format("YYYY-MM-DD"),n=t[s],H=i(s).day()===0||i(s).day()===6,F=typeof n=="object"&&(n==null?void 0:n.status)||"▼",M=E(F);return e.jsx(G,{placement:"top",content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",F]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(n==null?void 0:n.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(n==null?void 0:n.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(n==null?void 0:n.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(n==null?void 0:n.remarks)||"N/A"]})]}),className:"z-99999",children:e.jsxs("div",{className:`
                                        flex flex-col items-center justify-center p-1 rounded text-xs cursor-pointer
                                        ${H?"bg-default-100":"bg-default-50"}
                                        ${M.bg}
                                    `,children:[e.jsx("span",{className:"font-medium",children:g}),e.jsx("span",{children:M.icon?e.jsx(M.icon,{className:`w-3 h-3 ${M.color}`}):e.jsx("span",{className:M.color,children:F})})]})},g)})}),(p==null?void 0:p.length)>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map(a=>{var g;const d=((g=w==null?void 0:w[t.user_id])==null?void 0:g[a.type])||0;return e.jsxs(q,{size:"sm",variant:"flat",color:d>0?"warning":"default",startContent:e.jsx(V,{className:"w-3 h-3"}),children:[a.type,": ",d]},a.type)})})]})});return h?e.jsx(Box,{className:"flex justify-center items-center h-64",children:e.jsx(be,{className:"w-full h-full rounded-lg"})}):!l||l.length===0?e.jsxs(Box,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx(Typography,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):L?e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:e.jsxs(Box,{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsx(Typography,{variant:"h6",component:"h1",children:"Attendance Report"})]})}),e.jsx(z,{}),e.jsx(CardContent,{sx:{p:0},children:e.jsx(Z,{className:"max-h-[70vh]",children:l.map((t,u)=>e.jsx(I,{data:t,index:u,daysInMonth:$,currentMonth:x,currentYear:c,leaveTypes:f,leaveCounts:k},t.user_id||u))})})]}):e.jsxs(Box,{children:[e.jsx(ee,{title:e.jsxs(Box,{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary"}),e.jsxs(Typography,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",i(`${c}-${x}-01`).format("MMMM YYYY")]})]}),action:e.jsx(Stack,{direction:"row",spacing:1,children:S&&e.jsx(Tooltip,{title:"Refresh Data",children:e.jsx(IconButton,{onClick:S,disabled:h,sx:{background:O(_.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${O(_.palette.primary.main,.2)}`,"&:hover":{background:O(_.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e.jsx(Refresh,{color:"primary"})})})}),sx:{padding:"24px"}}),e.jsx(z,{}),e.jsx(CardContent,{children:e.jsx(Box,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e.jsx(Z,{className:"max-h-[70vh]",children:e.jsxs(je,{isCompact:!C,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e.jsx(ye,{columns:W,children:t=>e.jsx(Ne,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:e.jsxs(Box,{className:"flex flex-col items-center gap-1",children:[e.jsxs(Box,{className:"flex items-center gap-1",children:[t.icon&&e.jsx(t.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e.jsx("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e.jsx(we,{items:l,emptyContent:e.jsxs(Box,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx(Typography,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e.jsx(ve,{children:u=>{var v;const j=l.findIndex(y=>(y.user_id||y.id)===(t.user_id||t.id));switch(u){case"sl":return e.jsx(A,{className:"text-center font-medium",children:j+1});case"name":return e.jsx(A,{className:"whitespace-nowrap",children:e.jsx(K,{avatarProps:{radius:"lg",size:C?"md":"sm",src:t.profile_image_url||t.profile_image,fallback:e.jsx(B,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(u.startsWith("day-")){const p=parseInt(u.split("-")[1]),w=i(`${c}-${x}-${p}`).format("YYYY-MM-DD"),a=t[w],d=i(w).day()===0||i(w).day()===6,g=typeof a=="object"&&(a==null?void 0:a.status)||"▼",s=E(g);return e.jsx(A,{className:`text-center ${d?"bg-default-50":""}`,children:e.jsx(G,{content:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",g]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch In:"})," ",(a==null?void 0:a.punch_in)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Punch Out:"})," ",(a==null?void 0:a.punch_out)||"-"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Work Hours:"})," ",(a==null?void 0:a.total_work_hours)||"00:00"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",(a==null?void 0:a.remarks)||"N/A"]})]}),placement:"top",className:"z-99999",children:e.jsx(Box,{className:"flex items-center justify-center cursor-help",children:s.icon?e.jsx(s.icon,{className:`w-4 h-4 ${s.color}`}):e.jsx("span",{className:`text-xs ${s.color}`,children:g})})})})}const y=f==null?void 0:f.find(p=>p.type===u);if(y){const p=((v=k==null?void 0:k[t.user_id])==null?void 0:v[y.type])||0;return e.jsx(A,{className:"text-center",children:e.jsx(q,{size:"sm",variant:p>0?"flat":"bordered",color:p>0?"warning":"default",className:"min-w-8",children:p})})}return e.jsx(A,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Te=ce.memo(({title:h})=>{const[l,c]=r.useState(window.innerWidth<768);r.useEffect(()=>{const o=()=>c(window.innerWidth<768);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const[x,f]=r.useState(!1),[k,S]=r.useState([]),[_,C]=r.useState([]),[L,$]=r.useState([]),[T,W]=r.useState(0),[E,I]=r.useState(0),[t,u]=r.useState(""),[j,v]=r.useState(30),[y,p]=r.useState(1),[w,a]=r.useState(""),[d,g]=r.useState({currentMonth:i().format("YYYY-MM")}),[s,n]=r.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null}),H=r.useCallback((o,N)=>{g(b=>({...b,[o]:N}))},[]),F=async(o=1,N=30,b)=>{f(!0);try{const m=b.currentMonth?i(b.currentMonth).format("MM"):i().format("MM"),D=b.currentMonth?i(b.currentMonth).year():i().year(),R=await P.get(route("attendancesAdmin.paginate"),{params:{page:o,perPage:N,employee:t,currentYear:D,currentMonth:m}});S(R.data.data),W(R.data.total),I(R.data.last_page),$(R.data.leaveTypes),C(R.data.leaveCounts);const Q=await P.get(route("attendance.monthlyStats"),{params:{currentYear:D,currentMonth:m}});Q.data.success&&n(Q.data.data)}catch(m){console.error(m),fe.error("Failed to fetch data.",{icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}})}finally{f(!1)}},M=o=>{const N=o.target.value.toLowerCase();u(N)};r.useEffect(()=>{F(y,j,d).then(o=>"")},[y,j,d,t]);const re=o=>{p(o)},oe=async()=>{a("excel");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),N=await P.get(route("attendance.exportAdminExcel"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([N.data])),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.xlsx`,document.body.appendChild(m),m.click(),a(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("Download failed:",o),a(""),alert("Failed to download attendance sheet.")}},ne=async()=>{a("pdf");try{const o=d.currentMonth?i(d.currentMonth).format("YYYY-MM"):i().format("YYYY-MM"),N=await P.get(route("attendance.exportAdminPdf"),{params:{month:o},responseType:"blob"}),b=window.URL.createObjectURL(new Blob([N.data],{type:"application/pdf"})),m=document.createElement("a");m.href=b,m.download=`Admin_Attendance_${o}.pdf`,document.body.appendChild(m),m.click(),a(""),m.remove(),window.URL.revokeObjectURL(b)}catch(o){console.error("PDF download failed:",o),a(""),alert("Failed to download attendance PDF.")}},ie=r.useMemo(()=>[{title:"Total Employees",value:s.totalEmployees,icon:e.jsx(ue,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:s.totalWorkingDays,icon:e.jsx(J,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${s.month})`},{title:"Present Today",value:s.presentToday,icon:e.jsx($e,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:s.presentToday>0?`${(s.presentToday/s.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:s.absentToday,icon:e.jsx(Fe,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:s.absentToday>0?`${(s.absentToday/s.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:s.lateToday,icon:e.jsx(Re,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${s.attendancePercentage}%`,icon:e.jsx(Ae,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${s.averageWorkHours}h`,icon:e.jsx(X,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${s.overtimeHours}h`,icon:e.jsx(X,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:s.totalLeaveDays,icon:e.jsx(B,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[s.totalEmployees,s.totalWorkingDays,s.month,s.presentToday,s.absentToday,s.lateToday,s.attendancePercentage,s.averageWorkHours,s.overtimeHours,s.totalLeaveDays]);return e.jsxs("div",{children:[e.jsx(de,{title:h}),e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(he.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:e.jsx(ae,{children:e.jsx(xe,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e.jsx(Ce,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e.jsx(te,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:oe,isLoading:w==="excel",className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e.jsx(te,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:ne,isLoading:w==="pdf",className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:e.jsxs("div",{className:"p-6",children:[e.jsx(pe,{stats:ie,className:"mb-6"}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(se,{label:"Search Employee",type:"text",value:t,onValueChange:M,placeholder:"Enter employee name...",variant:"bordered",size:l?"sm":"md",startContent:e.jsx(Ye,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(se,{label:"Month/Year",type:"month",value:d.currentMonth,onValueChange:o=>H("currentMonth",o),variant:"bordered",size:l?"sm":"md",startContent:e.jsx(J,{className:"w-4 h-4 text-default-400"}),classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})})]})}),e.jsxs("div",{children:[e.jsx(Le,{attendanceData:k,currentYear:d.currentYear,currentMonth:d.currentMonth,leaveTypes:L,leaveCounts:_,loading:x}),T>=30&&e.jsx("div",{className:"py-4 px-2 flex justify-center items-center",children:e.jsx(Se,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:y,total:E,onChange:re,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}})})]})]})})})})})]})});Te.layout=h=>e.jsx(ge,{children:h});export{Te as default};
