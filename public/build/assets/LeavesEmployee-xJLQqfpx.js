import{J as _e,r as l,a as G,j as t,Q as we,c as S,b as M,d as Ne,F as Ce,f as ke}from"./app-P0jeSTbo.js";import{d as X}from"./dayjs.min-BHeaE5Vb.js";import{u as Z,c as K,s as Le,l as Se,a as $,A as Me}from"./App-BIkHU9Vu.js";import{L as U,D as Fe,B as Pe,a as Re,b as Ee}from"./BulkDeleteModal-D-bRKiKn.js";import{B as H}from"./react-toastify.esm-Mw1k_TUi.js";import{m as Be}from"./proxy-UyM1ZIn1.js";import{F as Ye}from"./PresentationChartLineIcon-CX6kyT23.js";import{F as ee}from"./ChartBarIcon-xyQkBFfS.js";import{F as Ie}from"./XCircleIcon-Bn5uEpcZ.js";import"./EnvelopeIcon-Dzoz4pS3.js";import"./UserIcon-CNOCXkP_.js";import"./ShieldCheckIcon-DblALsv4.js";import"./KeyIcon-3SnzuSGM.js";import"./chunk-SSA7SXE4-uTPPhFUW.js";import"./logo-C0vBlTRG.js";import"./features-animation-BI_sI58L.js";import"./create-visual-element-BrhSQBlx.js";import"./CheckCircleIcon-B7bakAHb.js";import"./ExclamationTriangleIcon-BKP2sSt9.js";import"./TrashIcon-BJ-QF0Wh.js";import"./PencilIcon-C5jJjkKv.js";import"./EllipsisVerticalIcon-DoWhR-31.js";import"./CheckCircleIcon-DlPgL153.js";import"./ClockIcon-fHY-9Y8a.js";import"./ExclamationTriangleIcon-BCujxz2D.js";import"./createLucideIcon-DQAUJzzf.js";import"./HeartIcon-BXJJ84VD.js";import"./SunIcon-CKuSxrYU.js";import"./chunk-F3UDT23P-C7U5wOuZ.js";import"./chunk-XJ2YRSUP-eHUra1vM.js";import"./useToggleState-CdU_Z1da.js";import"./chunk-S574QCAN-CDhT1cXs.js";import"./chunk-JOT4BT4P-B1s-gjZ_.js";import"./chunk-EAPQ7RWQ-6z8f_DOO.js";import"./chunk-YRZGWF2W-5Iub4StA.js";import"./clock-CqNlkBSj.js";import"./chunk-QESP63UR-r2TzLVib.js";import"./chunk-O5MCAK4F-DEtTNLxS.js";import"./InformationCircleIcon-BhEKrCho.js";import"./XCircleIcon-D7kvpL-8.js";import"./chunk-TQNYOUFX-B3dhB43U.js";const Te=({title:A,allUsers:p})=>{const{auth:C}=_e().props,F=Z("(max-width: 640px)"),te=Z("(min-width: 641px) and (max-width: 1024px)"),[g,R]=l.useState(0),[D,E]=l.useState(0),[Q,$e]=l.useState(!1),[j,u]=l.useState([]),[y,_]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[V,f]=l.useState(!1),[q,z]=l.useState(""),[o,O]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[n,ae]=l.useState({employee:"",selectedMonth:X().format("YYYY-MM"),year:new Date().getFullYear()}),[w,re]=l.useState(!1),[B,se]=l.useState(!1);l.useEffect(()=>{const e=()=>{re(window.innerWidth>=1025),se(window.innerWidth>=641&&window.innerWidth<=1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const m=l.useCallback(e=>{e&&(R(e.total||0),E(e.last_page||1),O(r=>({...r,total:e.total||0,lastPage:e.last_page||1})))},[]),k=()=>{var s;if(typeof window>"u")return"lg";const r=((s=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:s.trim())||"12px",a=parseInt(r);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},v=l.useCallback(async()=>{var e,r,a;f(!0);try{const{page:s,perPage:i}=o,{year:c}=n,x=await G.get(route("leaves.paginate"),{params:{page:s,perPage:i,year:c,user_id:C.user.id},timeout:1e4});if(x.status===200){const{leaves:h,leavesData:je}=x.data;h.data&&Array.isArray(h.data)?(u(h.data),m({total:h.total||h.data.length,last_page:h.last_page||1,current_page:h.current_page||1,per_page:h.per_page||o.perPage})):Array.isArray(h)?(u(h),m({total:h.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",h),u([]),m({total:0,last_page:1,current_page:1,per_page:o.perPage})),_(je),z("")}}catch(s){if(console.error("Error fetching leaves:",s),((e=s.response)==null?void 0:e.status)===404){const{leavesData:i}=s.response.data;_(i),z(((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.message)||"No leaves found for the selected criteria.")}else{z("Error retrieving leaves data. Please try again.");const i=Promise.reject("Failed to load leave data. Please try again.");H.promise(i,{error:{render(){return t.jsx("div",{children:"Failed to load leave data. Please try again."})},icon:"❌"}})}u([]),m({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{f(!1)}},[o.page,o.perPage,n,C.user.id,m]),Y=l.useCallback((e,r,a)=>{const{page:s,perPage:i}=o;e.length>=i||s<D||v()},[o,D,v]),le=l.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(r,a)=>{const s=1900+a;return{key:s.toString(),label:s.toString(),value:s}}).reverse()},[]),oe=l.useCallback((e,r)=>{if(e==="year"){const a=Number(r);if(a<1900||a>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}ae(a=>({...a,[e]:r})),e==="year"&&O(a=>({...a,page:1}))},[]),[b,I]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1});l.useCallback((e,r=null)=>{I(a=>({...a,[e]:!0}))},[]);const P=l.useCallback(()=>{I({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1})},[]),W=l.useCallback(e=>{I(r=>({...r,[e]:!0}))},[]),ne=l.useCallback((e,r)=>{J({id:e}),I(a=>({...a,[r]:!0}))},[]),[T,J]=l.useState(null),[ie,ce]=l.useState([]),de=l.useCallback(e=>{J(e)},[]),me=l.useCallback(e=>{ce(e),W("bulk_delete")},[W]),d=l.useCallback(async()=>{try{const e=await G.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:r,leaveCounts:a}=e.data;a&&_(s=>({...s,leaveCountsByUser:{...s.leaveCountsByUser,[C.user.id]:a}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,C.user.id]),ue=l.useCallback(e=>{e!==o.page&&O(r=>({...r,page:e}))},[o.page]);l.useEffect(()=>{v()},[v]),l.useEffect(()=>{d()},[d]);const pe=l.useMemo(()=>y.leaveCountsByUser[C.user.id]||[],[y.leaveCountsByUser,C.user.id]),L=l.useCallback(e=>[...e].sort((r,a)=>new Date(r.from_date)-new Date(a.from_date)),[]),N=l.useCallback(e=>{const r=new Date(e.from_date).getFullYear();if(n.year&&r!==n.year)return!1;if(n.employee){const a=p==null?void 0:p.find(i=>String(i.id)===String(e.user_id)),s=n.employee.trim().toLowerCase();if(a){if(String(a.id)!==s&&!(a.name&&a.name.trim().toLowerCase().includes(s)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&X(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const a=p==null?void 0:p.find(s=>String(s.id)===String(e.user_id));if(!a||String(a.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,p]);l.useMemo(()=>j||[],[j]);const ge=l.useCallback(e=>{N(e)&&(f(!0),u(r=>{const a=[...r,e];return L(a).slice(0,o.perPage)}),m({total:g+1,last_page:Math.ceil((g+1)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d())},[N,L,o,g,m,v,d]),fe=l.useCallback(e=>{var i;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}e.leavesData&&_(e.leavesData);const r=e.created_leaves||[];if(r.length===0){d();return}const a=r.filter(c=>N(c));if(a.length===0){d();return}f(!0),u(c=>{const x=[...c,...a];return L(x).slice(0,o.perPage)});const s=((i=e.summary)==null?void 0:i.successful)||r.length;m({total:g+s,last_page:Math.ceil((g+s)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d()},[N,L,o,g,m,v,d]),he=l.useCallback(e=>{const r=j.some(s=>s.id===e.id);if(f(!0),!N(e)&&r){u(i=>i.filter(c=>c.id!==e.id));const s=Promise.resolve();H.promise(s,{success:{render(){return t.jsx("div",{children:"Leave removed from filtered view."})},icon:"ℹ️"}}),f(!1);return}if(!r&&!N(e)){f(!1);return}u(s=>{const i=s.some(x=>x.id===e.id);let c;return i?c=s.map(x=>x.id===e.id?e:x):c=[...s,e],L(c).slice(0,o.perPage)});const a=Promise.resolve();H.promise(a,{success:{render(){return t.jsx("div",{children:"Leave updated!"})},icon:"✅"}}),f(!1),o.page!==1&&v(),d()},[N,L,j,o,v,d]),ve=l.useCallback(e=>{u(a=>{const s=a.filter(c=>c.id!==e),i=Math.max(0,g-1);return Y(s,i,"delete"),s});const r=Math.max(0,g-1);m({total:r,last_page:Math.max(1,Math.ceil(r/o.perPage)),current_page:o.page,per_page:o.perPage}),d()},[d,g,o,m,Y]),xe=l.useCallback(e=>{if(!e||!e.success){console.error("Invalid bulk delete response data:",e);return}e.leavesData&&_(e.leavesData);const r=e.deleted_leaves||[],a=r.map(c=>c.id);if(a.length===0){d();return}f(!0),u(c=>c.filter(x=>!a.includes(x.id)));const s=e.deleted_count||r.length,i=Math.max(0,g-s);m({total:i,last_page:Math.max(1,Math.ceil(i/o.perPage)),current_page:o.page,per_page:o.perPage}),f(!1),Y(j.filter(c=>!a.includes(c.id)),i,"delete"),d()},[m,o,g,j,Y,d]),ye=()=>y.leaveTypes.length?t.jsx("div",{className:`grid gap-4 ${F?"grid-cols-1":te?"grid-cols-2":"grid-cols-4"}`,children:y.leaveTypes.map(({type:e})=>{const r=pe.find(c=>c.leave_type===e)||{},a=r.days_used||0,s=r.remaining_days||0,i=a+s;return t.jsxs(S,{className:"transition-all duration-200 hover:scale-[1.02]",style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",borderRadius:k()},children:[t.jsx(K,{className:"pb-2",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx($,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),t.jsx("h3",{className:`font-semibold truncate ${F?"text-base":"text-lg"}`,style:{color:"var(--theme-foreground)"},children:e})]})}),t.jsx(M,{className:"pt-0",children:t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs opacity-70 mb-1",style:{color:"var(--theme-foreground)"},children:"Used"}),t.jsx("p",{className:`font-bold ${F?"text-lg":"text-xl"}`,style:{color:"var(--theme-danger)"},children:a})]}),t.jsx(ke,{orientation:"vertical",className:"h-8",style:{backgroundColor:"color-mix(in srgb, var(--theme-content3) 50%, transparent)"}}),t.jsxs("div",{className:"text-center",children:[t.jsx("p",{className:"text-xs opacity-70 mb-1",style:{color:"var(--theme-foreground)"},children:"Remaining"}),t.jsx("p",{className:`font-bold ${F?"text-lg":"text-xl"}`,style:{color:"var(--theme-success)"},children:s})]})]}),i>0&&t.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden",style:{backgroundColor:"color-mix(in srgb, var(--theme-content3) 40%, transparent)"},children:t.jsx("div",{className:"h-full transition-all duration-300 rounded-full",style:{width:`${a/i*100}%`,background:"linear-gradient(90deg, var(--theme-danger), color-mix(in srgb, var(--theme-danger) 80%, var(--theme-warning)))"}})})]})})]},e)})}):t.jsx(S,{className:"text-center py-8",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",borderRadius:k()},children:t.jsxs(M,{children:[t.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),t.jsx("p",{className:"opacity-70",style:{color:"var(--theme-foreground)"},children:"No leave types available"})]})}),be=l.useRef(null);return t.jsxs(t.Fragment,{children:[t.jsx(we,{title:A}),b.add_leave&&t.jsx(U,{open:b.add_leave,closeModal:()=>P(),leavesData:y,setLeavesData:_,currentLeave:null,allUsers:p,setTotalRows:R,setLastPage:E,setLeaves:u,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:ge,updatePaginationMetadata:m,fetchLeavesStats:d}),b.edit_leave&&t.jsx(U,{open:b.edit_leave,closeModal:()=>P(),leavesData:y,setLeavesData:_,currentLeave:T,allUsers:p,setTotalRows:R,setLastPage:E,setLeaves:u,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:he,updatePaginationMetadata:m,fetchLeavesStats:d}),b.delete_leave&&t.jsx(Fe,{open:b.delete_leave,closeModal:()=>P(),leaveId:T==null?void 0:T.id,setLeaves:u,setTotalRows:R,setLastPage:E,deleteLeaveOptimized:ve,updatePaginationMetadata:m,fetchLeavesStats:d}),b.bulk_leave&&t.jsx(Pe,{open:b.bulk_leave,onClose:()=>P(),onSuccess:e=>{fe(e)},allUsers:p,leavesData:y,isAdmin:!1,existingLeaves:j||[],publicHolidays:(y==null?void 0:y.publicHolidays)||[]}),b.bulk_delete&&t.jsx(Re,{open:b.bulk_delete,onClose:()=>P(),onSuccess:e=>{xe(e)},selectedLeaves:ie,allUsers:p}),t.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"My Attendance Management",children:t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"w-full",children:t.jsx(Be.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.3},className:"w-full max-w-7xl mx-auto",children:t.jsxs(S,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[t.jsx(K,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:t.jsx("div",{className:`${w?"p-6":B?"p-4":"p-3"} w-full`,children:t.jsx("div",{className:"flex flex-col space-y-4",children:t.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:t.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[t.jsx("div",{className:`
                                                ${w?"p-3":B?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:t.jsx(Ye,{className:`
                                                    ${w?"w-8 h-8":B?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("h4",{className:`
                                                    ${w?"text-2xl":B?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${w?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"My Leaves"}),t.jsx("p",{className:`
                                                    ${w?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${w?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Your leave requests and balances"})]})]})})})})}),t.jsxs(M,{className:"pt-4",children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[t.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:t.jsx(Le,{label:"Select Year",selectedKeys:[String(n.year)],onSelectionChange:e=>{const r=Number(Array.from(e)[0]);oe("year",r)},className:"w-full",variant:"bordered",style:{"--input-background":"color-mix(in srgb, var(--theme-content2) 50%, transparent)","--input-border":"color-mix(in srgb, var(--theme-content3) 50%, transparent)","--input-hover-border":"var(--theme-primary)","--input-focus-border":"var(--theme-primary)","--input-color":"var(--theme-foreground)","--input-placeholder":"color-mix(in srgb, var(--theme-foreground) 60%, transparent)",borderRadius:k()},startContent:t.jsx($,{className:"w-4 h-4 opacity-70"}),children:le.map(e=>t.jsx(Se,{value:e.value,children:e.label},e.key))})}),t.jsx("div",{className:"flex gap-2",children:t.jsx(Ne,{variant:"flat",color:"primary",size:F?"sm":"md",onPress:v,isLoading:Q,startContent:!Q&&!V&&t.jsx(Ce,{className:"w-4 h-4"}),children:"Refresh"})})]})}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",style:{color:"var(--theme-foreground)"},children:[t.jsx(ee,{className:"w-5 h-5"}),"Leave Balance Summary"]}),ye()]}),t.jsxs("div",{className:"min-h-96",children:[t.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",style:{color:"var(--theme-foreground)"},children:[t.jsx($,{className:"w-5 h-5"}),"Leave History"]}),V?t.jsx(S,{className:"text-center py-12",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",borderRadius:k()},children:t.jsxs(M,{children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-2 border-t-transparent",style:{borderColor:"var(--theme-primary)"}})}),t.jsx("p",{className:"opacity-70",style:{color:"var(--theme-foreground)"},children:"Loading leave data..."})]})}):q?t.jsx(S,{className:"text-center py-12",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-danger) 30%, transparent)",borderRadius:k()},children:t.jsxs(M,{children:[t.jsx(Ie,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--theme-danger)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"Error Loading Data"}),t.jsx("p",{className:"opacity-70",style:{color:"var(--theme-foreground)"},children:q})]})}):j.length>0?t.jsx("div",{className:"overflow-hidden rounded-lg",children:t.jsx(Ee,{ref:be,leaves:j,allUsers:p||[],handleClickOpen:ne,setCurrentLeave:de,openModal:W,setLeaves:u,setCurrentPage:ue,currentPage:o.page,totalRows:g,lastPage:D,perPage:o.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:d,updatePaginationMetadata:m,onBulkDelete:me,canDeleteLeaves:!0})}):t.jsx(S,{className:"text-center py-12",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",borderRadius:k()},children:t.jsxs(M,{children:[t.jsx($,{className:"w-16 h-16 mx-auto mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),t.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No Leave Records Found"}),t.jsxs("p",{className:"opacity-70",style:{color:"var(--theme-foreground)"},children:["You haven't submitted any leave requests for ",n.year,"."]})]})})]})]})]})})})})})]})};Te.layout=A=>t.jsx(Me,{children:A});export{Te as default};
