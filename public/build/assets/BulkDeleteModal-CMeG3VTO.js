import{r as i,R as be,J as ze,j as e,b as Y,a as ce,c as me,d as ue,g as Te,s as Ge}from"./app-DvThvOJx.js";import{u as De,B as Le,C as qe,D as Ve,E as ke,g as ne,y as He,j as je,h as Re,J as es,s as Ne,l as oe,x as ss,m as we,n as Fe,o as Se,p as _e,e as Me,M as ts}from"./App-lizfHJ8h.js";import{B as O,t as Ie,c as X}from"./react-toastify.esm-D8Ee02_s.js";import{F as pe}from"./TrashIcon-BWBUmRWT.js";import{F as We}from"./PencilIcon-BZWhUae7.js";import{F as Ae}from"./EllipsisVerticalIcon-Ccw26mC7.js";import{F as rs}from"./XCircleIcon-BZBorYMn.js";import{F as as}from"./CheckCircleIcon-D9ZFxKTO.js";import{F as ns}from"./ClockIcon-BUIQCltF.js";import{F as os}from"./ExclamationTriangleIcon-C-OEH45n.js";import{c as Ce}from"./createLucideIcon-7-lzAyBd.js";import{F as Xe}from"./UserIcon-BRRMU6ro.js";import{F as ls}from"./HeartIcon-CvQujA1U.js";import{F as is}from"./SunIcon-BKrKwxXi.js";import{c as de,t as ds,a as cs,b as ms}from"./chunk-F3UDT23P-CS_pGO2j.js";import{u as Oe}from"./chunk-S574QCAN-g-ZCk5yq.js";import{l as Ye}from"./chunk-JOT4BT4P-DVuvP79X.js";import{p as Ue}from"./chunk-EAPQ7RWQ-BH0v9CBm.js";import{t as us}from"./chunk-YRZGWF2W-C72Eui84.js";import{t as fs}from"./chunk-TSPNSPCL-8eD5lyXw.js";import{i as xe}from"./chunk-SSA7SXE4-CD4fNPKE.js";import{t as hs}from"./chunk-QESP63UR-BWWiwEcy.js";import{m as Ee}from"./chunk-O5MCAK4F-CE6bkbae.js";import{F as ve}from"./ExclamationTriangleIcon-D4GZVWy-.js";import{F as Ke}from"./InformationCircleIcon-DULmWzcY.js";import{F as xs}from"./XCircleIcon-DNFgn7AI.js";import{F as Be}from"./CheckCircleIcon-BIfezRZ7.js";import{s as ps}from"./chunk-TQNYOUFX-DiqpDegg.js";function ys({title:m,titleId:b,...g},p){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":b},g),m?i.createElement("title",{id:b},m):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const gs=i.forwardRef(ys);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Pe=Ce("calendar",vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Je=Ce("clock",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],Qe=Ce("phone-off",js);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],ws=Ce("user",Ns),Fs=be.forwardRef(({leaves:m,allUsers:b,handleClickOpen:g,setCurrentLeave:p,openModal:u,setLeaves:v,setCurrentPage:C,currentPage:k,totalRows:M,lastPage:h,perPage:F,selectedMonth:j,employee:N,isAdminView:P=!1,onBulkApprove:_,onBulkReject:c,onBulkDelete:y,canApproveLeaves:f=!1,canEditLeaves:w=!1,canDeleteLeaves:E=!1,fetchLeavesStats:H},K)=>{var ye,he;const{auth:J}=ze().props,B=De("(min-width: 1025px)");De("(min-width: 641px) and (max-width: 1024px)");const z=De("(max-width: 640px)"),[q,te]=i.useState(!1),[r,x]=i.useState(null),[t,A]=i.useState(new Set);be.useMemo(()=>Array.from(t).join(", ").replaceAll("_"," "),[t]);const L=()=>{var a;if(typeof window>"u")return"lg";const n=((a=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:a.trim())||"12px",s=parseInt(n);return s===0?"none":s<=4?"sm":s<=8?"md":s<=16?"lg":"full"},U=be.useMemo(()=>{const l=t==="all",n=l||t.size>0,s=l?m.length:t.size;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between gap-3 items-end",children:e.jsx("div",{className:"flex gap-3",children:n&&y&&e.jsxs(Y,{color:"danger",variant:"flat",startContent:e.jsx(pe,{className:"w-4 h-4"}),onPress:()=>{const a=l?m:m.filter(o=>t.has(o.id.toString()));y(a)},style:{background:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-danger) 30%, transparent)",color:"var(--theme-danger)",borderRadius:L()},children:["Delete ",s," selected"]})})}),n&&e.jsxs("span",{className:"text-small opacity-70",style:{color:"var(--theme-foreground)"},children:[s," of ",m.length," selected"]})]})},[t,m,y]);(ye=J.permissions)!=null&&ye.includes("leaves.view"),(he=J.permissions)!=null&&he.includes("leave.own.view");const $={New:{color:"primary",icon:os},Pending:{color:"warning",icon:ns},Approved:{color:"success",icon:as},Declined:{color:"danger",icon:rs}},W=l=>{switch(l==null?void 0:l.toLowerCase()){case"casual":return e.jsx(es,{className:"w-3 h-3 text-blue-500"});case"weekend":return e.jsx(is,{className:"w-3 h-3 text-yellow-500"});case"sick":return e.jsx(ls,{className:"w-3 h-3 text-red-500"});case"earned":return e.jsx(Re,{className:"w-3 h-3 text-green-500"});default:return e.jsx(je,{className:"w-3 h-3 text-primary"})}},V=i.useCallback(l=>{C&&C(l)},[C]),Q=i.useCallback(async(l,n)=>{if(l.status===n)return O.info(`Leave is already ${n}.`),Promise.resolve(`The leave status is already updated to ${n}`);const s=`${l.id}-${n}`;if(r===s)return;x(s);const a=new Promise(async(o,d)=>{var D,S,re,ae;try{const I=await ce.post(route("leave-update-status"),{id:l.id,status:n});I.status===200?(v(ge=>ge.map(ee=>ee.id===l.id?{...ee,status:n}:ee)),H(),o(I.data.message||"Leave status updated successfully")):d(((D=I.data)==null?void 0:D.message)||"Failed to update leave status")}catch(I){const ge=((re=(S=I.response)==null?void 0:S.data)==null?void 0:re.message)||((ae=I.response)==null?void 0:ae.statusText)||"Failed to update leave status";d(ge)}finally{x(null)}});return O.promise(a,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),a},[v,r,H]),Z=l=>{const s=($[l]||$.New).icon,o=(d=>{switch(d.toLowerCase()){case"approved":return{bg:"color-mix(in srgb, var(--theme-success) 20%, transparent)",border:"color-mix(in srgb, var(--theme-success) 40%, transparent)",color:"var(--theme-success)"};case"rejected":return{bg:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",border:"color-mix(in srgb, var(--theme-danger) 40%, transparent)",color:"var(--theme-danger)"};case"pending":return{bg:"color-mix(in srgb, var(--theme-warning) 20%, transparent)",border:"color-mix(in srgb, var(--theme-warning) 40%, transparent)",color:"var(--theme-warning)"};default:return{bg:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",border:"color-mix(in srgb, var(--theme-primary) 40%, transparent)",color:"var(--theme-primary)"}}})(l);return e.jsx(X,{size:"sm",variant:"flat",startContent:e.jsx(s,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},style:{background:o.bg,border:`1px solid ${o.border}`,color:o.color,borderRadius:L()},children:l})},G=(l,n)=>{const s=new Date(l),a=new Date(n),o=Math.abs(a-s),d=Math.ceil(o/(1e3*60*60*24))+1;return d===1?"1 day":`${d} days`},R=l=>new Date(l).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),T=l=>(b==null?void 0:b.find(n=>String(n.id)===String(l)))||{name:"Unknown User",phone:""},le=({leave:l,updatingLeave:n,setCurrentLeave:s,openModal:a,handleClickOpen:o,updateLeaveStatus:d,canEditLeaves:D,canDeleteLeaves:S,canApproveLeaves:re,isAdminView:ae})=>{const I=T(l.user_id),ge=G(l.from_date,l.to_date);return $[l.status]||$.New,e.jsx(me,{className:"mb-2",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:L()},children:e.jsxs(ue,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:ae&&e.jsx(Oe,{avatarProps:{radius:"lg",size:"sm",src:(I==null?void 0:I.profile_image_url)||(I==null?void 0:I.profile_image),showFallback:!0,name:(I==null?void 0:I.name)||"Unnamed User",isBordered:!0},description:I!=null&&I.phone?e.jsx(Ye,{href:`tel:${I==null?void 0:I.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:I==null?void 0:I.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Qe,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(I==null?void 0:I.name)||"Unnamed User"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[Z(l.status),(D||S)&&e.jsxs(Le,{children:[e.jsx(qe,{children:e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsxs(Ve,{"aria-label":"Leave actions",children:[D&&e.jsx(ke,{startContent:e.jsx(We,{className:"w-4 h-4"}),onPress:()=>{s(l),a("edit_leave")},children:"Edit Leave"},"edit"),S&&e.jsx(ke,{className:"text-danger",color:"danger",startContent:e.jsx(pe,{className:"w-4 h-4"}),onPress:()=>o(l.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e.jsx(Te,{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:l.leave_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("span",{className:"text-sm opacity-80",style:{color:"var(--theme-foreground)"},children:[R(l.from_date)," - ",R(l.to_date)]}),e.jsx(X,{size:"sm",variant:"bordered",style:{background:"color-mix(in srgb, var(--theme-content2) 50%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)",color:"var(--theme-foreground)",borderRadius:L()},children:ge})]}),l.reason&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Re,{className:"w-4 h-4 mt-0.5 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsx("span",{className:"text-sm flex-1 opacity-80",style:{color:"var(--theme-foreground)"},children:l.reason})]})]}),ae&&re&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"my-3"}),e.jsx("div",{className:"flex gap-2",children:["Approved","Declined"].map(ee=>e.jsx(Y,{size:"sm",variant:l.status===ee?"solid":"bordered",color:$[ee].color,isLoading:n===`${l.id}-${ee}`,onPress:()=>{n!==`${l.id}-${ee}`&&d(l,ee)},startContent:n!==`${l.id}-${ee}`?be.createElement($[ee].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:ee},ee))})]})]})})},ie=i.useCallback((l,n)=>{const s=T(l.user_id);switch(n){case"employee":return e.jsx(de,{className:"whitespace-nowrap",children:e.jsx(Oe,{avatarProps:{radius:"lg",size:"sm",src:(s==null?void 0:s.profile_image_url)||(s==null?void 0:s.profile_image),showFallback:!0,name:(s==null?void 0:s.name)||"Unnamed User",isBordered:!0},description:s!=null&&s.phone?e.jsx(Ye,{href:`tel:${s==null?void 0:s.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:s==null?void 0:s.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Qe,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(s==null?void 0:s.name)||"Unnamed User"})})});case"leave_type":return e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[W(l.leave_type),e.jsx("span",{className:"text-sm font-medium capitalize",children:l.leave_type})]})});case"from_date":case"to_date":return e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3 opacity-60",style:{color:"var(--theme-foreground)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:R(l[n])}),n==="from_date"&&e.jsx("div",{className:"text-xs opacity-60",style:{color:"var(--theme-foreground)"},children:G(l.from_date,l.to_date)})]})]})});case"status":return e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[Z(l.status),P&&f&&e.jsxs(Le,{children:[e.jsx(qe,{children:e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:r&&r.startsWith(`${l.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e.jsx(Ae,{className:"w-4 h-4"})})}),e.jsx(Ve,{"aria-label":"Status actions",onAction:a=>Q(l,a),children:Object.keys($).map(a=>{const o=$[a],d=o.icon;return e.jsx(ke,{startContent:e.jsx(d,{className:"w-4 h-4"}),color:o.color,children:a},a)})})]})]})});case"reason":return e.jsx(de,{children:e.jsx(Ie,{content:l.reason||"No reason provided",children:e.jsx("span",{className:"max-w-xs truncate cursor-help text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:l.reason||"No reason provided"})})});case"actions":return e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[w&&e.jsx(Ie,{content:"Edit Leave",children:e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:r&&r.startsWith(`${l.id}-`),onPress:()=>{r&&r.startsWith(`${l.id}-`)||(p(l),u("edit_leave"))},className:"min-w-8 h-8",children:e.jsx(We,{className:"w-4 h-4"})})}),E&&e.jsx(Ie,{content:"Delete Leave",color:"danger",children:e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:r&&r.startsWith(`${l.id}-`),onPress:()=>{r&&r.startsWith(`${l.id}-`)||(p(l),g(l.id,"delete_leave"))},className:"min-w-8 h-8",children:e.jsx(pe,{className:"w-4 h-4"})})})]})});default:return e.jsx(de,{children:l[n]})}},[P,f,B,r,p,u,g,Q]),fe=[...P?[{name:"Employee",uid:"employee",icon:Xe}]:[],{name:"Leave Type",uid:"leave_type",icon:je},{name:"From Date",uid:"from_date",icon:ne},{name:"To Date",uid:"to_date",icon:ne},{name:"Status",uid:"status",icon:Re},{name:"Reason",uid:"reason",icon:je},...P?[{name:"Actions",uid:"actions"}]:[]];return z?e.jsxs("div",{className:"space-y-4",children:[e.jsx(He,{className:"max-h-[70vh]",children:m.map(l=>e.jsx(le,{leave:l,updatingLeave:r,setCurrentLeave:p,openModal:u,handleClickOpen:g,updateLeaveStatus:Q,canEditLeaves:w,canDeleteLeaves:E,canApproveLeaves:f,isAdminView:P},l.id))}),M>F&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(Ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:k,radius:L(),total:h,onChange:V,style:{fontFamily:'var(--fontFamily, "Inter")'}})})]}):e.jsxs("div",{children:[e.jsx(He,{className:"max-h-[70vh]",children:e.jsxs(ds,{isStriped:!0,setSelection:!0,selectionMode:P?"multiple":"none",selectedKeys:t,onSelectionChange:A,topContent:U,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",radius:L(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(us,{columns:fe,children:l=>e.jsx(fs,{align:l.uid==="actions"?"center":"start",className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[l.icon&&e.jsx(l.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-semibold",children:l.name})]})},l.uid)}),e.jsx(cs,{items:m,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No leaves found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:N?`No leaves found for "${N}"`:"No leave requests for the selected period"})]}),children:l=>e.jsx(ms,{className:"transition-all duration-200 hover:scale-[1.01]",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:n=>ie(l,n)},l.id)})]})}),M>F&&e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(Ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:k,radius:L(),total:h,onChange:V,style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"text-xs opacity-70",style:{color:"var(--theme-foreground)"},children:["Page ",k," of ",h," (Total: ",M," records)"]})]})]})});Fs.displayName="LeaveEmployeeTable";const Ze=({selectedDepartmentId:m,selectedEmployeeId:b,onDepartmentChange:g,onEmployeeChange:p,allUsers:u=[],departments:v=[],showSearch:C=!0,variant:k="outlined",size:M="medium",disabled:h=!1,required:F=!1,error:j={},label:N={department:"Department",employee:"Employee"},showAllOption:P=!0,autoSelectFirstDepartment:_=!0,className:c="",theme:y})=>{const f=()=>{var A;if(typeof window>"u")return"lg";const x=((A=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:A.trim())||"12px",t=parseInt(x);return t===0?"none":t<=4?"sm":t<=8?"md":t<=16?"lg":"full"},[w,E]=i.useState(""),[H,K]=i.useState(""),[J,B]=i.useState(!1);i.useEffect(()=>{if(_&&v.length>0&&!m){const r=v[0];r&&g(r.id)}},[v,m,g,_]);const z=i.useMemo(()=>w.trim()?v.filter(r=>r.name.toLowerCase().includes(w.toLowerCase())||r.id.toString().includes(w)):v,[v,w]),q=i.useMemo(()=>m?u.filter(r=>String(r.department_id)===String(m)):P?u:[],[u,m,P]),te=i.useMemo(()=>H.trim()?q.filter(r=>{var x,t;return r.name.toLowerCase().includes(H.toLowerCase())||((x=r.email)==null?void 0:x.toLowerCase().includes(H.toLowerCase()))||r.id.toString().includes(H)||((t=r.designation)==null?void 0:t.toLowerCase().includes(H.toLowerCase()))}):q,[q,H]);return i.useEffect(()=>{m&&b&&(q.some(x=>String(x.id)===String(b))||p(""))},[m,b,q,p]),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${c}`,children:[e.jsx("div",{children:e.jsxs(Ne,{label:N.department,placeholder:"Select Department",selectionMode:"single",selectedKeys:m!=null?new Set([String(m)]):new Set,onSelectionChange:r=>{const x=Array.from(r)[0],t=x===""||x===void 0||x===null?null:parseInt(x);g(t),b&&p(null),E(""),K("")},isDisabled:h,isRequired:F,isInvalid:!!j.department_id,errorMessage:j.department_id,variant:"bordered",size:M==="medium"?"sm":M,radius:f(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[P&&e.jsx(oe,{value:"",textValue:"All Departments",children:e.jsx("span",{children:"All Departments"})},""),z.map(r=>e.jsx(oe,{value:String(r.id),textValue:r.name,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:r.name}),e.jsx(X,{size:"sm",variant:"bordered",className:"ml-auto text-xs",children:u.filter(x=>x.department_id===r.id).length})]})},String(r.id)))]})}),e.jsx("div",{children:e.jsxs(Ne,{label:N.employee,placeholder:!m&&!P?"Select department first":"Select Employee",selectionMode:"single",selectedKeys:b!=null?new Set([String(b)]):new Set,onSelectionChange:r=>{const x=Array.from(r)[0],t=x===""||x===void 0||x===null?null:parseInt(x);p(t),K("")},isDisabled:h||J||!m&&!P,isRequired:F,isInvalid:!!j.user_id,errorMessage:j.user_id,variant:"bordered",size:M==="medium"?"sm":M,radius:f(),className:"w-full",classNames:{trigger:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[P&&e.jsx(oe,{value:"",textValue:m?"All Employees in Department":"Select Department First",children:e.jsx("span",{children:m?"All Employees in Department":"Select Department First"})},""),te.map(r=>e.jsx(oe,{value:String(r.id),textValue:r.name,children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(ss,{src:r.profile_image_url||r.profile_image,size:"sm",name:r.name,showFallback:!0}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:r.name}),r.designation&&e.jsx("span",{className:"text-xs text-gray-500",children:r.designation})]}),r.department&&e.jsx(X,{size:"sm",variant:"bordered",className:"text-xs h-5",children:r.department})]})},String(r.id))),te.length===0&&e.jsx(oe,{isDisabled:!0,children:e.jsx("span",{className:"text-sm text-gray-500",children:m?"No employees found in selected department":"No employees found"})},"no-employees")]})})]})},st=({open:m,closeModal:b,leavesData:g,setLeavesData:p,currentLeave:u,allUsers:v,departments:C=[],setTotalRows:k,setLastPage:M,setLeaves:h,handleMonthChange:F,employee:j,selectedMonth:N,addLeaveOptimized:P,updateLeaveOptimized:_,fetchLeavesStats:c})=>{const y=()=>{var o;if(typeof window>"u")return"lg";const s=((o=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:o.trim())||"12px",a=parseInt(s);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},{auth:f}=ze().props,[w,E]=i.useState((u==null?void 0:u.user_id)||f.user.id),H=()=>{var n;if(u!=null&&u.user_id){const s=v==null?void 0:v.find(a=>a.id===u.user_id);return(s==null?void 0:s.department_id)||null}return((n=f==null?void 0:f.user)==null?void 0:n.department_id)||null},[K,J]=i.useState(H()),[B,z]=i.useState((g==null?void 0:g.leaveTypes)||[]),[q,te]=i.useState([]),[r,x]=i.useState((u==null?void 0:u.leave_type)||""),t=n=>{if(!n)return new Date().toISOString().split("T")[0];if(typeof n=="string"&&n.match(/^\d{4}-\d{2}-\d{2}$/))return n;if(typeof n=="string"&&n.includes("T")){if(n.includes("T18:00:00")){const a=n.split("T")[0].split("-"),o=parseInt(a[0]),d=parseInt(a[1]),D=parseInt(a[2])+1;return new Date(o,d-1,D).toISOString().split("T")[0]}return n.split("T")[0]}try{const s=new Date(n);if(isNaN(s.getTime()))return new Date().toISOString().split("T")[0];const a=s.getFullYear(),o=String(s.getMonth()+1).padStart(2,"0"),d=String(s.getDate()).padStart(2,"0");return`${a}-${o}-${d}`}catch(s){return console.error("Error formatting date:",s),new Date().toISOString().split("T")[0]}},[A,L]=i.useState(u!=null&&u.from_date?t(u.from_date):""),[U,$]=i.useState(u!=null&&u.to_date?t(u.to_date):""),[W,V]=i.useState((u==null?void 0:u.no_of_days)||""),[Q,Z]=i.useState(""),[G,R]=i.useState((u==null?void 0:u.reason)||""),[T,le]=i.useState({}),[ie,fe]=i.useState(!1),[ye,he]=i.useState("");i.useEffect(()=>{var n;if(g){const s=g.leaveTypes||[];z(s);const a=((n=g.leaveCountsByUser)==null?void 0:n[w])||[];if(te(a),s.length>0&&!r&&!u&&x(s[0].type),u&&!r){const o=s==null?void 0:s.find(d=>d.id===u.leave_type);o&&x(o.type)}}},[g,w,u]),i.useEffect(()=>{if(u){E(u.user_id);const n=v==null?void 0:v.find(s=>s.id===u.user_id);n!=null&&n.department_id&&J(n.department_id)}},[u,v]),i.useEffect(()=>{if(!r||!q||!B)return;const n=q.find(o=>o.leave_type===r),s=(n==null?void 0:n.days_used)||0;he(s);const a=B.find(o=>o.type===r);if(a){const o=a.days-s;Z(o),u&&W>o&&V(o)}},[r,q,B,u,W]),i.useEffect(()=>{V(((s,a)=>{if(!s||!a)return"";const o=new Date(s),d=new Date(a);if(o>d)return"";const D=d.getTime()-o.getTime();return Math.ceil(D/(1e3*3600*24))+1})(A,U))},[A,U]);const l=async n=>{n.preventDefault(),fe(!0);const s=new Promise(async(a,o)=>{try{const d={route:route().current(),user_id:w,leaveType:r,fromDate:A,toDate:U,daysCount:W,leaveReason:G,employee:j,month:N},D=u?route("leave-update"):route("leave-add");u&&(d.id=u.id);const S=await axios.post(D,d);S.status===200||S.status===201?(p(S.data.leavesData),u&&_&&S.data.leave?(_(S.data.leave),c()):P&&S.data.leave?(P(S.data.leave),c(),S.data.pagination&&(k(S.data.pagination.total),M(S.data.pagination.lastPage))):(console.log("Using fallback data update mode"),S.data.leaves&&(h(S.data.leaves.data),k(S.data.leaves.total),M(S.data.leaves.last_page)),S.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(S.data.leavesData)),b(),a([S.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",S.status),o(`Unexpected response status: ${S.status}`))}catch(d){console.error("Full error object:",d),d.response?(console.error("Error response status:",d.response.status),console.error("Error response data:",d.response.data),d.response.status===422?(le(d.response.data.errors||{}),o(d.response.data.error||"Failed to submit leave application")):o(`HTTP Error ${d.response.status}: ${d.response.data.message||"An unexpected error occurred. Please try again later."}`)):d.request?(console.error("No response received:",d.request),o("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",d.message),o("An error occurred while setting up the request."))}finally{fe(!1)}});O.promise(s,{pending:"Submitting leave application...",success:{render({data:a}){return a.join(", ")}},error:{render({data:a}){return a}}})};return e.jsx(we,{isOpen:m,onClose:b,size:"3xl",radius:y(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Fe,{children:n=>{var s;return e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:20,style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:u?"Edit Leave":"Add Leave"})]})}),e.jsxs("form",{onSubmit:l,children:[e.jsx(_e,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(Ne,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:r&&r!==""?new Set([r]):new Set,onSelectionChange:a=>{const o=Array.from(a)[0];x(o||"")},isInvalid:!!T.leaveType,errorMessage:T.leaveType,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(ws,{size:16,className:"text-default-400"}),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:B.map(a=>{const o=q==null?void 0:q.find(S=>S.leave_type===a.type),D=(o?a.days-o.days_used:a.days)<=0;return e.jsx(oe,{value:a.type,isDisabled:D,title:D?"No remaining leaves available":"",textValue:a.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:a.type}),e.jsx("span",{className:"text-small text-default-500",children:o?`${o.days_used} / ${a.days} days`:`${a.days} days`})]})},a.type)})})}),e.jsx("div",{className:"col-span-1",children:e.jsx(xe,{label:"From Date",type:"date",value:A,onValueChange:L,isInvalid:!!T.fromDate,errorMessage:T.fromDate,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Pe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(xe,{label:"To Date",type:"date",value:U,onValueChange:$,isInvalid:!!T.toDate,errorMessage:T.toDate,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Pe,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(xe,{label:"Number of Days",value:W.toString(),isReadOnly:!0,isInvalid:!!T.daysCount,errorMessage:T.daysCount,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Je,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(xe,{label:"Remaining Leaves",value:`${Q} day${Q!==1?"s":""} of ${((s=B.find(a=>a.type===r))==null?void 0:s.days)||0} total`,isReadOnly:!0,isInvalid:!!T.remainingLeaves,errorMessage:T.remainingLeaves,variant:"bordered",size:"sm",radius:y(),startContent:e.jsx(Je,{size:16,className:"text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),route().current()==="leaves"&&e.jsx("div",{className:"col-span-full",children:e.jsx(Ze,{selectedDepartmentId:K,selectedEmployeeId:w,onDepartmentChange:J,onEmployeeChange:E,allUsers:v,departments:C,showSearch:!0,error:T,variant:"bordered",size:"sm",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e.jsx("div",{className:"col-span-full",children:e.jsx(hs,{label:"Leave Reason",placeholder:"Please provide a detailed reason for your leave request...",value:G,onValueChange:R,isInvalid:!!T.leaveReason,errorMessage:T.leaveReason,variant:"bordered",size:"sm",radius:y(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})}),e.jsxs(Ee,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Y,{color:"default",variant:"bordered",onPress:n,radius:y(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(Y,{type:"submit",color:"primary",variant:"solid",isLoading:ie,isDisabled:ie,radius:y(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:ie?"Submitting...":"Submit"})]})]})]})}})})},tt=({open:m,closeModal:b,leaveId:g,setLeavesData:p,setLeaves:u,setTotalRows:v,setLastPage:C,setError:k,deleteLeaveOptimized:M,fetchLeavesStats:h})=>{const[F,j]=i.useState(!1),N=()=>{var f;if(typeof window>"u")return"lg";const c=((f=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:f.trim())||"12px",y=parseInt(c);return y===0?"none":y<=4?"sm":y<=8?"md":y<=16?"lg":"full"},P=async()=>{if(!g){O.error("Invalid leave ID provided");return}j(!0);const _=new Promise(async(c,y)=>{var f,w,E,H,K,J,B;try{const z=await ce.delete(route("leave-delete",{id:g,route:route().current()}));z.status===200&&(M?(M(g),v(q=>Math.max(0,q-1)),h&&h()):(p&&p(z.data.leavesData),v&&v(z.data.leaves.total),C&&C(z.data.leaves.last_page),u&&u(z.data.leaves.data),k&&k(!1),h&&h()),c("Leave application deleted successfully"))}catch(z){if(console.error("Error deleting leave:",z),((f=z.response)==null?void 0:f.status)===404){const{leavesData:q}=z.response.data||{};p&&q&&p(q),k&&k(((E=(w=z.response)==null?void 0:w.data)==null?void 0:E.message)||"Leave not found."),y("Leave not found or already deleted")}else((H=z.response)==null?void 0:H.status)===403?y("You do not have permission to delete this leave"):((K=z.response)==null?void 0:K.status)===422?y("Cannot delete leave with current status"):y(((B=(J=z.response)==null?void 0:J.data)==null?void 0:B.error)||"Failed to delete leave application")}finally{j(!1),b()}});O.promise(_,{pending:"Deleting leave application...",success:{render({data:c}){return c}},error:{render({data:c}){return c}}})};return e.jsx(we,{isOpen:m,onClose:b,size:"md",radius:N(),classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"py-6",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},isDismissable:!F,hideCloseButton:F,children:e.jsx(Fe,{children:_=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:"color-mix(in srgb, #ef4444 15%, transparent)",color:"#ef4444"},children:e.jsx(ve,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Confirm Deletion"})]})}),e.jsx(_e,{style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ve,{className:"w-5 h-5 mt-0.5 flex-shrink-0",style:{color:"#ef4444"}}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Are you sure you want to delete this leave application?"}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"This action cannot be undone. The leave application will be permanently removed from the system."})]})]})}),e.jsxs(Ee,{className:"flex justify-end gap-2 px-6 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Y,{color:"default",variant:"bordered",onPress:_,radius:N(),size:"sm",isDisabled:F,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(Y,{color:"danger",variant:"solid",onPress:P,radius:N(),size:"sm",isLoading:F,isDisabled:F,startContent:!F&&e.jsx(pe,{className:"w-4 h-4"}),style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:F?"Deleting...":"Delete Leave"})]})]})})})},se=()=>{var p;if(typeof window>"u")return"lg";const b=((p=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:p.trim())||"12px",g=parseInt(b);return g===0?"none":g<=4?"sm":g<=8?"md":g<=12?"lg":"xl"},Ss=({selectedDates:m=[],onDatesChange:b,existingLeaves:g=[],publicHolidays:p=[],minDate:u=null,maxDate:v=null,userId:C=null,fetchFromAPI:k=!1})=>{const[M,h]=i.useState(new Date),[F,j]=i.useState({existingLeaves:g,publicHolidays:p}),[N,P]=i.useState(!1),[_,c]=i.useState(null),y=i.useCallback(async r=>{if(!(!k||!C)&&_!==r){P(!0);try{const x=await ce.get(route("leaves.bulk.calendar-data"),{params:{user_id:C,year:r}});x.data.success&&(j({existingLeaves:x.data.data.existingLeaves||[],publicHolidays:x.data.data.publicHolidays||[]}),c(r))}catch(x){console.error("Failed to fetch calendar data:",x)}finally{P(!1)}}},[k,C,_]);i.useEffect(()=>{const r=M.getFullYear();y(r)},[y,M.getFullYear()]),i.useEffect(()=>{k&&C&&c(null)},[C,k]);const f=k?F.existingLeaves:g,w=k?F.publicHolidays:p,E=i.useMemo(()=>{const r=M.getFullYear(),x=M.getMonth(),t=new Date(r,x,1),L=new Date(r,x+1,0).getDate(),U=t.getDay(),$=new Date(r,x,0).getDate(),W=[];for(let R=U-1;R>=0;R--)W.push({date:$-R,isCurrentMonth:!1,fullDate:new Date(r,x-1,$-R)});const V=[];for(let R=1;R<=L;R++)V.push({date:R,isCurrentMonth:!0,fullDate:new Date(r,x,R)});const Z=42-(W.length+V.length),G=[];for(let R=1;R<=Z;R++)G.push({date:R,isCurrentMonth:!1,fullDate:new Date(r,x+1,R)});return[...W,...V,...G]},[M]),H=i.useCallback(()=>{h(r=>new Date(r.getFullYear(),r.getMonth()-1,1))},[]),K=i.useCallback(()=>{h(r=>new Date(r.getFullYear(),r.getMonth()+1,1))},[]),J=i.useCallback(()=>{h(new Date)},[]),B=i.useCallback(r=>{if(!r.isCurrentMonth||N)return;const x=r.fullDate.getFullYear()+"-"+String(r.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(r.fullDate.getDate()).padStart(2,"0"),t=f.some($=>{if(!$.from_date||!$.to_date)return!1;const W=$.from_date.split("T")[0],V=$.to_date.split("T")[0];return x>=W&&x<=V}),A=w.includes(x);if(t||A||u&&r.fullDate<new Date(u)||v&&r.fullDate>new Date(v))return;const L=m.includes(x);let U;L?U=m.filter($=>$!==x):U=[...m,x],b(U.sort())},[m,b,u,v,N,f,w]),z=i.useCallback(r=>{if(!r.isCurrentMonth)return{selectable:!1};const x=r.fullDate.getFullYear()+"-"+String(r.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(r.fullDate.getDate()).padStart(2,"0"),t=m.includes(x),A=r.fullDate.toDateString()===new Date().toDateString(),L=r.fullDate<new Date().setHours(0,0,0,0),U=r.fullDate.getDay()===0||r.fullDate.getDay()===6,$=f.some(Q=>{if(!Q.from_date||!Q.to_date)return!1;const Z=Q.from_date.split("T")[0],G=Q.to_date.split("T")[0];return x>=Z&&x<=G}),W=w.includes(x),V=!N&&!$&&!W&&(!u||r.fullDate>=new Date(u))&&(!v||r.fullDate<=new Date(v));return{isSelected:t,isToday:A,isPast:L,isWeekend:U,hasExistingLeave:$,isPublicHoliday:W,selectable:V}},[m,f,w,u,v,N]),q=M.toLocaleDateString("en-US",{month:"long",year:"numeric"}),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs(me,{radius:se(),className:"w-full shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                    color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                    color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx(Me,{className:"pb-3 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 sm:w-5 sm:h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:q}),k&&_&&e.jsx(X,{size:"sm",variant:"bordered",color:"primary",className:"ml-2 text-xs hidden sm:flex",radius:se(),style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:_})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",onClick:H,isDisabled:N,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(gs,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx(Y,{size:"sm",variant:"light",onClick:J,isDisabled:N,radius:se(),className:"px-2 py-1 text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(Y,{isIconOnly:!0,size:"sm",variant:"light",onClick:K,isDisabled:N,radius:se(),className:"min-w-8 h-8",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(ts,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]})}),e.jsxs(ue,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[N&&e.jsxs("div",{className:"flex justify-center items-center py-4 rounded-lg mb-4",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)"},children:[e.jsx(Ge,{size:"sm",color:"primary"}),e.jsxs("span",{className:"ml-2 text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:["Loading calendar data for ",M.getFullYear(),"..."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mb-4",children:[e.jsx(X,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected"}),e.jsx(X,{size:"sm",color:"danger",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Leave"}),e.jsx(X,{size:"sm",color:"warning",variant:"solid",radius:se(),className:"text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Holiday"}),e.jsx(X,{size:"sm",color:"secondary",variant:"solid",radius:se(),className:"text-xs font-medium hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Today"}),e.jsx(X,{size:"sm",color:"default",variant:"bordered",radius:se(),className:"text-xs hidden sm:flex",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Weekend"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1 mb-2",children:te.map(r=>e.jsx("div",{className:"flex items-center justify-center w-8 h-6 sm:w-10 sm:h-8 text-xs sm:text-sm font-medium",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:r},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-0.5 sm:gap-1",children:E.map((r,x)=>{const t=z(r);return e.jsxs("div",{onClick:()=>B(r),className:`
                                    relative flex items-center justify-center w-8 h-8 sm:w-10 sm:h-10 min-h-8 sm:min-h-10
                                    rounded-md transition-all duration-200 text-xs sm:text-sm select-none
                                    ${t.selectable?"cursor-pointer":"cursor-not-allowed"}
                                    ${r.isCurrentMonth?"":"opacity-30"}
                                    ${N?"opacity-50 pointer-events-none":""}
                                    ${t.isSelected?"font-bold border-2 shadow-md scale-105 z-10":""}
                                    ${t.hasExistingLeave&&!t.isSelected?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"border-2 font-medium cursor-not-allowed":""}
                                    ${t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"font-semibold border-2 shadow-sm":""}
                                    ${t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"border opacity-70":""}
                                    ${!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"cursor-not-allowed opacity-60":""}
                                    ${t.selectable&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"border border-transparent hover:scale-105":""}
                                `,style:{backgroundColor:t.isSelected?"var(--theme-primary)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-200)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday||N?"var(--theme-content2)":"transparent",color:t.isSelected?"var(--theme-primary-foreground)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-foreground)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-foreground)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-800)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-foreground-500)":!t.selectable&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday&&!t.isWeekend?"var(--theme-foreground-400)":"var(--theme-foreground-900)",borderColor:t.isSelected?"var(--theme-primary-600)":t.hasExistingLeave&&!t.isSelected?"var(--theme-danger-600)":t.isPublicHoliday&&!t.isSelected&&!t.hasExistingLeave?"var(--theme-warning-600)":t.isToday&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday?"var(--theme-secondary-500)":t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&!t.isToday?"var(--theme-divider)":"transparent",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},role:"button",tabIndex:t.selectable?0:-1,title:t.hasExistingLeave?"Existing leave - cannot select":t.isPublicHoliday?"Public holiday - cannot select":t.selectable?"":"Not selectable","aria-label":`${r.fullDate.toDateString()}${t.isSelected?" (selected)":""}${t.hasExistingLeave?" (existing leave)":""}${t.isPublicHoliday?" (public holiday)":""}`,onKeyDown:A=>{(A.key==="Enter"||A.key===" ")&&(A.preventDefault(),B(r))},children:[r.date,t.isWeekend&&!t.isSelected&&!t.hasExistingLeave&&!t.isPublicHoliday&&e.jsx("div",{className:"absolute top-0.5 right-0.5 w-1 h-1 rounded-full opacity-50 hidden sm:block",style:{backgroundColor:"var(--theme-foreground-500)"}})]},x)})}),m.length>0&&e.jsxs("div",{className:"mt-4 p-3 sm:p-4 rounded-lg relative overflow-hidden",style:{background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-primary) 10%, transparent) 20%, 
                            color-mix(in srgb, var(--theme-primary) 5%, transparent) 80%)`,border:"1px solid color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-xs sm:text-sm font-semibold mb-2",style:{color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["ðŸ“… ",m.length," date",m.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[m.slice(0,8).map(r=>e.jsx(X,{size:"sm",color:"primary",variant:"solid",radius:se(),className:"text-xs font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric"})},r)),m.length>8&&e.jsxs(X,{size:"sm",color:"primary",variant:"bordered",radius:se(),className:"text-xs font-medium",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)",fontFamily:'var(--fontFamily, "Inter")'},children:["+",m.length-8," more"]})]})]}),e.jsx("div",{className:"absolute -top-2 -right-2 w-12 h-12 rounded-full opacity-30",style:{backgroundColor:"var(--theme-primary)"}})]})]})]})},$e=()=>{var p;if(typeof window>"u")return"lg";const b=((p=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:p.trim())||"12px",g=parseInt(b);return g===0?"none":g<=4?"sm":g<=8?"md":g<=12?"lg":"xl"},_s=({validationResults:m=[],balanceImpact:b=null,isValidating:g=!1})=>{if(m.length===0&&!g)return null;const p=m.filter(h=>h.status==="valid").length,u=m.filter(h=>h.status==="warning").length,v=m.filter(h=>h.status==="conflict").length;m.length;const C=h=>{const F={className:"w-4 h-4"};switch(h){case"valid":return e.jsx(Be,{...F,style:{color:"var(--theme-success, #22C55E)"}});case"warning":return e.jsx(ve,{...F,style:{color:"var(--theme-warning, #F59E0B)"}});case"conflict":return e.jsx(xs,{...F,style:{color:"var(--theme-danger, #EF4444)"}});default:return e.jsx(Ke,{...F,style:{color:"var(--theme-foreground-400, #A1A1AA)"}})}},k=h=>{switch(h){case"valid":return"success";case"warning":return"warning";case"conflict":return"danger";default:return"default"}},M=h=>new Date(h).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex flex-col gap-3 sm:gap-4",children:[e.jsxs(me,{radius:$e(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                        color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                        color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx(Me,{className:"pb-2 px-4 pt-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Validation Results"}),g&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{size:"sm",color:"primary"}),e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Validating..."})]})]})}),e.jsxs(ue,{className:"pt-0 px-4 pb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:p}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-success, #22C55E)",fontFamily:'var(--fontFamily, "Inter")'},children:"Valid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:u}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-warning, #F59E0B)",fontFamily:'var(--fontFamily, "Inter")'},children:"Warnings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-lg sm:text-2xl font-bold",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:v}),e.jsx("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger, #EF4444)",fontFamily:'var(--fontFamily, "Inter")'},children:"Conflicts"})]})]}),b&&e.jsxs("div",{className:"p-3 sm:p-4 rounded-lg border",style:{background:"var(--theme-content2, #F4F4F5)",borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},children:[e.jsxs("h4",{className:"text-xs sm:text-sm font-medium mb-3 sm:mb-4 flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ke,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),"Leave Balance Impact"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Leave Type:"}),e.jsx("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:b.leave_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Current Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.current_balance," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Requested Days:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[b.requested_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs sm:text-sm",style:{color:"var(--theme-foreground-600, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:"Remaining Balance:"}),e.jsxs("span",{className:"text-xs sm:text-sm font-medium ml-2",style:{color:b.remaining_balance<0?"var(--theme-danger)":"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:[b.remaining_balance," days"]})]})]}),b.remaining_balance<0&&e.jsx("div",{className:"mt-3 p-2 sm:p-3 rounded-md border",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"text-xs sm:text-sm",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["âš ï¸ This request exceeds your available leave balance by ",Math.abs(b.remaining_balance)," days."]})})]})]})]}),m.length>0&&e.jsxs(me,{radius:$e(),className:"shadow-sm border border-divider/50",style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-content1) 90%, transparent) 40%, 
                            color-mix(in srgb, var(--theme-content2) 80%, transparent) 60%)`},children:[e.jsx(Me,{className:"px-4 pt-4 pb-2",children:e.jsx("h3",{className:"text-base sm:text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Date-by-Date Results"})}),e.jsx(ue,{className:"px-4 pb-4 pt-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex flex-col gap-2 max-h-40 overflow-y-auto",children:m.map((h,F)=>e.jsxs("div",{className:"flex items-start justify-between p-3 rounded-lg border transition-colors",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 8px)"},onMouseEnter:j=>{j.target.style.borderColor="var(--theme-divider-hover, #D4D4D8)"},onMouseLeave:j=>{j.target.style.borderColor="var(--theme-divider, #E4E4E7)"},children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[C(h.status),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:M(h.date)}),e.jsx("p",{className:"text-xs opacity-75",style:{color:"var(--theme-foreground-500, #71717A)",fontFamily:'var(--fontFamily, "Inter")'},children:h.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(X,{size:"sm",variant:"bordered",color:k(h.status),radius:$e(),className:"capitalize text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:h.status}),h.errors&&h.errors.length>0&&e.jsx("div",{className:"text-right",children:h.errors.map((j,N)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:j},N))}),h.warnings&&h.warnings.length>0&&e.jsx("div",{className:"text-right",children:h.warnings.map((j,N)=>e.jsx("p",{className:"text-xs",style:{color:"var(--theme-warning)",fontFamily:'var(--fontFamily, "Inter")'},children:j},N))})]})]},F))})})]})]})},rt=({open:m,onClose:b,onSuccess:g,allUsers:p=[],departments:u=[],leavesData:v={leaveTypes:[],leaveCountsByUser:{}},isAdmin:C=!1,existingLeaves:k=[],publicHolidays:M=[]})=>{var l;const{auth:h}=ze().props,F=()=>{var o;if(typeof window>"u")return"lg";const s=((o=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:o.trim())||"12px",a=parseInt(s);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},[j,N]=i.useState([]),[P,_]=i.useState(null),[c,y]=i.useState(null),[f,w]=i.useState(""),[E,H]=i.useState(""),[K,J]=i.useState(!1),[B,z]=i.useState([]),[q,te]=i.useState(!1),[r,x]=i.useState([]),[t,A]=i.useState(null),[L,U]=i.useState(!1),[$,W]=i.useState(!1),[V,Q]=i.useState(!1),[Z,G]=i.useState({});i.useMemo(()=>!k||k.length===0?[]:k.filter(n=>n.user_id===parseInt(c)),[k,c]);const R=i.useMemo(()=>B.length>0?B:(v==null?void 0:v.leaveTypes)||[],[B,v]),T=i.useMemo(()=>{var n;return B.length>0?B.map(s=>({leave_type:s.type,days_used:s.used,total_days:s.days,remaining_days:s.remaining})):((n=v==null?void 0:v.leaveCountsByUser)==null?void 0:n[c])||[]},[B,v,c]),le=i.useCallback(async n=>{if(n){te(!0);try{const s=await ce.get(route("leaves.bulk.leave-types"),{params:{user_id:n,year:new Date().getFullYear()}});s.data.success&&z(s.data.leave_types)}catch(s){console.error("Failed to fetch user leave types:",s),z([])}finally{te(!1)}}},[]);i.useEffect(()=>{(m&&c&&C||m&&c&&!C)&&le(c)},[c,m,C,le]),i.useEffect(()=>{if(m&&(h!=null&&h.user)){const n=p==null?void 0:p.find(s=>s.id===h.user.id);(n&&n.department_id&&!C||C&&!P&&!c&&n&&n.department_id)&&(_(n.department_id),y(h.user.id))}},[m,h==null?void 0:h.user,p,C,P,c]),i.useEffect(()=>{var n;m||(N([]),_(null),y(((n=h==null?void 0:h.user)==null?void 0:n.id)||null),w(""),H(""),J(!1),x([]),A(null),W(!1),G({}),z([]))},[m,(l=h==null?void 0:h.user)==null?void 0:l.id]),i.useEffect(()=>{if(R.length>0&&!f&&m&&c){const n=R.find(s=>{if(B.length>0)return s.remaining>0;const a=T==null?void 0:T.find(d=>d.leave_type===s.type);return(a?s.days-a.days_used:s.days)>0});n&&w(n.type)}},[R,T,B,f,m,c]);const ie=i.useCallback(async()=>{var n,s,a;if(j.length===0){const o=Promise.reject(new Error("No dates selected"));O.promise(o,{error:"Please select at least one date"});return}if(!f){const o=Promise.reject(new Error("No leave type selected"));O.promise(o,{error:"Please select a leave type"});return}if(!E.trim()||E.trim().length<5){const o=Promise.reject("Please provide a reason for leave (at least 5 characters)");O.promise(o,{error:"Please provide a reason for leave (at least 5 characters)"});return}U(!0),G({});try{const o=R.find(D=>D.type===f),d=await ce.post(route("leaves.bulk.validate"),{user_id:parseInt(c),dates:j,leave_type_id:o==null?void 0:o.id,reason:E.trim()});if(d.data.success){x(d.data.validation_results),A(d.data.estimated_balance_impact),W(!0);const D=d.data.validation_results.filter(ae=>ae.status==="conflict").length,S=d.data.validation_results.filter(ae=>ae.status==="warning").length,re=Promise.resolve();D>0?O.promise(re,{success:`${D} date(s) have conflicts. Please review before submitting.`}):S>0?O.promise(re,{success:`${S} date(s) have warnings. You may proceed if acceptable.`}):O.promise(re,{success:"All dates validated successfully!"})}}catch(o){console.error("Validation error:",o),((n=o.response)==null?void 0:n.status)===422&&G(o.response.data.errors||{});const d=Promise.reject(o);O.promise(d,{error:((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to validate dates"})}finally{U(!1)}},[j,f,E,c,R]),fe=i.useCallback(async()=>{if(!$){const a=Promise.reject(new Error("Not validated"));O.promise(a,{error:"Please validate dates before submitting"});return}if(r.filter(a=>a.status==="conflict").length>0&&!K){const a=Promise.reject("Please resolve conflicts or enable partial success mode");O.promise(a,{error:"Please resolve conflicts or enable partial success mode"});return}Q(!0);const s=new Promise(async(a,o)=>{try{const d=R.find(S=>S.type===f),D=await ce.post(route("leaves.bulk.store"),{user_id:parseInt(c),dates:j,leave_type_id:d==null?void 0:d.id,reason:E.trim(),allow_partial_success:K});D.status===200||D.status===201?(g==null||g(D.data),b(),a([D.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",D.status),o(`Unexpected response status: ${D.status}`))}catch(d){console.error("Full error object:",d),d.response?(console.error("Error response status:",d.response.status),console.error("Error response data:",d.response.data),d.response.status===422?(G(d.response.data.errors||{}),o(d.response.data.error||"Failed to submit bulk leave requests")):o(`HTTP Error ${d.response.status}: ${d.response.data.message||"An unexpected error occurred. Please try again later."}`)):d.request?(console.error("No response received:",d.request),o("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",d.message),o("An error occurred while setting up the request."))}finally{Q(!1)}});O.promise(s,{pending:"Creating bulk leave requests...",success:{render({data:a}){return a.join(", ")}},error:{render({data:a}){return a}}})},[$,r,K,c,j,f,E,g,b,R]),ye=j.length>0&&f&&E.trim().length>=5,he=$&&(r.filter(n=>n.status==="conflict").length===0||K);return e.jsx(we,{isOpen:m,onClose:b,size:"5xl",radius:F(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md max-h-[95vh] my-2",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(95vh-160px)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Fe,{children:n=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"flex flex-col gap-1 py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 sm:w-6 sm:h-6",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Add Bulk Leave"}),e.jsx("p",{className:"text-sm text-default-500 mt-0.5",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Select multiple dates and create leave requests in batch"})]})]})}),e.jsx(_e,{className:"py-4 px-4 sm:py-6 sm:px-6 overflow-y-auto",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ne,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Select Dates"]}),e.jsx(Ss,{selectedDates:j,onDatesChange:s=>{N(s),W(!1)},userId:c,fetchFromAPI:!0})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",style:{color:"var(--theme-foreground-900, #18181B)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Xe,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Leave Details"]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[C&&p.length>0&&e.jsx(Ze,{selectedDepartmentId:P,selectedEmployeeId:c,onDepartmentChange:_,onEmployeeChange:s=>{y(s),w(""),W(!1),z([])},allUsers:p,departments:u,showSearch:!0,error:Z,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:V||L}),e.jsx("div",{children:e.jsx(Ne,{label:"Leave Type",placeholder:"Select Leave Type",selectionMode:"single",selectedKeys:f?new Set([f]):new Set,onSelectionChange:s=>{const a=Array.from(s)[0];w(a||""),W(!1)},isDisabled:V||L||q,isInvalid:!!Z.leave_type_id,errorMessage:Z.leave_type_id,variant:"bordered",size:"sm",radius:F(),classNames:{trigger:"min-h-unit-10",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:q?e.jsx(oe,{isDisabled:!0,children:"Loading leave types..."},"loading"):R.map(s=>{let a,o;if(B.length>0)a=s.remaining,o=a<=0;else{const d=T==null?void 0:T.find(D=>D.leave_type===s.type);a=d?s.days-d.days_used:s.days,o=a<=0}return e.jsx(oe,{value:s.type,isDisabled:o,title:o?"No remaining leaves available":"",textValue:s.type,children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:s.type}),e.jsxs("span",{children:["(",a," remaining)"]})]})},s.type)})})}),f&&e.jsx(xe,{label:"Remaining Leaves",value:(()=>{const s=R.find(d=>d.type===f);let a,o;if(B.length>0&&s)a=s.remaining,o=s.days;else{const d=T==null?void 0:T.find(D=>D.leave_type===f);a=d?(s==null?void 0:s.days)-d.days_used:s==null?void 0:s.days,o=s==null?void 0:s.days}return`${a||0} remaining of ${o||0} total`})(),isReadOnly:!0,variant:"bordered",size:"sm",radius:F(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(xe,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:E,onChange:s=>{H(s.target.value),W(!1)},isRequired:!0,isInvalid:!!Z.reason||E.length>0&&E.length<5,errorMessage:Z.reason||(E.length>0&&E.length<5?"Reason must be at least 5 characters":`${E.length}/500 characters`),maxLength:500,isDisabled:V||L,variant:"bordered",size:"sm",radius:F(),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ps,{isSelected:K,onValueChange:J,size:"sm",isDisabled:V||L}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allow partial success"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Valid dates will be processed even if some dates fail validation"})]})]})]})]}),j.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",style:{borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 30%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 20%, transparent) 10%)`,fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Selected Dates Summary"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("strong",{children:j.length})," date",j.length!==1?"s":""," selected"]}),f&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Leave type: ",f]})]}),e.jsx(_s,{validationResults:r,balanceImpact:t,isValidating:L})]})})]})}),e.jsxs(Ee,{className:"flex flex-col sm:flex-row justify-between items-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Y,{variant:"light",onPress:n,isDisabled:V,radius:F(),className:"w-full sm:w-auto order-2 sm:order-1",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto order-1 sm:order-2",children:[e.jsx(Y,{variant:"bordered",color:"primary",onPress:ie,isLoading:L,isDisabled:!ye||V,startContent:!L&&e.jsx(ve,{className:"w-4 h-4"}),radius:F(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:L?"Validating...":"Validate Dates"})}),e.jsx(Y,{variant:"solid",color:"primary",onPress:fe,isLoading:V,isDisabled:!he||L,startContent:!V&&e.jsx(Be,{className:"w-4 h-4"}),radius:F(),className:"w-full sm:w-auto",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("span",{className:"truncate",children:V?"Creating...":`Create ${j.length} Leave${j.length!==1?"s":""}`})})]})]})]})})})},at=({open:m,onClose:b,onSuccess:g,selectedLeaves:p=[],allUsers:u=[]})=>{const v=()=>{var f;if(typeof window>"u")return"lg";const c=((f=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:f.trim())||"12px",y=parseInt(c);return y===0?"none":y<=4?"sm":y<=8?"md":y<=16?"lg":"full"},[C,k]=i.useState(!1),[M,h]=i.useState({}),F=i.useCallback(_=>{const c=u.find(y=>y.id===_);return(c==null?void 0:c.name)||`User ID: ${_}`},[u]),j=p.filter(_=>_.status&&_.status.toLowerCase()==="approved"),N=j.length===0,P=i.useCallback(async()=>{if(!N){const c=Promise.reject("Cannot delete approved leaves");O.promise(c,{error:"Cannot delete approved leave requests"});return}if(p.length===0){const c=Promise.reject("No leaves selected");O.promise(c,{error:"No leave requests selected for deletion"});return}k(!0);const _=new Promise(async(c,y)=>{try{const f=p.map(E=>E.id),w=await ce.delete(route("leaves.bulk.delete"),{data:{leave_ids:f}});w.status===200&&w.data.success?(g==null||g(w.data),b(),c([w.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",w.status),y(`Unexpected response status: ${w.status}`))}catch(f){console.error("Full error object:",f),f.response?(console.error("Error response status:",f.response.status),console.error("Error response data:",f.response.data),f.response.status===422?(h(f.response.data.errors||{}),y(f.response.data.error||"Failed to delete leave requests")):f.response.status===403?y(f.response.data.error||"You are not authorized to delete these leave requests"):f.response.status===404?y(f.response.data.error||"Some leave requests were not found"):y(`HTTP Error ${f.response.status}: ${f.response.data.message||"An unexpected error occurred. Please try again later."}`)):f.request?(console.error("No response received:",f.request),y("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",f.message),y("An error occurred while setting up the request."))}finally{k(!1)}});O.promise(_,{pending:"Deleting leave requests...",success:{render({data:c}){return c.join(", ")}},error:{render({data:c}){return c}}})},[p,N,g,b]);return e.jsx(we,{isOpen:m,onClose:b,size:"2xl",radius:v(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(Fe,{children:_=>e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-6 h-6",style:{color:"var(--theme-danger, #f31260)"}}),e.jsxs("div",{children:[e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")',color:"var(--theme-foreground)"},children:"Delete Leave Requests"}),e.jsxs("p",{className:"text-sm mt-0.5",style:{color:"var(--theme-foreground-600)"},children:["Confirm deletion of ",p.length," leave request",p.length!==1?"s":""]})]})]})}),e.jsx(_e,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[!N&&e.jsx(me,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(ue,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ve,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("h4",{className:"font-semibold",style:{color:"var(--theme-danger)"},children:"Cannot Delete Approved Leaves"})]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:[j.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Be,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Selected Leave Requests (",p.length,")"]})]}),e.jsx(me,{className:"border max-h-80 overflow-y-auto",style:{backgroundColor:"var(--theme-content1)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(ue,{className:"p-0",children:p.map((c,y)=>{var w,E,H;const f=c.status&&c.status.toLowerCase()==="approved";return e.jsxs("div",{children:[e.jsxs("div",{className:`p-4 ${f?"opacity-60":""}`,style:{backgroundColor:f?"color-mix(in srgb, var(--theme-danger) 5%, transparent)":"transparent"},children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:F(c.user_id)}),e.jsx(X,{size:"sm",variant:"bordered",color:((w=c.status)==null?void 0:w.toLowerCase())==="approved"?"success":((E=c.status)==null?void 0:E.toLowerCase())==="pending"?"warning":((H=c.status)==null?void 0:H.toLowerCase())==="rejected"?"danger":"default",radius:v(),style:{borderRadius:"var(--borderRadius, 8px)"},children:c.status||"Unknown"}),f&&e.jsx(X,{size:"sm",variant:"bordered",color:"danger",radius:v(),style:{borderRadius:"var(--borderRadius, 8px)"},children:"Cannot Delete"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[c.leave_type," - ",c.from_date," to ",c.to_date]}),e.jsxs("p",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:[c.no_of_days," day",c.no_of_days!==1?"s":""," - ",c.reason]})]})]}),y<p.length-1&&e.jsx(Te,{style:{background:"var(--theme-divider)"}})]},c.id)})})})]}),N&&e.jsx(me,{className:"border",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(ue,{className:"p-4",children:e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--theme-warning)"},children:"âš ï¸ This action cannot be undone. The selected leave requests will be permanently deleted."})})})]})}),e.jsxs(Ee,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Y,{color:"default",variant:"bordered",onPress:_,radius:v(),size:"sm",isDisabled:C,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(Y,{color:"danger",variant:"solid",onPress:P,isLoading:C,isDisabled:!N||C||p.length===0,startContent:!C&&e.jsx(pe,{className:"w-4 h-4"}),radius:v(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:C?"Deleting...":`Delete ${p.length} Request${p.length!==1?"s":""}`})]})]})})})};export{rt as B,tt as D,st as L,at as a,Fs as b};
