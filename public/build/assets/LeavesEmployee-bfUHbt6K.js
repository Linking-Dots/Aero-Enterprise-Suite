import{u as be,r as l,a as W,j as a,H as ye,c as je,F as X,g as S,h as M,d as _e}from"./app-CmFfjWsP.js";import{d as Z}from"./dayjs.min-Yb-mO8Jg.js";import{u as we,B as Ne,G as Ce,T as p}from"./logo-Bb-VUmpc.js";import{P as ke}from"./PageHeader-VPvENNef.js";import{u as K,B as $,G as Le,b as F,A as Pe}from"./App-DKNf4kbj.js";import{L as U,D as Se,B as Me,a as Fe,b as Be}from"./BulkDeleteModal-B_69oa3l.js";import{F as ee}from"./ChartBarIcon-CxG4so3Y.js";import{C as Ye}from"./CircularProgress-BjwqTAiA.js";import{F as Te}from"./XCircleIcon-BDKkub3n.js";import{F as De}from"./PlusIcon-CjH05r6-.js";import{F as Re}from"./PresentationChartLineIcon-5WMSZMJj.js";import{s as Ae,l as Ee}from"./chunk-Y2AYO5NJ-DTFyT4m_.js";import{c as Ie}from"./chunk-D5XJWRAV-D-wO4tV2.js";import"./create-visual-element-CNNoQd8i.js";import"./EnvelopeIcon-B03bj0NI.js";import"./UserIcon-C42ICOt3.js";import"./ShieldCheckIcon-B_1qhU2x.js";import"./chunk-SSA7SXE4-DCTIi96t.js";import"./ExclamationTriangleIcon-DVI7Fufz.js";import"./TrashIcon-BNDxSKX0.js";import"./PencilIcon-G8jhViOO.js";import"./EllipsisVerticalIcon-DYnqK8rG.js";import"./CheckCircleIcon-B5WT3CBF.js";import"./ClockIcon-BQhZqSV8.js";import"./ExclamationTriangleIcon-B3ukLrRt.js";import"./InputAdornment-BP2MBWnf.js";import"./CardContent-Cjk6s5Uk.js";import"./colorManipulator-Cwo1EpZz.js";import"./chunk-F3UDT23P-DZAw_N80.js";import"./useHasTabbableChild-mvVqOm0Y.js";import"./index-8-ppjCsZ.js";import"./chunk-BOOVDPB6-DSWITBr2.js";import"./chunk-S574QCAN-WXP3Hn5v.js";import"./chunk-JOT4BT4P-q5jZEdSI.js";import"./chunk-EAPQ7RWQ-DgLMMHg6.js";import"./index-CokAva9Y.js";import"./Clear-DHv5tnIK.js";import"./GlassDialog-C5_CkNH7.js";import"./Dialog-ydNep9GA.js";import"./DialogTitle-JICgBhou.js";import"./DialogContent-RSy4PdMH.js";import"./TextField-CZkJRVYj.js";import"./Select-D2ehSAHQ.js";import"./Popover-BA5NTheW.js";import"./LoadingButton-B6iBg8R1.js";import"./Button-CPbP042r.js";import"./DialogContentText-C16qrWWs.js";import"./Avatar-DwP7JS7S.js";import"./useSlot-DSwTWDBd.js";import"./CardHeader-DQhWvFvf.js";import"./InformationCircleIcon-DR8HcnxA.js";import"./XCircleIcon-DRvI_4Zc.js";import"./CheckCircleIcon-DcAHPOOH.js";import"./ListItemText-BA3HGqMp.js";import"./Divider-BqW5YimP.js";const ze=({title:E,allUsers:g})=>{const{auth:C}=be().props,H=we(),k=K(H.breakpoints.down("sm")),ae=K(H.breakpoints.down("md")),[h,B]=l.useState(0),[I,Y]=l.useState(0),[G,Oe]=l.useState(!1),[_,u]=l.useState([]),[y,w]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[q,f]=l.useState(!1),[Q,z]=l.useState(""),[o,O]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[n,te]=l.useState({employee:"",selectedMonth:Z().format("YYYY-MM"),year:new Date().getFullYear()}),m=l.useCallback(e=>{e&&(B(e.total||0),Y(e.last_page||1),O(s=>({...s,total:e.total||0,lastPage:e.last_page||1})))},[]),v=l.useCallback(async()=>{var e,s,t;f(!0);try{const{page:r,perPage:i}=o,{year:c}=n,b=await W.get(route("leaves.paginate"),{params:{page:r,perPage:i,year:c,user_id:C.user.id},timeout:1e4});if(b.status===200){const{leaves:x,leavesData:xe}=b.data;x.data&&Array.isArray(x.data)?(u(x.data),m({total:x.total||x.data.length,last_page:x.last_page||1,current_page:x.current_page||1,per_page:x.per_page||o.perPage})):Array.isArray(x)?(u(x),m({total:x.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",x),u([]),m({total:0,last_page:1,current_page:1,per_page:o.perPage})),w(xe),z("")}}catch(r){if(console.error("Error fetching leaves:",r),((e=r.response)==null?void 0:e.status)===404){const{leavesData:i}=r.response.data;w(i),z(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else{z("Error retrieving leaves data. Please try again.");const i=Promise.reject("Failed to load leave data. Please try again.");$.promise(i,{error:{render(){return a.jsx("div",{children:"Failed to load leave data. Please try again."})},icon:"❌"}})}u([]),m({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{f(!1)}},[o.page,o.perPage,n,C.user.id,m]),T=l.useCallback((e,s,t)=>{const{page:r,perPage:i}=o;e.length>=i||r<I||v()},[o,I,v]),se=l.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(s,t)=>{const r=1900+t;return{key:r.toString(),label:r.toString(),value:r}}).reverse()},[]),V=l.useCallback((e,s)=>{if(e==="year"){const t=Number(s);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}te(t=>({...t,[e]:s})),e==="year"&&O(t=>({...t,page:1}))},[]),[j,D]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1});l.useCallback((e,s=null)=>{D(t=>({...t,[e]:!0}))},[]);const P=l.useCallback(()=>{D({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1})},[]),R=l.useCallback(e=>{D(s=>({...s,[e]:!0}))},[]),re=l.useCallback((e,s)=>{J({id:e}),D(t=>({...t,[s]:!0}))},[]),[A,J]=l.useState(null),[le,oe]=l.useState([]),ne=l.useCallback(e=>{J(e)},[]),ie=l.useCallback(e=>{oe(e),R("bulk_delete")},[R]),d=l.useCallback(async()=>{try{const e=await W.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:s,leaveCounts:t}=e.data;t&&w(r=>({...r,leaveCountsByUser:{...r.leaveCountsByUser,[C.user.id]:t}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,C.user.id]),ce=l.useCallback(e=>{e!==o.page&&O(s=>({...s,page:e}))},[o.page]);l.useEffect(()=>{v()},[v]),l.useEffect(()=>{d()},[d]);const de=l.useMemo(()=>y.leaveCountsByUser[C.user.id]||[],[y.leaveCountsByUser,C.user.id]),L=l.useCallback(e=>[...e].sort((s,t)=>new Date(s.from_date)-new Date(t.from_date)),[]),N=l.useCallback(e=>{const s=new Date(e.from_date).getFullYear();if(n.year&&s!==n.year)return!1;if(n.employee){const t=g==null?void 0:g.find(i=>String(i.id)===String(e.user_id)),r=n.employee.trim().toLowerCase();if(t){if(String(t.id)!==r&&!(t.name&&t.name.trim().toLowerCase().includes(r)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&Z(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const t=g==null?void 0:g.find(r=>String(r.id)===String(e.user_id));if(!t||String(t.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,g]);l.useMemo(()=>_||[],[_]);const me=l.useCallback(e=>{N(e)&&(f(!0),u(s=>{const t=[...s,e];return L(t).slice(0,o.perPage)}),m({total:h+1,last_page:Math.ceil((h+1)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d())},[N,L,o,h,m,v,d]),ue=l.useCallback(e=>{var i;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}e.leavesData&&w(e.leavesData);const s=e.created_leaves||[];if(s.length===0){d();return}const t=s.filter(c=>N(c));if(t.length===0){d();return}f(!0),u(c=>{const b=[...c,...t];return L(b).slice(0,o.perPage)});const r=((i=e.summary)==null?void 0:i.successful)||s.length;m({total:h+r,last_page:Math.ceil((h+r)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d()},[N,L,o,h,m,v,d]),pe=l.useCallback(e=>{const s=_.some(r=>r.id===e.id);if(f(!0),!N(e)&&s){u(i=>i.filter(c=>c.id!==e.id));const r=Promise.resolve();$.promise(r,{success:{render(){return a.jsx("div",{children:"Leave removed from filtered view."})},icon:"ℹ️"}}),f(!1);return}if(!s&&!N(e)){f(!1);return}u(r=>{const i=r.some(b=>b.id===e.id);let c;return i?c=r.map(b=>b.id===e.id?e:b):c=[...r,e],L(c).slice(0,o.perPage)});const t=Promise.resolve();$.promise(t,{success:{render(){return a.jsx("div",{children:"Leave updated!"})},icon:"✅"}}),f(!1),o.page!==1&&v(),d()},[N,L,_,o,v,d]),ge=l.useCallback(e=>{u(t=>{const r=t.filter(c=>c.id!==e),i=Math.max(0,h-1);return T(r,i,"delete"),r});const s=Math.max(0,h-1);m({total:s,last_page:Math.max(1,Math.ceil(s/o.perPage)),current_page:o.page,per_page:o.perPage}),d()},[d,h,o,m,T]),he=l.useCallback(e=>{if(!e||!e.success){console.error("Invalid bulk delete response data:",e);return}e.leavesData&&w(e.leavesData);const s=e.deleted_leaves||[],t=s.map(c=>c.id);if(t.length===0){d();return}f(!0),u(c=>c.filter(b=>!t.includes(b.id)));const r=e.deleted_count||s.length,i=Math.max(0,h-r);m({total:i,last_page:Math.max(1,Math.ceil(i/o.perPage)),current_page:o.page,per_page:o.perPage}),f(!1),T(_.filter(c=>!t.includes(c.id)),i,"delete"),d()},[m,o,h,_,T,d]),fe=()=>y.leaveTypes.length?a.jsx("div",{className:`grid gap-4 ${k?"grid-cols-1":ae?"grid-cols-2":"grid-cols-4"}`,children:y.leaveTypes.map(({type:e})=>{const s=de.find(c=>c.leave_type===e)||{},t=s.days_used||0,r=s.remaining_days||0,i=t+r;return a.jsxs(S,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a.jsx(Ie,{className:"pb-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),a.jsx(p,{variant:k?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a.jsx(M,{className:"pt-0",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(p,{variant:"caption",color:"textSecondary",children:"Used"}),a.jsx(p,{variant:k?"h6":"h5",className:"font-bold text-red-400",children:t})]}),a.jsx(_e,{orientation:"vertical",className:"h-8"}),a.jsxs("div",{className:"text-center",children:[a.jsx(p,{variant:"caption",color:"textSecondary",children:"Remaining"}),a.jsx(p,{variant:k?"h6":"h5",className:"font-bold text-green-400",children:r})]})]}),i>0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-linear-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${t/i*100}%`}})})]})})]},e)})}):a.jsx(S,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(M,{className:"text-center py-8",children:[a.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a.jsx(p,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),ve=l.useRef(null);return a.jsxs(a.Fragment,{children:[a.jsx(ye,{title:E}),j.add_leave&&a.jsx(U,{open:j.add_leave,closeModal:()=>P(),leavesData:y,setLeavesData:w,currentLeave:null,allUsers:g,setTotalRows:B,setLastPage:Y,setLeaves:u,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:me,updatePaginationMetadata:m,fetchLeavesStats:d}),j.edit_leave&&a.jsx(U,{open:j.edit_leave,closeModal:()=>P(),leavesData:y,setLeavesData:w,currentLeave:A,allUsers:g,setTotalRows:B,setLastPage:Y,setLeaves:u,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:pe,updatePaginationMetadata:m,fetchLeavesStats:d}),j.delete_leave&&a.jsx(Se,{open:j.delete_leave,closeModal:()=>P(),leaveId:A==null?void 0:A.id,setLeaves:u,setTotalRows:B,setLastPage:Y,deleteLeaveOptimized:ge,updatePaginationMetadata:m,fetchLeavesStats:d}),j.bulk_leave&&a.jsx(Me,{open:j.bulk_leave,onClose:()=>P(),onSuccess:e=>{ue(e)},allUsers:g,leavesData:y,isAdmin:!1,existingLeaves:_||[],publicHolidays:(y==null?void 0:y.publicHolidays)||[]}),j.bulk_delete&&a.jsx(Fe,{open:j.bulk_delete,onClose:()=>P(),onSuccess:e=>{he(e)},selectedLeaves:le,allUsers:g}),a.jsxs(Ne,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a.jsx(Le,{in:!0,children:a.jsx(Ce,{children:a.jsx(ke,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a.jsx(Re,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a.jsx(De,{className:"w-4 h-4"}),onPress:()=>R("add_leave"),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a.jsx(F,{className:"w-4 h-4"}),onPress:()=>V("year",new Date().getFullYear()),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a.jsx(X,{className:"w-4 h-4"}),onPress:v,className:"bg-linear-to-r from-[rgba(var(--theme-success-rgb),0.8)] to-[rgba(var(--theme-success-rgb),1)] text-white font-medium hover:opacity-90"}],children:a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a.jsx(Ae,{label:"Select Year",variant:"bordered",selectedKeys:[String(n.year)],onSelectionChange:e=>{const s=Array.from(e)[0];s&&V("year",Number(s))},startContent:a.jsx(F,{className:"w-4 h-4"}),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",popoverContent:"bg-white/10 backdrop-blur-lg border-white/20"},size:k?"sm":"md",children:se.map(e=>a.jsx(Ee,{value:e.value,children:e.label},e.key))})}),a.jsx("div",{className:"flex gap-2",children:a.jsx(je,{variant:"flat",color:"primary",size:k?"sm":"md",onPress:v,isLoading:G,startContent:!G&&!q&&a.jsx(X,{className:"w-4 h-4"}),children:"Refresh"})})]})}),a.jsxs("div",{className:"mb-6",children:[a.jsxs(p,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(ee,{className:"w-5 h-5"}),"Leave Balance Summary"]}),fe()]}),a.jsxs("div",{className:"min-h-96",children:[a.jsxs(p,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),"Leave History"]}),q?a.jsx(S,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(M,{className:"text-center py-12",children:[a.jsx(Ye,{size:40}),a.jsx(p,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):Q?a.jsx(S,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(M,{className:"text-center py-12",children:[a.jsx(Te,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a.jsx(p,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a.jsx(p,{color:"textSecondary",children:Q})]})}):_.length>0?a.jsx("div",{className:"overflow-hidden rounded-lg",children:a.jsx(Be,{ref:ve,leaves:_,allUsers:g||[],handleClickOpen:re,setCurrentLeave:ne,openModal:R,setLeaves:u,setCurrentPage:ce,currentPage:o.page,totalRows:h,lastPage:I,perPage:o.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:d,updatePaginationMetadata:m,onBulkDelete:ie,canDeleteLeaves:!0})}):a.jsx(S,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(M,{className:"text-center py-12",children:[a.jsx(F,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a.jsx(p,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),a.jsxs(p,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};ze.layout=E=>a.jsx(Pe,{children:E});export{ze as default};
