import{i as Re,r as n,k as xe,a4 as Te,h as Le,j as e,R as X,u as De,c as M,f as ye,b as ne,s as ce,d as de,J as be,a as Y,a5 as Ae,a6 as $e,Q as Pe}from"./app-Cxcpl1Gx.js";import{T as Me}from"./TimeSheetTable-B3_vsxPU.js";import{R as Oe,S as We,T as Ue,y as we,u as ae,c as fe,F as me,d as je,U as ze,V as He,b as ue,H as Ge,P as Ve,f as Be,k as Q,a as Ze,m as qe,n as Je,o as Ke,p as Ye,A as Xe}from"./App-DeydwTFj.js";import{S as Qe}from"./StatsCards-J7ErQqG4.js";import{M as et,T as tt,u as Ne,L as K}from"./leaflet-B5EswDGA.js";import"./leaflet-routing-machine-CcsEjlUh.js";import{m as O}from"./proxy-lFVLbX3H.js";import{c as oe}from"./createLucideIcon-BK2XMo8e.js";import{M as rt}from"./map-pin-BwvaiZzH.js";import{d as z}from"./dayjs.min-D3S79Pzg.js";import{i as st}from"./isBetween-Dr01FD9o.js";import{F as te}from"./ExclamationTriangleIcon-aIxfp1U5.js";import{F as V,c as J,B as G,t as le}from"./react-toastify.esm-DJaDf_tZ.js";import{F as at}from"./SunIcon-BCGBdOgY.js";import{F as Fe}from"./InformationCircleIcon-D0EQUMam.js";import{F as ge}from"./UserIcon-7jPaNw5u.js";import{F as nt}from"./XCircleIcon-CONjhzzw.js";import{F as pe}from"./CheckCircleIcon-BRJxgPDr.js";import{s as he}from"./chunk-TLYTI3QM-BmP2YiFh.js";import{F as ot}from"./ClipboardDocumentListIcon-B34xekJ6.js";import{F as it}from"./WifiIcon-DInYSnu4.js";import{F as lt}from"./ShieldCheckIcon-DwGf7sJq.js";import{F as ct}from"./GlobeAltIcon-Biuo7qzl.js";import{m as dt}from"./chunk-O5MCAK4F-N0e_i_PQ.js";import"./PageHeader-JWwboz-u.js";import"./UserPlusIcon-CqrXMPmD.js";import"./chunk-SSA7SXE4-CFoa1ngp.js";import"./DocumentArrowDownIcon-NgI7w7jo.js";import"./chunk-JOT4BT4P-C_p7F7v2.js";import"./chunk-F3UDT23P-jOWee1N-.js";import"./chunk-XJ2YRSUP-QlzE6No0.js";import"./useToggleState-Dnk57j1c.js";import"./chunk-YRZGWF2W-_qQWbuAO.js";import"./chunk-EAPQ7RWQ-9IBh9NNE.js";import"./chunk-S574QCAN-CqE2q7NV.js";import"./EnvelopeIcon-CVouYG3i.js";import"./KeyIcon-BRQMV5c3.js";import"./logo-DXcsmTTZ.js";import"./features-animation-tLJ-KL0g.js";import"./create-visual-element-DcEhP5JW.js";function mt(s={}){const{as:r,ref:m,max:l=5,total:o,size:h,color:u,radius:c,children:g,isBordered:I,isDisabled:w,isGrid:j,renderCount:A,className:_,classNames:R,...v}=s,f=Re(m),a=r||"div",d=n.useMemo(()=>({size:h,color:u,radius:c,isGrid:j,isBordered:I,isDisabled:w}),[h,u,c,j,I,w]),p=n.useMemo(()=>Oe({className:_,isGrid:j}),[_,j]),N=We(g),k=l?N.slice(0,l):N,C=o||(l!=null?N.length-l:-1),$=k.map((t,i)=>{const F=i===0,x=i===k.length-1,b={className:xe(F?"ms-0":j?"":"-ms-2",x&&C<1?"hover:-translate-x-0":"")};return n.cloneElement(t,Te(b))});return{Component:a,context:d,remainingCount:C,clones:$,renderCount:A,getAvatarGroupProps:()=>({ref:f,className:p.base({class:xe(R==null?void 0:R.base,_)}),role:"group",...v}),getAvatarGroupCountProps:()=>({className:p.count({class:R==null?void 0:R.count})})}}var ke=Le((s,r)=>{const{Component:m,clones:l,context:o,remainingCount:h,getAvatarGroupCountProps:u,getAvatarGroupProps:c,renderCount:g=I=>e.jsx(we,{...u(),name:`+${I}`})}=mt({...s,ref:r});return e.jsx(m,{...c(),children:e.jsxs(Ue,{value:o,children:[l,h>0&&g(h)]})})});ke.displayName="HeroUI.AvatarGroup";var ut=ke;function ht({title:s,titleId:r,...m},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":r},m),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const ft=n.forwardRef(ht);function pt({title:s,titleId:r,...m},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":r},m),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const xt=n.forwardRef(pt);function gt({title:s,titleId:r,...m},l){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":r},m),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const vt=n.forwardRef(gt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],bt=oe("clock-4",yt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],ve=oe("map",wt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Nt=oe("refresh-cw",jt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],kt=oe("users",Ft);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(s){var r=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",r),this.link.href="#",this._map=s,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),r},_click:function(s){L.DomEvent.stopPropagation(s),L.DomEvent.preventDefault(s),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(s){var r=this.getContainer();this.isFullscreen()?s&&s.pseudoFullscreen?this._disablePseudoFullscreen(r):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(r):s&&s.pseudoFullscreen?this._enablePseudoFullscreen(r):r.requestFullscreen?r.requestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):r.msRequestFullscreen?r.msRequestFullscreen():this._enablePseudoFullscreen(r)},_enablePseudoFullscreen:function(s){L.DomUtil.addClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(s){L.DomUtil.removeClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(s){this._isFullscreen=s;var r=this.getContainer();s?L.DomUtil.addClass(r,"leaflet-fullscreen-on"):L.DomUtil.removeClass(r,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(s){var r=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;r===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):r!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var s;if("onfullscreenchange"in document?s="fullscreenchange":"onmozfullscreenchange"in document?s="mozfullscreenchange":"onwebkitfullscreenchange"in document?s="webkitfullscreenchange":"onmsfullscreenchange"in document&&(s="MSFullscreenChange"),s){var r=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,s,r)}),this.on("unload",function(){L.DomEvent.off(document,s,r)})}});L.control.fullscreen=function(s){return new L.Control.Fullscreen(s)};const q=(s,r)=>{if(s.startsWith("var("))return`color-mix(in srgb, ${s} ${r*100}%, transparent)`;if(s.startsWith("#")){const m=s.replace("#",""),l=parseInt(m.substr(0,2),16),o=parseInt(m.substr(2,2),16),h=parseInt(m.substr(4,2),16);return`rgba(${l}, ${o}, ${h}, ${r})`}return s.replace(/[\d.]+\)$/g,`${r})`)},Ct=()=>{var l;const r=((l=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:l.trim())||"12px",m=parseInt(r);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},H={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:300},ee={primary:{lat:23.879132,lng:90.502617},route:{start:{lat:23.987057,lng:90.361908,name:"Route Start"},end:{lat:23.690618,lng:90.546729,name:"Route End"}}},Ce=X.memo(({startLocation:s,endLocation:r,theme:m})=>{const l=Ne();return n.useEffect(()=>{var h;if(!l||!s||!r)return;const o=K.Routing.control({waypoints:[K.latLng(s.lat,s.lng),K.latLng(r.lat,r.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((h=m==null?void 0:m.customColors)==null?void 0:h.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(l);return()=>{l&&o&&l.removeControl(o)}},[l,s,r,m]),null});Ce.displayName="RoutingMachine";const _e=X.memo(({selectedDate:s,onUsersLoad:r,theme:m,lastUpdate:l,users:o,setUsers:h,setLoading:u,setError:c})=>{const g=Ne(),I=n.useRef([]),w=n.useCallback(async()=>{if(!s){u(!1),h([]),r==null||r([]);return}u(!0),c(null);try{const a=route("getUserLocationsForDate",{date:s,_t:Date.now()}),p=(await axios.get(a)).data;if(!p.success||!Array.isArray(p.locations))throw new Error("Unexpected response format from server.");const N=p.locations;JSON.stringify(N)!==JSON.stringify(I.current)&&(h(N),I.current=N),r==null||r(N)}catch(a){let d="Error fetching user locations.";a.response?(d+=` Server error (${a.response.status}): ${a.response.statusText}`,typeof a.response.data=="object"&&(d+=`
Details: ${JSON.stringify(a.response.data)}`)):a.request?d+=" No response received from server.":a.message&&(d+=` ${a.message}`),console.error(d,a),c(d),h([]),r==null||r([])}finally{u(!1)}},[s,r,l]);n.useEffect(()=>{w()},[w]);const j=n.useCallback((a,d)=>{const p=H.OFFSET_MULTIPLIER*d;return{lat:a.lat+p,lng:a.lng+p}},[]),A=n.useCallback((a,d)=>Math.abs(a.lat-d.lat)<H.POSITION_THRESHOLD&&Math.abs(a.lng-d.lng)<H.POSITION_THRESHOLD,[]),_=n.useCallback(a=>{if(!a)return null;if(typeof a=="object"&&a.lat&&a.lng){const d=parseFloat(a.lat),p=parseFloat(a.lng);return isNaN(d)||isNaN(p)?null:{lat:d,lng:p}}if(typeof a=="string")try{const d=JSON.parse(a);if(d.lat&&d.lng){const p=parseFloat(d.lat),N=parseFloat(d.lng);return isNaN(p)||isNaN(N)?null:{lat:p,lng:N}}}catch{const p=a.split(",");if(p.length>=2){const N=parseFloat(p[0].trim()),k=parseFloat(p[1].trim());return isNaN(N)||isNaN(k)?null:{lat:N,lng:k}}}return null},[]),R=n.useCallback(a=>{if(!a)return"Not recorded";try{let d;return a.includes("T")?d=new Date(a):d=new Date(`${s}T${a}`),isNaN(d.getTime())?"Invalid time":d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(d){return console.warn("Error formatting time:",d),a}},[s]),v=n.useCallback(a=>{var k,C,$,P;const d="var(--theme-primary, #3b82f6)",N=`
            <div style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${d}, var(--theme-secondary, #8b5cf6));
                border: 3px solid white;
                box-shadow: 0 4px 12px ${q(d,.4)};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((C=(k=a.name)==null?void 0:k.charAt(0))==null?void 0:C.toUpperCase())||"?"}';" />`:((P=($=a.name)==null?void 0:$.charAt(0))==null?void 0:P.toUpperCase())||"?"}
            </div>
        `;return K.divIcon({html:N,className:"user-marker-icon",iconSize:H.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),f=n.useCallback(a=>{var P,W,t,i;const d=a.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",p="var(--theme-primary, #3b82f6)",N="var(--theme-secondary, #8b5cf6)",k="var(--theme-content1, #ffffff)",C="var(--theme-foreground, #1f2937)",$="var(--theme-content3, #6b7280)";return`
            <div style="
                min-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, ${q(k,.95)}, ${q(p,.05)});
                border-radius: 12px;
                border: 1px solid ${q(p,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            ">
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                    <div style="
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${p}, ${N});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        margin-right: 12px;
                    ">
                        ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((W=(P=a.name)==null?void 0:P.charAt(0))==null?void 0:W.toUpperCase())||"?"}';" />`:((i=(t=a.name)==null?void 0:t.charAt(0))==null?void 0:i.toUpperCase())||"?"}
                    </div>
                    <div>
                        <div style="font-weight: 600; color: ${C}; font-size: 16px;">
                            ${a.name||"Unknown User"}
                        </div>
                        <div style="color: ${$}; font-size: 12px;">
                            ${a.designation||"No designation"}
                        </div>
                    </div>
                </div>
                <div style="
                    display: inline-block;
                    padding: 4px 8px;
                    background: ${q(d,.1)};
                    color: ${d};
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid ${q(d,.2)};
                ">
                    ${a.punchout_time?"✓ Completed":"⏱ Active"}
                </div>
                <div style="space-y: 8px;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <span style="color: var(--theme-success, #10b981); margin-right: 8px;">📍</span>
                        <span style="color: ${$}; font-size: 13px;">
                            Check In: ${R(a.punchin_time)}
                        </span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <span style="color: var(--theme-danger, #ef4444); margin-right: 8px;">📍</span>
                        <span style="color: ${$}; font-size: 13px;">
                            Check Out: ${R(a.punchout_time)}
                        </span>
                    </div>
                </div>
            </div>
        `},[R]);return n.useEffect(()=>{if(!g||!o.length)return;g.eachLayer(d=>{d instanceof K.Marker&&d.options.userData&&g.removeLayer(d)});const a=[];o.forEach((d,p)=>{const N=_(d.punchout_location||d.punchin_location);if(!N)return;let k={...N},C=0;const $=10;for(;C<$&&a.some(t=>A(k,t));)k=j(N,C+1),C++;a.push(k);const P=K.marker([k.lat,k.lng],{icon:v(d),userData:!0});P.bindPopup(f(d),{maxWidth:H.POPUP_MAX_WIDTH,className:"custom-popup"}),P.addTo(g)})},[g,o,m,_,A,j,v,f]),null});_e.displayName="UserMarkers";const _t=s=>n.useMemo(()=>{const r=s.reduce((u,c)=>{const g=c.user_id;return u[g]||(u[g]=[]),u[g].push(c),u},{}),m=Object.keys(r),l=m.length;let o=0,h=0;return m.forEach(u=>{const c=r[u];c.sort((w,j)=>w.punchin_time?j.punchin_time?w.punchin_time.localeCompare(j.punchin_time):-1:1);const g=c[c.length-1];c.some(w=>w.punchin_time)&&(g.punchout_time?h++:o++)}),{checkedIn:o,completed:h,total:l}},[s]),St=X.memo(({updateMap:s,selectedDate:r})=>{const{themeSettings:m}=De(),l=ae("(min-width: 1025px)"),o=ae("(min-width: 641px) and (max-width: 1024px)"),[h,u]=n.useState([]),[c,g]=n.useState(!0),[I,w]=n.useState(null),[j,A]=n.useState(!1),[_,R]=n.useState(null),[v,f]=n.useState(!0),[a,d]=n.useState(0),p=window.innerWidth<640,[N,k]=n.useState(new Date),C=n.useRef([]),$=n.useRef(null),P=n.useCallback(async()=>{g(!0);try{const b=route("getUserLocationsForDate",{date:r,_t:Date.now()});if(!r){u([]),C.current=[],d(T=>T+1),k(new Date),R(new Date);return}const S=await fetch(b);if(!S.ok)throw new Error(`HTTP ${S.status}: Failed to refresh user locations`);const U=await S.json(),y=Array.isArray(U.locations)?U.locations:[];u(y),C.current=y,d(T=>T+1),k(new Date),R(new Date)}catch(b){console.error("Error refreshing map:",b),u([]),C.current=[]}finally{g(!1)}},[r]),W=n.useMemo(()=>{if(!r)return"Invalid Date";try{return new Date(r).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[r]),t=_t(h),i=n.useCallback(async()=>{if(!r){g(!1);return}try{const b=route("check-user-locations-updates",{date:r.split("T")[0]}),S=await fetch(b);if(!S.ok)throw new Error(`HTTP ${S.status}: Failed to check for updates`);const U=await S.json();U.success&&U.last_updated!==$.current&&U.last_updated&&($.current=U.last_updated,P(),R(new Date)),k(new Date)}catch(b){console.error("Error checking for updates:",b),g(!1)}},[r,P]);n.useEffect(()=>{if(!v)return;i();const b=setInterval(i,5e3);return()=>clearInterval(b)},[v,i]),n.useEffect(()=>{h.length===0&&c&&j&&g(!1)},[h,c,j]),n.useEffect(()=>{if(c){const b=setTimeout(()=>{c&&(console.log("Loading timeout reached, forcing loading to false"),g(!1))},1e4);return()=>clearTimeout(b)}},[c]);const F=n.useMemo(()=>N?N.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[N]),x=n.useCallback(b=>{const S=Array.isArray(b)?b:[];JSON.stringify(S)!==JSON.stringify(C.current)&&(u(S),C.current=S),A(!0),g(!1)},[]);return e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(M,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(fe,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${l?"p-6":o?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${l?"p-3":o?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(ve,{className:`
                                                    ${l?"w-8 h-8":o?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${l?"text-2xl":o?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${l?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${l?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${l?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:W})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:F&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",F]})})]})})})}),e.jsx(ye,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(ne,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(Qe,{className:"mb-6",stats:[{title:"Total",value:t.total,icon:e.jsx(kt,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:t.checkedIn,icon:e.jsx(bt,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:t.completed,icon:e.jsx(rt,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:p})}),e.jsx("div",{className:"p-6 pt-0",children:h.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(et,{center:[ee.primary.lat,ee.primary.lng],zoom:H.DEFAULT_ZOOM,minZoom:H.MIN_ZOOM,maxZoom:H.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(tt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:H.MAX_ZOOM,attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ce,{startLocation:ee.route.start,endLocation:ee.route.end,theme:m}),e.jsx(_e,{users:h,setUsers:u,setLoading:g,setError:w,lastUpdate:_,selectedDate:r,onUsersLoad:x,theme:m})]},`${s}-${a}`)]}):c?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ve,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",W,".",r&&new Date(r)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(de,{variant:"bordered",color:"primary",size:"md",radius:Ct(),onPress:P,startContent:e.jsx(Nt,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})})})});z.extend(st);const re=()=>{var l;if(typeof window>"u")return"lg";const r=((l=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:l.trim())||"12px",m=parseInt(r);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},se=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),It=({title:s,items:r,users:m,icon:l,color:o})=>{var v;const[h,u]=n.useState(null),[c,g]=n.useState(null),I=(f,a)=>{u(f.currentTarget),g(a)},w=()=>{u(null),g(null)},j=!!h,A=j?"leave-details-popover":void 0,_=f=>{switch(f==null?void 0:f.toLowerCase()){case"approved":return e.jsx(pe,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(nt,{className:"w-4 h-4 text-danger"});default:return e.jsx(V,{className:"w-4 h-4 text-warning"})}},R=f=>{switch(f==null?void 0:f.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(M,{className:"h-full flex flex-col",radius:re(),style:se(),onMouseEnter:f=>{f.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${o} 50%, transparent)`,f.currentTarget.style.borderRadius="var(--borderRadius, 12px)",f.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",f.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(fe,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${o} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${o} 25%, transparent)`},children:e.jsx(l,{className:"w-6 h-6 stroke-2",style:{color:o},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s})]})}),e.jsx(ne,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r.map((f,a)=>e.jsxs(X.Fragment,{children:[e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.text}),f.leaves&&f.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(je,{className:"w-3 h-3"}),f.leaves.length," employee",f.leaves.length>1?"s":""]})]}),f.leaves&&(()=>{const d=f.leaves.filter(p=>p.leave_type===f.type);return d.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(ut,{max:4,isBordered:!0,size:"sm",children:d.map((p,N)=>{const k=m.find(C=>String(C.id)===String(p.user_id));return k&&e.jsx(we,{src:k.profile_image_url,name:`${k.name} - on leave`,onClick:C=>I(C,p),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e.jsx(ge,{className:"w-4 h-4"})},N)})})})})()]}),a<r.length-1&&e.jsx(ye,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},a))}),e.jsx(ze,{id:A,open:j,anchorEl:h,onClose:w,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(He,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:c&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ue,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((v=m.find(f=>String(f.id)===String(c.user_id)))==null?void 0:v.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:c.from_date!==c.to_date?`${new Date(c.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(c.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(c.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:c.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[_(c.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(J,{label:c.status||"Pending",variant:"flat",color:R(c.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},Et=()=>{const{auth:s}=be().props,r=ae("(min-width: 1025px)"),m=ae("(min-width: 641px) and (max-width: 1024px)"),[l,o]=n.useState(!0),[h,u]=n.useState(null),[c,g]=n.useState([]),[I,w]=n.useState([]),[j,A]=n.useState([]),[_,R]=n.useState(null);n.useEffect(()=>{let t=!0;const i=new AbortController;return(async()=>{try{o(!0),u(null);const x=await Y.get(route("updates"),{signal:i.signal,timeout:1e4});t&&x.data&&(g(x.data.users||[]),w(x.data.todayLeaves||[]),A(x.data.upcomingLeaves||[]),R(x.data.upcomingHoliday||null))}catch(x){t&&!i.signal.aborted&&(console.error("Failed to fetch updates:",x),u(x.message),g([]),w([]),A([]),R(null))}finally{t&&o(!1)}})(),()=>{t=!1,i.abort()}},[]);const v=(t,i)=>{let F=i;const x=y=>i.some(E=>String(E.user_id)===String(s.user.id)&&E.leave_type===y)?(F=i.filter(E=>String(E.user_id)!==String(s.user.id)),`You ${t==="today"?"are":"will be"} on ${y} leave.`):null,b=i.reduce((y,T)=>{const E=x(T.leave_type);return E&&!y.some(B=>B.type===T.leave_type)&&y.push({text:E,type:T.leave_type}),y},[]),S=F.reduce((y,T)=>(y[T.leave_type]=(y[T.leave_type]||0)+1,y),{}),U=Object.entries(S).map(([y,T])=>({text:`${T} person${T>1?"s":""} ${t==="today"?"is":"will be"} on ${y} leave`,type:y,leaves:F.filter(E=>E.leave_type===y)}));return[...b,...U]},f=z(),a=f.add(1,"day"),d=a.add(7,"day"),p=I.filter(t=>z(f).isBetween(z(t.from_date),z(t.to_date),"day","[]")),N=j.filter(t=>z(a).isBetween(z(t.from_date),z(t.to_date),"day","[]")),k=j.filter(t=>(z(t.from_date).isBetween(a,d,"day","[]")||z(t.to_date).isBetween(a,d,"day","[]"))&&!/week/i.test(t.leave_type)),C=v("today",p),$=v("tomorrow",N),P=v("nextSevenDays",k);C.length===0&&C.push({text:"No one is away today."}),$.length===0&&$.push({text:"No one is away tomorrow."}),P.length===0&&P.push({text:"No one is going to be away in the next seven days."});const W=[{title:"Today",items:C,icon:me,color:"#3b82f6"},{title:"Tomorrow",items:$,icon:V,color:"#10b981"},{title:"Next Seven Days",items:P,icon:je,color:"#f59e0b"}];return l?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((t,i)=>e.jsx("div",{children:e.jsxs(M,{className:"w-full h-full",radius:re(),style:se(),children:[e.jsx(he,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(he,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},i))})}):h?e.jsx("div",{className:`${r?"p-6":m?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(M,{radius:re(),style:{...se(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(te,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",h]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:W.map((t,i)=>e.jsx("div",{className:"flex",children:e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(It,{title:t.title,items:t.items,users:c,icon:t.icon,color:t.color})})})},t.title))}),_&&e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(M,{radius:re(),style:se(),onMouseEnter:t=>{t.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",t.currentTarget.style.borderRadius="var(--borderRadius, 12px)",t.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:t=>{t.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",t.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(fe,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(at,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(ne,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Fe,{className:"w-4 h-4"}),_.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(me,{className:"w-4 h-4"}),new Date(_.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(_.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ft,{className:"w-4 h-4"}),_.description]})]})})})]})})})]})},Rt=({title:s,value:r,icon:m,color:l,isLoaded:o,testId:h})=>e.jsx(O.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(M,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:u=>{u.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${l} 50%, transparent)`,u.currentTarget.style.borderRadius="var(--borderRadius, 12px)",u.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:u=>{u.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",u.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(he,{className:"rounded-lg",isLoaded:o,"data-testid":h,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${s} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${l} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${l} 25%, transparent)`},children:e.jsx(m,{className:"w-6 h-6 stroke-2",style:{color:l},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof r=="number"?r.toLocaleString():r})})]})})})})}),Tt=()=>{const[s,r]=n.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[m,l]=n.useState(!0),[o,h]=n.useState(null);n.useEffect(()=>{let c=!0;const g=new AbortController;return(async()=>{var w;try{l(!0),h(null);const j=await Y.get(route("stats"),{signal:g.signal,timeout:1e4});if(c&&((w=j.data)!=null&&w.statistics))r(j.data.statistics);else throw new Error("Invalid response structure")}catch(j){c&&!g.signal.aborted&&(console.error("Failed to fetch statistics:",j),h(j.message),r({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{c&&l(!1)}})(),()=>{c=!1,g.abort()}},[]);const u=[{id:"total-daily-works",title:"Total Daily Works",value:s.total,icon:ot,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:s.completed,icon:pe,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:s.pending,icon:V,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:s.rfi_submissions,icon:ue,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return o?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(M,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",o]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:u.map((c,g)=>e.jsx("div",{className:"w-full",children:e.jsx(Rt,{title:c.title,value:c.value,icon:c.icon,color:c.color,isLoaded:!m,testId:c.testId})},c.id))})})})},Lt=(s,r)=>{let m;return function(...o){const h=()=>{clearTimeout(m),s(...o)};clearTimeout(m),m=setTimeout(h,r)}},Dt=()=>{const[s,r]=n.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),m=n.useCallback(()=>{const l=window.innerWidth,o={isMobile:l<=768,isTablet:l>768&&l<=1024,isDesktop:l>1024};r(h=>JSON.stringify(h)!==JSON.stringify(o)?o:h)},[]);return n.useEffect(()=>{m();const l=Lt(m,150);return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[m]),s},D={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Se=X.memo(()=>{var W;const{auth:s}=be().props,r=s.user,{isMobile:m,isTablet:l}=Dt(),[o,h]=n.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[u,c]=n.useState({status:D.CHECKING,coordinates:null,error:null,lastUpdate:null}),[g,I]=n.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[w,j]=n.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),A=n.useCallback(()=>new Promise((t,i)=>{if(!navigator.geolocation){i(new Error("Geolocation is not supported by this browser"));return}const F={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(x=>{const b={latitude:x.coords.latitude,longitude:x.coords.longitude,accuracy:x.coords.accuracy,timestamp:new Date(x.timestamp)};t(b)},x=>{let b="Location unavailable";switch(x.code){case 1:b="Location access denied. Please allow location permission in your browser settings.";break;case 2:b="Location unavailable. Please ensure GPS is enabled.";break;case 3:b="Location request timed out. Please try again.";break;default:b="Unable to retrieve location. Please try again."}i(new Error(b))},F)}),[]),_=n.useCallback(async()=>{c(t=>({...t,status:D.CHECKING,error:null}));try{const t=await A();c({status:D.ACTIVE,coordinates:t,error:null,lastUpdate:new Date})}catch(t){const i=t.message.includes("denied")||t.message.includes("Permission");c({status:i?D.DENIED:D.INACTIVE,coordinates:null,error:t.message,lastUpdate:new Date})}},[A]),R=n.useCallback(async()=>{if(u.status===D.DENIED)try{c(i=>({...i,status:D.CHECKING,error:null}));const t=await A();c({status:D.ACTIVE,coordinates:t,error:null,lastUpdate:new Date}),G.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{c(i=>({...i,status:D.DENIED,error:"Location access still denied. Please check your browser settings."})),G.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[u.status,A]),v=n.useMemo(()=>{if(o.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(te,{className:"w-4 h-4"})};switch(o.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(xt,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(vt,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(V,{className:"w-4 h-4"})}}},[o.currentStatus,o.userOnLeave]),f=n.useMemo(()=>({sessionsToday:o.todayPunches.length,averageSessionTime:o.todayPunches.length>0?Math.round(parseFloat(o.realtimeWorkTime.split(":")[0])/o.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(o.realtimeWorkTime.split(":")[0])/8*100)}),[o.todayPunches,o.realtimeWorkTime]),a=n.useMemo(()=>{var t;switch(u.status){case D.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case D.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (±${Math.round(((t=u.coordinates)==null?void 0:t.accuracy)||0)}m)`};case D.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case D.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[u.status,(W=u.coordinates)==null?void 0:W.accuracy]),d=n.useCallback(()=>{const t=new Date;let i=0,F=!1;if(o.todayPunches.forEach(y=>{if(y.punchin_time){let T;try{if(T=new Date(y.punchin_time),isNaN(T.getTime())||typeof y.punchin_time=="string"&&y.punchin_time.includes(":")&&!y.punchin_time.includes("T")){const E=new Date,[B,Z,ie]=y.punchin_time.split(":");T=new Date(E.getFullYear(),E.getMonth(),E.getDate(),parseInt(B),parseInt(Z),parseInt(ie||0))}}catch{console.warn("Invalid punch in time format:",y.punchin_time);return}if(isNaN(T.getTime()))return;if(y.punchout_time){let E;try{if(E=new Date(y.punchout_time),isNaN(E.getTime())||typeof y.punchout_time=="string"&&y.punchout_time.includes(":")&&!y.punchout_time.includes("T")){const Z=new Date,[ie,Ie,Ee]=y.punchout_time.split(":");E=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate(),parseInt(ie),parseInt(Ie),parseInt(Ee||0))}}catch{console.warn("Invalid punch out time format:",y.punchout_time);return}if(isNaN(E.getTime()))return;const B=Math.floor((E-T)/1e3);B>0&&(i+=B)}else{F=!0;const E=Math.floor((t-T)/1e3);E>0&&(i+=E)}}}),!F&&o.totalWorkTime&&o.totalWorkTime!=="00:00:00"){h(y=>({...y,realtimeWorkTime:o.totalWorkTime}));return}(isNaN(i)||i<0)&&(i=0);const x=Math.floor(i/3600),b=Math.floor(i%3600/60),S=i%60,U=`${x.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}`;h(y=>({...y,realtimeWorkTime:U}))},[o.todayPunches,o.totalWorkTime]),p=n.useCallback(async()=>{try{const i=(await Y.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;h(F=>({...F,todayPunches:i.punches||[],totalWorkTime:i.total_production_time||"00:00:00",realtimeWorkTime:i.total_production_time||"00:00:00",userOnLeave:i.isUserOnLeave,lastRefresh:new Date,currentStatus:i.punches&&i.punches.length>0?i.punches[i.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(t){console.error("Error fetching current status:",t),G.error("Failed to fetch attendance status")}},[]),N=n.useCallback(()=>{const t=document.createElement("canvas"),i=t.getContext("2d");return i.textBaseline="top",i.font="14px Arial",i.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:t.toDataURL(),timestamp:Date.now()}},[]),k=n.useCallback(async()=>{if(o.userOnLeave){G.warning("You are on leave today. Cannot punch in/out.");return}if(u.status!==D.ACTIVE){G.error("Location access required for attendance. Please enable GPS and try again.");return}h(t=>({...t,loading:!0}));try{const t=await A(),i=N();let F="Unknown";try{F=(await Y.get(route("getClientIp"))).data.ip}catch(S){console.warn("Could not fetch IP address:",S)}j(S=>({...S,sessionInfo:{ip:F,accuracy:t.accuracy?`${Math.round(t.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const x={lat:t.latitude,lng:t.longitude,accuracy:t.accuracy,ip:F,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(i),user_agent:navigator.userAgent,timestamp:new Date().toISOString()},b=await Y.post(route("attendance.punch"),x);b.data.status==="success"?(G.success(b.data.message,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}}),I(S=>({...S,sessionDialogOpen:!0})),setTimeout(()=>{p()},500)):G.error(b.data.message)}catch(t){console.error("Punch operation failed:",t);const i=t.response.data.message||"Unable to record attendance. Please try again.";G.error(i,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{h(t=>({...t,loading:!1}))}},[o.userOnLeave,u.status,A,N,p]),C=n.useCallback(()=>{a.clickable&&(u.status===D.DENIED?R():u.status===D.INACTIVE&&_())},[a.clickable,u.status,R,_]),$=n.useCallback(t=>{if(!t)return"--:--";try{let i;if(typeof t=="string"&&t.includes(":")&&!t.includes("T")){const F=new Date,[x,b,S]=t.split(":");i=new Date(F.getFullYear(),F.getMonth(),F.getDate(),parseInt(x),parseInt(b),parseInt(S||0))}else i=new Date(t);return isNaN(i.getTime())?"--:--":i.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),P=n.useCallback(t=>{var i,F;if(!t)return"Location not available";try{if(typeof t=="object"&&t.lat&&t.lng)return(i=t.address)!=null&&i.trim()?t.address.substring(0,30):`${t.lat.toFixed(4)}, ${t.lng.toFixed(4)}`;if(typeof t=="string")try{const x=JSON.parse(t);if(x.lat&&x.lng)return(F=x.address)!=null&&F.trim()?x.address.substring(0,30):`${x.lat.toFixed(4)}, ${x.lng.toFixed(4)}`}catch{return t.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return n.useEffect(()=>{const t=setInterval(()=>{j(i=>({...i,currentTime:new Date})),o.currentStatus==="punched_in"&&o.todayPunches.length>0&&d()},1e3);return()=>clearInterval(t)},[o.currentStatus,o.todayPunches.length,d]),n.useEffect(()=>{p(),_();const t=()=>{j(x=>({...x,connectionStatus:{...x.connectionStatus,network:!0}})),p()},i=()=>{j(x=>({...x,connectionStatus:{...x.connectionStatus,network:!1}}))},F=()=>{p(),_()};return window.addEventListener("online",t),window.addEventListener("offline",i),window.addEventListener("focus",F),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",i),window.removeEventListener("focus",F)}},[p,_]),n.useEffect(()=>{const t=setInterval(()=>{p()},3e4);return()=>clearInterval(t)},[p]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(M,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(ne,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(Ge,{content:"",color:v.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(Ve,{src:(r==null?void 0:r.profile_image_url)||(r==null?void 0:r.profile_image),name:r==null?void 0:r.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate",style:{color:"var(--theme-foreground)"},children:r==null?void 0:r.name}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:["ID: ",(r==null?void 0:r.employee_id)||(r==null?void 0:r.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:w.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:w.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(J,{color:v.color,variant:"flat",startContent:v.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:v.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(M,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(V,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:o.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(M,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Be,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:f.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(de,{color:v.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:k,isDisabled:o.loading||o.userOnLeave||u.status!==D.ACTIVE,isLoading:o.loading,startContent:!o.loading&&v.icon,className:"mb-4 font-semibold",style:{background:o.userOnLeave||u.status!==D.ACTIVE?"var(--theme-default, #71717A)":v.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":v.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":v.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading||o.userOnLeave||u.status!==D.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:o.loading?"Processing...":v.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(le,{content:a.tooltip,children:e.jsx(J,{size:"sm",variant:a.variant,color:a.color,startContent:u.status===D.CHECKING?e.jsx(ce,{size:"sm",className:"w-3 h-3"}):e.jsx(Q,{className:"w-3 h-3"}),className:`text-xs transition-all ${a.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:a.clickable?C:void 0,children:a.text})}),e.jsx(le,{content:`Network: ${w.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(J,{size:"sm",variant:"flat",color:w.connectionStatus.network?"success":"default",startContent:e.jsx(it,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(le,{content:"Device Security",children:e.jsx(J,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(lt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),u.error&&u.status!==D.ACTIVE&&e.jsx(M,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(te,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:u.error})]})}),o.userOnLeave&&e.jsx(M,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",o.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(o.userOnLeave.from_date).toLocaleDateString()," - ",new Date(o.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(Ae,{children:e.jsx($e,{"aria-label":"Today's Activity",startContent:e.jsx(Ze,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[f.sessionsToday," sessions • ",o.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:o.todayPunches.length>0?o.todayPunches.map((t,i)=>e.jsx(M,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:$(t.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Q,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:P(t.punchin_location)})]})]})]}),t.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:$(t.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Q,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:P(t.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(V,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),t.duration&&e.jsx(J,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:t.duration})]})},i)):e.jsxs(M,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Fe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(qe,{isOpen:g.sessionDialogOpen,onOpenChange:t=>I(i=>({...i,sessionDialogOpen:t})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(Je,{children:t=>e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{className:"flex flex-col gap-1 text-center",children:[e.jsx(pe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Ye,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(M,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ct,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:w.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(M,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Q,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:w.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(M,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",w.sessionInfo.timestamp]})]})})]}),e.jsx(dt,{children:e.jsx(de,{color:"primary",variant:"shadow",fullWidth:!0,onPress:t,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})})]})});Se.displayName="PunchStatusCard";function At({auth:s}){const[r,m]=n.useState(!1),[l,o]=n.useState(!1),[h,u]=n.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),c={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},g={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},I={hidden:{opacity:0,y:30,scale:.9},visible:v=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:v*.15,ease:"easeOut"}})},w=v=>s.permissions&&s.permissions.includes(v),j=v=>v.some(f=>w(f)),A=v=>v.every(f=>w(f)),_=()=>{m(v=>!v),o(v=>!v)},R=v=>{const f=v.target.value;u(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(f))),o(a=>!a),m(a=>!a)};return e.jsxs(e.Fragment,{children:[e.jsx(Pe,{title:"Dashboard"}),e.jsx(O.div,{variants:c,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(O.div,{variants:g,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[A(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(O.div,{variants:I,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Se,{handlePunchSuccess:_})},"punch-status-card")},"punch-status-grid"),w("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(O.div,{variants:I,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Tt,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),j(["attendance.view","employees.view"])&&e.jsxs(O.div,{variants:c,initial:"hidden",animate:"visible",children:[e.jsx(O.div,{variants:I,custom:2,children:e.jsx(Me,{selectedDate:h,handleDateChange:R,updateTimeSheet:l})},"timesheet-section"),e.jsx(O.div,{variants:I,custom:3,children:e.jsx(St,{selectedDate:h,updateMap:r})},"user-locations-section")]}),w("core.updates.view")&&e.jsx(O.div,{variants:I,custom:4,initial:"hidden",animate:"visible",children:e.jsx(Et,{})},"updates-section")]})})]})}At.layout=s=>e.jsx(Xe,{children:s});export{At as default};
