import{E as me,y as xe,u as se,r as a,j as e,H as he}from"./app-C1U45Ebj.js";import{p as ge,u as oe,T as fe,B as le,G as ye}from"./logo-CfQNLy2U.js";import{w as be,I as je,k as p,l as Z,B as ie,G as ve,A as Ce}from"./App-whY0_PgO.js";import{C as Se}from"./Clear-DEIruHJj.js";import{G as ne}from"./GlassDialog-DlDj20KD.js";import{D as de}from"./DialogTitle-n4i8VQ5D.js";import{D as ce,a as ue}from"./DialogContent-Buy6bhT7.js";import{I as $,F as L,T as M}from"./TextField-BppgltFh.js";import{S as ee,M as q}from"./Select-6qEezkdx.js";import{A as Pe}from"./Avatar-DuuqbjIn.js";import{L as De}from"./LoadingButton-Df5WnXLU.js";import{C as pe}from"./CircularProgress-CE3Tiwse.js";import{D as _e}from"./DialogContentText-BxlR_yJE.js";import{B as V}from"./Button-D2aSymif.js";import{d as ke}from"./dayjs.min-BTc-9rSv.js";import{C as Te}from"./CardHeader-BqMsir7C.js";import{A as we}from"./Add-CNpSLwub.js";import{C as te}from"./CardContent-Dr2XfLTO.js";import{i as ae}from"./chunk-SSA7SXE4-CwjhqkNF.js";import{t as Fe,a as Ie,b as Re,c as Ee,d as Be,e as Me}from"./chunk-F3UDT23P-C9zYK25D.js";import{p as Ae}from"./chunk-EAPQ7RWQ-X8us5Cw9.js";import"./create-visual-element-BuHeE9lo.js";import"./EnvelopeIcon-DYtxSQqd.js";import"./UserIcon-Ch89lSMO.js";import"./ShieldCheckIcon-BOaBImyC.js";import"./ExclamationTriangleIcon-C6Etxr_V.js";import"./Dialog-CLSehbXy.js";import"./Popover-B0BuhAs7.js";import"./useSlot-Cnb0Rlda.js";import"./useHasTabbableChild-zsiyx3Qk.js";import"./index-C-LltKoZ.js";import"./index-CokAva9Y.js";var A={},re;function We(){if(re)return A;re=1;var f=ge();Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var d=f(be()),c=me();return A.default=(0,d.default)((0,c.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),A}var qe=We();const Ge=xe(qe),He=({open:f,closeModal:d,leavesData:c,setLeavesData:w,currentLeave:t,allUsers:y,setTotalRows:F,setLastPage:m,setLeaves:I,handleMonthChange:x,employee:G})=>{const{auth:R}=se().props,o=oe(),[j,H]=a.useState((t==null?void 0:t.user_id)||R.user.id),[h,S]=a.useState(c.leaveTypes||[]),[P,D]=a.useState(c.leaveCounts||[]),[v,E]=a.useState((t==null?void 0:t.leave_type)||(h.length>0?h[0].type:"")),[_,k]=a.useState((t==null?void 0:t.from_date)||""),[B,U]=a.useState((t==null?void 0:t.to_date)||""),[Y,X]=a.useState((t==null?void 0:t.no_of_days)||""),[N,O]=a.useState(""),[W,z]=a.useState((t==null?void 0:t.reason)||""),[l,J]=a.useState({}),[s,g]=a.useState(!1),[T,K]=a.useState("");a.useEffect(()=>{c&&(S(c.leaveTypes||[]),D(c.leaveCountsByUser[j]||[]))},[c,j]),a.useEffect(()=>{var u;const r=((u=P==null?void 0:P.find(n=>n.leave_type===v))==null?void 0:u.days_used)||0;K(r);const C=h==null?void 0:h.find(n=>n.type===v);C&&O(C.days-r)},[v,P,h]),a.useEffect(()=>{X(((C,u)=>{if(!C||!u)return"";const n=new Date(C),i=new Date(u);if(n>i)return"";const b=i.getTime()-n.getTime();return Math.ceil(b/(1e3*3600*24))+1})(_,B))},[_,B]);const Q=async r=>{r.preventDefault(),g(!0);const C=new Promise(async(u,n)=>{try{const i={route:route().current(),user_id:j,leaveType:v,fromDate:_,toDate:B,daysCount:Y,leaveReason:W,employee:G};t&&(i.id=t.id);const b=await axios.post(route("leave-add"),i);b.status===200&&(w(b.data.leavesData),F(b.data.leavesData.leaveRecords.total),m(b.data.leavesData.leaveRecords.last_page),I(b.data.leavesData.leaveRecords.data),x({target:{value:_.slice(0,7)}}),d(),u([b.data.message||"Leave application submitted successfully"]))}catch(i){console.error(i),g(!1),i.response?(i.response.status===422?(J(i.response.data.errors||{}),n(i.response.data.error||"Failed to submit leave application")):n("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(n("No response received from the server. Please check your internet connection."),console.error(i.request)):(n("An error occurred while setting up the request."),console.error("Error",i.message))}finally{g(!1)}});ie.promise(C,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:u}){return e.jsx(e.Fragment,{children:u.map((n,i)=>e.jsx("div",{children:n},i))})},icon:"ğŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:u}){return e.jsx(e.Fragment,{children:u})},icon:"ğŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})};return e.jsxs(ne,{open:f,onClose:d,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(de,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(fe,{variant:"h6",children:"Add Leave"}),e.jsx(je,{onClick:d,sx:{position:"absolute",top:8,right:16},children:e.jsx(Se,{})})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsx(ce,{children:e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx($,{id:"leave-type-label",children:"Leave Type"}),e.jsxs(ee,{labelId:"leave-type-label",value:v,onChange:r=>E(r.target.value),label:"Leave Type",error:!!l.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e.jsx(q,{value:"",disabled:!0,children:"Select Leave Type"}),h.map(r=>e.jsxs(q,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e.jsx(L,{children:l.leaveType})]})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(M,{label:"From",type:"date",fullWidth:!0,value:_,onChange:r=>k(r.target.value),InputLabelProps:{shrink:!0},error:!!l.fromDate,helperText:l.fromDate})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(M,{label:"To",type:"date",fullWidth:!0,value:B,onChange:r=>U(r.target.value),InputLabelProps:{shrink:!0},error:!!l.toDate,helperText:l.toDate})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(M,{label:"Number of days",type:"text",fullWidth:!0,value:Y,InputProps:{readOnly:!0},error:!!l.daysCount,helperText:l.daysCount})}),e.jsx(p,{item:!0,xs:12,md:6,children:e.jsx(M,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:N,InputProps:{readOnly:!0},error:!!l.remainingLeaves,helperText:l.remainingLeaves})}),R.roles.includes("Administrator")&&route().current()==="leaves"&&e.jsx(p,{item:!0,xs:12,md:6,children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx($,{id:"leave-employee-label",children:"Employee"}),e.jsxs(ee,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:j||"na",error:!!l.user_id,onChange:r=>H(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e.jsx(q,{value:"na",disabled:!0,children:"Please select"}),y.map(r=>e.jsx(q,{value:r.id,children:e.jsxs(le,{sx:{display:"flex"},children:[e.jsx(Pe,{src:r.profile_image_url||r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e.jsx(L,{children:l.user_id})]})}),e.jsx(p,{item:!0,xs:12,children:e.jsx(M,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:W,onChange:r=>z(r.target.value),error:!!l.leaveReason,helperText:l.leaveReason})})]})}),e.jsx(ue,{sx:{padding:"16px",justifyContent:"center"},children:e.jsx(De,{type:"submit",variant:"outlined",color:"primary",loading:s,disabled:s,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ue=({open:f,handleClose:d,leaveIdToDelete:c,setLeavesData:w})=>{const t=oe(),y=()=>{const F=new Promise(async(m,I)=>{try{const x=await axios.delete(route("leave-delete",{id:c,route:route().current()}));x.status===200&&(w(x.data.leavesData),m("Leave application deleted successfully"))}catch(x){console.error("Error deleting task:",x),I(x.response.data.error||"Failed to delete leave application")}finally{d()}});ie.promise(F,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(pe,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:m}){return e.jsx(e.Fragment,{children:m})},icon:"ğŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:m}){return e.jsx(e.Fragment,{children:m})},icon:"ğŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}}})};return e.jsxs(ne,{open:f,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(de,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(ce,{children:e.jsx(_e,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),e.jsxs(ue,{children:[e.jsx(V,{onClick:d,color:"primary",children:"Cancel"}),e.jsx(V,{onClick:y,color:"error",autoFocus:!0,children:"Delete"})]})]})},Ye=({title:f,allUsers:d})=>{const{auth:c,props:w}=se(),[t,y]=a.useState(null),[F,m]=a.useState(w.leavesData),[I,x]=a.useState(),[G,R]=a.useState(0),[o,j]=a.useState(0),[H,h]=a.useState(null),[S,P]=a.useState(""),[D,v]=a.useState(ke().format("YYYY-MM")),[E,_]=a.useState(30),[k,B]=a.useState(1),[U,Y]=a.useState(),[X,N]=a.useState(""),O=s=>y(s);a.useCallback((s,g)=>{h(s),y(g)},[]);const W=a.useCallback(()=>{y(null),h(null)},[]),z=s=>P(s.target.value.toLowerCase()),l=s=>{v(s.target.value)},J=async()=>{var s,g;try{const T=await axios.get(route("leaves.paginate"),{params:{page:k,perPage:E,employee:S,month:D}});if(T.status===200){const{data:K,total:Q,last_page:r}=T.data.leaves;x(K),R(Q),j(r)}}catch(T){console.error("Error fetching leaves data:",T),N(((g=(s=T.response)==null?void 0:s.data)==null?void 0:g.message)||"Error retrieving data.")}};return a.useEffect(()=>{J()},[D,k,E,S]),e.jsxs(e.Fragment,{children:[e.jsx(he,{title:f}),["add_leave","edit_leave"].includes(t)&&e.jsx(He,{setTotalRows:R,setLastPage:j,setPicnicParticipants:x,perPage:E,employee:S,currentPage:k,selectedMonth:D,allUsers:d,open:!0,setPicnicParticipantsData:m,closeModal:()=>y(null),leavesData:F,currentPicnicParticipant:t==="edit_leave"?U:null,handleMonthChange:l}),t==="delete_leave"&&e.jsx(Ue,{open:!0,handleClose:W,leaveIdToDelete:H,setPicnicParticipantsData:m}),e.jsx(le,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(ve,{in:!0,children:e.jsxs(ye,{children:[e.jsx(Te,{title:"Picnic Participants",sx:{padding:"24px"},action:e.jsx(V,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e.jsx(we,{}),onClick:()=>O("add_leave"),children:"Add Picnic Participant"})}),e.jsx(te,{children:e.jsxs(p,{container:!0,spacing:2,children:[e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ae,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:S,onChange:z,endContent:e.jsx(Ge,{})})}),e.jsx(p,{item:!0,xs:12,sm:6,md:4,children:e.jsx(ae,{label:"Select Month",type:"month",variant:"bordered",onChange:l,value:D})})]})}),e.jsx(te,{children:e.jsxs("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[e.jsxs(Fe,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e.jsx(Ie,{columns,children:s=>e.jsx(Re,{align:s.uid==="actions"?"center":"start",children:s.name},s.uid)}),e.jsx(Ee,{items:I,children:s=>e.jsx(Be,{children:g=>e.jsx(Me,{style:{whiteSpace:"nowrap"},children:renderCell(s,g)})},s.id)})]}),G>10&&e.jsx("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e.jsx(Ae,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:k,total:o,onChange:handlePageChange})})]})})]})})})]})};Ye.layout=f=>e.jsx(Ce,{children:f});export{Ye as default};
