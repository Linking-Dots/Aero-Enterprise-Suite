import{r as t,j as e,e as Nt,a as ye,H as St,c as k,F as Ct,f as Rt,g as _e,h as De}from"./app-C1U45Ebj.js";import{b as Pt,q as kt,a as U,h as Gs,i as Hs,d as Ws,_ as os,s as Ke,e as Vs,P as Et,g as _t,u as qs,j as qe,B as Ne,T as f,G as Dt}from"./logo-CfQNLy2U.js";import{G as es}from"./GlassDialog-DlDj20KD.js";import{P as At}from"./PageHeader-BguKKtkP.js";import{S as Mt}from"./StatsCards-CTb1gp2_.js";import{a9 as ls,aa as ss,ab as Lt,ac as Ds,G as Ks,ad as Ft,u as As,e as Se,ae as Ms,B as I,K as We,h as ts,c as Q,T as Ae,af as Ot,A as Tt}from"./App-whY0_PgO.js";import{F as Ce,a as It}from"./ShieldCheckIcon-BOaBImyC.js";import{F as zt}from"./FunnelIcon-DQeo0PRv.js";import{A as rs}from"./Alert-BM1miaEH.js";import{F as Ls}from"./ExclamationTriangleIcon-C6Etxr_V.js";import{F as Ut}from"./CogIcon-ASMQZN-3.js";import{T as $t,a as Ve}from"./Tabs-C5N9P5e1.js";import{F as as}from"./AdjustmentsHorizontalIcon-yosOaLGg.js";import{F as Bt}from"./DocumentArrowDownIcon-BXxQ19kw.js";import{s as Re,l as G}from"./chunk-Y2AYO5NJ-BRwLVlLS.js";import{F as Fs}from"./PlusIcon-BuMNm0s1.js";import{F as Os}from"./PencilSquareIcon-Df8Iq3-8.js";import{F as Ts}from"./TrashIcon-CloBOZ-O.js";import{p as Is}from"./chunk-XVMALT6H-CYgKbo0D.js";import{i as X}from"./chunk-SSA7SXE4-CwjhqkNF.js";import{c as Me}from"./chunk-D5XJWRAV-D_e-q5OY.js";import"./create-visual-element-BuHeE9lo.js";import"./Dialog-CLSehbXy.js";import"./EnvelopeIcon-DYtxSQqd.js";import"./UserIcon-Ch89lSMO.js";import"./useSlot-Cnb0Rlda.js";import"./KeyboardArrowRight-ZcFSeBTr.js";import"./index-C-LltKoZ.js";import"./index-aV7qt4-Z.js";import"./NumberFormatter-DNR9MAW-.js";function zs(n){return n.substring(2).toLowerCase()}function Gt(n,i){return i.documentElement.clientWidth<n.clientX||i.documentElement.clientHeight<n.clientY}function Ht(n){const{children:i,disableReactTree:g=!1,mouseEvent:p="onClick",onClickAway:b,touchEvent:j="onTouchEnd"}=n,D=t.useRef(!1),A=t.useRef(null),F=t.useRef(!1),E=t.useRef(!1);t.useEffect(()=>(setTimeout(()=>{F.current=!0},0),()=>{F.current=!1}),[]);const v=Pt(kt(i),A),C=ls(R=>{const h=E.current;E.current=!1;const O=ss(A.current);if(!F.current||!A.current||"clientX"in R&&Gt(R,O))return;if(D.current){D.current=!1;return}let l;R.composedPath?l=R.composedPath().indexOf(A.current)>-1:l=!O.documentElement.contains(R.target)||A.current.contains(R.target),!l&&(g||!h)&&b(R)}),V=R=>h=>{E.current=!0;const O=i.props[R];O&&O(h)},z={ref:v};return j!==!1&&(z[j]=V(j)),t.useEffect(()=>{if(j!==!1){const R=zs(j),h=ss(A.current),O=()=>{D.current=!0};return h.addEventListener(R,C),h.addEventListener("touchmove",O),()=>{h.removeEventListener(R,C),h.removeEventListener("touchmove",O)}}},[C,j]),p!==!1&&(z[p]=V(p)),t.useEffect(()=>{if(p!==!1){const R=zs(p),h=ss(A.current);return h.addEventListener(R,C),()=>{h.removeEventListener(R,C)}}},[C,p]),e.jsx(t.Fragment,{children:t.cloneElement(i,z)})}function Wt(n={}){const{autoHideDuration:i=null,disableWindowBlurListener:g=!1,onClose:p,open:b,resumeHideDuration:j}=n,D=Lt();t.useEffect(()=>{if(!b)return;function l(w){w.defaultPrevented||(w.key==="Escape"||w.key==="Esc")&&(p==null||p(w,"escapeKeyDown"))}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[b,p]);const A=ls((l,w)=>{p==null||p(l,w)}),F=ls(l=>{!p||l==null||D.start(l,()=>{A(null,"timeout")})});t.useEffect(()=>(b&&F(i),D.clear),[b,i,F,D]);const E=l=>{p==null||p(l,"clickaway")},v=D.clear,C=t.useCallback(()=>{i!=null&&F(j??i*.5)},[i,j,F]),V=l=>w=>{const N=l.onBlur;N==null||N(w),C()},z=l=>w=>{const N=l.onFocus;N==null||N(w),v()},R=l=>w=>{const N=l.onMouseEnter;N==null||N(w),v()},h=l=>w=>{const N=l.onMouseLeave;N==null||N(w),C()};return t.useEffect(()=>{if(!g&&b)return window.addEventListener("focus",C),window.addEventListener("blur",v),()=>{window.removeEventListener("focus",C),window.removeEventListener("blur-sm",v)}},[g,b,C,v]),{getRootProps:(l={})=>{const w=U({},Ds(n),Ds(l));return U({role:"presentation"},l,w,{onBlur:V(w),onFocus:z(w),onMouseEnter:R(w),onMouseLeave:h(w)})},onClickAway:E}}function Vt(n){return Gs("MuiSnackbarContent",n)}Hs("MuiSnackbarContent",["root","message","action"]);const qt=["action","className","message","role"],Kt=n=>{const{classes:i}=n;return Vs({root:["root"],action:["action"],message:["message"]},Vt,i)},Qt=Ke(Et,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:(n,i)=>i.root})(({theme:n})=>{const i=n.palette.mode==="light"?.8:.98,g=_t.emphasize(n.palette.background.default,i);return U({},n.typography.body2,{color:n.vars?n.vars.palette.SnackbarContent.color:n.palette.getContrastText(g),backgroundColor:n.vars?n.vars.palette.SnackbarContent.bg:g,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(n.vars||n).shape.borderRadius,flexGrow:1,[n.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}})}),Xt=Ke("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:(n,i)=>i.message})({padding:"8px 0"}),Yt=Ke("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:(n,i)=>i.action})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),Jt=t.forwardRef(function(i,g){const p=Ws({props:i,name:"MuiSnackbarContent"}),{action:b,className:j,message:D,role:A="alert"}=p,F=os(p,qt),E=p,v=Kt(E);return e.jsxs(Qt,U({role:A,square:!0,elevation:6,className:Nt(v.root,j),ownerState:E,ref:g},F,{children:[e.jsx(Xt,{className:v.message,ownerState:E,children:D}),b?e.jsx(Yt,{className:v.action,ownerState:E,children:b}):null]}))});function Zt(n){return Gs("MuiSnackbar",n)}Hs("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const er=["onEnter","onExited"],sr=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],tr=n=>{const{classes:i,anchorOrigin:g}=n,p={root:["root",`anchorOrigin${qe(g.vertical)}${qe(g.horizontal)}`]};return Vs(p,Zt,i)},Us=Ke("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(n,i)=>{const{ownerState:g}=n;return[i.root,i[`anchorOrigin${qe(g.anchorOrigin.vertical)}${qe(g.anchorOrigin.horizontal)}`]]}})(({theme:n,ownerState:i})=>{const g={left:"50%",right:"auto",transform:"translateX(-50%)"};return U({zIndex:(n.vars||n).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},i.anchorOrigin.vertical==="top"?{top:8}:{bottom:8},i.anchorOrigin.horizontal==="left"&&{justifyContent:"flex-start"},i.anchorOrigin.horizontal==="right"&&{justifyContent:"flex-end"},{[n.breakpoints.up("sm")]:U({},i.anchorOrigin.vertical==="top"?{top:24}:{bottom:24},i.anchorOrigin.horizontal==="center"&&g,i.anchorOrigin.horizontal==="left"&&{left:24,right:"auto"},i.anchorOrigin.horizontal==="right"&&{right:24,left:"auto"})})}),$s=t.forwardRef(function(i,g){const p=Ws({props:i,name:"MuiSnackbar"}),b=qs(),j={enter:b.transitions.duration.enteringScreen,exit:b.transitions.duration.leavingScreen},{action:D,anchorOrigin:{vertical:A,horizontal:F}={vertical:"bottom",horizontal:"left"},autoHideDuration:E=null,children:v,className:C,ClickAwayListenerProps:V,ContentProps:z,disableWindowBlurListener:R=!1,message:h,open:O,TransitionComponent:l=Ks,transitionDuration:w=j,TransitionProps:{onEnter:N,onExited:ee}={}}=p,q=os(p.TransitionProps,er),Qe=os(p,sr),T=U({},p,{anchorOrigin:{vertical:A,horizontal:F},autoHideDuration:E,disableWindowBlurListener:R,TransitionComponent:l,transitionDuration:w}),K=tr(T),{getRootProps:P,onClickAway:$}=Wt(U({},T)),[Y,_]=t.useState(!0),Xe=Ft({elementType:Us,getSlotProps:P,externalForwardedProps:Qe,ownerState:T,additionalProps:{ref:g},className:[K.root,C]}),Le=he=>{_(!0),ee&&ee(he)},Ye=(he,cs)=>{_(!1),N&&N(he,cs)};return!O&&Y?null:e.jsx(Ht,U({onClickAway:$},V,{children:e.jsx(Us,U({},Xe,{children:e.jsx(l,U({appear:!0,in:O,timeout:w,direction:A==="top"?"down":"up",onEnter:Ye,onExited:Le},q,{children:v||e.jsx(Jt,U({message:h,action:D},z))}))}))}))}),ns=n=>Array.isArray(n)?[...n]:[],Bs=n=>n&&typeof n=="object"&&!Array.isArray(n)?{...n}:{},rr=n=>{const i={roles:ns(n.roles),permissions:ns(n.permissions),role_has_permissions:ns(n.role_has_permissions),permissionsGrouped:Bs(n.permissionsGrouped||n.permissions_grouped),enterprise_modules:Bs(n.enterprise_modules),errors:[]};if(i.roles.length===0&&i.errors.push("No roles data available"),i.permissions.length===0&&i.errors.push("No permissions data available"),i.roles.length>0&&i.permissions.length>0&&i.role_has_permissions.length===0&&i.errors.push("Role-permission relationships missing - this may indicate a cache or database issue"),i.role_has_permissions.length>0){const g=i.roles.map(j=>j.id),p=i.permissions.map(j=>j.id),b=i.role_has_permissions.filter(j=>!g.includes(j.role_id)||!p.includes(j.permission_id));b.length>0&&i.errors.push(`${b.length} invalid role-permission relationships found`)}return i},is=(n,i)=>{const[g,p]=t.useState(n);return t.useEffect(()=>{const b=setTimeout(()=>{p(n)},i);return()=>{clearTimeout(b)}},[n,i]),g},y={IDLE:"idle",LOADING:"loading",SUCCESS:"success",ERROR:"error"},ar=n=>{const i=t.useMemo(()=>rr(n),[n]),g=i.roles,p=i.permissions,b=i.permissionsGrouped,j=i.role_has_permissions;i.enterprise_modules;const D=!!n.can_manage_super_admin,A=n.title;n.error;const F=i.errors,E=n.users||[],v=t.useRef(null),C=t.useRef(Date.now()),V=qs();As(V.breakpoints.down("sm")),As(V.breakpoints.down("md"));const[z,R]=t.useState(0),[h,O]=t.useState(g),[l,w]=t.useState(p),[N,ee]=t.useState(j),[q,Qe]=t.useState(g.length>0?g[0].id:null),[T,K]=t.useState(new Set),[P,$]=t.useState(!1),[Y,_]=t.useState({permissions:{},modules:{},roles:y.IDLE,users:y.IDLE}),[Xe,Le]=t.useState(!1),[Ye,he]=t.useState(!1),[cs,ds]=t.useState(!1),[nr,ms]=t.useState(!1),[se,us]=t.useState(null),[te,hs]=t.useState(null),[ir,ps]=t.useState(null),[or,xs]=t.useState(null),[Qs,pe]=t.useState(!1),[xe,gs]=t.useState(null),[Fe,fs]=t.useState(null),[Oe,bs]=t.useState(""),[Te,ws]=t.useState(""),[Ie,vs]=t.useState(""),[ge,js]=t.useState("all"),[re,ys]=t.useState("all"),[Pe,Ns]=t.useState("all"),ze=is(Oe,300),Ue=is(Te,300),$e=is(Ie,300),[fe,Be]=t.useState(0),[be,Ge]=t.useState(0),[we,He]=t.useState(0),[ae,lr]=t.useState(10),[ne,cr]=t.useState(10),[ie,dr]=t.useState(10),[Ss,M]=t.useState(""),[Cs,oe]=t.useState(""),[J,ve]=t.useState({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0}),[H,le]=t.useState({name:"",display_name:"",description:"",module:"",guard_name:"web"}),[W,B]=t.useState({}),[mr,Rs]=t.useState(new Set),[ur,Ps]=t.useState(new Set),[hr,pr]=t.useState(!1),u=t.useMemo(()=>h.find(s=>s.id===q)||null,[h,q]),ce=t.useCallback(s=>{if(Array.isArray(N)){const r=N.filter(a=>a&&a.role_id===s).map(a=>a.permission_id).filter(Boolean);if(r.length>0)return r}if(Array.isArray(h)){const r=h.find(a=>a&&a.id===s);if(r&&Array.isArray(r.permissions))return r.permissions.map(a=>a.id).filter(Boolean)}return[]},[N,h]);t.useEffect(()=>{if(q){const s=ce(q),r=new Set(s);(r.size!==T.size||[...r].some(a=>!T.has(a)))&&K(r)}else T.size>0&&K(new Set)},[q,N,h,ce]),t.useMemo(()=>u,[u==null?void 0:u.id,u==null?void 0:u.name]),t.useMemo(()=>D,[D]);const de=t.useMemo(()=>({totalRoles:Array.isArray(h)?h.length:0,totalPermissions:Array.isArray(l)?l.length:0,activeRole:(u==null?void 0:u.name)||"None Selected",grantedPermissions:T.size}),[h,l,u,T]);t.useMemo(()=>[{title:"Total Roles",value:de.totalRoles,icon:e.jsx(Se,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:de.totalPermissions,icon:e.jsx(Ce,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Role",value:de.activeRole==="None Selected"?"None":de.activeRole,icon:e.jsx(Ms,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"Currently selected",customStyle:de.activeRole==="None Selected"?{fontSize:"1rem"}:{}},{title:"Granted",value:de.grantedPermissions,icon:e.jsx(zt,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Active permissions"}],[de]);const me=t.useMemo(()=>h.filter(s=>{const r=ze===""||s.name.toLowerCase().includes(ze.toLowerCase())||s.description&&s.description.toLowerCase().includes(ze.toLowerCase()),a=ge==="all"||ge==="active"&&s.is_active!==!1||ge==="inactive"&&s.is_active===!1;return r&&a}),[h,ze,ge]),ue=t.useMemo(()=>l.filter(s=>{const r=Ue===""||s.name&&s.name.toLowerCase().includes(Ue.toLowerCase())||s.display_name&&s.display_name.toLowerCase().includes(Ue.toLowerCase()),a=re==="all"||s.module===re||s.name&&s.name.startsWith(re);return r&&a}),[l,Ue,re]),je=t.useMemo(()=>E.filter(s=>{var o,c;const r=$e===""||((o=s.name)==null?void 0:o.toLowerCase().includes($e.toLowerCase()))||((c=s.email)==null?void 0:c.toLowerCase().includes($e.toLowerCase())),a=Pe==="all"||s.roles&&s.roles.some(d=>d.name===Pe);return r&&a}),[E,$e,Pe]),Xs=t.useMemo(()=>{const s=fe*ae;return me.slice(s,s+ae)},[me,fe,ae]),Ys=t.useMemo(()=>{const s=be*ne;return ue.slice(s,s+ne)},[ue,be,ne]),Js=t.useMemo(()=>{const s=we*ie;return je.slice(s,s+ie)},[je,we,ie]),ke=t.useMemo(()=>{const s=new Set;return l.forEach(r=>{r.module?s.add(r.module):r.name&&r.name.includes(".")&&s.add(r.name.split(".")[0])}),Array.from(s).sort()},[l]),Zs=t.useMemo(()=>h.map(s=>s.name).sort(),[h]),Z=t.useCallback((s,r)=>{if(Array.isArray(N)&&Array.isArray(l)){const a=N.filter(c=>c&&c.role_id===s),o=l.find(c=>c&&c.name===r);if(o&&a.some(c=>c.permission_id===o.id))return!0}if(Array.isArray(h)){const a=h.find(o=>o&&o.id===s);if(a&&Array.isArray(a.permissions))return a.permissions.some(o=>o&&o.name===r)}if(u&&u.id===s&&T.size>0){const a=l.find(o=>o&&o.name===r);if(a)return T.has(a.id)}return!1},[N,l,h,u,T]);t.useCallback(s=>!u||!b[s]?!1:b[s].permissions.every(a=>Z(u.id,a.name)),[u,b,Z]),t.useCallback(s=>!u||!b[s]?!1:b[s].permissions.some(a=>Z(u.id,a.name)),[u,b,Z]);const ks=s=>s.name==="Super Administrator"?D:!0,et=t.useCallback(s=>{try{Qe(s);const r=ce(s);K(new Set(r)),M("")}catch(r){console.error("Error selecting role:",r),M("Failed to select role. Please try again.")}},[ce]),st=t.useCallback(s=>{bs(s),Be(0)},[]),tt=t.useCallback(s=>{ws(s),Ge(0)},[]),rt=t.useCallback(s=>{vs(s),He(0)},[]),at=t.useCallback(s=>{js(s),Be(0)},[]),nt=t.useCallback(s=>{ys(s),Ge(0)},[]),it=t.useCallback(s=>{Ns(s),He(0)},[]),Es=t.useCallback((s=null)=>{us(s),ve({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",permissions:(s==null?void 0:s.permissions)||[],hierarchy_level:(s==null?void 0:s.hierarchy_level)||10,is_active:(s==null?void 0:s.is_active)??!0}),Le(!0),B({}),M("")},[]),Je=t.useCallback(()=>{Le(!1),us(null),B({}),M(""),ve({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0})},[]),_s=t.useCallback((s=null)=>{hs(s),le({name:(s==null?void 0:s.name)||"",display_name:(s==null?void 0:s.display_name)||"",description:(s==null?void 0:s.description)||"",module:(s==null?void 0:s.module)||ke[0]||"users",guard_name:(s==null?void 0:s.guard_name)||"web"}),he(!0),B({}),M("")},[ke]),Ze=t.useCallback(()=>{he(!1),hs(null),B({}),M(""),le({name:"",display_name:"",description:"",module:"",guard_name:"web"})},[]);t.useCallback(s=>{ps(s),ds(!0);const r=ce(s.id);Ps(new Set(r))},[ce]),t.useCallback(()=>{ds(!1),ps(null),Ps(new Set)},[]);const ot=t.useCallback(s=>{xs(s),ms(!0);const r=s.roles?new Set(s.roles.map(a=>a.id)):new Set;Rs(r)},[]);t.useCallback(()=>{ms(!1),xs(null),Rs(new Set)},[]);const lt=t.useCallback(s=>{gs(s),pe(!0)},[]),ct=t.useCallback(s=>{fs(s),pe(!0)},[]),dt=async()=>{var s,r;if(xe){$(!0);try{await ye.delete(`/api/roles/${xe.id}`),I.success("Role deleted successfully"),oe("Role deleted successfully"),pe(!1),gs(null),C.current=Date.now()}catch(a){console.error("Error deleting role:",a);const o=((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete role";I.error(o),M(o)}finally{$(!1)}}},mt=async()=>{var s,r;if(Fe){$(!0);try{await ye.delete(`/api/permissions/${Fe.id}`),I.success("Permission deleted successfully"),oe("Permission deleted successfully"),pe(!1),fs(null),C.current=Date.now()}catch(a){console.error("Error deleting permission:",a);const o=((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete permission";I.error(o),M(o)}finally{$(!1)}}},ut=async()=>{var r,a,o;B({}),M("");const s={};if(J.name.trim()||(s.name="Role name is required"),J.name.length>255&&(s.name="Role name must be less than 255 characters"),J.description&&J.description.length>500&&(s.description="Description must be less than 500 characters"),Object.keys(s).length>0){B(s);return}$(!0),_(c=>({...c,roles:y.LOADING}));try{const c=se?`/api/roles/${se.id}`:"/api/roles",x=await ye[se?"put":"post"](c,J);(x.status===200||x.status===201)&&(se?(O(m=>m.map(S=>S.id===se.id?x.data.role:S)),I.success("Role updated successfully"),oe("Role updated successfully")):(O(m=>[...m,x.data.role]),I.success("Role created successfully"),oe("Role created successfully")),Je(),_(m=>({...m,roles:y.SUCCESS})),setTimeout(()=>{_(m=>({...m,roles:y.IDLE})),oe("")},3e3),C.current=Date.now())}catch(c){if(console.error("Error saving role:",c),_(d=>({...d,roles:y.ERROR})),((r=c.response)==null?void 0:r.status)===422&&c.response.data.errors)B(c.response.data.errors);else{const d=((o=(a=c.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to save role";I.error(d),M(d)}setTimeout(()=>{_(d=>({...d,roles:y.IDLE}))},3e3)}finally{$(!1)}},ht=async()=>{var r,a,o;B({}),M("");const s={};if(H.name.trim()||(s.name="Permission name is required"),H.display_name.trim()||(s.display_name="Display name is required"),H.module.trim()||(s.module="Module is required"),Object.keys(s).length>0){B(s);return}$(!0);try{const c=te?`/api/permissions/${te.id}`:"/api/permissions",x=await ye[te?"put":"post"](c,H);(x.status===200||x.status===201)&&(te?(w(m=>m.map(S=>S.id===te.id?x.data.permission:S)),I.success("Permission updated successfully")):(w(m=>[...m,x.data.permission]),I.success("Permission created successfully")),Ze(),C.current=Date.now())}catch(c){if(console.error("Error saving permission:",c),((r=c.response)==null?void 0:r.status)===422&&c.response.data.errors)B(c.response.data.errors);else{const d=((o=(a=c.response)==null?void 0:a.data)==null?void 0:o.message)||"Failed to save permission";I.error(d),M(d)}}finally{$(!1)}},pt=t.useCallback(async s=>{var r,a,o,c;if(!(!u||P)){v.current&&v.current.abort(),v.current=new AbortController,_(d=>({...d,permissions:{...d.permissions,[s]:y.LOADING}}));try{const d=Z(u.id,s),x=d?"revoke":"grant",m=await ye.post("/admin/roles/update-permission",{role_id:u.id,permission:s,action:x},{signal:v.current.signal});if(m.status===200){if(m.data.role_has_permissions){ee(m.data.role_has_permissions);const S=m.data.role_has_permissions.filter(L=>L.role_id===u.id).map(L=>L.permission_id);K(new Set(S))}else{const S=l.find(L=>L.name===s);S&&(d?(ee(L=>L.filter(Ee=>!(Ee.role_id===u.id&&Ee.permission_id===S.id))),K(L=>{const Ee=new Set(L);return Ee.delete(S.id),Ee})):(ee(L=>[...L,{role_id:u.id,permission_id:S.id}]),K(L=>new Set([...L,S.id]))))}_(S=>({...S,permissions:{...S.permissions,[s]:y.SUCCESS}})),setTimeout(()=>{_(S=>({...S,permissions:{...S.permissions,[s]:y.IDLE}}))},2e3),I.success(`Permission ${x}ed successfully`),C.current=Date.now()}}catch(d){d.name!=="AbortError"&&(console.error("Error updating permission:",d),_(x=>({...x,permissions:{...x.permissions,[s]:y.ERROR}})),setTimeout(()=>{_(x=>({...x,permissions:{...x.permissions,[s]:y.IDLE}}))},3e3),I.error(((a=(r=d.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to update permission"),M(((c=(o=d.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to update permission"))}finally{$(!1)}}},[u,P,Z,l]),xt=t.useCallback(async s=>{var r,a,o,c;if(!(!u||P)){v.current&&v.current.abort(),v.current=new AbortController,_(d=>({...d,modules:{...d.modules,[s]:y.LOADING}}));try{const d=await ye.post("/admin/roles/update-module",{roleId:u.id,module:s,action:"toggle"},{signal:v.current.signal});if(d.status===200){ee(d.data.role_has_permissions);const x=d.data.role_has_permissions.filter(m=>m.role_id===u.id).map(m=>m.permission_id);K(new Set(x)),_(m=>({...m,modules:{...m.modules,[s]:y.SUCCESS}})),setTimeout(()=>{_(m=>({...m,modules:{...m.modules,[s]:y.IDLE}}))},2e3),I.success("Module permissions updated successfully"),C.current=Date.now()}}catch(d){d.name!=="AbortError"&&(console.error("Error updating module permissions:",d),_(x=>({...x,modules:{...x.modules,[s]:y.ERROR}})),setTimeout(()=>{_(x=>({...x,modules:{...x.modules,[s]:y.IDLE}}))},3e3),I.error(((a=(r=d.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to update module permissions"),M(((c=(o=d.response)==null?void 0:o.data)==null?void 0:c.message)||"Failed to update module permissions"))}}},[u,P]);t.useCallback((s,r)=>{ve(a=>({...a,[s]:r})),W[s]&&B(a=>({...a,[s]:void 0}))},[W]),t.useEffect(()=>()=>{v.current&&v.current.abort()},[]),t.useEffect(()=>{const s=r=>{if(r.key==="/"&&!r.ctrlKey&&!r.metaKey&&!r.altKey){const a=r.target;if(a.tagName!=="INPUT"&&a.tagName!=="TEXTAREA"&&!a.isContentEditable){r.preventDefault();const o=document.querySelector('input[placeholder*="Search"]');o&&o.focus()}}if(r.key==="Escape"&&(Oe||Te||Ie||re!=="all")&&(bs(""),ws(""),vs(""),ys("all"),js("all"),Ns("all")),(r.ctrlKey||r.metaKey)&&r.key==="k"){r.preventDefault();const a=document.querySelector('input[placeholder*="Search"]');a&&a.focus()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[Oe,Te,Ie,re,ge,Pe]);const gt=t.useCallback(s=>Y.permissions[s]||y.IDLE,[Y.permissions]),ft=t.useCallback(s=>Y.modules[s]||y.IDLE,[Y.modules]),bt=()=>e.jsxs(_e,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[e.jsxs(Me,{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[e.jsxs(f,{variant:"h6",className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Roles Management"]}),e.jsx(k,{onPress:()=>Es(),startContent:e.jsx(Fs,{className:"w-4 h-4"}),className:"bg-linear-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 border border-blue-400/30 text-white",variant:"bordered",children:"Add Role"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[e.jsx(X,{label:"Search Roles",variant:"bordered",placeholder:"Search by role name...",value:Oe,onValueChange:st,startContent:e.jsx(ts,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),e.jsxs(Re,{label:"Status Filter",variant:"bordered",selectedKeys:[ge],onSelectionChange:s=>at(Array.from(s)[0]),className:"min-w-[140px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[e.jsx(G,{value:"all",children:"All Status"},"all"),e.jsx(G,{value:"active",children:"Active"},"active"),e.jsx(G,{value:"inactive",children:"Inactive"},"inactive")]})]})]}),e.jsxs(De,{className:"p-0",children:[e.jsx("div",{className:"divide-y divide-white/10",children:Xs.map(s=>{const r=ce(s.id),a=r.map(o=>{var c;return(c=l.find(d=>d.id===o))==null?void 0:c.name}).filter(Boolean).slice(0,3);return e.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:s.name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"body1",className:"font-medium",children:s.name}),s.name==="Super Administrator"&&e.jsx(Q,{size:"sm",color:"warning",variant:"flat",children:"System"}),e.jsx(Q,{size:"sm",color:s.is_active!==!1?"success":"default",variant:"flat",children:s.is_active!==!1?"Active":"Inactive"})]}),s.description&&e.jsx(f,{variant:"body2",color:"textSecondary",className:"mt-1",children:s.description}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[a.map((o,c)=>e.jsx(Q,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:o},c)),r.length>3&&e.jsxs(Q,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",r.length-3," more"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ae,{content:"Edit Role",children:e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Es(s),isDisabled:!ks(s),className:"text-blue-400 hover:text-blue-300",children:e.jsx(Os,{className:"w-4 h-4"})})}),e.jsx(Ae,{content:"Delete Role",children:e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>lt(s),isDisabled:!ks(s),className:"text-red-400 hover:text-red-300",children:e.jsx(Ts,{className:"w-4 h-4"})})})]})]})},s.id)})}),me.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Se,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx(f,{variant:"body1",color:"textSecondary",children:"No roles found matching your criteria"})]}),me.length>ae&&e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[e.jsxs(f,{variant:"body2",color:"textSecondary",children:["Showing ",fe*ae+1," to ",Math.min((fe+1)*ae,me.length)," of ",me.length," roles"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:fe===0,onPress:()=>Be(s=>Math.max(0,s-1)),className:"text-white",children:"‹"}),e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(fe+1)*ae>=me.length,onPress:()=>Be(s=>s+1),className:"text-white",children:"›"})]})]})]})]}),wt=()=>e.jsxs(_e,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[e.jsxs(Me,{className:"p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[e.jsxs(f,{variant:"h6",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5"}),"Permissions Management"]}),e.jsx(k,{onPress:()=>_s(),startContent:e.jsx(Fs,{className:"w-4 h-4"}),className:"bg-linear-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 border border-green-400/30 text-white",variant:"bordered",children:"Add Permission"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[e.jsx(X,{label:"Search Permissions",variant:"bordered",placeholder:"Search by permission name...",value:Te,onValueChange:tt,startContent:e.jsx(ts,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),e.jsxs(Re,{label:"Module Filter",variant:"bordered",selectedKeys:[re],onSelectionChange:s=>nt(Array.from(s)[0]),className:"min-w-[180px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[e.jsx(G,{value:"all",children:"All Modules"},"all"),ke.map(s=>e.jsx(G,{value:s,children:s},s))]})]})]}),e.jsxs(De,{className:"p-0",children:[e.jsx("div",{className:"divide-y divide-white/10",children:Ys.map(s=>e.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold",children:s.name?s.name.charAt(0).toUpperCase():"P"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"body1",className:"font-medium",children:s.display_name||s.name}),e.jsx(Q,{size:"sm",color:"secondary",variant:"flat",children:s.module||(s.name?s.name.split(".")[0]:"General")})]}),e.jsx(f,{variant:"body2",color:"textSecondary",className:"mt-1",children:s.name}),s.description&&e.jsx(f,{variant:"body2",color:"textSecondary",className:"mt-1 max-w-md",children:s.description})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Ae,{content:"Edit Permission",children:e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>_s(s),className:"text-blue-400 hover:text-blue-300",children:e.jsx(Os,{className:"w-4 h-4"})})}),e.jsx(Ae,{content:"Delete Permission",children:e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ct(s),className:"text-red-400 hover:text-red-300",children:e.jsx(Ts,{className:"w-4 h-4"})})})]})]})},s.id))}),ue.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx(f,{variant:"body1",color:"textSecondary",children:"No permissions found matching your criteria"})]}),ue.length>ne&&e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[e.jsxs(f,{variant:"body2",color:"textSecondary",children:["Showing ",be*ne+1," to ",Math.min((be+1)*ne,ue.length)," of ",ue.length," permissions"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:be===0,onPress:()=>Ge(s=>Math.max(0,s-1)),className:"text-white",children:"‹"}),e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(be+1)*ne>=ue.length,onPress:()=>Ge(s=>s+1),className:"text-white",children:"›"})]})]})]})]}),vt=()=>e.jsxs(_e,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[e.jsx(Me,{className:"p-4 border-b border-white/10",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs(f,{variant:"h6",className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-5 h-5"}),"Role-Permission Assignment"]}),e.jsx(Re,{label:"Select Role to Manage",variant:"bordered",selectedKeys:q?[q.toString()]:[],onSelectionChange:s=>{const r=Array.from(s)[0];r&&et(parseInt(r))},className:"max-w-md",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:h.map(s=>e.jsx(G,{value:s.id.toString(),children:s.name},s.id.toString()))})]})}),e.jsx(De,{className:"p-4",children:u?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[e.jsxs("div",{children:[e.jsxs(f,{variant:"body1",className:"font-medium",children:["Managing permissions for: ",u.name]}),e.jsxs(f,{variant:"body2",color:"textSecondary",children:[T.size," of ",l.length," permissions granted"]})]}),e.jsx(Is,{value:T.size/l.length*100,size:"sm",color:"primary",className:"w-32","aria-label":`${Math.round(T.size/l.length*100)}% permissions granted`})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(b).map(([s,r])=>{const a=r.permissions||[],o=a.filter(m=>Z(u.id,m.name)).length,c=a.length,d=o===c,x=o>0&&o<c;return e.jsxs(_e,{className:"bg-white/5 border-white/10",children:[e.jsxs(Me,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx(f,{variant:"body1",className:"font-medium capitalize",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{size:"sm",variant:"flat",color:d?"success":x?"warning":"default",children:[o,"/",c]}),e.jsx(k,{size:"sm",variant:"light",onPress:()=>xt(s),isLoading:ft(s)===y.LOADING,className:"text-xs",children:d?"Revoke All":"Grant All"})]})]}),e.jsx(Is,{value:o/c*100,size:"sm",color:d?"success":x?"warning":"default","aria-label":`${o} of ${c} permissions granted for ${s} module`})]}),e.jsx(De,{className:"pt-0",children:e.jsx("div",{className:"space-y-2",children:a.map(m=>{const S=Z(u.id,m.name),L=gt(m.name);return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-sm bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs("div",{children:[e.jsx(f,{variant:"body2",className:"font-medium",children:m.display_name||m.name}),e.jsx(f,{variant:"caption",color:"textSecondary",children:m.name})]}),e.jsx(Ot,{size:"sm",isSelected:S,onValueChange:()=>pt(m.name),isDisabled:L===y.LOADING,color:"success","aria-label":`Toggle ${m.display_name||m.name} permission`},`${m.id}-${S}-${L}`)]},m.id)})})})]},s)})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(as,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx(f,{variant:"body1",color:"textSecondary",className:"mb-2",children:"Select a role to manage permissions"}),e.jsx(f,{variant:"body2",color:"textSecondary",children:"Choose a role from the dropdown above to assign or revoke permissions"})]})})]}),jt=()=>e.jsxs(_e,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[e.jsxs(Me,{className:"p-4 border-b border-white/10",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:e.jsxs(f,{variant:"h6",className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-5 h-5"}),"User-Role Assignment"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[e.jsx(X,{label:"Search Users",variant:"bordered",placeholder:"Search by user name or email...",value:Ie,onValueChange:rt,startContent:e.jsx(ts,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),e.jsxs(Re,{label:"Filter by Role",variant:"bordered",selectedKeys:[Pe],onSelectionChange:s=>it(Array.from(s)[0]),className:"min-w-[160px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[e.jsx(G,{value:"all",children:"All Roles"},"all"),Zs.map(s=>e.jsx(G,{value:s,children:s},s))]})]})]}),e.jsxs(De,{className:"p-0",children:[E&&E.length>0?e.jsx("div",{className:"divide-y divide-white/10",children:Js.map(s=>{var r;return e.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-orange-500 to-red-500 flex items-center justify-center text-white font-bold",children:((r=s.name)==null?void 0:r.charAt(0).toUpperCase())||"U"}),e.jsxs("div",{children:[e.jsx(f,{variant:"body1",className:"font-medium",children:s.name||"Unknown User"}),e.jsx(f,{variant:"body2",color:"textSecondary",children:s.email||"No email"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.roles&&s.roles.length>0?e.jsxs(e.Fragment,{children:[s.roles.slice(0,3).map((a,o)=>e.jsx(Q,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:a.name},o)),s.roles.length>3&&e.jsxs(Q,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",s.roles.length-3," more"]})]}):e.jsx(Q,{size:"sm",variant:"flat",color:"default",className:"text-xs",children:"No roles assigned"})})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Ae,{content:"Assign Roles",children:e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ot(s),className:"text-orange-400 hover:text-orange-300",children:e.jsx(Ms,{className:"w-4 h-4"})})})})]})},s.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(We,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),e.jsx(f,{variant:"body1",children:"No users found"}),e.jsx(f,{variant:"body2",children:"Users data is not available. Please ensure users are loaded from the backend."})]}),je.length>ie&&e.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[e.jsxs(f,{variant:"body2",children:["Showing ",we*ie+1," to ",Math.min((we+1)*ie,je.length)," of ",je.length," users"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:we===0,onPress:()=>He(s=>Math.max(0,s-1)),className:"text-white",children:"‹"}),e.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(we+1)*ie>=je.length,onPress:()=>He(s=>s+1),className:"text-white",children:"›"})]})]})]})]}),yt=()=>e.jsxs(e.Fragment,{children:[e.jsxs(es,{open:Xe,onClose:P?void 0:Je,maxWidth:"md",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-6 h-6"}),se?"Edit Role":"Create New Role",Y.roles===y.LOADING&&e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"light",onPress:Je,isDisabled:P,children:"Cancel"}),e.jsx(k,{color:"primary",onPress:ut,isLoading:P,children:se?"Update Role":"Create Role"})]}),children:[Y.roles===y.ERROR&&e.jsx("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:e.jsx("p",{className:"text-danger text-sm",children:"Failed to save role. Please check the form and try again."})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(X,{label:"Role Name",placeholder:"Enter role name",value:J.name,onValueChange:s=>ve(r=>({...r,name:s})),isInvalid:!!W.name,errorMessage:W.name,description:"Unique identifier for the role",isRequired:!0,isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),e.jsx("div",{className:"col-span-1",children:e.jsxs(Re,{label:"Guard Name",placeholder:"Select guard",selectedKeys:[J.guard_name],onSelectionChange:s=>{const r=Array.from(s)[0];ve(a=>({...a,guard_name:r}))},isDisabled:P,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:[e.jsx(G,{value:"web",children:"Web"},"web"),e.jsx(G,{value:"api",children:"API"},"api")]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(X,{label:"Description",placeholder:"Optional description of role responsibilities",value:J.description,onValueChange:s=>ve(r=>({...r,description:s})),isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70"}})})]})]}),e.jsx(es,{open:Ye,onClose:P?void 0:Ze,maxWidth:"md",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-6 h-6"}),te?"Edit Permission":"Create New Permission"]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"light",onPress:Ze,isDisabled:P,children:"Cancel"}),e.jsx(k,{color:"success",onPress:ht,isLoading:P,children:te?"Update Permission":"Create Permission"})]}),children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(X,{label:"Permission Name",placeholder:"e.g., users.create",value:H.name,onValueChange:s=>le(r=>({...r,name:s})),isInvalid:!!W.name,errorMessage:W.name,description:"Use format: module.action (e.g., users.create)",isRequired:!0,isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(X,{label:"Display Name",placeholder:"Human-readable name",value:H.display_name,onValueChange:s=>le(r=>({...r,display_name:s})),isInvalid:!!W.display_name,errorMessage:W.display_name,description:"Human-readable name",isRequired:!0,isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(Re,{label:"Module",placeholder:"Select module",selectedKeys:H.module?[H.module]:[],onSelectionChange:s=>{const r=Array.from(s)[0];le(a=>({...a,module:r}))},isInvalid:!!W.module,errorMessage:W.module,isDisabled:P,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:ke.map(s=>e.jsx(G,{value:s,children:s},s))})}),e.jsx("div",{className:"col-span-1",children:e.jsx(X,{label:"Guard Name",placeholder:"Usually 'web'",value:H.guard_name,onValueChange:s=>le(r=>({...r,guard_name:s})),description:"Usually 'web' for web permissions",isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),e.jsx("div",{className:"col-span-2",children:e.jsx(X,{label:"Description",placeholder:"Optional description of what this permission allows",value:H.description,onValueChange:s=>le(r=>({...r,description:s})),description:"Optional description of what this permission allows",isDisabled:P,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})})]})}),e.jsx(es,{open:Qs,onClose:()=>pe(!1),maxWidth:"sm",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ls,{className:"w-6 h-6 text-danger"}),"Confirm Delete"]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{variant:"light",onPress:()=>pe(!1),children:"Cancel"}),e.jsxs(k,{color:"danger",onPress:xe?dt:mt,isLoading:P,children:["Delete ",xe?"Role":"Permission"]})]}),children:e.jsxs("p",{className:"text-white/90",children:["Are you sure you want to delete ",xe?`the role "${xe.name}"`:Fe?`the permission "${Fe.name}"`:"this item","? This action cannot be undone."]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(St,{title:A}),e.jsx($s,{open:!!Cs,autoHideDuration:3e3,onClose:()=>oe(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(rs,{severity:"success",variant:"filled",onClose:()=>oe(""),children:Cs})}),e.jsx($s,{open:!!Ss,autoHideDuration:5e3,onClose:()=>M(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(rs,{severity:"error",variant:"filled",onClose:()=>M(""),children:Ss})}),F.length>0&&e.jsx(Ne,{sx:{mb:2},children:e.jsx(rs,{severity:"warning",variant:"outlined",icon:e.jsx(Ls,{className:"w-5 h-5"}),action:e.jsx(k,{color:"warning",size:"small",onClick:()=>{Rt.reload({only:["roles","permissions","users"]})},startContent:e.jsx(Ct,{className:"w-4 h-4"}),children:"Refresh Data"}),children:e.jsxs(Ne,{children:[e.jsx(f,{variant:"subtitle2",sx:{mb:1},children:"Data Integrity Issues Detected"}),e.jsx(Ne,{component:"ul",sx:{m:0,pl:2},children:F.map((s,r)=>e.jsx(f,{component:"li",variant:"body2",sx:{mb:.5},children:s},r))}),e.jsx(f,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"This may indicate a cache or database synchronization issue on the server."})]})})}),e.jsx(Ne,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(Ks,{in:!0,children:e.jsx(Dt,{children:e.jsx(At,{title:"Role & Permission Management",subtitle:"Comprehensive access control and permission management system",icon:e.jsx(It,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Export Data",icon:e.jsx(Bt,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-success-rgb),0.3)] bg-[rgba(var(--theme-success-rgb),0.05)] hover:bg-[rgba(var(--theme-success-rgb),0.1)]"}],children:e.jsxs("div",{className:"p-6",children:[e.jsx(Mt,{stats:[{title:"Total Roles",value:h.length,icon:e.jsx(Se,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:l.length,icon:e.jsx(Ce,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Users",value:E.length,icon:e.jsx(We,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"System users"},{title:"Modules",value:ke.length,icon:e.jsx(Ut,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Permission modules"}]}),e.jsxs(Ne,{sx:{width:"100%",mt:4},children:[e.jsx(Ne,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs($t,{value:z,onChange:(s,r)=>R(r),"aria-label":"role management tabs",sx:{"& .MuiTab-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-selected":{color:"#3b82f6"}},"& .MuiTabs-indicator":{backgroundColor:"#3b82f6"}},children:[e.jsx(Ve,{label:"Roles Management",icon:e.jsx(Se,{className:"w-5 h-5"}),iconPosition:"start"}),e.jsx(Ve,{label:"Permissions Management",icon:e.jsx(Ce,{className:"w-5 h-5"}),iconPosition:"start"}),e.jsx(Ve,{label:"Role-Permission Assignment",icon:e.jsx(as,{className:"w-5 h-5"}),iconPosition:"start"}),e.jsx(Ve,{label:"User-Role Assignment",icon:e.jsx(We,{className:"w-5 h-5"}),iconPosition:"start"})]})}),z===0&&e.jsx(bt,{}),z===1&&e.jsx(wt,{}),z===2&&e.jsx(vt,{}),z===3&&e.jsx(jt,{})]})]})})})})}),yt()]})};ar.layout=n=>e.jsx(Tt,{children:n});export{ar as default};
