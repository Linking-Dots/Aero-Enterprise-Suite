import{l as Je,r,n as Ie,ar as Xe,k as Ye,j as e,R as ce,a as Qe,c as Z,i as We,d as ye,s as we,f as ae,u as Ue,b as le,t as et,v as tt,F as Pe,H as rt}from"./app-a3eZZoru.js";import{T as at}from"./TimeSheetTable-NgqKNfbl.js";import{I as st,J as nt,K as ot,w as ze,p as ge,F as je,L as it,M as lt,h as Ne,N as ct,P as dt,k as ut,c as Re,e as Ee,f as Le,g as Te,A as mt}from"./Dashboard-B7BHb5AP.js";import{S as ht}from"./StatsCards-B5EncZuN.js";import{M as pt,T as ft,u as Ce,L as W}from"./leaflet-Cw59lk1H.js";import"./leaflet-routing-machine-DzFzWry4.js";import{m as K}from"./proxy-D7hJMD_Y.js";import{c as _e}from"./createLucideIcon-BKQLwZea.js";import{U as gt}from"./users-CLzfcJh8.js";import{M as xt}from"./map-pin-CaQz8ywE.js";import{c as Se}from"./chunk-D5XJWRAV-D9mUZTgA.js";import{d as re}from"./dayjs.min-CgqM20kp.js";import{i as yt}from"./isBetween-CxKnDTXp.js";import{F as he}from"./ExclamationTriangleIcon-GOC-UB39.js";import{F as se}from"./ClockIcon-V9xC1J90.js";import{F as Be}from"./UserGroupIcon-BUT_sDOc.js";import{F as vt}from"./SunIcon-CnaOUzwT.js";import{F as Fe}from"./InformationCircleIcon-B0KL0wLu.js";import{F as $e}from"./UserIcon-DU1IQJ_N.js";import{F as bt}from"./XCircleIcon-DR3LK5z9.js";import{F as xe}from"./CheckCircleIcon-D0N6KpHY.js";import{s as ke}from"./chunk-TLYTI3QM-B8tAL69S.js";import{c as ie}from"./chunk-IHOGUXIG-YqO1VlQP.js";import{F as wt}from"./ClipboardDocumentListIcon-D8bdSX51.js";import{B as Y}from"./react-toastify.esm-CNLc7eNI.js";import{a as me,F as jt}from"./MapPinIcon-D-46P2G-.js";import{F as Nt}from"./WifiIcon-CkQfGqnB.js";import{F as Ft}from"./ShieldCheckIcon-D3mB8qoD.js";import{t as be,F as kt}from"./XMarkIcon-TON3Hehf.js";import{m as De}from"./chunk-O5MCAK4F-DMYJFOmH.js";import"./PageHeader-MJSxEsU0.js";import"./MagnifyingGlassIcon-BF-5zKfh.js";import"./UserPlusIcon-BwQl9Vo0.js";import"./chunk-SSA7SXE4-C44QYUui.js";import"./DocumentArrowDownIcon-CcqYnznM.js";import"./chunk-JOT4BT4P-BjoNR-ta.js";import"./chunk-Y2AYO5NJ-DUPN4suc.js";import"./chunk-F3UDT23P-D4u4zats.js";import"./chunk-XJ2YRSUP-DZhzqFDE.js";import"./useToggleState-CHHixmNq.js";import"./chunk-YRZGWF2W-5GBgYbnZ.js";import"./chunk-APIAPHLK-eyi_qljn.js";import"./chunk-S574QCAN-CkpB12ag.js";import"./EnvelopeIcon-8B5WUcv1.js";import"./KeyIcon-D8lR1Gkw.js";import"./index-fsJ9-q6a.js";import"./logo-Pwvcz7fP.js";import"./create-visual-element-DVFpNyBr.js";function Ct(s={}){const{as:t,ref:d,max:u=5,total:o,size:h,color:m,radius:g,children:N,isBordered:w,isDisabled:F,isGrid:k,renderCount:j,className:P,classNames:T,...b}=s,p=Je(d),y=t||"div",a=r.useMemo(()=>({size:h,color:m,radius:g,isGrid:k,isBordered:w,isDisabled:F}),[h,m,g,k,w,F]),c=r.useMemo(()=>st({className:P,isGrid:k}),[P,k]),i=nt(N),C=u?i.slice(0,u):i,v=o||(u!=null?i.length-u:-1),D=C.map((f,I)=>{const R=I===0,$=I===C.length-1,H={className:Ie(R?"ms-0":k?"":"-ms-2",$&&v<1?"hover:-translate-x-0":"")};return r.cloneElement(f,Xe(H))});return{Component:y,context:a,remainingCount:v,clones:D,renderCount:j,getAvatarGroupProps:()=>({ref:p,className:c.base({class:Ie(T==null?void 0:T.base,P)}),role:"group",...b}),getAvatarGroupCountProps:()=>({className:c.count({class:T==null?void 0:T.count})})}}var He=Ye((s,t)=>{const{Component:d,clones:u,context:o,remainingCount:h,getAvatarGroupCountProps:m,getAvatarGroupProps:g,renderCount:N=w=>e.jsx(ze,{...m(),name:`+${w}`})}=Ct({...s,ref:t});return e.jsx(d,{...g(),children:e.jsxs(ot,{value:o,children:[u,h>0&&N(h)]})})});He.displayName="HeroUI.AvatarGroup";var _t=He;function St({title:s,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const It=r.forwardRef(St);function Pt({title:s,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const Ae=r.forwardRef(Pt);function Rt({title:s,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const Et=r.forwardRef(Rt);function Lt({title:s,titleId:t,...d},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},d),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const Tt=r.forwardRef(Lt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Dt=_e("clock-4",$t);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Me=_e("map",At);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ot=_e("refresh-cw",Mt);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(s){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=s,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(s){L.DomEvent.stopPropagation(s),L.DomEvent.preventDefault(s),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(s){var t=this.getContainer();this.isFullscreen()?s&&s.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):s&&s.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(s){L.DomUtil.addClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(s){L.DomUtil.removeClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(s){this._isFullscreen=s;var t=this.getContainer();s?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(s){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var s;if("onfullscreenchange"in document?s="fullscreenchange":"onmozfullscreenchange"in document?s="mozfullscreenchange":"onwebkitfullscreenchange"in document?s="webkitfullscreenchange":"onmsfullscreenchange"in document&&(s="MSFullscreenChange"),s){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,s,t)}),this.on("unload",function(){L.DomEvent.off(document,s,t)})}});L.control.fullscreen=function(s){return new L.Control.Fullscreen(s)};const Q=(s,t)=>{if(s.startsWith("var("))return`color-mix(in srgb, ${s} ${t*100}%, transparent)`;if(s.startsWith("#")){const d=s.replace("#",""),u=parseInt(d.substr(0,2),16),o=parseInt(d.substr(2,2),16),h=parseInt(d.substr(4,2),16);return`rgba(${u}, ${o}, ${h}, ${t})`}return s.replace(/[\d.]+\)$/g,`${t})`)},Wt=()=>{var u;const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},q={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:150},Oe={lat:23.8103,lng:90.4125},Ge=ce.memo(({attendanceTypeConfigs:s,theme:t})=>{const d=Ce(),u=r.useRef([]);return r.useEffect(()=>{if(!d||!(s!=null&&s.length))return;d.eachLayer(h=>{h.options&&(h.options.isAttendanceBoundary||h.options.isPolygon||h.options.isRoute)&&d.removeLayer(h)}),u.current.forEach(h=>{try{d.removeControl(h)}catch(m){console.warn("Error removing routing control:",m)}}),u.current=[],d.getContainer().querySelectorAll(".leaflet-routing-container").forEach(h=>h.remove());const o=[];if(s.forEach((h,m)=>{var j;const{base_slug:g,config:N,name:w}=h;(j=t==null?void 0:t.customColors)!=null&&j.primary;const F=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],k=F[m%F.length];if(g==="geo_polygon"&&N){const P=N.polygon||[],T=N.polygons||[];if(P.length>=3){const b=P.filter(p=>p.lat&&p.lng);if(b.length>=3){const p=b.map(a=>[parseFloat(a.lat),parseFloat(a.lng)]),y=W.polygon(p,{color:k,fillColor:k,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);y.bindPopup(`
                            <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                <strong style="color: ${k};">${w}</strong><br>
                                <small>Geofence Zone</small><br>
                                <small>Points: ${b.length}</small>
                            </div>
                        `),o.push(y.getBounds())}}T.forEach((b,p)=>{const y=b.points||[];if(y.length>=3){const a=y.filter(c=>c.lat&&c.lng);if(a.length>=3){const c=a.map(C=>[parseFloat(C.lat),parseFloat(C.lng)]),i=W.polygon(c,{color:k,fillColor:k,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);i.bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${k};">${w}</strong><br>
                                    <small>${b.name||`Zone ${p+1}`}</small>
                                </div>
                            `),o.push(i.getBounds())}}})}if(g==="route_waypoint"&&N){const P=N.waypoints||[],T=N.routes||[];if(P.length>=2){const b=P.filter(p=>p.lat&&p.lng);if(b.length>=2){const p=b.map(y=>W.latLng(parseFloat(y.lat),parseFloat(y.lng)));b.forEach((y,a)=>{const c=a===0,i=a===b.length-1,C=`
                                <div style="
                                    width: 24px;
                                    height: 24px;
                                    border-radius: 50%;
                                    background: ${c?"#10b981":i?"#ef4444":k};
                                    border: 2px solid white;
                                    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-weight: bold;
                                    font-size: 11px;
                                ">
                                    ${a+1}
                                </div>
                            `;W.marker([parseFloat(y.lat),parseFloat(y.lng)],{icon:W.divIcon({html:C,className:"route-waypoint-marker",iconSize:[24,24],iconAnchor:[12,12]}),isAttendanceBoundary:!0}).addTo(d).bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${k};">${w}</strong><br>
                                    <small>Waypoint ${a+1}${y.name?`: ${y.name}`:""}</small>
                                </div>
                            `)});try{const y=W.Routing.control({waypoints:p,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:k,weight:4,opacity:.7,dashArray:"8, 4"}],extendToWaypoints:!0,missingRouteTolerance:0},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);u.current.push(y);const a=W.latLngBounds(p);o.push(a)}catch(y){console.warn("Error creating route:",y);const a=W.polyline(p,{color:k,weight:3,opacity:.6,dashArray:"10, 10",isAttendanceBoundary:!0,isRoute:!0}).addTo(d);o.push(a.getBounds())}}}T.forEach((b,p)=>{const y=b.waypoints||[];if(y.length>=2){const a=y.filter(c=>c.lat&&c.lng);if(a.length>=2){const c=a.map(i=>W.latLng(parseFloat(i.lat),parseFloat(i.lng)));try{const i=W.Routing.control({waypoints:c,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:k,weight:4,opacity:.7,dashArray:"8, 4"}]},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);u.current.push(i),o.push(W.latLngBounds(c))}catch(i){console.warn("Error creating route:",i)}}}})}}),o.length>0){const h=o.reduce((m,g)=>m?m.extend(g):g,null);h&&h.isValid()&&setTimeout(()=>{d.fitBounds(h,{padding:[50,50],maxZoom:14})},500)}return()=>{u.current.forEach(h=>{try{d.removeControl(h)}catch{}}),u.current=[]}},[d,s,t]),null});Ge.displayName="AttendanceTypeBoundaries";const Ut=ce.memo(({startLocation:s,endLocation:t,theme:d})=>{const u=Ce();return r.useEffect(()=>{var h;if(!u||!s||!t)return;const o=W.Routing.control({waypoints:[W.latLng(s.lat,s.lng),W.latLng(t.lat,t.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((h=d==null?void 0:d.customColors)==null?void 0:h.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(u);return()=>{u&&o&&u.removeControl(o)}},[u,s,t,d]),null});Ut.displayName="RoutingMachine";const Ve=ce.memo(({selectedDate:s,onUsersLoad:t,theme:d,lastUpdate:u,users:o,setUsers:h,setLoading:m,setError:g,setAttendanceTypeConfigs:N})=>{const w=Ce(),F=r.useRef([]),k=r.useCallback(async()=>{if(!s){m(!1),h([]),N==null||N([]),t==null||t([]);return}m(!0),g(null);try{const a=route("getUserLocationsForDate",{date:s,_t:Date.now()}),i=(await axios.get(a)).data;if(!i.success||!Array.isArray(i.locations))throw new Error("Unexpected response format from server.");const C=i.locations,v=i.attendance_type_configs||[];JSON.stringify(C)!==JSON.stringify(F.current)&&(h(C),F.current=C),N==null||N(v),t==null||t(C)}catch(a){let c="Error fetching user locations.";a.response?(c+=` Server error (${a.response.status}): ${a.response.statusText}`,typeof a.response.data=="object"&&(c+=`
Details: ${JSON.stringify(a.response.data)}`)):a.request?c+=" No response received from server.":a.message&&(c+=` ${a.message}`),console.error(c,a),g(c),h([]),t==null||t([])}finally{m(!1)}},[s,t,u]);r.useEffect(()=>{k()},[k]);const j=r.useCallback((a,c)=>{const i=q.OFFSET_MULTIPLIER*c;return{lat:a.lat+i,lng:a.lng+i}},[]),P=r.useCallback((a,c)=>Math.abs(a.lat-c.lat)<q.POSITION_THRESHOLD&&Math.abs(a.lng-c.lng)<q.POSITION_THRESHOLD,[]),T=r.useCallback(a=>{if(!a)return null;if(typeof a=="object"&&a.lat&&a.lng){const c=parseFloat(a.lat),i=parseFloat(a.lng);return isNaN(c)||isNaN(i)?null:{lat:c,lng:i}}if(typeof a=="string")try{const c=JSON.parse(a);if(c.lat&&c.lng){const i=parseFloat(c.lat),C=parseFloat(c.lng);return isNaN(i)||isNaN(C)?null:{lat:i,lng:C}}}catch{const i=a.split(",");if(i.length>=2){const C=parseFloat(i[0].trim()),v=parseFloat(i[1].trim());return isNaN(C)||isNaN(v)?null:{lat:C,lng:v}}}return null},[]),b=r.useCallback(a=>{if(!a)return"Not recorded";try{let c;return a.includes("T")?c=new Date(a):c=new Date(`${s}T${a}`),isNaN(c.getTime())?"Invalid time":c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(c){return console.warn("Error formatting time:",c),a}},[s]),p=r.useCallback((a,c="default")=>{var R,$,H,G;const i="var(--theme-primary, #3b82f6)",C="var(--theme-secondary, #8b5cf6)",v="var(--theme-success, #17C964)",D="var(--theme-danger, #ef4444)";let S,A,f="";c==="punchin"?(S=`${v}, #059669`,A=Q(v,.4),f='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚ñ∂</span>'):c==="punchout"?(S=`${D}, #dc2626`,A=Q(D,.4),f='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚óº</span>'):(S=`${i}, ${C}`,A=Q(i,.4));const I=`
            <div style="
                position: relative;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${S});
                border: 3px solid white;
                box-shadow: 0 4px 12px ${A};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${(($=(R=a.name)==null?void 0:R.charAt(0))==null?void 0:$.toUpperCase())||"?"}';" />`:((G=(H=a.name)==null?void 0:H.charAt(0))==null?void 0:G.toUpperCase())||"?"}
                ${f}
            </div>
        `;return W.divIcon({html:I,className:"user-marker-icon",iconSize:q.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),y=r.useCallback((a,c="combined")=>{var E,M,z,ee;const i=a.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",C="var(--theme-primary, #3b82f6)",v="var(--theme-secondary, #8b5cf6)",D="var(--theme-success, #17C964)",S="var(--theme-danger, #ef4444)",A="var(--theme-content1, #ffffff)",f="var(--theme-foreground, #1f2937)",I="var(--theme-content3, #6b7280)";let R=null,$="";c==="punchin"&&a.punchin_photo_url?(R=a.punchin_photo_url,$="Check In Photo"):c==="punchout"&&a.punchout_photo_url&&(R=a.punchout_photo_url,$="Check Out Photo");const H=R?`
            <div style="margin-top: 12px; margin-bottom: 12px;">
                <div style="color: ${I}; font-size: 11px; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">
                    ${$}
                </div>
                <img 
                    src="${R}" 
                    data-fullscreen-photo="${R}"
                    style="
                        width: 100%; 
                        height: auto;
                        object-fit: contain; 
                        border-radius: 8px;
                        border: 1px solid ${Q(C,.2)};
                        background: rgba(0,0,0,0.02);
                        cursor: pointer;
                        transition: opacity 0.2s;
                    " 
                    onmouseover="this.style.opacity='0.85'"
                    onmouseout="this.style.opacity='1'"
                    onerror="this.style.display='none';"
                    title="Click to view full screen"
                />
            </div>
        `:"";let G="",J=C;c==="punchin"?(G=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Q(D,.1)};
                    color: ${D};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Q(D,.2)};
                ">CHECK IN</div>
            `,J=D):c==="punchout"&&(G=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Q(S,.1)};
                    color: ${S};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Q(S,.2)};
                ">CHECK OUT</div>
            `,J=S);let U="";return c==="punchin"?U=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${D}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Time: ${b(a.punchin_time)}
                    </span>
                </div>
            `:c==="punchout"?U=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${S}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Time: ${b(a.punchout_time)}
                    </span>
                </div>
            `:U=`
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="color: ${D}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Check In: ${b(a.punchin_time)}
                    </span>
                </div>
                <div style="display: flex; align-items: center;">
                    <span style="color: ${S}; margin-right: 8px;">üìç</span>
                    <span style="color: ${I}; font-size: 13px;">
                        Check Out: ${b(a.punchout_time)}
                    </span>
                </div>
            `,`
            <div style="
                min-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, ${Q(A,.95)}, ${Q(J,.05)});
                border-radius: 12px;
                border: 1px solid ${Q(J,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            ">
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                    <div style="
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${c==="punchin"?D:c==="punchout"?S:C}, ${v});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        margin-right: 12px;
                    ">
                        ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((M=(E=a.name)==null?void 0:E.charAt(0))==null?void 0:M.toUpperCase())||"?"}';" />`:((ee=(z=a.name)==null?void 0:z.charAt(0))==null?void 0:ee.toUpperCase())||"?"}
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center;">
                            <span style="font-weight: 600; color: ${f}; font-size: 16px;">
                                ${a.name||"Unknown User"}
                            </span>
                            ${G}
                        </div>
                        <div style="color: ${I}; font-size: 12px;">
                            ${a.designation||"No designation"}
                        </div>
                    </div>
                </div>
                ${c==="combined"?`
                <div style="
                    display: inline-block;
                    padding: 4px 8px;
                    background: ${Q(i,.1)};
                    color: ${i};
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid ${Q(i,.2)};
                ">
                    ${a.punchout_time?"‚úì Completed":"‚è± Active"}
                </div>`:""}
                ${H}
                <div style="space-y: 8px;">
                    ${U}
                </div>
            </div>
        `},[b]);return r.useEffect(()=>{if(!w||!o.length)return;w.eachLayer(i=>{(i instanceof W.Marker&&i.options.userData||i instanceof W.Polyline&&i.options.userRoute)&&w.removeLayer(i)});const a=[],c=i=>{let C={...i},v=0;const D=10;for(;v<D&&a.some(A=>P(C,A));)C=j(i,v+1),v++;return a.push(C),C};o.forEach(i=>{const C=i.cycles||[];if(C.length>0)C.forEach((v,D)=>{const S=T(v.punchin_location),A=T(v.punchout_location);if(!S&&!A)return;const f=S&&A&&v.is_complete,I={...i,punchin_time:v.punchin_time,punchout_time:v.punchout_time,punchin_photo_url:v.punchin_photo_url,punchout_photo_url:v.punchout_photo_url};if(f){const R=c(S),$=c(A),H=W.marker([R.lat,R.lng],{icon:p(i,"punchin"),userData:!0});H.bindPopup(y(I,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),H.addTo(w);const G=W.marker([$.lat,$.lng],{icon:p(i,"punchout"),userData:!0});G.bindPopup(y(I,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),G.addTo(w),W.polyline([[R.lat,R.lng],[$.lat,$.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const $=c(S||A),H=S?"punchin":"punchout",G=W.marker([$.lat,$.lng],{icon:p(i,H),userData:!0});G.bindPopup(y(I,H),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),G.addTo(w)}});else{const v=T(i.punchin_location),D=T(i.punchout_location);if(!v&&!D)return;if(v&&D&&i.punchout_time){const A=c(v),f=c(D),I=W.marker([A.lat,A.lng],{icon:p(i,"punchin"),userData:!0});I.bindPopup(y(i,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),I.addTo(w);const R=W.marker([f.lat,f.lng],{icon:p(i,"punchout"),userData:!0});R.bindPopup(y(i,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(w),W.polyline([[A.lat,A.lng],[f.lat,f.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const f=c(v||D),I=v?"punchin":"punchout",R=W.marker([f.lat,f.lng],{icon:p(i,I),userData:!0});R.bindPopup(y(i,I),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(w)}}})},[w,o,d,T,P,j,p,y]),null});Ve.displayName="UserMarkers";const zt=s=>r.useMemo(()=>{const t=s.reduce((m,g)=>{const N=g.user_id;return m[N]||(m[N]=[]),m[N].push(g),m},{}),d=Object.keys(t),u=d.length;let o=0,h=0;return d.forEach(m=>{const g=t[m];g.sort((F,k)=>F.punchin_time?k.punchin_time?F.punchin_time.localeCompare(k.punchin_time):-1:1);const N=g[g.length-1];g.some(F=>F.punchin_time)&&(N.punchout_time?h++:o++)}),{checkedIn:o,completed:h,total:u}},[s]),Bt=ce.memo(({updateMap:s,selectedDate:t})=>{const{themeSettings:d}=Qe(),u=ge("(min-width: 1025px)"),o=ge("(min-width: 641px) and (max-width: 1024px)"),[h,m]=r.useState([]),[g,N]=r.useState([]),[w,F]=r.useState(!0),[k,j]=r.useState(null),[P,T]=r.useState(null),[b,p]=r.useState(!1),[y,a]=r.useState(null),[c,i]=r.useState(!0),[C,v]=r.useState(0),D=window.innerWidth<640,[S,A]=r.useState(new Date),f=r.useRef([]),I=r.useRef(null);r.useRef(null),r.useEffect(()=>{const E=M=>{var ee;const z=(ee=M.target.dataset)==null?void 0:ee.fullscreenPhoto;z&&T(z)};return document.addEventListener("click",E),()=>{document.removeEventListener("click",E)}},[]);const R=r.useCallback(async()=>{F(!0);try{const E=route("getUserLocationsForDate",{date:t,_t:Date.now()});if(!t){m([]),N([]),f.current=[],v(l=>l+1),A(new Date),a(new Date);return}const M=await fetch(E);if(!M.ok)throw new Error(`HTTP ${M.status}: Failed to refresh user locations`);const z=await M.json(),ee=Array.isArray(z.locations)?z.locations:[],n=Array.isArray(z.attendance_type_configs)?z.attendance_type_configs:[];m(ee),N(n),f.current=ee,v(l=>l+1),A(new Date),a(new Date)}catch(E){console.error("Error refreshing map:",E),m([]),N([]),f.current=[]}finally{F(!1)}},[t]),$=r.useMemo(()=>{if(!t)return"Invalid Date";try{return new Date(t).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[t]),H=zt(h),G=r.useCallback(async()=>{if(!t){F(!1);return}try{const E=route("check-user-locations-updates",{date:t.split("T")[0]}),M=await fetch(E);if(!M.ok)throw new Error(`HTTP ${M.status}: Failed to check for updates`);const z=await M.json();z.success&&z.last_updated!==I.current&&z.last_updated&&(I.current=z.last_updated,R(),a(new Date)),A(new Date)}catch(E){console.error("Error checking for updates:",E),F(!1)}},[t,R]);r.useEffect(()=>{if(!c)return;G();const E=setInterval(G,5e3);return()=>clearInterval(E)},[c,G]),r.useEffect(()=>{h.length===0&&w&&b&&F(!1)},[h,w,b]),r.useEffect(()=>{if(w){const E=setTimeout(()=>{w&&(console.log("Loading timeout reached, forcing loading to false"),F(!1))},1e4);return()=>clearTimeout(E)}},[w]);const J=r.useMemo(()=>S?S.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[S]),U=r.useCallback(E=>{const M=Array.isArray(E)?E:[];JSON.stringify(M)!==JSON.stringify(f.current)&&(m(M),f.current=M),p(!0),F(!1)},[]);return e.jsxs("div",{className:"flex justify-center p-4",children:[e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(Z,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Se,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${u?"p-6":o?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${u?"p-3":o?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(Me,{className:`
                                                    ${u?"w-8 h-8":o?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${u?"text-2xl":o?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${u?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:$})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:J&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",J]})})]})})})}),e.jsx(We,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(ye,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(ht,{className:"mb-6",stats:[{title:"Total",value:H.total,icon:e.jsx(gt,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:H.checkedIn,icon:e.jsx(Dt,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:H.completed,icon:e.jsx(xt,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:D})}),e.jsx("div",{className:"p-6 pt-0",children:h.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(pt,{center:[Oe.lat,Oe.lng],zoom:q.DEFAULT_ZOOM,minZoom:q.MIN_ZOOM,maxZoom:q.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(ft,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:q.MAX_ZOOM,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ge,{attendanceTypeConfigs:g,theme:d}),e.jsx(Ve,{users:h,setUsers:m,setLoading:F,setError:j,setAttendanceTypeConfigs:N,lastUpdate:y,selectedDate:t,onUsersLoad:U,theme:d})]},`${s}-${C}`)]}):w?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Me,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",$,".",t&&new Date(t)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(ae,{variant:"bordered",color:"primary",size:"md",radius:Wt(),onPress:R,startContent:e.jsx(Ot,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})}),P&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",style:{backgroundColor:"rgba(0, 0, 0, 0.9)",backdropFilter:"blur(4px)"},onClick:()=>T(null),children:[e.jsx("button",{className:"absolute top-4 right-4 p-2 rounded-full transition-all hover:bg-white/20",style:{color:"white",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)"},onClick:()=>T(null),"aria-label":"Close fullscreen",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsxs("div",{className:"relative max-w-[95vw] max-h-[95vh] p-4",onClick:E=>E.stopPropagation(),children:[e.jsx("img",{src:P,alt:"Attendance photo",className:"max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl",style:{boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.5)"}}),e.jsx("p",{className:"text-center mt-4 text-sm",style:{color:"rgba(255, 255, 255, 0.6)"},children:"Click anywhere to close"})]})]})]})});re.extend(yt);const pe=()=>{var u;if(typeof window>"u")return"lg";const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},fe=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),Ht=({title:s,items:t,users:d,icon:u,color:o})=>{var b;const[h,m]=r.useState(null),[g,N]=r.useState(null),w=(p,y)=>{m(p.currentTarget),N(y)},F=()=>{m(null),N(null)},k=!!h,j=k?"leave-details-popover":void 0,P=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return e.jsx(xe,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(bt,{className:"w-4 h-4 text-danger"});default:return e.jsx(se,{className:"w-4 h-4 text-warning"})}},T=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(Z,{className:"h-full flex flex-col",radius:pe(),style:fe(),onMouseEnter:p=>{p.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${o} 50%, transparent)`,p.currentTarget.style.borderRadius="var(--borderRadius, 12px)",p.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:p=>{p.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",p.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Se,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${o} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${o} 25%, transparent)`},children:e.jsx(u,{className:"w-6 h-6 stroke-2",style:{color:o},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s})]})}),e.jsx(ye,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:t.map((p,y)=>e.jsxs(ce.Fragment,{children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:y*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:p.text}),p.leaves&&p.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Be,{className:"w-3 h-3"}),p.leaves.length," employee",p.leaves.length>1?"s":""]})]}),p.leaves&&(()=>{const a=p.leaves.filter(c=>c.leave_type===p.type);return a.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(_t,{max:4,isBordered:!0,size:"sm",children:a.map((c,i)=>{const C=d.find(v=>String(v.id)===String(c.user_id));return C&&e.jsx(ze,{src:C.profile_image_url,name:`${C.name} - on leave`,onClick:v=>w(v,c),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e.jsx($e,{className:"w-4 h-4"})},i)})})})})()]}),y<t.length-1&&e.jsx(We,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},y))}),e.jsx(it,{id:j,open:k,anchorEl:h,onClose:F,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(lt,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:g&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ne,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((b=d.find(p=>String(p.id)===String(g.user_id)))==null?void 0:b.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:g.from_date!==g.to_date?`${new Date(g.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(g.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(g.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:g.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P(g.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(ie,{label:g.status||"Pending",variant:"flat",color:T(g.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},Gt=()=>{const{auth:s}=Ue().props,t=ge("(min-width: 1025px)"),d=ge("(min-width: 641px) and (max-width: 1024px)"),[u,o]=r.useState(!0),[h,m]=r.useState(null),[g,N]=r.useState([]),[w,F]=r.useState([]),[k,j]=r.useState([]),[P,T]=r.useState(null);r.useEffect(()=>{let f=!0;const I=new AbortController;return(async()=>{try{o(!0),m(null);const $=await le.get(route("updates"),{signal:I.signal,timeout:1e4});f&&$.data&&(N($.data.users||[]),F($.data.todayLeaves||[]),j($.data.upcomingLeaves||[]),T($.data.upcomingHoliday||null))}catch($){f&&!I.signal.aborted&&(console.error("Failed to fetch updates:",$),m($.message),N([]),F([]),j([]),T(null))}finally{f&&o(!1)}})(),()=>{f=!1,I.abort()}},[]);const b=(f,I)=>{let R=I;const $=U=>I.some(M=>String(M.user_id)===String(s.user.id)&&M.leave_type===U)?(R=I.filter(M=>String(M.user_id)!==String(s.user.id)),`You ${f==="today"?"are":"will be"} on ${U} leave.`):null,H=I.reduce((U,E)=>{const M=$(E.leave_type);return M&&!U.some(z=>z.type===E.leave_type)&&U.push({text:M,type:E.leave_type}),U},[]),G=R.reduce((U,E)=>(U[E.leave_type]=(U[E.leave_type]||0)+1,U),{}),J=Object.entries(G).map(([U,E])=>({text:`${E} person${E>1?"s":""} ${f==="today"?"is":"will be"} on ${U} leave`,type:U,leaves:R.filter(M=>M.leave_type===U)}));return[...H,...J]},p=re(),y=p.add(1,"day"),a=y.add(7,"day"),c=w.filter(f=>re(p).isBetween(re(f.from_date),re(f.to_date),"day","[]")),i=k.filter(f=>re(y).isBetween(re(f.from_date),re(f.to_date),"day","[]")),C=k.filter(f=>(re(f.from_date).isBetween(y,a,"day","[]")||re(f.to_date).isBetween(y,a,"day","[]"))&&!/week/i.test(f.leave_type)),v=b("today",c),D=b("tomorrow",i),S=b("nextSevenDays",C);v.length===0&&v.push({text:"No one is away today."}),D.length===0&&D.push({text:"No one is away tomorrow."}),S.length===0&&S.push({text:"No one is going to be away in the next seven days."});const A=[{title:"Today",items:v,icon:je,color:"#3b82f6"},{title:"Tomorrow",items:D,icon:se,color:"#10b981"},{title:"Next Seven Days",items:S,icon:Be,color:"#f59e0b"}];return u?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((f,I)=>e.jsx("div",{children:e.jsxs(Z,{className:"w-full h-full",radius:pe(),style:fe(),children:[e.jsx(ke,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(ke,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},I))})}):h?e.jsx("div",{className:`${t?"p-6":d?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(Z,{radius:pe(),style:{...fe(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",h]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:A.map((f,I)=>e.jsx("div",{className:"flex",children:e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:I*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(Ht,{title:f.title,items:f.items,users:g,icon:f.icon,color:f.color})})})},f.title))}),P&&e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(Z,{radius:pe(),style:fe(),onMouseEnter:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",f.currentTarget.style.borderRadius="var(--borderRadius, 12px)",f.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",f.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Se,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(vt,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(ye,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Fe,{className:"w-4 h-4"}),P.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(je,{className:"w-4 h-4"}),new Date(P.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(P.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(It,{className:"w-4 h-4"}),P.description]})]})})})]})})})]})},Vt=({title:s,value:t,icon:d,color:u,isLoaded:o,testId:h})=>e.jsx(K.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(Z,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:m=>{m.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${u} 50%, transparent)`,m.currentTarget.style.borderRadius="var(--borderRadius, 12px)",m.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:m=>{m.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",m.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(ke,{className:"rounded-lg",isLoaded:o,"data-testid":h,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${s} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${u} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${u} 25%, transparent)`},children:e.jsx(d,{className:"w-6 h-6 stroke-2",style:{color:u},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof t=="number"?t.toLocaleString():t})})]})})})})}),Zt=()=>{const[s,t]=r.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[d,u]=r.useState(!0),[o,h]=r.useState(null);r.useEffect(()=>{let g=!0;const N=new AbortController;return(async()=>{var F;try{u(!0),h(null);const k=await le.get(route("stats"),{signal:N.signal,timeout:1e4});if(g&&((F=k.data)!=null&&F.statistics))t(k.data.statistics);else throw new Error("Invalid response structure")}catch(k){g&&!N.signal.aborted&&(console.error("Failed to fetch statistics:",k),h(k.message),t({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{g&&u(!1)}})(),()=>{g=!1,N.abort()}},[]);const m=[{id:"total-daily-works",title:"Total Daily Works",value:s.total,icon:wt,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:s.completed,icon:xe,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:s.pending,icon:se,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:s.rfi_submissions,icon:Ne,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return o?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(Z,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",o]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:m.map((g,N)=>e.jsx("div",{className:"w-full",children:e.jsx(Vt,{title:g.title,value:g.value,icon:g.icon,color:g.color,isLoaded:!d,testId:g.testId})},g.id))})})})},qt=(s,t)=>{let d;return function(...o){const h=()=>{clearTimeout(d),s(...o)};clearTimeout(d),d=setTimeout(h,t)}},Kt=()=>{const[s,t]=r.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),d=r.useCallback(()=>{const u=window.innerWidth,o={isMobile:u<=768,isTablet:u>768&&u<=1024,isDesktop:u>1024};t(h=>JSON.stringify(h)!==JSON.stringify(o)?o:h)},[]);return r.useEffect(()=>{d();const u=qt(d,150);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[d]),s},B={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Ze=ce.memo(()=>{var ee;const{auth:s}=Ue().props,t=s.user,{isMobile:d,isTablet:u}=Kt(),[o,h]=r.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[m,g]=r.useState({status:B.CHECKING,coordinates:null,error:null,lastUpdate:null}),[N,w]=r.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[F,k]=r.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),[j,P]=r.useState({isOpen:!1,capturedPhoto:null,isCapturing:!1,stream:null,pendingPunchData:null,facingMode:"user",isSwitching:!1}),T=r.useRef(null),b=r.useRef(null),p=r.useMemo(()=>{const n=t==null?void 0:t.attendance_type;if(!(n!=null&&n.slug))return!1;const l=n.slug.replace(/_\d+$/,"");return["geo_polygon","route_waypoint"].includes(l)},[t==null?void 0:t.attendance_type]),y=r.useCallback(()=>new Promise((n,l)=>{if(!navigator.geolocation){l(new Error("Geolocation is not supported by this browser"));return}const x={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(_=>{const V={latitude:_.coords.latitude,longitude:_.coords.longitude,accuracy:_.coords.accuracy,timestamp:new Date(_.timestamp)};n(V)},_=>{let V="Location unavailable";switch(_.code){case 1:V="Location access denied. Please allow location permission in your browser settings.";break;case 2:V="Location unavailable. Please ensure GPS is enabled.";break;case 3:V="Location request timed out. Please try again.";break;default:V="Unable to retrieve location. Please try again."}l(new Error(V))},x)}),[]),a=r.useCallback(async()=>{g(n=>({...n,status:B.CHECKING,error:null}));try{const n=await y();g({status:B.ACTIVE,coordinates:n,error:null,lastUpdate:new Date})}catch(n){const l=n.message.includes("denied")||n.message.includes("Permission");g({status:l?B.DENIED:B.INACTIVE,coordinates:null,error:n.message,lastUpdate:new Date})}},[y]),c=r.useCallback(async()=>{if(m.status===B.DENIED)try{g(l=>({...l,status:B.CHECKING,error:null}));const n=await y();g({status:B.ACTIVE,coordinates:n,error:null,lastUpdate:new Date}),Y.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{g(l=>({...l,status:B.DENIED,error:"Location access still denied. Please check your browser settings."})),Y.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[m.status,y]),i=r.useMemo(()=>{if(o.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(he,{className:"w-4 h-4"})};switch(o.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(Et,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(Tt,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(se,{className:"w-4 h-4"})}}},[o.currentStatus,o.userOnLeave]),C=r.useMemo(()=>({sessionsToday:o.todayPunches.length,averageSessionTime:o.todayPunches.length>0?Math.round(parseFloat(o.realtimeWorkTime.split(":")[0])/o.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(o.realtimeWorkTime.split(":")[0])/8*100)}),[o.todayPunches,o.realtimeWorkTime]),v=r.useMemo(()=>{var n;switch(m.status){case B.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case B.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (¬±${Math.round(((n=m.coordinates)==null?void 0:n.accuracy)||0)}m)`};case B.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case B.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[m.status,(ee=m.coordinates)==null?void 0:ee.accuracy]),D=r.useCallback(()=>{const n=new Date;let l=0,x=!1;if(o.todayPunches.forEach(O=>{if(O.punchin_time){let ne;try{if(ne=new Date(O.punchin_time),isNaN(ne.getTime())||typeof O.punchin_time=="string"&&O.punchin_time.includes(":")&&!O.punchin_time.includes("T")){const X=new Date,[ue,oe,ve]=O.punchin_time.split(":");ne=new Date(X.getFullYear(),X.getMonth(),X.getDate(),parseInt(ue),parseInt(oe),parseInt(ve||0))}}catch{console.warn("Invalid punch in time format:",O.punchin_time);return}if(isNaN(ne.getTime()))return;if(O.punchout_time){let X;try{if(X=new Date(O.punchout_time),isNaN(X.getTime())||typeof O.punchout_time=="string"&&O.punchout_time.includes(":")&&!O.punchout_time.includes("T")){const oe=new Date,[ve,qe,Ke]=O.punchout_time.split(":");X=new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),parseInt(ve),parseInt(qe),parseInt(Ke||0))}}catch{console.warn("Invalid punch out time format:",O.punchout_time);return}if(isNaN(X.getTime()))return;const ue=Math.floor((X-ne)/1e3);ue>0&&(l+=ue)}else{x=!0;const X=Math.floor((n-ne)/1e3);X>0&&(l+=X)}}}),!x&&o.totalWorkTime&&o.totalWorkTime!=="00:00:00"){h(O=>({...O,realtimeWorkTime:o.totalWorkTime}));return}(isNaN(l)||l<0)&&(l=0);const _=Math.floor(l/3600),V=Math.floor(l%3600/60),te=l%60,de=`${_.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}:${te.toString().padStart(2,"0")}`;h(O=>({...O,realtimeWorkTime:de}))},[o.todayPunches,o.totalWorkTime]),S=r.useCallback(async()=>{try{const l=(await le.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;h(x=>({...x,todayPunches:l.punches||[],totalWorkTime:l.total_production_time||"00:00:00",realtimeWorkTime:l.total_production_time||"00:00:00",userOnLeave:l.isUserOnLeave,lastRefresh:new Date,currentStatus:l.punches&&l.punches.length>0?l.punches[l.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(n){console.error("Error fetching current status:",n),Y.error("Failed to fetch attendance status")}},[]),A=r.useCallback(()=>{const n=document.createElement("canvas"),l=n.getContext("2d");return l.textBaseline="top",l.font="14px Arial",l.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:n.toDataURL(),timestamp:Date.now()}},[]),f=r.useCallback(async(n="user")=>{try{j.stream&&j.stream.getTracks().forEach(x=>x.stop());const l=await navigator.mediaDevices.getUserMedia({video:{facingMode:n,width:{ideal:1280},height:{ideal:720}}});T.current&&(T.current.srcObject=l,await T.current.play()),P(x=>({...x,stream:l,isCapturing:!1,isSwitching:!1,facingMode:n}))}catch(l){console.error("Camera access error:",l);try{const x=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});T.current&&(T.current.srcObject=x,await T.current.play()),P(_=>({..._,stream:x,isCapturing:!1,isSwitching:!1}))}catch{Y.error("Unable to access camera. Please check permissions."),P(_=>({..._,isOpen:!1,isSwitching:!1}))}}},[j.stream]),I=r.useCallback(async()=>{const n=j.facingMode==="environment"?"user":"environment";P(l=>({...l,isSwitching:!0})),await f(n)},[j.facingMode,f]),R=r.useCallback(()=>{j.stream&&j.stream.getTracks().forEach(n=>n.stop()),P(n=>({...n,stream:null,isOpen:!1,capturedPhoto:null,facingMode:"user",isSwitching:!1}))},[j.stream]),$=r.useCallback(async()=>{if(!(!T.current||!b.current)){P(n=>({...n,isCapturing:!0}));try{const n=T.current,l=b.current,x=l.getContext("2d");l.width=n.videoWidth,l.height=n.videoHeight,x.drawImage(n,0,0);const _=m.coordinates;if(_){const te=`üìç ${_.latitude.toFixed(6)}, ${_.longitude.toFixed(6)} | ${new Date().toLocaleString()}`;x.fillStyle="rgba(0, 0, 0, 0.7)",x.fillRect(0,l.height-40,l.width,40),x.fillStyle="#ffffff",x.font="bold 16px Arial",x.textBaseline="middle",x.fillText(te,10,l.height-20)}const V=l.toDataURL("image/jpeg",.85);P(te=>({...te,capturedPhoto:V,isCapturing:!1})),Y.success("Photo captured successfully!")}catch(n){console.error("Photo capture error:",n),Y.error("Failed to capture photo. Please try again."),P(l=>({...l,isCapturing:!1}))}}},[m.coordinates]),H=r.useCallback(()=>{P(n=>({...n,capturedPhoto:null}))},[]),G=r.useCallback(async()=>{var n,l;if(!j.capturedPhoto||!j.pendingPunchData){Y.error("Please capture a photo first.");return}h(x=>({...x,loading:!0})),R();try{const x={...j.pendingPunchData,photo:j.capturedPhoto},_=await le.post(route("attendance.punch"),x);_.data.status==="success"?(w(V=>({...V,sessionDialogOpen:!0})),setTimeout(()=>{S()},500)):Y.error(_.data.message)}catch(x){console.error("Punch operation failed:",x);const _=((l=(n=x.response)==null?void 0:n.data)==null?void 0:l.message)||"Unable to record attendance. Please try again.";Y.error(_)}finally{h(x=>({...x,loading:!1})),P(x=>({...x,pendingPunchData:null,capturedPhoto:null}))}},[j.capturedPhoto,j.pendingPunchData,R,S]),J=r.useCallback(async n=>{P(l=>({...l,isOpen:!0,pendingPunchData:n,capturedPhoto:null})),setTimeout(()=>f(),300)},[f]),U=r.useCallback(async()=>{var n,l;if(o.userOnLeave){Y.warning("You are on leave today. Cannot punch in/out.");return}if(m.status!==B.ACTIVE){Y.error("Location access required for attendance. Please enable GPS and try again.");return}h(x=>({...x,loading:!0}));try{const x=await y(),_=A();let V="Unknown";try{V=(await le.get(route("getClientIp"))).data.ip}catch(O){console.warn("Could not fetch IP address:",O)}k(O=>({...O,sessionInfo:{ip:V,accuracy:x.accuracy?`${Math.round(x.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const te={lat:x.latitude,lng:x.longitude,accuracy:x.accuracy,ip:V,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(_),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};if(p){h(O=>({...O,loading:!1})),J(te);return}const de=await le.post(route("attendance.punch"),te);de.data.status==="success"?(w(O=>({...O,sessionDialogOpen:!0})),setTimeout(()=>{S()},500)):Y.error(de.data.message)}catch(x){console.error("Punch operation failed:",x);const _=((l=(n=x.response)==null?void 0:n.data)==null?void 0:l.message)||"Unable to record attendance. Please try again.";Y.error(_,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{h(x=>({...x,loading:!1}))}},[o.userOnLeave,m.status,y,A,S,p,J]),E=r.useCallback(()=>{v.clickable&&(m.status===B.DENIED?c():m.status===B.INACTIVE&&a())},[v.clickable,m.status,c,a]),M=r.useCallback(n=>{if(!n)return"--:--";try{let l;if(typeof n=="string"&&n.includes(":")&&!n.includes("T")){const x=new Date,[_,V,te]=n.split(":");l=new Date(x.getFullYear(),x.getMonth(),x.getDate(),parseInt(_),parseInt(V),parseInt(te||0))}else l=new Date(n);return isNaN(l.getTime())?"--:--":l.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),z=r.useCallback(n=>{var l,x;if(!n)return"Location not available";try{if(typeof n=="object"&&n.lat&&n.lng)return(l=n.address)!=null&&l.trim()?n.address.substring(0,30):`${n.lat.toFixed(4)}, ${n.lng.toFixed(4)}`;if(typeof n=="string")try{const _=JSON.parse(n);if(_.lat&&_.lng)return(x=_.address)!=null&&x.trim()?_.address.substring(0,30):`${_.lat.toFixed(4)}, ${_.lng.toFixed(4)}`}catch{return n.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return r.useEffect(()=>{const n=setInterval(()=>{k(l=>({...l,currentTime:new Date})),o.currentStatus==="punched_in"&&o.todayPunches.length>0&&D()},1e3);return()=>clearInterval(n)},[o.currentStatus,o.todayPunches.length,D]),r.useEffect(()=>{S(),a();const n=()=>{k(_=>({..._,connectionStatus:{..._.connectionStatus,network:!0}})),S()},l=()=>{k(_=>({..._,connectionStatus:{..._.connectionStatus,network:!1}}))},x=()=>{S(),a()};return window.addEventListener("online",n),window.addEventListener("offline",l),window.addEventListener("focus",x),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",l),window.removeEventListener("focus",x)}},[S,a]),r.useEffect(()=>{const n=setInterval(()=>{S()},3e4);return()=>clearInterval(n)},[S]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(Z,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(ye,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(ct,{content:"",color:i.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(dt,{src:(t==null?void 0:t.profile_image_url)||(t==null?void 0:t.profile_image),name:t==null?void 0:t.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate notranslate",style:{color:"var(--theme-foreground)"},"data-name":"true",children:t==null?void 0:t.name}),e.jsxs("p",{className:"text-xs notranslate",style:{color:"var(--theme-foreground-600)"},"data-no-translate":"true",children:["ID: ",(t==null?void 0:t.employee_id)||(t==null?void 0:t.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:F.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:F.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ie,{color:i.color,variant:"flat",startContent:i.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:i.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(se,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:o.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ut,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:C.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(ae,{color:i.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:U,isDisabled:o.loading||o.userOnLeave||m.status!==B.ACTIVE,isLoading:o.loading,startContent:!o.loading&&i.icon,className:"mb-4 font-semibold",style:{background:o.userOnLeave||m.status!==B.ACTIVE?"var(--theme-default, #71717A)":i.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":i.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":i.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading||o.userOnLeave||m.status!==B.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:o.loading?"Processing...":i.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(be,{content:v.tooltip,children:e.jsx(ie,{size:"sm",variant:v.variant,color:v.color,startContent:m.status===B.CHECKING?e.jsx(we,{size:"sm",className:"w-3 h-3"}):e.jsx(me,{className:"w-3 h-3"}),className:`text-xs transition-all ${v.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:v.clickable?E:void 0,children:v.text})}),e.jsx(be,{content:`Network: ${F.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(ie,{size:"sm",variant:"flat",color:F.connectionStatus.network?"success":"default",startContent:e.jsx(Nt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(be,{content:"Device Security",children:e.jsx(ie,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(Ft,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),m.error&&m.status!==B.ACTIVE&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:m.error})]})}),o.userOnLeave&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",o.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(o.userOnLeave.from_date).toLocaleDateString()," - ",new Date(o.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(et,{children:e.jsx(tt,{"aria-label":"Today's Activity",startContent:e.jsx(jt,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[C.sessionsToday," sessions ‚Ä¢ ",o.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:o.todayPunches.length>0?o.todayPunches.map((n,l)=>e.jsx(Z,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:M(n.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:z(n.punchin_location)})]})]})]}),n.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:M(n.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:z(n.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(se,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),n.duration&&e.jsx(ie,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:n.duration})]})},l)):e.jsxs(Z,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Fe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(Re,{isOpen:N.sessionDialogOpen,onOpenChange:n=>w(l=>({...l,sessionDialogOpen:n})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(Ee,{children:n=>e.jsxs(e.Fragment,{children:[e.jsxs(Le,{className:"flex flex-col gap-1 text-center",children:[e.jsx(xe,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Te,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(kt,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:F.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(me,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:F.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(Z,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",F.sessionInfo.timestamp]})]})})]}),e.jsx(De,{children:e.jsx(ae,{color:"primary",variant:"shadow",fullWidth:!0,onPress:n,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})}),e.jsx(Re,{isOpen:j.isOpen,onClose:R,size:"lg",classNames:{backdrop:"bg-black/80",base:"bg-content1"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs(Ee,{children:[e.jsxs(Le,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Capture Attendance Photo"})]}),e.jsx("p",{className:"text-sm text-default-500 font-normal",children:"Take a photo for verification. Location coordinates will be added automatically."})]}),e.jsxs(Te,{className:"p-4",children:[e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black",children:[j.capturedPhoto?e.jsx("img",{src:j.capturedPhoto,alt:"Captured",className:"w-full h-auto max-h-[400px] object-contain"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:T,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-[400px] object-contain",style:{transform:j.facingMode==="user"?"scaleX(-1)":"none"}}),e.jsx(ae,{isIconOnly:!0,size:"sm",variant:"flat",className:"absolute top-3 right-3 bg-black/50 text-white hover:bg-black/70",onPress:I,isLoading:j.isSwitching,isDisabled:!j.stream||j.isSwitching,style:{borderRadius:"50%"},children:e.jsx(Pe,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 rounded-full text-xs text-white bg-black/50",children:j.facingMode==="user"?"ü§≥ Front":"üì∑ Back"})]}),e.jsx("canvas",{ref:b,className:"hidden"}),m.coordinates&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white text-xs",style:{background:"rgba(0,0,0,0.7)"},children:["üìç ",m.coordinates.latitude.toFixed(6),", ",m.coordinates.longitude.toFixed(6)]})]}),e.jsx("div",{className:"mt-3 p-3 rounded-lg text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),j.capturedPhoto?"Review your photo. You can retake if needed.":"Position yourself clearly in the frame and capture the photo."]})})]}),e.jsxs(De,{className:"flex gap-2",children:[e.jsx(ae,{color:"danger",variant:"light",onPress:R,style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Cancel"}),j.capturedPhoto?e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",variant:"flat",onPress:H,startContent:e.jsx(Pe,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Retake"}),e.jsxs(ae,{color:"success",variant:"shadow",onPress:G,isLoading:o.loading,startContent:!o.loading&&e.jsx(xe,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:["Confirm & ",i.action]})]}):e.jsx(ae,{color:"primary",variant:"shadow",onPress:$,isLoading:j.isCapturing,isDisabled:!j.stream,startContent:!j.isCapturing&&e.jsx(Ae,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Capture Photo"})]})]})})]})});Ze.displayName="PunchStatusCard";function Jt({auth:s}){const[t,d]=r.useState(!1),[u,o]=r.useState(!1),[h,m]=r.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),g={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},N={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},w={hidden:{opacity:0,y:30,scale:.9},visible:b=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:b*.15,ease:"easeOut"}})},F=b=>s.permissions&&s.permissions.includes(b),k=b=>b.some(p=>F(p)),j=b=>b.every(p=>F(p)),P=()=>{d(b=>!b),o(b=>!b)},T=b=>{const p=b.target.value;m(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(p))),o(y=>!y),d(y=>!y)};return e.jsxs(e.Fragment,{children:[e.jsx(rt,{title:"Dashboard"}),e.jsx(K.div,{variants:g,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(K.div,{variants:N,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[j(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Ze,{handlePunchSuccess:P})},"punch-status-card")},"punch-status-grid"),F("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Zt,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),k(["attendance.view","employees.view"])&&e.jsxs(K.div,{variants:g,initial:"hidden",animate:"visible",children:[e.jsx(K.div,{variants:w,custom:2,children:e.jsx(at,{selectedDate:h,handleDateChange:T,updateTimeSheet:u})},"timesheet-section"),e.jsx(K.div,{variants:w,custom:3,children:e.jsx(Bt,{selectedDate:h,updateMap:t})},"user-locations-section")]}),F("core.updates.view")&&e.jsx(K.div,{variants:w,custom:4,initial:"hidden",animate:"visible",children:e.jsx(Gt,{})},"updates-section")]})})]})}Jt.layout=s=>e.jsx(mt,{children:s});export{Jt as default};
