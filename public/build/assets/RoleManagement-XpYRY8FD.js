import{r,j as s,c as Rr,a as Se,H as kr,e as k,F as Mr,f as Ar,g as Ie,h as Le}from"./app-B8QYX9Px.js";import{f as Er,A as _r,d as Ks,g as Qs,a as Vs,s as as,c as Xs,P as Dr,b as Ys,D as Ls,u as Js,e as ts,B as Ne,T as x,G as Ir}from"./logo-BoX8pchB.js";import{G as cs}from"./GlassDialog-w1fMVGB6.js";import{P as Lr}from"./PageHeader-XJFWVm9P.js";import{S as Tr}from"./StatsCards-DEVVTSBN.js";import{u as Ts,e as Ce,_ as Fs,B as U,y as es,g as ds,c as ee,T as Te,a0 as Fr,A as Or}from"./App-DkF9RL3Y.js";import{F as Pe,a as zr}from"./ShieldCheckIcon-RZqgNGJW.js";import{F as Ur}from"./FunnelIcon-D6AgR1Ej.js";import{h as bs,o as us,j as $r,k as Os,b as ss,G as Zs}from"./Grow-DP1KP2ex.js";import{A as ms}from"./Alert-D_AVVXbH.js";import{F as zs}from"./ExclamationTriangleIcon-BW32ASrn.js";import{F as Br}from"./CogIcon-UnhsJs-F.js";import{T as Gr,a as rs}from"./Tabs-lfX35CRF.js";import{F as hs}from"./AdjustmentsHorizontalIcon-BrcFRj1g.js";import{F as Hr}from"./DocumentArrowDownIcon-JzXafcAn.js";import{T as se}from"./TextField-BAa6JqDO.js";import{s as Re,l as q}from"./chunk-Y2AYO5NJ-DRZIqULh.js";import{F as Us}from"./PlusIcon-BzbZnk-Z.js";import{I as ps}from"./InputAdornment-Cc_eLtv_.js";import{F as $s}from"./PencilSquareIcon-wKCO7LYU.js";import{F as Bs}from"./TrashIcon-DFtGfjbZ.js";import{p as Gs}from"./chunk-XVMALT6H-Dh5JAmN7.js";import{c as Fe}from"./chunk-D5XJWRAV-zQzkTunB.js";import"./create-visual-element-4S4I33NB.js";import"./Dialog-Bo_XotCr.js";import"./EnvelopeIcon-B1M8vjD_.js";import"./UserIcon-D9_80nkG.js";import"./KeyboardArrowRight-Sd5Dh1k-.js";import"./Select-8HD_0XQO.js";import"./InputLabel-CehJzubO.js";import"./useListState-7_qqofvb.js";import"./index-Dxlg9OmP.js";import"./chunk-VAMG3REK-CFukFOAm.js";import"./index-DU2jcyFo.js";import"./NumberFormatter-DNR9MAW-.js";function Hs(o){return o.substring(2).toLowerCase()}function Wr(o,n){return n.documentElement.clientWidth<o.clientX||n.documentElement.clientHeight<o.clientY}function qr(o){const{children:n,disableReactTree:w=!1,mouseEvent:p="onClick",onClickAway:b,touchEvent:y="onTouchEnd"}=o,_=r.useRef(!1),D=r.useRef(null),T=r.useRef(!1),A=r.useRef(!1);r.useEffect(()=>(setTimeout(()=>{T.current=!0},0),()=>{T.current=!1}),[]);const f=Er(_r(n),D),P=bs(R=>{const h=A.current;A.current=!1;const B=us(D.current);if(!T.current||!D.current||"clientX"in R&&Wr(R,B))return;if(_.current){_.current=!1;return}let c;R.composedPath?c=R.composedPath().includes(D.current):c=!B.documentElement.contains(R.target)||D.current.contains(R.target),!c&&(w||!h)&&b(R)}),X=R=>h=>{A.current=!0;const B=n.props[R];B&&B(h)},$={ref:f};return y!==!1&&($[y]=X(y)),r.useEffect(()=>{if(y!==!1){const R=Hs(y),h=us(D.current),B=()=>{_.current=!0};return h.addEventListener(R,P),h.addEventListener("touchmove",B),()=>{h.removeEventListener(R,P),h.removeEventListener("touchmove",B)}}},[P,y]),p!==!1&&($[p]=X(p)),r.useEffect(()=>{if(p!==!1){const R=Hs(p),h=us(D.current);return h.addEventListener(R,P),()=>{h.removeEventListener(R,P)}}},[P,p]),r.cloneElement(n,$)}function Kr(o={}){const{autoHideDuration:n=null,disableWindowBlurListener:w=!1,onClose:p,open:b,resumeHideDuration:y}=o,_=$r();r.useEffect(()=>{if(!b)return;function c(j){j.defaultPrevented||j.key==="Escape"&&(p==null||p(j,"escapeKeyDown"))}return document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}},[b,p]);const D=bs((c,j)=>{p==null||p(c,j)}),T=bs(c=>{!p||c==null||_.start(c,()=>{D(null,"timeout")})});r.useEffect(()=>(b&&T(n),_.clear),[b,n,T,_]);const A=c=>{p==null||p(c,"clickaway")},f=_.clear,P=r.useCallback(()=>{n!=null&&T(y??n*.5)},[n,y,T]),X=c=>j=>{const v=c.onBlur;v==null||v(j),P()},$=c=>j=>{const v=c.onFocus;v==null||v(j),f()},R=c=>j=>{const v=c.onMouseEnter;v==null||v(j),f()},h=c=>j=>{const v=c.onMouseLeave;v==null||v(j),P()};return r.useEffect(()=>{if(!w&&b)return window.addEventListener("focus",P),window.addEventListener("blur",f),()=>{window.removeEventListener("focus",P),window.removeEventListener("blur",f)}},[w,b,P,f]),{getRootProps:(c={})=>{const j={...Os(o),...Os(c)};return{role:"presentation",...c,...j,onBlur:X(j),onFocus:$(j),onMouseEnter:R(j),onMouseLeave:h(j)}},onClickAway:A}}function Qr(o){return Ks("MuiSnackbarContent",o)}Qs("MuiSnackbarContent",["root","message","action"]);const Vr=o=>{const{classes:n}=o;return Xs({root:["root"],action:["action"],message:["message"]},Qr,n)},Xr=as(Dr,{name:"MuiSnackbarContent",slot:"Root"})(Ys(({theme:o})=>{const n=o.palette.mode==="light"?.8:.98;return{...o.typography.body2,color:o.vars?o.vars.palette.SnackbarContent.color:o.palette.getContrastText(Ls(o.palette.background.default,n)),backgroundColor:o.vars?o.vars.palette.SnackbarContent.bg:Ls(o.palette.background.default,n),display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",flexGrow:1,[o.breakpoints.up("sm")]:{flexGrow:"initial",minWidth:288}}})),Yr=as("div",{name:"MuiSnackbarContent",slot:"Message"})({padding:"8px 0"}),Jr=as("div",{name:"MuiSnackbarContent",slot:"Action"})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),Zr=r.forwardRef(function(n,w){const p=Vs({props:n,name:"MuiSnackbarContent"}),{action:b,className:y,message:_,role:D="alert",...T}=p,A=p,f=Vr(A);return s.jsxs(Xr,{role:D,elevation:6,className:Rr(f.root,y),ownerState:A,ref:w,...T,children:[s.jsx(Yr,{className:f.message,ownerState:A,children:_}),b?s.jsx(Jr,{className:f.action,ownerState:A,children:b}):null]})});function et(o){return Ks("MuiSnackbar",o)}Qs("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);const st=o=>{const{classes:n,anchorOrigin:w}=o,p={root:["root",`anchorOrigin${ts(w.vertical)}${ts(w.horizontal)}`]};return Xs(p,et,n)},rt=as("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:(o,n)=>{const{ownerState:w}=o;return[n.root,n[`anchorOrigin${ts(w.anchorOrigin.vertical)}${ts(w.anchorOrigin.horizontal)}`]]}})(Ys(({theme:o})=>({zIndex:(o.vars||o).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center",variants:[{props:({ownerState:n})=>n.anchorOrigin.vertical==="top",style:{top:8,[o.breakpoints.up("sm")]:{top:24}}},{props:({ownerState:n})=>n.anchorOrigin.vertical!=="top",style:{bottom:8,[o.breakpoints.up("sm")]:{bottom:24}}},{props:({ownerState:n})=>n.anchorOrigin.horizontal==="left",style:{justifyContent:"flex-start",[o.breakpoints.up("sm")]:{left:24,right:"auto"}}},{props:({ownerState:n})=>n.anchorOrigin.horizontal==="right",style:{justifyContent:"flex-end",[o.breakpoints.up("sm")]:{right:24,left:"auto"}}},{props:({ownerState:n})=>n.anchorOrigin.horizontal==="center",style:{[o.breakpoints.up("sm")]:{left:"50%",right:"auto",transform:"translateX(-50%)"}}}]}))),Ws=r.forwardRef(function(n,w){const p=Vs({props:n,name:"MuiSnackbar"}),b=Js(),y={enter:b.transitions.duration.enteringScreen,exit:b.transitions.duration.leavingScreen},{action:_,anchorOrigin:{vertical:D,horizontal:T}={vertical:"bottom",horizontal:"left"},autoHideDuration:A=null,children:f,className:P,ClickAwayListenerProps:X,ContentProps:$,disableWindowBlurListener:R=!1,message:h,onBlur:B,onClose:c,onFocus:j,onMouseEnter:v,onMouseLeave:ke,open:K,resumeHideDuration:fs,slots:F={},slotProps:Y={},TransitionComponent:N,transitionDuration:G=y,TransitionProps:{onEnter:J,onExited:E,...os}={},...Oe}=p,re={...p,anchorOrigin:{vertical:D,horizontal:T},autoHideDuration:A,disableWindowBlurListener:R,TransitionComponent:N,transitionDuration:G},ze=st(re),{getRootProps:vs,onClickAway:Ue}=Kr({...re}),[ws,Me]=r.useState(!0),Z=M=>{Me(!0),E&&E(M)},$e=(M,O)=>{Me(!1),J&&J(M,O)},H={slots:{transition:N,...F},slotProps:{content:$,clickAwayListener:X,transition:os,...Y}},[Be,ys]=ss("root",{ref:w,className:[ze.root,P],elementType:rt,getSlotProps:vs,externalForwardedProps:{...H,...Oe},ownerState:re}),[Ge,{ownerState:js,...He}]=ss("clickAwayListener",{elementType:qr,externalForwardedProps:H,getSlotProps:M=>({onClickAway:(...O)=>{var Ae;const z=O[0];(Ae=M.onClickAway)==null||Ae.call(M,...O),!(z!=null&&z.defaultMuiPrevented)&&Ue(...O)}}),ownerState:re}),[ns,te]=ss("content",{elementType:Zr,shouldForwardComponentProp:!0,externalForwardedProps:H,additionalProps:{message:h,action:_},ownerState:re}),[ae,We]=ss("transition",{elementType:Zs,externalForwardedProps:H,getSlotProps:M=>({onEnter:(...O)=>{var z;(z=M.onEnter)==null||z.call(M,...O),$e(...O)},onExited:(...O)=>{var z;(z=M.onExited)==null||z.call(M,...O),Z(...O)}}),additionalProps:{appear:!0,in:K,timeout:G,direction:D==="top"?"down":"up"},ownerState:re});return!K&&ws?null:s.jsx(Ge,{...He,...F.clickAwayListener&&{ownerState:js},children:s.jsx(Be,{...ys,children:s.jsx(ae,{...We,children:f||s.jsx(ns,{...te})})})})}),gs=o=>Array.isArray(o)?[...o]:[],qs=o=>o&&typeof o=="object"&&!Array.isArray(o)?{...o}:{},tt=o=>{const n={roles:gs(o.roles),permissions:gs(o.permissions),role_has_permissions:gs(o.role_has_permissions),permissionsGrouped:qs(o.permissionsGrouped||o.permissions_grouped),enterprise_modules:qs(o.enterprise_modules),errors:[]};if(n.roles.length===0&&n.errors.push("No roles data available"),n.permissions.length===0&&n.errors.push("No permissions data available"),n.roles.length>0&&n.permissions.length>0&&n.role_has_permissions.length===0&&n.errors.push("Role-permission relationships missing - this may indicate a cache or database issue"),n.role_has_permissions.length>0){const w=n.roles.map(y=>y.id),p=n.permissions.map(y=>y.id),b=n.role_has_permissions.filter(y=>!w.includes(y.role_id)||!p.includes(y.permission_id));b.length>0&&n.errors.push(`${b.length} invalid role-permission relationships found`)}return n},xs=(o,n)=>{const[w,p]=r.useState(o);return r.useEffect(()=>{const b=setTimeout(()=>{p(o)},n);return()=>{clearTimeout(b)}},[o,n]),w},S={IDLE:"idle",LOADING:"loading",SUCCESS:"success",ERROR:"error"},at=o=>{const n=r.useMemo(()=>tt(o),[o]),w=n.roles,p=n.permissions,b=n.permissionsGrouped,y=n.role_has_permissions;n.enterprise_modules;const _=!!o.can_manage_super_admin,D=o.title;o.error;const T=n.errors,A=o.users||[],f=r.useRef(null),P=r.useRef(Date.now()),X=Js();Ts(X.breakpoints.down("sm")),Ts(X.breakpoints.down("md"));const[$,R]=r.useState(0),[h,B]=r.useState(w),[c,j]=r.useState(p),[v,ke]=r.useState(y),[K,fs]=r.useState(w.length>0?w[0].id:null),[F,Y]=r.useState(new Set),[N,G]=r.useState(!1),[J,E]=r.useState({permissions:{},modules:{},roles:S.IDLE,users:S.IDLE}),[os,Oe]=r.useState(!1),[re,ze]=r.useState(!1),[vs,Ue]=r.useState(!1),[ws,Me]=r.useState(!1),[Z,$e]=r.useState(null),[H,Be]=r.useState(null),[ys,Ge]=r.useState(null),[js,He]=r.useState(null),[ns,te]=r.useState(!1),[ae,We]=r.useState(null),[M,O]=r.useState(null),[z,Ae]=r.useState(""),[qe,Ss]=r.useState(""),[Ke,Ns]=r.useState(""),[be,Cs]=r.useState("all"),[ie,Ps]=r.useState("all"),[Ee,Rs]=r.useState("all"),Qe=xs(z,300),Ve=xs(qe,300),Xe=xs(Ke,300),[fe,Ye]=r.useState(0),[ve,Je]=r.useState(0),[we,Ze]=r.useState(0),[le,ot]=r.useState(10),[ce,nt]=r.useState(10),[de,it]=r.useState(10),[ks,I]=r.useState(""),[Ms,ue]=r.useState(""),[oe,ye]=r.useState({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0}),[Q,me]=r.useState({name:"",display_name:"",description:"",module:"",guard_name:"web"}),[V,W]=r.useState({}),[lt,As]=r.useState(new Set),[ct,Es]=r.useState(new Set),[dt,ut]=r.useState(!1),m=r.useMemo(()=>h.find(e=>e.id===K)||null,[h,K]),he=r.useCallback(e=>{if(Array.isArray(v)){const t=v.filter(a=>a&&a.role_id===e).map(a=>a.permission_id).filter(Boolean);if(t.length>0)return t}if(Array.isArray(h)){const t=h.find(a=>a&&a.id===e);if(t&&Array.isArray(t.permissions))return t.permissions.map(a=>a.id).filter(Boolean)}return[]},[v,h]);r.useEffect(()=>{if(K){const e=he(K),t=new Set(e);(t.size!==F.size||[...t].some(a=>!F.has(a)))&&Y(t)}else F.size>0&&Y(new Set)},[K,v,h,he]),r.useMemo(()=>m,[m==null?void 0:m.id,m==null?void 0:m.name]),r.useMemo(()=>_,[_]);const pe=r.useMemo(()=>({totalRoles:Array.isArray(h)?h.length:0,totalPermissions:Array.isArray(c)?c.length:0,activeRole:(m==null?void 0:m.name)||"None Selected",grantedPermissions:F.size}),[h,c,m,F]);r.useMemo(()=>[{title:"Total Roles",value:pe.totalRoles,icon:s.jsx(Ce,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:pe.totalPermissions,icon:s.jsx(Pe,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Role",value:pe.activeRole==="None Selected"?"None":pe.activeRole,icon:s.jsx(Fs,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"Currently selected",customStyle:pe.activeRole==="None Selected"?{fontSize:"1rem"}:{}},{title:"Granted",value:pe.grantedPermissions,icon:s.jsx(Ur,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Active permissions"}],[pe]);const ge=r.useMemo(()=>h.filter(e=>{const t=Qe===""||e.name.toLowerCase().includes(Qe.toLowerCase())||e.description&&e.description.toLowerCase().includes(Qe.toLowerCase()),a=be==="all"||be==="active"&&e.is_active!==!1||be==="inactive"&&e.is_active===!1;return t&&a}),[h,Qe,be]),xe=r.useMemo(()=>c.filter(e=>{const t=Ve===""||e.name&&e.name.toLowerCase().includes(Ve.toLowerCase())||e.display_name&&e.display_name.toLowerCase().includes(Ve.toLowerCase()),a=ie==="all"||e.module===ie||e.name&&e.name.startsWith(ie);return t&&a}),[c,Ve,ie]),je=r.useMemo(()=>A.filter(e=>{var i,l;const t=Xe===""||((i=e.name)==null?void 0:i.toLowerCase().includes(Xe.toLowerCase()))||((l=e.email)==null?void 0:l.toLowerCase().includes(Xe.toLowerCase())),a=Ee==="all"||e.roles&&e.roles.some(d=>d.name===Ee);return t&&a}),[A,Xe,Ee]),er=r.useMemo(()=>{const e=fe*le;return ge.slice(e,e+le)},[ge,fe,le]),sr=r.useMemo(()=>{const e=ve*ce;return xe.slice(e,e+ce)},[xe,ve,ce]),rr=r.useMemo(()=>{const e=we*de;return je.slice(e,e+de)},[je,we,de]),_e=r.useMemo(()=>{const e=new Set;return c.forEach(t=>{t.module?e.add(t.module):t.name&&t.name.includes(".")&&e.add(t.name.split(".")[0])}),Array.from(e).sort()},[c]),tr=r.useMemo(()=>h.map(e=>e.name).sort(),[h]),ne=r.useCallback((e,t)=>{if(Array.isArray(v)&&Array.isArray(c)){const a=v.filter(l=>l&&l.role_id===e),i=c.find(l=>l&&l.name===t);if(i&&a.some(l=>l.permission_id===i.id))return!0}if(Array.isArray(h)){const a=h.find(i=>i&&i.id===e);if(a&&Array.isArray(a.permissions))return a.permissions.some(i=>i&&i.name===t)}if(m&&m.id===e&&F.size>0){const a=c.find(i=>i&&i.name===t);if(a)return F.has(a.id)}return!1},[v,c,h,m,F]);r.useCallback(e=>!m||!b[e]?!1:b[e].permissions.every(a=>ne(m.id,a.name)),[m,b,ne]),r.useCallback(e=>!m||!b[e]?!1:b[e].permissions.some(a=>ne(m.id,a.name)),[m,b,ne]);const _s=e=>e.name==="Super Administrator"?_:!0,ar=r.useCallback(e=>{try{fs(e);const t=he(e);Y(new Set(t)),I("")}catch(t){console.error("Error selecting role:",t),I("Failed to select role. Please try again.")}},[he]),or=r.useCallback(e=>{Ae(e),Ye(0)},[]),nr=r.useCallback(e=>{Ss(e),Je(0)},[]),ir=r.useCallback(e=>{Ns(e),Ze(0)},[]),lr=r.useCallback(e=>{Cs(e),Ye(0)},[]),cr=r.useCallback(e=>{Ps(e),Je(0)},[]),dr=r.useCallback(e=>{Rs(e),Ze(0)},[]),Ds=r.useCallback((e=null)=>{$e(e),ye({name:(e==null?void 0:e.name)||"",description:(e==null?void 0:e.description)||"",permissions:(e==null?void 0:e.permissions)||[],hierarchy_level:(e==null?void 0:e.hierarchy_level)||10,is_active:(e==null?void 0:e.is_active)??!0}),Oe(!0),W({}),I("")},[]),is=r.useCallback(()=>{Oe(!1),$e(null),W({}),I(""),ye({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0})},[]),Is=r.useCallback((e=null)=>{Be(e),me({name:(e==null?void 0:e.name)||"",display_name:(e==null?void 0:e.display_name)||"",description:(e==null?void 0:e.description)||"",module:(e==null?void 0:e.module)||_e[0]||"users",guard_name:(e==null?void 0:e.guard_name)||"web"}),ze(!0),W({}),I("")},[_e]),ls=r.useCallback(()=>{ze(!1),Be(null),W({}),I(""),me({name:"",display_name:"",description:"",module:"",guard_name:"web"})},[]);r.useCallback(e=>{Ge(e),Ue(!0);const t=he(e.id);Es(new Set(t))},[he]),r.useCallback(()=>{Ue(!1),Ge(null),Es(new Set)},[]);const ur=r.useCallback(e=>{He(e),Me(!0);const t=e.roles?new Set(e.roles.map(a=>a.id)):new Set;As(t)},[]);r.useCallback(()=>{Me(!1),He(null),As(new Set)},[]);const mr=r.useCallback(e=>{We(e),te(!0)},[]),hr=r.useCallback(e=>{O(e),te(!0)},[]),pr=async()=>{var e,t;if(ae){G(!0);try{await Se.delete(`/api/roles/${ae.id}`),U.success("Role deleted successfully"),ue("Role deleted successfully"),te(!1),We(null),P.current=Date.now()}catch(a){console.error("Error deleting role:",a);const i=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to delete role";U.error(i),I(i)}finally{G(!1)}}},gr=async()=>{var e,t;if(M){G(!0);try{await Se.delete(`/api/permissions/${M.id}`),U.success("Permission deleted successfully"),ue("Permission deleted successfully"),te(!1),O(null),P.current=Date.now()}catch(a){console.error("Error deleting permission:",a);const i=((t=(e=a.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to delete permission";U.error(i),I(i)}finally{G(!1)}}},xr=async()=>{var t,a,i;W({}),I("");const e={};if(oe.name.trim()||(e.name="Role name is required"),oe.name.length>255&&(e.name="Role name must be less than 255 characters"),oe.description&&oe.description.length>500&&(e.description="Description must be less than 500 characters"),Object.keys(e).length>0){W(e);return}G(!0),E(l=>({...l,roles:S.LOADING}));try{const l=Z?`/api/roles/${Z.id}`:"/api/roles",g=await Se[Z?"put":"post"](l,oe);(g.status===200||g.status===201)&&(Z?(B(u=>u.map(C=>C.id===Z.id?g.data.role:C)),U.success("Role updated successfully"),ue("Role updated successfully")):(B(u=>[...u,g.data.role]),U.success("Role created successfully"),ue("Role created successfully")),is(),E(u=>({...u,roles:S.SUCCESS})),setTimeout(()=>{E(u=>({...u,roles:S.IDLE})),ue("")},3e3),P.current=Date.now())}catch(l){if(console.error("Error saving role:",l),E(d=>({...d,roles:S.ERROR})),((t=l.response)==null?void 0:t.status)===422&&l.response.data.errors)W(l.response.data.errors);else{const d=((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save role";U.error(d),I(d)}setTimeout(()=>{E(d=>({...d,roles:S.IDLE}))},3e3)}finally{G(!1)}},br=async()=>{var t,a,i;W({}),I("");const e={};if(Q.name.trim()||(e.name="Permission name is required"),Q.display_name.trim()||(e.display_name="Display name is required"),Q.module.trim()||(e.module="Module is required"),Object.keys(e).length>0){W(e);return}G(!0);try{const l=H?`/api/permissions/${H.id}`:"/api/permissions",g=await Se[H?"put":"post"](l,Q);(g.status===200||g.status===201)&&(H?(j(u=>u.map(C=>C.id===H.id?g.data.permission:C)),U.success("Permission updated successfully")):(j(u=>[...u,g.data.permission]),U.success("Permission created successfully")),ls(),P.current=Date.now())}catch(l){if(console.error("Error saving permission:",l),((t=l.response)==null?void 0:t.status)===422&&l.response.data.errors)W(l.response.data.errors);else{const d=((i=(a=l.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save permission";U.error(d),I(d)}}finally{G(!1)}},fr=r.useCallback(async e=>{var t,a,i,l;if(!(!m||N)){f.current&&f.current.abort(),f.current=new AbortController,E(d=>({...d,permissions:{...d.permissions,[e]:S.LOADING}}));try{const d=ne(m.id,e),g=d?"revoke":"grant",u=await Se.post("/admin/roles/update-permission",{role_id:m.id,permission:e,action:g},{signal:f.current.signal});if(u.status===200){if(u.data.role_has_permissions){ke(u.data.role_has_permissions);const C=u.data.role_has_permissions.filter(L=>L.role_id===m.id).map(L=>L.permission_id);Y(new Set(C))}else{const C=c.find(L=>L.name===e);C&&(d?(ke(L=>L.filter(De=>!(De.role_id===m.id&&De.permission_id===C.id))),Y(L=>{const De=new Set(L);return De.delete(C.id),De})):(ke(L=>[...L,{role_id:m.id,permission_id:C.id}]),Y(L=>new Set([...L,C.id]))))}E(C=>({...C,permissions:{...C.permissions,[e]:S.SUCCESS}})),setTimeout(()=>{E(C=>({...C,permissions:{...C.permissions,[e]:S.IDLE}}))},2e3),U.success(`Permission ${g}ed successfully`),P.current=Date.now()}}catch(d){d.name!=="AbortError"&&(console.error("Error updating permission:",d),E(g=>({...g,permissions:{...g.permissions,[e]:S.ERROR}})),setTimeout(()=>{E(g=>({...g,permissions:{...g.permissions,[e]:S.IDLE}}))},3e3),U.error(((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update permission"),I(((l=(i=d.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to update permission"))}finally{G(!1)}}},[m,N,ne,c]),vr=r.useCallback(async e=>{var t,a,i,l;if(!(!m||N)){f.current&&f.current.abort(),f.current=new AbortController,E(d=>({...d,modules:{...d.modules,[e]:S.LOADING}}));try{const d=await Se.post("/admin/roles/update-module",{roleId:m.id,module:e,action:"toggle"},{signal:f.current.signal});if(d.status===200){ke(d.data.role_has_permissions);const g=d.data.role_has_permissions.filter(u=>u.role_id===m.id).map(u=>u.permission_id);Y(new Set(g)),E(u=>({...u,modules:{...u.modules,[e]:S.SUCCESS}})),setTimeout(()=>{E(u=>({...u,modules:{...u.modules,[e]:S.IDLE}}))},2e3),U.success("Module permissions updated successfully"),P.current=Date.now()}}catch(d){d.name!=="AbortError"&&(console.error("Error updating module permissions:",d),E(g=>({...g,modules:{...g.modules,[e]:S.ERROR}})),setTimeout(()=>{E(g=>({...g,modules:{...g.modules,[e]:S.IDLE}}))},3e3),U.error(((a=(t=d.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to update module permissions"),I(((l=(i=d.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to update module permissions"))}}},[m,N]);r.useCallback((e,t)=>{ye(a=>({...a,[e]:t})),V[e]&&W(a=>({...a,[e]:void 0}))},[V]),r.useEffect(()=>()=>{f.current&&f.current.abort()},[]),r.useEffect(()=>{const e=t=>{if(t.key==="/"&&!t.ctrlKey&&!t.metaKey&&!t.altKey){const a=t.target;if(a.tagName!=="INPUT"&&a.tagName!=="TEXTAREA"&&!a.isContentEditable){t.preventDefault();const i=document.querySelector('input[placeholder*="Search"]');i&&i.focus()}}if(t.key==="Escape"&&(z||qe||Ke||ie!=="all")&&(Ae(""),Ss(""),Ns(""),Ps("all"),Cs("all"),Rs("all")),(t.ctrlKey||t.metaKey)&&t.key==="k"){t.preventDefault();const a=document.querySelector('input[placeholder*="Search"]');a&&a.focus()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[z,qe,Ke,ie,be,Ee]);const wr=r.useCallback(e=>J.permissions[e]||S.IDLE,[J.permissions]),yr=r.useCallback(e=>J.modules[e]||S.IDLE,[J.modules]),jr=()=>s.jsxs(Ie,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s.jsxs(Fe,{className:"p-4 border-b border-white/10",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[s.jsxs(x,{variant:"h6",className:"flex items-center gap-2",children:[s.jsx(Ce,{className:"w-5 h-5"}),"Roles Management"]}),s.jsx(k,{onPress:()=>Ds(),startContent:s.jsx(Us,{className:"w-4 h-4"}),className:"bg-linear-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 border border-blue-400/30 text-white",variant:"bordered",children:"Add Role"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s.jsx(se,{label:"Search Roles",variant:"outlined",placeholder:"Search by role name...",value:z,onChange:e=>or(e.target.value),fullWidth:!0,size:"medium",InputProps:{startAdornment:s.jsx(ps,{position:"start",children:s.jsx(ds,{className:"w-4 h-4"})}),style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{flex:1,"& .MuiInputBase-input":{backgroundColor:"transparent",color:"white"},"& .MuiOutlinedInput-root:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)"}}}),s.jsxs(Re,{label:"Status Filter",variant:"bordered",selectedKeys:[be],onSelectionChange:e=>lr(Array.from(e)[0]),className:"min-w-[140px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s.jsx(q,{value:"all",children:"All Status"},"all"),s.jsx(q,{value:"active",children:"Active"},"active"),s.jsx(q,{value:"inactive",children:"Inactive"},"inactive")]})]})]}),s.jsxs(Le,{className:"p-0",children:[s.jsx("div",{className:"divide-y divide-white/10",children:er.map(e=>{const t=he(e.id),a=t.map(i=>{var l;return(l=c.find(d=>d.id===i))==null?void 0:l.name}).filter(Boolean).slice(0,3);return s.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:e.name.charAt(0).toUpperCase()}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{variant:"body1",className:"font-medium",children:e.name}),e.name==="Super Administrator"&&s.jsx(ee,{size:"sm",color:"warning",variant:"flat",children:"System"}),s.jsx(ee,{size:"sm",color:e.is_active!==!1?"success":"default",variant:"flat",children:e.is_active!==!1?"Active":"Inactive"})]}),e.description&&s.jsx(x,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.description}),s.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[a.map((i,l)=>s.jsx(ee,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:i},l)),t.length>3&&s.jsxs(ee,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",t.length-3," more"]})]})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(Te,{content:"Edit Role",children:s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Ds(e),isDisabled:!_s(e),className:"text-blue-400 hover:text-blue-300",children:s.jsx($s,{className:"w-4 h-4"})})}),s.jsx(Te,{content:"Delete Role",children:s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>mr(e),isDisabled:!_s(e),className:"text-red-400 hover:text-red-300",children:s.jsx(Bs,{className:"w-4 h-4"})})})]})]})},e.id)})}),ge.length===0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Ce,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s.jsx(x,{variant:"body1",color:"textSecondary",children:"No roles found matching your criteria"})]}),ge.length>le&&s.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[s.jsxs(x,{variant:"body2",color:"textSecondary",children:["Showing ",fe*le+1," to ",Math.min((fe+1)*le,ge.length)," of ",ge.length," roles"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:fe===0,onPress:()=>Ye(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(fe+1)*le>=ge.length,onPress:()=>Ye(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),Sr=()=>s.jsxs(Ie,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s.jsxs(Fe,{className:"p-4 border-b border-white/10",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[s.jsxs(x,{variant:"h6",className:"flex items-center gap-2",children:[s.jsx(Pe,{className:"w-5 h-5"}),"Permissions Management"]}),s.jsx(k,{onPress:()=>Is(),startContent:s.jsx(Us,{className:"w-4 h-4"}),className:"bg-linear-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 border border-green-400/30 text-white",variant:"bordered",children:"Add Permission"})]}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s.jsx(se,{label:"Search Permissions",variant:"outlined",placeholder:"Search by permission name...",value:qe,onChange:e=>nr(e.target.value),fullWidth:!0,size:"medium",InputProps:{startAdornment:s.jsx(ps,{position:"start",children:s.jsx(ds,{className:"w-4 h-4"})}),style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{flex:1,"& .MuiInputBase-input":{backgroundColor:"transparent",color:"white"},"& .MuiOutlinedInput-root:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)"}}}),s.jsxs(Re,{label:"Module Filter",variant:"bordered",selectedKeys:[ie],onSelectionChange:e=>cr(Array.from(e)[0]),className:"min-w-[180px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s.jsx(q,{value:"all",children:"All Modules"},"all"),_e.map(e=>s.jsx(q,{value:e,children:e},e))]})]})]}),s.jsxs(Le,{className:"p-0",children:[s.jsx("div",{className:"divide-y divide-white/10",children:sr.map(e=>s.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold",children:e.name?e.name.charAt(0).toUpperCase():"P"}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(x,{variant:"body1",className:"font-medium",children:e.display_name||e.name}),s.jsx(ee,{size:"sm",color:"secondary",variant:"flat",children:e.module||(e.name?e.name.split(".")[0]:"General")})]}),s.jsx(x,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.name}),e.description&&s.jsx(x,{variant:"body2",color:"textSecondary",className:"mt-1 max-w-md",children:e.description})]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(Te,{content:"Edit Permission",children:s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Is(e),className:"text-blue-400 hover:text-blue-300",children:s.jsx($s,{className:"w-4 h-4"})})}),s.jsx(Te,{content:"Delete Permission",children:s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>hr(e),className:"text-red-400 hover:text-red-300",children:s.jsx(Bs,{className:"w-4 h-4"})})})]})]})},e.id))}),xe.length===0&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(Pe,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s.jsx(x,{variant:"body1",color:"textSecondary",children:"No permissions found matching your criteria"})]}),xe.length>ce&&s.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[s.jsxs(x,{variant:"body2",color:"textSecondary",children:["Showing ",ve*ce+1," to ",Math.min((ve+1)*ce,xe.length)," of ",xe.length," permissions"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:ve===0,onPress:()=>Je(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(ve+1)*ce>=xe.length,onPress:()=>Je(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),Nr=()=>s.jsxs(Ie,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s.jsx(Fe,{className:"p-4 border-b border-white/10",children:s.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[s.jsxs(x,{variant:"h6",className:"flex items-center gap-2",children:[s.jsx(hs,{className:"w-5 h-5"}),"Role-Permission Assignment"]}),s.jsx(Re,{label:"Select Role to Manage",variant:"bordered",selectedKeys:K?[K.toString()]:[],onSelectionChange:e=>{const t=Array.from(e)[0];t&&ar(parseInt(t))},className:"max-w-md",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:h.map(e=>s.jsx(q,{value:e.id.toString(),children:e.name},e.id.toString()))})]})}),s.jsx(Le,{className:"p-4",children:m?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[s.jsxs("div",{children:[s.jsxs(x,{variant:"body1",className:"font-medium",children:["Managing permissions for: ",m.name]}),s.jsxs(x,{variant:"body2",color:"textSecondary",children:[F.size," of ",c.length," permissions granted"]})]}),s.jsx(Gs,{value:F.size/c.length*100,size:"sm",color:"primary",className:"w-32","aria-label":`${Math.round(F.size/c.length*100)}% permissions granted`})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(b).map(([e,t])=>{const a=t.permissions||[],i=a.filter(u=>ne(m.id,u.name)).length,l=a.length,d=i===l,g=i>0&&i<l;return s.jsxs(Ie,{className:"bg-white/5 border-white/10",children:[s.jsxs(Fe,{className:"pb-2",children:[s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsx(x,{variant:"body1",className:"font-medium capitalize",children:e}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(ee,{size:"sm",variant:"flat",color:d?"success":g?"warning":"default",children:[i,"/",l]}),s.jsx(k,{size:"sm",variant:"light",onPress:()=>vr(e),isLoading:yr(e)===S.LOADING,className:"text-xs",children:d?"Revoke All":"Grant All"})]})]}),s.jsx(Gs,{value:i/l*100,size:"sm",color:d?"success":g?"warning":"default","aria-label":`${i} of ${l} permissions granted for ${e} module`})]}),s.jsx(Le,{className:"pt-0",children:s.jsx("div",{className:"space-y-2",children:a.map(u=>{const C=ne(m.id,u.name),L=wr(u.name);return s.jsxs("div",{className:"flex items-center justify-between p-2 rounded-sm bg-white/5 hover:bg-white/10 transition-colors",children:[s.jsxs("div",{children:[s.jsx(x,{variant:"body2",className:"font-medium",children:u.display_name||u.name}),s.jsx(x,{variant:"caption",color:"textSecondary",children:u.name})]}),s.jsx(Fr,{size:"sm",isSelected:C,onValueChange:()=>fr(u.name),isDisabled:L===S.LOADING,color:"success","aria-label":`Toggle ${u.display_name||u.name} permission`},`${u.id}-${C}-${L}`)]},u.id)})})})]},e)})})]}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(hs,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s.jsx(x,{variant:"body1",color:"textSecondary",className:"mb-2",children:"Select a role to manage permissions"}),s.jsx(x,{variant:"body2",color:"textSecondary",children:"Choose a role from the dropdown above to assign or revoke permissions"})]})})]}),Cr=()=>s.jsxs(Ie,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s.jsxs(Fe,{className:"p-4 border-b border-white/10",children:[s.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:s.jsxs(x,{variant:"h6",className:"flex items-center gap-2",children:[s.jsx(es,{className:"w-5 h-5"}),"User-Role Assignment"]})}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s.jsx(se,{label:"Search Users",variant:"outlined",placeholder:"Search by user name or email...",value:Ke,onChange:e=>ir(e.target.value),fullWidth:!0,size:"medium",InputProps:{startAdornment:s.jsx(ps,{position:"start",children:s.jsx(ds,{className:"w-4 h-4"})}),style:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{flex:1,"& .MuiInputBase-input":{backgroundColor:"transparent",color:"white"},"& .MuiOutlinedInput-root:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)"}}}),s.jsxs(Re,{label:"Filter by Role",variant:"bordered",selectedKeys:[Ee],onSelectionChange:e=>dr(Array.from(e)[0]),className:"min-w-[160px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s.jsx(q,{value:"all",children:"All Roles"},"all"),tr.map(e=>s.jsx(q,{value:e,children:e},e))]})]})]}),s.jsxs(Le,{className:"p-0",children:[A&&A.length>0?s.jsx("div",{className:"divide-y divide-white/10",children:rr.map(e=>{var t;return s.jsx("div",{className:"p-4 hover:bg-white/5 transition-colors",children:s.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-linear-to-r from-orange-500 to-red-500 flex items-center justify-center text-white font-bold",children:((t=e.name)==null?void 0:t.charAt(0).toUpperCase())||"U"}),s.jsxs("div",{children:[s.jsx(x,{variant:"body1",className:"font-medium",children:e.name||"Unknown User"}),s.jsx(x,{variant:"body2",color:"textSecondary",children:e.email||"No email"}),s.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:e.roles&&e.roles.length>0?s.jsxs(s.Fragment,{children:[e.roles.slice(0,3).map((a,i)=>s.jsx(ee,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:a.name},i)),e.roles.length>3&&s.jsxs(ee,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",e.roles.length-3," more"]})]}):s.jsx(ee,{size:"sm",variant:"flat",color:"default",className:"text-xs",children:"No roles assigned"})})]})]}),s.jsx("div",{className:"flex gap-2",children:s.jsx(Te,{content:"Assign Roles",children:s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>ur(e),className:"text-orange-400 hover:text-orange-300",children:s.jsx(Fs,{className:"w-4 h-4"})})})})]})},e.id)})}):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(es,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s.jsx(x,{variant:"body1",children:"No users found"}),s.jsx(x,{variant:"body2",children:"Users data is not available. Please ensure users are loaded from the backend."})]}),je.length>de&&s.jsxs("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[s.jsxs(x,{variant:"body2",children:["Showing ",we*de+1," to ",Math.min((we+1)*de,je.length)," of ",je.length," users"]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:we===0,onPress:()=>Ze(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s.jsx(k,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(we+1)*de>=je.length,onPress:()=>Ze(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),Pr=()=>s.jsxs(s.Fragment,{children:[s.jsxs(cs,{open:os,onClose:N?void 0:is,maxWidth:"md",title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Ce,{className:"w-6 h-6"}),Z?"Edit Role":"Create New Role",J.roles===S.LOADING&&s.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),actions:s.jsxs("div",{className:"flex gap-3",children:[s.jsx(k,{variant:"light",onPress:is,isDisabled:N,children:"Cancel"}),s.jsx(k,{color:"primary",onPress:xr,isLoading:N,children:Z?"Update Role":"Create Role"})]}),children:[J.roles===S.ERROR&&s.jsx("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:s.jsx("p",{className:"text-danger text-sm",children:"Failed to save role. Please check the form and try again."})}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"Role Name",placeholder:"Enter role name",value:oe.name,onChange:e=>ye(t=>({...t,name:e.target.value})),error:!!V.name,helperText:V.name||"Unique identifier for the role",required:!0,disabled:N,variant:"outlined",fullWidth:!0,size:"medium",InputProps:{style:{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{"& .MuiInputBase-input":{color:"white","&::placeholder":{color:"rgba(255, 255, 255, 0.5)"}},"& .MuiOutlinedInput-root:hover":{borderColor:"rgba(255, 255, 255, 0.3)"},"& .MuiOutlinedInput-root.Mui-focused":{borderColor:"rgba(59, 130, 246, 0.5)"},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.5)"}}})}),s.jsx("div",{className:"col-span-1",children:s.jsxs(Re,{label:"Guard Name",placeholder:"Select guard",selectedKeys:[oe.guard_name],onSelectionChange:e=>{const t=Array.from(e)[0];ye(a=>({...a,guard_name:t}))},isDisabled:N,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:[s.jsx(q,{value:"web",children:"Web"},"web"),s.jsx(q,{value:"api",children:"API"},"api")]})}),s.jsx("div",{className:"col-span-2",children:s.jsx(se,{label:"Description",placeholder:"Optional description of role responsibilities",value:oe.description,onChange:e=>ye(t=>({...t,description:e.target.value})),disabled:N,variant:"outlined",fullWidth:!0,multiline:!0,rows:2,size:"medium",InputProps:{style:{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{"& .MuiInputBase-input":{color:"white","&::placeholder":{color:"rgba(255, 255, 255, 0.5)"}},"& .MuiOutlinedInput-root:hover":{borderColor:"rgba(255, 255, 255, 0.3)"},"& .MuiOutlinedInput-root.Mui-focused":{borderColor:"rgba(59, 130, 246, 0.5)"}}})})]})]}),s.jsx(cs,{open:re,onClose:N?void 0:ls,maxWidth:"md",title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Pe,{className:"w-6 h-6"}),H?"Edit Permission":"Create New Permission"]}),actions:s.jsxs("div",{className:"flex gap-3",children:[s.jsx(k,{variant:"light",onPress:ls,isDisabled:N,children:"Cancel"}),s.jsx(k,{color:"success",onPress:br,isLoading:N,children:H?"Update Permission":"Create Permission"})]}),children:s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"Permission Name",placeholder:"e.g., users.create",value:Q.name,onChange:e=>me(t=>({...t,name:e.target.value})),error:!!V.name,helperText:V.name||"Use format: module.action (e.g., users.create)",required:!0,disabled:N,variant:"outlined",fullWidth:!0,size:"medium",InputProps:{style:{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{"& .MuiInputBase-input":{color:"white","&::placeholder":{color:"rgba(255, 255, 255, 0.5)"}},"& .MuiOutlinedInput-root:hover":{borderColor:"rgba(255, 255, 255, 0.3)"},"& .MuiOutlinedInput-root.Mui-focused":{borderColor:"rgba(59, 130, 246, 0.5)"},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.5)"}}})}),s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"Display Name",placeholder:"Human-readable name",value:Q.display_name,onChange:e=>me(t=>({...t,display_name:e.target.value})),error:!!V.display_name,helperText:V.display_name||"Human-readable name",required:!0,disabled:N,variant:"outlined",fullWidth:!0,size:"medium",InputProps:{style:{backgroundColor:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",color:"white"}},InputLabelProps:{style:{color:"rgba(255, 255, 255, 0.7)"}},sx:{"& .MuiInputBase-input":{color:"white","&::placeholder":{color:"rgba(255, 255, 255, 0.5)"}},"& .MuiOutlinedInput-root:hover":{borderColor:"rgba(255, 255, 255, 0.3)"},"& .MuiOutlinedInput-root.Mui-focused":{borderColor:"rgba(59, 130, 246, 0.5)"},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.5)"}}})}),s.jsx("div",{className:"col-span-1",children:s.jsx(Re,{label:"Module",placeholder:"Select module",selectedKeys:Q.module?[Q.module]:[],onSelectionChange:e=>{const t=Array.from(e)[0];me(a=>({...a,module:t}))},isInvalid:!!V.module,errorMessage:V.module,isDisabled:N,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:_e.map(e=>s.jsx(q,{value:e,children:e},e))})}),s.jsx("div",{className:"col-span-1",children:s.jsx(se,{label:"Guard Name",placeholder:"Usually 'web'",value:Q.guard_name,onChange:e=>me(t=>({...t,guard_name:e.target.value})),helperText:"Usually 'web' for web permissions",disabled:N,fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:"12px",color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"var(--primary-color)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-focused":{color:"var(--primary-color)"}},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.5)"}}})}),s.jsx("div",{className:"col-span-2",children:s.jsx(se,{label:"Description",placeholder:"Optional description of what this permission allows",value:Q.description,onChange:e=>me(t=>({...t,description:e.target.value})),helperText:"Optional description of what this permission allows",disabled:N,fullWidth:!0,size:"small",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.05)",backdropFilter:"blur(10px)",borderRadius:"12px",color:"white","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"var(--primary-color)"},"& input::placeholder":{color:"rgba(255, 255, 255, 0.5)",opacity:1}},"& .MuiInputLabel-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-focused":{color:"var(--primary-color)"}},"& .MuiFormHelperText-root":{color:"rgba(255, 255, 255, 0.5)"}}})})]})}),s.jsx(cs,{open:ns,onClose:()=>te(!1),maxWidth:"sm",title:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(zs,{className:"w-6 h-6 text-danger"}),"Confirm Delete"]}),actions:s.jsxs("div",{className:"flex gap-3",children:[s.jsx(k,{variant:"light",onPress:()=>te(!1),children:"Cancel"}),s.jsxs(k,{color:"danger",onPress:ae?pr:gr,isLoading:N,children:["Delete ",ae?"Role":"Permission"]})]}),children:s.jsxs("p",{className:"text-white/90",children:["Are you sure you want to delete ",ae?`the role "${ae.name}"`:M?`the permission "${M.name}"`:"this item","? This action cannot be undone."]})})]});return s.jsxs(s.Fragment,{children:[s.jsx(kr,{title:D}),s.jsx(Ws,{open:!!Ms,autoHideDuration:3e3,onClose:()=>ue(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s.jsx(ms,{severity:"success",variant:"filled",onClose:()=>ue(""),children:Ms})}),s.jsx(Ws,{open:!!ks,autoHideDuration:5e3,onClose:()=>I(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s.jsx(ms,{severity:"error",variant:"filled",onClose:()=>I(""),children:ks})}),T.length>0&&s.jsx(Ne,{sx:{mb:2},children:s.jsx(ms,{severity:"warning",variant:"outlined",icon:s.jsx(zs,{className:"w-5 h-5"}),action:s.jsx(k,{color:"warning",size:"small",onClick:()=>{Ar.reload({only:["roles","permissions","users"]})},startContent:s.jsx(Mr,{className:"w-4 h-4"}),children:"Refresh Data"}),children:s.jsxs(Ne,{children:[s.jsx(x,{variant:"subtitle2",sx:{mb:1},children:"Data Integrity Issues Detected"}),s.jsx(Ne,{component:"ul",sx:{m:0,pl:2},children:T.map((e,t)=>s.jsx(x,{component:"li",variant:"body2",sx:{mb:.5},children:e},t))}),s.jsx(x,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"This may indicate a cache or database synchronization issue on the server."})]})})}),s.jsx(Ne,{sx:{display:"flex",justifyContent:"center",p:2},children:s.jsx(Zs,{in:!0,children:s.jsx(Ir,{children:s.jsx(Lr,{title:"Role & Permission Management",subtitle:"Comprehensive access control and permission management system",icon:s.jsx(zr,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Export Data",icon:s.jsx(Hr,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-success-rgb),0.3)] bg-[rgba(var(--theme-success-rgb),0.05)] hover:bg-[rgba(var(--theme-success-rgb),0.1)]"}],children:s.jsxs("div",{className:"p-6",children:[s.jsx(Tr,{stats:[{title:"Total Roles",value:h.length,icon:s.jsx(Ce,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:c.length,icon:s.jsx(Pe,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Users",value:A.length,icon:s.jsx(es,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"System users"},{title:"Modules",value:_e.length,icon:s.jsx(Br,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Permission modules"}]}),s.jsxs(Ne,{sx:{width:"100%",mt:4},children:[s.jsx(Ne,{sx:{borderBottom:1,borderColor:"divider"},children:s.jsxs(Gr,{value:$,onChange:(e,t)=>R(t),"aria-label":"role management tabs",sx:{"& .MuiTab-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-selected":{color:"#3b82f6"}},"& .MuiTabs-indicator":{backgroundColor:"#3b82f6"}},children:[s.jsx(rs,{label:"Roles Management",icon:s.jsx(Ce,{className:"w-5 h-5"}),iconPosition:"start"}),s.jsx(rs,{label:"Permissions Management",icon:s.jsx(Pe,{className:"w-5 h-5"}),iconPosition:"start"}),s.jsx(rs,{label:"Role-Permission Assignment",icon:s.jsx(hs,{className:"w-5 h-5"}),iconPosition:"start"}),s.jsx(rs,{label:"User-Role Assignment",icon:s.jsx(es,{className:"w-5 h-5"}),iconPosition:"start"})]})}),$===0&&s.jsx(jr,{}),$===1&&s.jsx(Sr,{}),$===2&&s.jsx(Nr,{}),$===3&&s.jsx(Cr,{})]})]})})})})}),Pr()]})};at.layout=o=>s.jsx(Or,{children:o});export{at as default};
