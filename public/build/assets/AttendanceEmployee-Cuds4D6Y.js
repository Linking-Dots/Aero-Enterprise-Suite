import{J as H,r as s,e as Q,j as e,a as W,R as X,Q as Z,d as z}from"./app-CXVy-AmZ.js";import{p as V,n as $,A as ee}from"./Dashboard-T69k2ogy.js";import{S as te}from"./StatsCards-CjFqSzN1.js";import{d as m}from"./dayjs.min-DU2q2q_C.js";import{F as c}from"./ClockIcon-BZdFQI9v.js";import{F as C}from"./ExclamationTriangleIcon-BatQCU_y.js";import{c as p,t as se,a as ae,b as re}from"./chunk-F3UDT23P-XfTYxSwz.js";import{a as ne}from"./chunk-Y2AYO5NJ-Di_MG5Co.js";import{s as le}from"./chunk-TLYTI3QM-BSLAf0Ky.js";import{t as oe,a as ie}from"./chunk-YRZGWF2W-MHyJPKcB.js";import{p as ce}from"./chunk-EAPQ7RWQ-DSkgqx9G.js";import{F as de}from"./CheckCircleIcon-ELAb3fzt.js";import{F as me}from"./XCircleIcon-D_wAPF3V.js";import{F as ue}from"./UserIcon-pC-qbD6I.js";import{F as O}from"./PresentationChartLineIcon-Bo_85UQz.js";import{F as xe}from"./ChartBarIcon-CM_omqnX.js";import{m as he}from"./proxy-Cdac7JMG.js";import{c as U}from"./chunk-D5XJWRAV-DU87gX_a.js";import{i as pe}from"./chunk-SSA7SXE4-DhBPeL1m.js";import"./toastUtils-D7LMmq7_.js";import"./EnvelopeIcon-lC1_DGJe.js";import"./UserGroupIcon-C289kc4l.js";import"./MapPinIcon-BzL_6d-5.js";import"./ShieldCheckIcon-DWIf3l99.js";import"./XMarkIcon-vqEAiE0C.js";import"./KeyIcon-B1jfTiTe.js";import"./index-De3GqDBO.js";import"./logo-Pwvcz7fP.js";import"./MagnifyingGlassIcon-Bhzw0GfZ.js";import"./chunk-IHOGUXIG-CorBOu8W.js";import"./features-animation-D9Iafa5k.js";import"./create-visual-element-VSnojGb8.js";import"./chunk-XJ2YRSUP-jBVnJYql.js";import"./useToggleState-CoJmWfwq.js";const fe=({handleDateChange:F,selectedDate:N,updateTimeSheet:T,externalFilterData:R,externalEmployee:L})=>{const{url:J}=H();V("(min-width: 1025px)"),V("(min-width: 641px) and (max-width: 1024px)");const[u,_]=s.useState([]),[g,j]=s.useState(""),[D,k]=s.useState(0),[E,I]=s.useState(0),[M,y]=s.useState(10),[w,n]=s.useState(1),[S,P]=s.useState(L||""),[Y,b]=s.useState(!1),o=s.useMemo(()=>R||{currentMonth:m().format("YYYY-MM")},[R]),r=()=>{var l;if(typeof window>"u")return"lg";const h=((l=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:l.trim())||"12px",a=parseInt(h);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},d=s.useCallback((t,h)=>{if(!t)return null;const a=m(h).format("YYYY-MM-DD");let l;return t.match(/^\d{2}:\d{2}(:\d{2})?$/)?l=m(`${a}T${t}`):l=m(t),l.isValid()?l.format("h:mm A"):"Invalid Time"},[]),x=s.useCallback(async(t=!1)=>{var a,l;if(!N){b(!0),j("No date selected");return}b(!1),j("");const h=route("getCurrentUserAttendanceForDate");try{const i=await Q.get(h,{params:{page:w,perPage:M,employee:S,date:m(N).format("YYYY-MM-DD"),currentYear:o!=null&&o.currentMonth?m(o.currentMonth).year():"",currentMonth:o!=null&&o.currentMonth?m(o.currentMonth).format("MM"):"",_t:t?Date.now():void 0}});i.status===200?(_(i.data.attendances||[]),k(i.data.total||0),I(i.data.last_page||1),i.data.current_page&&n(i.data.current_page),j("")):j(`Unexpected response: ${i.status}`)}catch(i){console.error("Error fetching attendance data:",i),j(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.message)||"An error occurred while retrieving attendance data."),_([]),k(0)}finally{b(!0)}},[N,w,M,S,o]);s.useEffect(()=>{x()},[x,T]),s.useEffect(()=>{n(1)},[N,o.currentMonth]);const A=t=>{n(t)},q=[{name:"Date",uid:"date",icon:$,ariaLabel:"Attendance date"},{name:"Clock In",uid:"clockin_time",icon:c,ariaLabel:"All clock in times"},{name:"Clock Out",uid:"clockout_time",icon:c,ariaLabel:"All clock out times"},{name:"Work Hours",uid:"production_time",icon:c,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:c,ariaLabel:"Number of time punches recorded"}],G=s.useCallback((t,h)=>{const a="text-xs sm:text-sm md:text-base whitespace-nowrap",l=m(t.date).isSame(m(),"day");switch(h){case"date":return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:m(t.date).format("MMM D, YYYY")})})]})});case"clockin_time":return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-success"}),e.jsx("div",{className:"flex flex-col",children:t.punches&&t.punches.length>0?t.punches.filter(f=>f.punch_in).map((f,v)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[v+1,"."]}),d(f.punch_in,t.date)||"Invalid time"]},v)):e.jsx("span",{children:"Not clocked in"})})]})});case"clockout_time":return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-danger"}),e.jsx("div",{className:"flex flex-col",children:t.punches&&t.punches.length>0?t.punches.map((f,v)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[v+1,"."]}),f.punch_out?d(f.punch_out,t.date)||"Invalid time":"No punch out"]},v)):t.punchin_time?e.jsx("span",{children:l?"Currently working":"Missing punch-out"}):e.jsx("span",{children:"Not started"})})]})});case"production_time":const i=t.total_work_minutes>0,B=t.has_incomplete_punch,K=t.punchin_time&&!t.punchout_time&&l;if(i){const f=Math.floor(t.total_work_minutes/60),v=Math.floor(t.total_work_minutes%60);return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:`w-4 h-4 ${B?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${f}h ${v}m`}),e.jsx("span",{className:"text-xs text-default-500",children:B?"Partial data - in progress":"Total worked time"})]})]})})}else{if(K)return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(t.punchin_time&&!t.punchout_time&&!l)return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(p,{className:`${a}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[t.punch_count||0," punch",(t.punch_count||0)!==1?"es":""]}),t.complete_punches!==t.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[t.complete_punches," complete"]}),t.complete_punches===t.punch_count&&t.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(p,{className:`${a}`,children:"N/A"})}},[d]);return e.jsx("div",{role:"region","aria-label":"Attendance data table",className:"w-full",children:g?e.jsx(W,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:g})]})}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{orientation:"horizontal",className:"overflow-y-hidden",children:e.jsx(le,{className:"rounded-lg",isLoaded:Y,children:e.jsxs(se,{selectionMode:"none",isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:r(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(oe,{columns:q,children:t=>e.jsx(ie,{align:"start","aria-label":t.ariaLabel||t.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.icon&&e.jsx(t.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:t.name})]})},t.uid)}),e.jsx(ae,{items:u,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(c,{className:"w-16 h-16 text-default-300 mb-4"}),e.jsx("h6",{className:"text-lg font-semibold mb-2",children:"No Attendance Records"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found for the selected date"})]}),children:t=>e.jsx(re,{children:h=>G(t,h)},t.id||t.user_id)})]})})}),D>M&&e.jsx("div",{className:"flex justify-center items-center py-4",children:e.jsx(ce,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:r(),page:w,total:E,onChange:A,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})})},ge=X.memo(({title:F,totalWorkingDays:N,presentDays:T,absentDays:R,lateArrivals:L})=>{const{auth:J}=H().props,[u,_]=s.useState(!1),[g,j]=s.useState(!1);s.useEffect(()=>{const r=()=>{_(window.innerWidth>=1025),j(window.innerWidth>=641&&window.innerWidth<=1024)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const D=()=>{var A;if(typeof window>"u")return"lg";const d=((A=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:A.trim())||"12px",x=parseInt(d);return x===0?"none":x<=4?"sm":x<=8?"md":x<=16?"lg":"full"},[k,E]=s.useState(new Date),[I,M]=s.useState(!1),[y,w]=s.useState({currentMonth:new Date().toISOString().slice(0,7)}),[n,S]=s.useState({meta:{month:"",workingDays:0,holidays:0,weekends:0},attendance:{present:0,absent:0,leaves:0,lateArrivals:0,percentage:0},hours:{totalWork:0,averageDaily:0,overtime:0}}),P=r=>{const d=r.target.value;d&&E(new Date(d))},Y=s.useCallback((r,d)=>{w(x=>({...x,[r]:d}))},[]),b=s.useCallback(async()=>{try{const r=await Q.get(route("attendance.myMonthlyStats"),{params:{currentYear:new Date(y.currentMonth).getFullYear(),currentMonth:String(new Date(y.currentMonth).getMonth()+1).padStart(2,"0")}});r.data.success&&S(r.data.data)}catch(r){console.error("Failed to fetch stats:",r)}},[y.currentMonth]);s.useEffect(()=>{b()},[b]);const o=[{title:"Working Days",value:n.meta.workingDays,icon:e.jsx($,{}),color:"text-default-600",iconBg:"bg-default-100",description:`Calendar: ${n.meta.month}`},{title:"Present",value:n.attendance.present,icon:e.jsx(de,{}),color:"text-success",iconBg:"bg-success/20",description:`${n.attendance.percentage}% Attendance Rate`},{title:"Absent",value:n.attendance.absent,icon:e.jsx(me,{}),color:"text-danger",iconBg:"bg-danger/20",description:"Unexcused absences"},{title:"On Leave",value:n.attendance.leaves,icon:e.jsx(ue,{}),color:"text-warning",iconBg:"bg-warning/20",description:"Approved leaves"},{title:"Late Arrivals",value:n.attendance.lateArrivals,icon:e.jsx(C,{}),color:"text-orange-500",iconBg:"bg-orange-100",description:"After grace period"},{title:"Total Hours",value:`${n.hours.totalWork}h`,icon:e.jsx(c,{}),color:"text-primary",iconBg:"bg-primary/20",description:"Total production time"},{title:"Daily Avg",value:`${n.hours.averageDaily}h`,icon:e.jsx(O,{}),color:"text-secondary",iconBg:"bg-secondary/20",description:"Target: 8.0h"},{title:"Overtime",value:`${n.hours.overtime}h`,icon:e.jsx(xe,{}),color:"text-success-600",iconBg:"bg-success-100",description:"Extra hours logged"}];return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:F||"My Attendance"}),e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"My Attendance Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(he.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(W,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:"linear-gradient(135deg, var(--theme-content1, #FAFAFA) 20%, var(--theme-content2, #F4F4F5) 10%, var(--theme-content3, #F1F3F4) 20%)"},children:[e.jsx(U,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:"linear-gradient(135deg, color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)"},children:e.jsx("div",{className:`${u?"p-6":g?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`${u?"p-3":g?"p-2.5":"p-2"} rounded-xl flex items-center justify-center`,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(O,{className:`${u?"w-8 h-8":g?"w-6 h-6":"w-5 h-5"}`,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`${u?"text-2xl":g?"text-xl":"text-lg"} font-bold text-foreground ${u?"":"truncate"}`,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"My Attendance"}),e.jsx("p",{className:`${u?"text-sm":"text-xs"} text-default-500 ${u?"":"truncate"}`,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"View your attendance records and timesheet details"})]})]})})})})}),e.jsxs(z,{className:"p-6",children:[e.jsx(te,{stats:o,className:"mb-6"}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e.jsx(pe,{label:"Month/Year",type:"month",value:y.currentMonth,onChange:r=>Y("currentMonth",r.target.value),variant:"bordered",size:"sm",radius:D(),startContent:e.jsx($,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select month and year for attendance"})})})}),e.jsxs(W,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',background:"linear-gradient(135deg, var(--theme-content1, #FAFAFA) 20%, var(--theme-content2, #F4F4F5) 10%, var(--theme-content3, #F1F3F4) 20%)"},children:[e.jsx(U,{className:"border-b pb-2",style:{borderColor:"var(--theme-divider, #E4E4E7)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg flex items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)"},children:e.jsx(c,{className:"w-6 h-6",style:{color:"var(--theme-primary)"}})}),e.jsx("h1",{className:"text-xl sm:text-2xl md:text-3xl font-semibold text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"My Attendance Records"})]})}),e.jsx(z,{children:e.jsx("div",{className:"max-h-[84vh] overflow-y-auto",children:e.jsx(fe,{selectedDate:k,handleDateChange:P,updateTimeSheet:I,externalFilterData:y})})})]})]})]})})})})})]})});ge.layout=F=>e.jsx(ee,{children:F});export{ge as default};
