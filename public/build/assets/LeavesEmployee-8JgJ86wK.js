import{u as be,r as l,a as J,j as a,H as ye,e as je,F as X,g as L,h as P,d as _e}from"./app-B8QYX9Px.js";import{d as Z}from"./dayjs.min-BHuFkWn-.js";import{u as we,B as Ce,G as Ne,T as p}from"./logo-BoX8pchB.js";import{P as ke}from"./PageHeader-XJFWVm9P.js";import{u as K,B as $,b as F,A as Me}from"./App-DkF9RL3Y.js";import{L as U,D as Se,B as Le,a as Pe,b as Fe}from"./BulkDeleteModal-6R4Zot8f.js";import{G as Be,F as Ye,C as Ie}from"./Grow-DP1KP2ex.js";import{I as Te}from"./InputLabel-CehJzubO.js";import{S as Re}from"./Select-8HD_0XQO.js";import{M as De}from"./MenuItem-BN00sQGI.js";import{F as ee}from"./ChartBarIcon-BBONCpWc.js";import{F as Oe}from"./XCircleIcon-CVN-tgoC.js";import{F as Ee}from"./PlusIcon-BzbZnk-Z.js";import{F as Ae}from"./PresentationChartLineIcon-fF9RAVuy.js";import{c as ze}from"./chunk-D5XJWRAV-zQzkTunB.js";import"./create-visual-element-4S4I33NB.js";import"./EnvelopeIcon-B1M8vjD_.js";import"./UserIcon-D9_80nkG.js";import"./ShieldCheckIcon-RZqgNGJW.js";import"./ExclamationTriangleIcon-BW32ASrn.js";import"./TrashIcon-DFtGfjbZ.js";import"./PencilIcon-q28LArt-.js";import"./EllipsisVerticalIcon-B1J6VG1L.js";import"./CheckCircleIcon-z54E82w1.js";import"./ClockIcon-DF9_6HP0.js";import"./ExclamationTriangleIcon-CPu9A391.js";import"./HeartIcon-CF3RRDsF.js";import"./CardContent-B5B4Qw18.js";import"./Stack-DJbibjmc.js";import"./chunk-F3UDT23P-Hrzl6yhk.js";import"./useHasTabbableChild-CrUAHYqA.js";import"./index-Dxlg9OmP.js";import"./chunk-BOOVDPB6-CftkAAhs.js";import"./chunk-S574QCAN-CoPQlLbo.js";import"./chunk-JOT4BT4P-C9GtIuSp.js";import"./chunk-EAPQ7RWQ-OKuZgSIq.js";import"./index-CokAva9Y.js";import"./Clear-Defissbz.js";import"./GlassDialog-w1fMVGB6.js";import"./Dialog-Bo_XotCr.js";import"./DialogTitle-B_yNWDSa.js";import"./DialogContent-DYCSoO7D.js";import"./TextField-BAa6JqDO.js";import"./LoadingButton-BJ0_t8OA.js";import"./Button-CpKhJqSS.js";import"./DialogContentText-CZB7joVz.js";import"./InputAdornment-Cc_eLtv_.js";import"./Avatar-BIHQefTu.js";import"./CardHeader-Bhq2T4qN.js";import"./InformationCircleIcon-se4RznBA.js";import"./XCircleIcon-tcb-l3UC.js";import"./CheckCircleIcon-B90VRiLI.js";import"./ListItemText-WuLbSXtN.js";import"./listItemTextClasses-DfTDYmaW.js";import"./Divider-DfNajlN5.js";const $e=({title:O,allUsers:g})=>{const{auth:N}=be().props,H=we(),k=K(H.breakpoints.down("sm")),ae=K(H.breakpoints.down("md")),[h,B]=l.useState(0),[E,Y]=l.useState(0),[G,He]=l.useState(!1),[_,m]=l.useState([]),[y,w]=l.useState({leaveTypes:[],leaveCountsByUser:{}}),[q,f]=l.useState(!1),[Q,A]=l.useState(""),[o,z]=l.useState({page:1,perPage:30,total:0,lastPage:0}),[n,te]=l.useState({employee:"",selectedMonth:Z().format("YYYY-MM"),year:new Date().getFullYear()}),u=l.useCallback(e=>{e&&(B(e.total||0),Y(e.last_page||1),z(s=>({...s,total:e.total||0,lastPage:e.last_page||1})))},[]),v=l.useCallback(async()=>{var e,s,t;f(!0);try{const{page:r,perPage:i}=o,{year:c}=n,b=await J.get(route("leaves.paginate"),{params:{page:r,perPage:i,year:c,user_id:N.user.id},timeout:1e4});if(b.status===200){const{leaves:x,leavesData:xe}=b.data;x.data&&Array.isArray(x.data)?(m(x.data),u({total:x.total||x.data.length,last_page:x.last_page||1,current_page:x.current_page||1,per_page:x.per_page||o.perPage})):Array.isArray(x)?(m(x),u({total:x.length,last_page:1,current_page:1,per_page:o.perPage})):(console.error("Unexpected leaves data format:",x),m([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})),w(xe),A("")}}catch(r){if(console.error("Error fetching leaves:",r),((e=r.response)==null?void 0:e.status)===404){const{leavesData:i}=r.response.data;w(i),A(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.message)||"No leaves found for the selected criteria.")}else{A("Error retrieving leaves data. Please try again.");const i=Promise.reject("Failed to load leave data. Please try again.");$.promise(i,{error:{render(){return a.jsx("div",{children:"Failed to load leave data. Please try again."})},icon:"❌"}})}m([]),u({total:0,last_page:1,current_page:1,per_page:o.perPage})}finally{f(!1)}},[o.page,o.perPage,n,N.user.id,u]),I=l.useCallback((e,s,t)=>{const{page:r,perPage:i}=o;e.length>=i||r<E||v()},[o,E,v]),se=l.useMemo(()=>{const e=new Date().getFullYear();return Array.from({length:e-1900+1},(s,t)=>{const r=1900+t;return{key:r.toString(),label:r.toString(),value:r}}).reverse()},[]),V=l.useCallback((e,s)=>{if(e==="year"){const t=Number(s);if(t<1900||t>new Date().getFullYear()){console.warn("Invalid year selected. Must be between 1900 and current year.");return}}te(t=>({...t,[e]:s})),e==="year"&&z(t=>({...t,page:1}))},[]),[j,T]=l.useState({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1});l.useCallback((e,s=null)=>{T(t=>({...t,[e]:!0}))},[]);const S=l.useCallback(()=>{T({add_leave:!1,edit_leave:!1,delete_leave:!1,bulk_leave:!1,bulk_delete:!1})},[]),R=l.useCallback(e=>{T(s=>({...s,[e]:!0}))},[]),re=l.useCallback((e,s)=>{W({id:e}),T(t=>({...t,[s]:!0}))},[]),[D,W]=l.useState(null),[le,oe]=l.useState([]),ne=l.useCallback(e=>{W(e)},[]),ie=l.useCallback(e=>{oe(e),R("bulk_delete")},[R]),d=l.useCallback(async()=>{try{const e=await J.get(route("leaves.stats"),{params:{year:n.year}});if(e.status===200){const{stats:s,leaveCounts:t}=e.data;t&&w(r=>({...r,leaveCountsByUser:{...r.leaveCountsByUser,[N.user.id]:t}}))}}catch(e){console.error("Error fetching leaves stats:",e.response)}},[n.year,N.user.id]),ce=l.useCallback(e=>{e!==o.page&&z(s=>({...s,page:e}))},[o.page]);l.useEffect(()=>{v()},[v]),l.useEffect(()=>{d()},[d]);const de=l.useMemo(()=>y.leaveCountsByUser[N.user.id]||[],[y.leaveCountsByUser,N.user.id]),M=l.useCallback(e=>[...e].sort((s,t)=>new Date(s.from_date)-new Date(t.from_date)),[]),C=l.useCallback(e=>{const s=new Date(e.from_date).getFullYear();if(n.year&&s!==n.year)return!1;if(n.employee){const t=g==null?void 0:g.find(i=>String(i.id)===String(e.user_id)),r=n.employee.trim().toLowerCase();if(t){if(String(t.id)!==r&&!(t.name&&t.name.trim().toLowerCase().includes(r)))return!1}else if(String(n.employee)!==String(e.user_id))return!1}if(n.selectedMonth&&Z(e.from_date).format("YYYY-MM")!==n.selectedMonth||n.status&&n.status!=="all"&&String(e.status).toLowerCase()!==String(n.status).toLowerCase()||n.leaveType&&n.leaveType!=="all"&&String(e.leave_type).toLowerCase()!==String(n.leaveType).toLowerCase())return!1;if(n.department&&n.department!=="all"){const t=g==null?void 0:g.find(r=>String(r.id)===String(e.user_id));if(!t||String(t.department).toLowerCase()!==String(n.department).toLowerCase())return!1}return!0},[n,g]);l.useMemo(()=>_||[],[_]);const ue=l.useCallback(e=>{C(e)&&(f(!0),m(s=>{const t=[...s,e];return M(t).slice(0,o.perPage)}),u({total:h+1,last_page:Math.ceil((h+1)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d())},[C,M,o,h,u,v,d]),me=l.useCallback(e=>{var i;if(!e||!e.success){console.error("Invalid bulk response data:",e);return}e.leavesData&&w(e.leavesData);const s=e.created_leaves||[];if(s.length===0){d();return}const t=s.filter(c=>C(c));if(t.length===0){d();return}f(!0),m(c=>{const b=[...c,...t];return M(b).slice(0,o.perPage)});const r=((i=e.summary)==null?void 0:i.successful)||s.length;u({total:h+r,last_page:Math.ceil((h+r)/o.perPage),current_page:o.page,per_page:o.perPage}),f(!1),o.page!==1&&v(),d()},[C,M,o,h,u,v,d]),pe=l.useCallback(e=>{const s=_.some(r=>r.id===e.id);if(f(!0),!C(e)&&s){m(i=>i.filter(c=>c.id!==e.id));const r=Promise.resolve();$.promise(r,{success:{render(){return a.jsx("div",{children:"Leave removed from filtered view."})},icon:"ℹ️"}}),f(!1);return}if(!s&&!C(e)){f(!1);return}m(r=>{const i=r.some(b=>b.id===e.id);let c;return i?c=r.map(b=>b.id===e.id?e:b):c=[...r,e],M(c).slice(0,o.perPage)});const t=Promise.resolve();$.promise(t,{success:{render(){return a.jsx("div",{children:"Leave updated!"})},icon:"✅"}}),f(!1),o.page!==1&&v(),d()},[C,M,_,o,v,d]),ge=l.useCallback(e=>{m(t=>{const r=t.filter(c=>c.id!==e),i=Math.max(0,h-1);return I(r,i,"delete"),r});const s=Math.max(0,h-1);u({total:s,last_page:Math.max(1,Math.ceil(s/o.perPage)),current_page:o.page,per_page:o.perPage}),d()},[d,h,o,u,I]),he=l.useCallback(e=>{if(!e||!e.success){console.error("Invalid bulk delete response data:",e);return}e.leavesData&&w(e.leavesData);const s=e.deleted_leaves||[],t=s.map(c=>c.id);if(t.length===0){d();return}f(!0),m(c=>c.filter(b=>!t.includes(b.id)));const r=e.deleted_count||s.length,i=Math.max(0,h-r);u({total:i,last_page:Math.max(1,Math.ceil(i/o.perPage)),current_page:o.page,per_page:o.perPage}),f(!1),I(_.filter(c=>!t.includes(c.id)),i,"delete"),d()},[u,o,h,_,I,d]),fe=()=>y.leaveTypes.length?a.jsx("div",{className:`grid gap-4 ${k?"grid-cols-1":ae?"grid-cols-2":"grid-cols-4"}`,children:y.leaveTypes.map(({type:e})=>{const s=de.find(c=>c.leave_type===e)||{},t=s.days_used||0,r=s.remaining_days||0,i=t+r;return a.jsxs(L,{className:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15 transition-all duration-200",children:[a.jsx(ze,{className:"pb-2",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),a.jsx(p,{variant:k?"subtitle1":"h6",className:"font-semibold truncate",children:e})]})}),a.jsx(P,{className:"pt-0",children:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(p,{variant:"caption",color:"textSecondary",children:"Used"}),a.jsx(p,{variant:k?"h6":"h5",className:"font-bold text-red-400",children:t})]}),a.jsx(_e,{orientation:"vertical",className:"h-8"}),a.jsxs("div",{className:"text-center",children:[a.jsx(p,{variant:"caption",color:"textSecondary",children:"Remaining"}),a.jsx(p,{variant:k?"h6":"h5",className:"font-bold text-green-400",children:r})]})]}),i>0&&a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-linear-to-r from-red-400 to-orange-400 h-2 rounded-full transition-all duration-300",style:{width:`${t/i*100}%`}})})]})})]},e)})}):a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-8",children:[a.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),a.jsx(p,{variant:"body1",color:"textSecondary",children:"No leave types available"})]})}),ve=l.useRef(null);return a.jsxs(a.Fragment,{children:[a.jsx(ye,{title:O}),j.add_leave&&a.jsx(U,{open:j.add_leave,closeModal:()=>S(),leavesData:y,setLeavesData:w,currentLeave:null,allUsers:g,setTotalRows:B,setLastPage:Y,setLeaves:m,employee:"",selectedMonth:n.selectedMonth,addLeaveOptimized:ue,updatePaginationMetadata:u,fetchLeavesStats:d}),j.edit_leave&&a.jsx(U,{open:j.edit_leave,closeModal:()=>S(),leavesData:y,setLeavesData:w,currentLeave:D,allUsers:g,setTotalRows:B,setLastPage:Y,setLeaves:m,employee:"",selectedMonth:n.selectedMonth,updateLeaveOptimized:pe,updatePaginationMetadata:u,fetchLeavesStats:d}),j.delete_leave&&a.jsx(Se,{open:j.delete_leave,closeModal:()=>S(),leaveId:D==null?void 0:D.id,setLeaves:m,setTotalRows:B,setLastPage:Y,deleteLeaveOptimized:ge,updatePaginationMetadata:u,fetchLeavesStats:d}),j.bulk_leave&&a.jsx(Le,{open:j.bulk_leave,onClose:()=>S(),onSuccess:e=>{me(e)},allUsers:g,leavesData:y,isAdmin:!1,existingLeaves:_||[],publicHolidays:(y==null?void 0:y.publicHolidays)||[]}),j.bulk_delete&&a.jsx(Pe,{open:j.bulk_delete,onClose:()=>S(),onSuccess:e=>{he(e)},selectedLeaves:le,allUsers:g}),a.jsxs(Ce,{sx:{display:"flex",justifyContent:"center",p:2},children:["        ",a.jsx(Be,{in:!0,children:a.jsx(Ne,{children:a.jsx(ke,{title:"My Leaves",subtitle:"Your leave requests and balances",icon:a.jsx(Ae,{className:"w-8 h-8"}),variant:"gradient",actionButtons:[{label:"Add Leave",icon:a.jsx(Ee,{className:"w-4 h-4"}),onPress:()=>R("add_leave"),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Current Year",icon:a.jsx(F,{className:"w-4 h-4"}),onPress:()=>V("year",new Date().getFullYear()),className:"bg-linear-to-r from-(--theme-primary) to-(--theme-secondary) text-white font-medium hover:opacity-90"},{label:"Refresh",icon:a.jsx(X,{className:"w-4 h-4"}),onPress:v,className:"bg-linear-to-r from-[rgba(var(--theme-success-rgb),0.8)] to-[rgba(var(--theme-success-rgb),1)] text-white font-medium hover:opacity-90"}],children:a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[a.jsx("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:a.jsxs(Ye,{size:k?"small":"medium",sx:{minWidth:200,width:"100%"},children:[a.jsxs(Te,{sx:{color:"rgba(255, 255, 255, 0.7)",display:"flex",alignItems:"center",gap:1},children:[a.jsx(F,{className:"w-4 h-4"}),"Select Year"]}),a.jsx(Re,{value:String(n.year),onChange:e=>V("year",Number(e.target.value)),label:"Select Year",sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(16px)",borderRadius:"12px","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255, 255, 255, 0.3)",backgroundColor:"rgba(255, 255, 255, 0.15)"},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(59, 130, 246, 0.5)"},"& .MuiSelect-select":{color:"rgba(255, 255, 255, 0.9)"},"& .MuiSelect-icon":{color:"rgba(255, 255, 255, 0.7)"}},MenuProps:{PaperProps:{sx:{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(16px)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"12px","& .MuiMenuItem-root":{color:"rgba(255, 255, 255, 0.9)","&:hover":{backgroundColor:"rgba(255, 255, 255, 0.15)"},"&.Mui-selected":{backgroundColor:"rgba(59, 130, 246, 0.3)"}}}}},children:se.map(e=>a.jsx(De,{value:e.value,children:e.label},e.key))})]})}),a.jsx("div",{className:"flex gap-2",children:a.jsx(je,{variant:"flat",color:"primary",size:k?"sm":"md",onPress:v,isLoading:G,startContent:!G&&!q&&a.jsx(X,{className:"w-4 h-4"}),children:"Refresh"})})]})}),a.jsxs("div",{className:"mb-6",children:[a.jsxs(p,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(ee,{className:"w-5 h-5"}),"Leave Balance Summary"]}),fe()]}),a.jsxs("div",{className:"min-h-96",children:[a.jsxs(p,{variant:"h6",className:"mb-4 flex items-center gap-2",children:[a.jsx(F,{className:"w-5 h-5"}),"Leave History"]}),q?a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(Ie,{size:40}),a.jsx(p,{className:"mt-4",color:"textSecondary",children:"Loading leave data..."})]})}):Q?a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(Oe,{className:"w-16 h-16 mx-auto mb-4 text-red-400"}),a.jsx(p,{variant:"h6",className:"mb-2",children:"Error Loading Data"}),a.jsx(p,{color:"textSecondary",children:Q})]})}):_.length>0?a.jsx("div",{className:"overflow-hidden rounded-lg",children:a.jsx(Fe,{ref:ve,leaves:_,allUsers:g||[],handleClickOpen:re,setCurrentLeave:ne,openModal:R,setLeaves:m,setCurrentPage:ce,currentPage:o.page,totalRows:h,lastPage:E,perPage:o.perPage,selectedMonth:n.selectedMonth,employee:"",isAdminView:!1,fetchLeavesStats:d,updatePaginationMetadata:u,onBulkDelete:ie,canDeleteLeaves:!0})}):a.jsx(L,{className:"bg-white/10 backdrop-blur-md border-white/20",children:a.jsxs(P,{className:"text-center py-12",children:[a.jsx(F,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),a.jsx(p,{variant:"h6",className:"mb-2",children:"No Leave Records Found"}),a.jsxs(p,{color:"textSecondary",children:["You haven't submitted any leave requests for ",n.year,"."]}),"                      "]})})]})]})})})})]})]})};$e.layout=O=>a.jsx(Me,{children:O});export{$e as default};
