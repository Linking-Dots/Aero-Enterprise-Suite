import{r as c,j as e,d as $,e as A,s as oe,b as P,k as V,a as L,f as le,H as de}from"./app-DVP_m8h7.js";import{m as X,n as ee,o as se,p as te,s as ce,l as me,g as G,h as z,t as ue,d as Y,F as K,y as pe,u as Z,i as he,A as xe}from"./App-pkq0eXyk.js";import{T as fe}from"./TimeSheetTable-x6hMAF3S.js";import{B as E,c as W}from"./react-toastify.esm-11ySLd55.js";import{d as M}from"./dayjs.min-Y9dspzXh.js";import{c as ye,l as ge,a as ve,e as be,M as je,T as _e,u as Ne,L as ae}from"./leaflet-xgTe8Vlk.js";import{F as T}from"./MapPinIcon--iZT6muV.js";import{F as J}from"./GlobeAltIcon-BtiJNiWC.js";import{F as we}from"./ExclamationTriangleIcon-D2qoBr5-.js";import{i as C}from"./chunk-SSA7SXE4-C5QhRsCJ.js";import{F as H}from"./UserPlusIcon-eYl6hwUP.js";import{F as O}from"./InformationCircleIcon-CYpAqvAO.js";import{F as q}from"./ShieldCheckIcon-CAzrY1qb.js";import{u as re}from"./chunk-S574QCAN-dtvn5DCJ.js";import{t as ne}from"./chunk-QESP63UR-B3NEdiup.js";import{m as ie}from"./chunk-O5MCAK4F-D9RskNqb.js";import{c as Q}from"./chunk-XJ2YRSUP-ot1Ib-Dn.js";import{F as Fe}from"./CheckCircleIcon-BkiSCmd_.js";import{F as ke}from"./ChartBarIcon-CenWUbeF.js";import"./EnvelopeIcon-CCl31SqK.js";import"./UserIcon-SndiMFUs.js";import"./KeyIcon-ClouCyVq.js";import"./logo-D1JCVLgz.js";import"./proxy-BomxYwOG.js";import"./create-visual-element-DRYypj6G.js";import"./features-animation-DPmZMQ5S.js";import"./PageHeader-BUuKVLC7.js";import"./XCircleIcon-Cpn7u5Q-.js";import"./DocumentArrowDownIcon-BwWTOcN6.js";import"./chunk-JOT4BT4P-C5Izt6LX.js";import"./chunk-TLYTI3QM-D0ZS13cM.js";import"./chunk-F3UDT23P-bTe2Vr3o.js";import"./chunk-YRZGWF2W-OOeD0y1O.js";import"./chunk-TSPNSPCL-apcFqiC2.js";import"./chunk-EAPQ7RWQ-BA9qruv0.js";import"./useToggleState-DUQRr0AO.js";import"./index-Jgrs7YXA.js";const Ie=ye(function({position:m,...u},h){const k=new ge.Marker(m,u);return ve(k,be(h,{overlayContainer:k}))},function(m,u,h){u.position!==h.position&&m.setLatLng(u.position),u.icon!=null&&u.icon!==h.icon&&m.setIcon(u.icon),u.zIndexOffset!=null&&u.zIndexOffset!==h.zIndexOffset&&m.setZIndexOffset(u.zIndexOffset),u.opacity!=null&&u.opacity!==h.opacity&&m.setOpacity(u.opacity),m.dragging!=null&&u.draggable!==h.draggable&&(u.draggable===!0?m.dragging.enable():m.dragging.disable())});delete ae.Icon.Default.prototype._getIconUrl;ae.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const w={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Se=({onLocationSelect:p})=>(Ne({click(m){const{lat:u,lng:h}=m.latlng;p({latitude:u,longitude:h,accuracy:10,source:"manual"})}}),null),Ce=({onLocationChange:p,initialLocation:m=null,className:u="",style:h={}})=>{const k=()=>{var f;if(typeof window>"u")return"lg";const x=((f=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:f.trim())||"12px",g=parseInt(x);return g===0?"none":g<=4?"sm":g<=8?"md":g<=16?"lg":"full"},[l,d]=c.useState({status:w.CHECKING,coordinates:m||{latitude:23.8103,longitude:90.4125},error:null,accuracy:null}),[s,j]=c.useState({latitude:"",longitude:""}),o=c.useCallback(()=>new Promise((r,x)=>{if(!navigator.geolocation){x(new Error("Geolocation is not supported by this browser"));return}const g={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(f=>{const v={latitude:f.coords.latitude,longitude:f.coords.longitude,accuracy:f.coords.accuracy,source:"gps"};r(v)},f=>{let v="Location unavailable";switch(f.code){case 1:v="Location access denied. Please allow location permission.";break;case 2:v="Location unavailable. Please ensure GPS is enabled.";break;case 3:v="Location request timed out.";break;default:v="Unable to retrieve location."}x(new Error(v))},g)}),[]);c.useEffect(()=>{if(m){d(r=>({...r,status:w.ACTIVE,coordinates:m,accuracy:m.accuracy||null}));return}d(r=>({...r,status:w.CHECKING})),o().then(r=>{d({status:w.ACTIVE,coordinates:r,error:null,accuracy:r.accuracy}),p==null||p(r)}).catch(r=>{const x=r.message.includes("denied");d({status:x?w.DENIED:w.INACTIVE,coordinates:{latitude:23.8103,longitude:90.4125},error:r.message,accuracy:null})})},[m,o,p]);const _=c.useCallback(r=>{d(x=>({...x,coordinates:r,status:w.ACTIVE,accuracy:r.accuracy||10})),p==null||p(r)},[p]),N=c.useCallback(()=>{const r=parseFloat(s.latitude),x=parseFloat(s.longitude);if(isNaN(r)||isNaN(x)||r<-90||r>90||x<-180||x>180){d(f=>({...f,error:"Invalid coordinates. Latitude must be between -90 and 90, longitude between -180 and 180."}));return}_({latitude:r,longitude:x,accuracy:50,source:"manual"}),j({latitude:"",longitude:""})},[s,_]),I=c.useCallback(()=>{d(r=>({...r,status:w.CHECKING,error:null})),o().then(r=>{d({status:w.ACTIVE,coordinates:r,error:null,accuracy:r.accuracy}),p==null||p(r)}).catch(r=>{const x=r.message.includes("denied");d(g=>({...g,status:x?w.DENIED:w.INACTIVE,error:r.message}))})},[o,p]);return e.jsxs("div",{className:`space-y-4 ${u}`,style:h,children:[e.jsx($,{style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(A,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Location Selection"})]}),l.status===w.CHECKING&&e.jsx(oe,{size:"sm"}),(l.status===w.DENIED||l.status===w.INACTIVE)&&e.jsx(P,{size:"sm",color:"primary",variant:"flat",onPress:I,startContent:e.jsx(J,{className:"w-3 h-3"}),children:"Get GPS"})]}),l.coordinates&&e.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--theme-foreground-600)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Lat:"})," ",l.coordinates.latitude.toFixed(6),",",e.jsx("strong",{children:" Lng:"})," ",l.coordinates.longitude.toFixed(6)]}),l.accuracy&&e.jsxs("div",{children:[e.jsx("strong",{children:"Accuracy:"})," ±",Math.round(l.accuracy),"m"]})]}),l.error&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 p-2 rounded",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",color:"var(--theme-danger)"},children:[e.jsx(we,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:l.error})]})]})}),e.jsx($,{style:{borderRadius:"var(--borderRadius, 8px)",overflow:"hidden"},children:e.jsx("div",{style:{height:"300px",width:"100%"},children:l.coordinates&&e.jsxs(je,{center:[l.coordinates.latitude,l.coordinates.longitude],zoom:16,style:{height:"100%",width:"100%"},children:[e.jsx(_e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Ie,{position:[l.coordinates.latitude,l.coordinates.longitude]}),e.jsx(Se,{onLocationSelect:_})]})})}),e.jsx($,{style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(A,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(J,{className:"w-4 h-4",style:{color:"var(--theme-secondary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Manual Coordinates"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(C,{size:"sm",label:"Latitude",placeholder:"23.8103",value:s.latitude,onValueChange:r=>j(x=>({...x,latitude:r})),variant:"bordered",radius:k()}),e.jsx(C,{size:"sm",label:"Longitude",placeholder:"90.4125",value:s.longitude,onValueChange:r=>j(x=>({...x,longitude:r})),variant:"bordered",radius:k()}),e.jsx(P,{size:"sm",color:"secondary",variant:"flat",onPress:N,isDisabled:!s.latitude||!s.longitude,className:"h-10",children:"Set Location"})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-foreground-600)"},children:"Click on the map or enter coordinates manually to set the punch location."})]})})]})},Ee=({open:p,closeModal:m,selectedDate:u,allUsers:h,refreshTimeSheet:k,currentUser:l=null})=>{const d=()=>{var n;if(typeof window>"u")return"lg";const t=((n=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:n.trim())||"12px",a=parseInt(t);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},[s,j]=c.useState({user_id:"",date:u,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Manually marked present by admin",coordinates:null,ip:"Unknown",device_fingerprint:null,user_agent:navigator.userAgent}),[o,_]=c.useState({}),[N,I]=c.useState(!1),r=()=>{const i=document.createElement("canvas"),t=i.getContext("2d");return t.textBaseline="top",t.font="14px Arial",t.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:i.toDataURL(),timestamp:Date.now()}},x=async()=>{try{return(await L.get(route("getClientIp"))).data.ip}catch(i){return console.warn("Could not fetch IP address:",i),"Unknown"}};c.useEffect(()=>{p&&(async()=>{const t=await x(),a=r();j(l?n=>({...n,user_id:l.id,date:u,ip:t,device_fingerprint:JSON.stringify(a)}):n=>({...n,user_id:"",date:u,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Manually marked present by admin",ip:t,device_fingerprint:JSON.stringify(a)}))})(),_({})},[l,u,p]);const g=i=>{j(t=>({...t,coordinates:i,location:i.source==="manual"?`Manual: ${i.latitude.toFixed(6)}, ${i.longitude.toFixed(6)}`:`GPS: ${i.latitude.toFixed(6)}, ${i.longitude.toFixed(6)} (±${Math.round(i.accuracy)}m)`}))},f=c.useMemo(()=>(h==null?void 0:h.filter(i=>{var t;return(t=i.roles)==null?void 0:t.some(a=>a.name==="Employee")}))||[],[h]),v=(i,t)=>{j(a=>({...a,[i]:t})),o[i]&&_(a=>({...a,[i]:void 0}))},b=c.useMemo(()=>{if(s.punch_in_time&&s.punch_out_time){const i=M(`${s.date} ${s.punch_in_time}`),t=M(`${s.date} ${s.punch_out_time}`);if(t.isAfter(i)){const a=t.diff(i,"minute"),n=Math.floor(a/60),y=a%60;return`${n}h ${y}m`}}return null},[s.punch_in_time,s.punch_out_time,s.date]),S=async i=>{var t,a,n;i.preventDefault(),I(!0),_({});try{if(!s.coordinates){E.error("Please select a location on the map before submitting."),I(!1);return}const y={user_id:parseInt(s.user_id),date:s.date,punch_in_time:s.punch_in_time,punch_out_time:s.punch_out_time||null,reason:s.reason||"Marked present by administrator",location:s.location,lat:s.coordinates.latitude,lng:s.coordinates.longitude,accuracy:s.coordinates.accuracy||10,ip:s.ip,device_fingerprint:s.device_fingerprint,user_agent:s.user_agent,timestamp:new Date().toISOString(),wifi_ssid:"Unknown",manual_entry:!0},F=await L.post(route("attendance.mark-as-present"),y);F.status===200&&(E.success(F.data.message||"User marked as present successfully!"),k(),m())}catch(y){((t=y.response)==null?void 0:t.status)===422?(_(y.response.data.errors||{}),E.error(y.response.data.message||"Please check the form for errors")):E.error(((n=(a=y.response)==null?void 0:a.data)==null?void 0:n.message)||"Failed to mark user as present")}finally{I(!1)}},R=f.find(i=>i.id==s.user_id);return e.jsx(X,{isOpen:p,onClose:m,size:"2xl",radius:d(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ee,{children:i=>e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Mark Employee as Present"})]})}),e.jsxs("form",{onSubmit:S,children:[e.jsx(te,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Employee Selection"})]}),"                                        ",e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(ce,{label:"Select Employee",placeholder:"Choose an employee to mark as present",selectedKeys:s.user_id?new Set([s.user_id.toString()]):new Set,onSelectionChange:t=>{const a=Array.from(t)[0];v("user_id",a||"")},isInvalid:!!o.user_id,errorMessage:o.user_id,variant:"bordered",size:"sm",radius:d(),classNames:{trigger:"min-h-unit-12",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},renderValue:t=>t.map(a=>{const n=f.find(y=>y.id.toString()===a.key);return n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:n.name}),e.jsxs("span",{className:"text-xs text-default-500",children:["(",n.employee_id,")"]})]},a.key):null}),children:f.map(t=>e.jsx(me,{value:t.id.toString(),textValue:`${t.name} (${t.employee_id})`,children:e.jsx(re,{avatarProps:{size:"sm",src:t.profile_image_url,showFallback:!0,name:t.name},description:`ID: ${t.employee_id}`,name:t.name})},t.id.toString()))}),e.jsx(C,{label:"Date",type:"date",value:s.date,onValueChange:t=>v("date",t),isInvalid:!!o.date,errorMessage:o.date,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(G,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),e.jsx(V,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Working Hours"})]}),b&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",b]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(C,{label:"Punch In Time",type:"time",value:s.punch_in_time,onValueChange:t=>v("punch_in_time",t),isInvalid:!!o.punch_in_time,errorMessage:o.punch_in_time,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(z,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(C,{label:"Punch Out Time (Optional)",type:"time",value:s.punch_out_time,onValueChange:t=>v("punch_out_time",t),isInvalid:!!o.punch_out_time,errorMessage:o.punch_out_time,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(z,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employee is still working"})]})]}),e.jsx(V,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Location & Security Information"})]}),e.jsxs(ue,{"aria-label":"Attendance Information",color:"primary",variant:"underlined",classNames:{tabList:"gap-6 w-full relative rounded-none p-0 border-b border-divider",cursor:"w-full bg-primary-500",tab:"max-w-fit px-0 h-12",tabContent:"group-data-[selected=true]:text-primary-500"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Y,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Location"})]}),children:e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx(Ce,{onLocationChange:g,initialLocation:s.coordinates}),e.jsx(C,{label:"Location Description",value:s.location,onValueChange:t=>v("location",t),isInvalid:!!o.location,errorMessage:o.location,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(T,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"This will be auto-filled when you select a location on the map"})]})},"location"),e.jsx(Y,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Details"})]}),children:e.jsx("div",{className:"space-y-4 py-4",children:e.jsx(ne,{label:"Reason (Optional)",placeholder:"Reason for manually marking as present...",value:s.reason,onValueChange:t=>v("reason",t),isInvalid:!!o.reason,errorMessage:o.reason,variant:"bordered",size:"sm",radius:d(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})})},"details"),e.jsx(Y,{title:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{children:"Security"})]}),children:e.jsx("div",{className:"space-y-4 py-4",children:e.jsx($,{style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Security Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-xs",style:{color:"var(--theme-foreground-600)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"IP Address:"}),e.jsx("br",{}),s.ip||"Detecting..."]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Browser:"}),e.jsx("br",{}),navigator.userAgent.split(" ")[0]||"Unknown"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Platform:"}),e.jsx("br",{}),navigator.platform||"Unknown"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Timezone:"}),e.jsx("br",{}),Intl.DateTimeFormat().resolvedOptions().timeZone]})]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-foreground-500)"},children:[e.jsx("strong",{children:"Note:"})," This attendance entry will include security verification data to ensure consistency with regular punch entries."]})]})})})})},"security")]})]}),R&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:"Preview"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[R.name," will be marked present for"," ",M(s.date).format("MMM D, YYYY")," from"," ",s.punch_in_time," ",s.punch_out_time&&`to ${s.punch_out_time}`,b&&` (${b})`]})]})]})})]})}),e.jsxs(ie,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(P,{color:"default",variant:"bordered",onPress:i,radius:d(),size:"sm",isDisabled:N,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(P,{type:"submit",color:"primary",variant:"solid",isLoading:N,isDisabled:N||!s.user_id,radius:d(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:N?"Marking Present...":"Mark as Present"})]})]})]})})})},Me=({open:p,closeModal:m,selectedDate:u,allUsers:h,refreshTimeSheet:k,selectedUsers:l=[]})=>{const d=()=>{var y;if(typeof window>"u")return"lg";const a=((y=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:y.trim())||"12px",n=parseInt(a);return n===0?"none":n<=4?"sm":n<=8?"md":n<=16?"lg":"full"},[s,j]=c.useState({user_ids:[],date:u,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Bulk marked present by admin"}),[o,_]=c.useState({}),[N,I]=c.useState(!1),[r,x]=c.useState(!1),g=c.useMemo(()=>(h==null?void 0:h.filter(t=>{var a;return(a=t.roles)==null?void 0:a.some(n=>n.name==="Employee")}))||[],[h]);c.useEffect(()=>{const t=l.map(a=>a.id.toString());j(a=>({...a,user_ids:t,date:u})),x(t.length===g.length),_({})},[l,u,p,g.length]);const f=(t,a)=>{j(n=>({...n,[t]:a})),o[t]&&_(n=>({...n,[t]:void 0}))},v=(t,a)=>{const n=t.toString();j(y=>({...y,user_ids:a?[...y.user_ids,n]:y.user_ids.filter(F=>F!==n)}))},b=t=>{x(t),j(a=>({...a,user_ids:t?g.map(n=>n.id.toString()):[]}))},S=c.useMemo(()=>{if(s.punch_in_time&&s.punch_out_time){const t=M(`${s.date} ${s.punch_in_time}`),a=M(`${s.date} ${s.punch_out_time}`);if(a.isAfter(t)){const n=a.diff(t,"minute"),y=Math.floor(n/60),F=n%60;return`${y}h ${F}m`}}return null},[s.punch_in_time,s.punch_out_time,s.date]),R=async t=>{var a,n,y;t.preventDefault(),I(!0),_({});try{const F={user_ids:s.user_ids.map(U=>parseInt(U)),date:s.date,punch_in_time:s.punch_in_time,punch_out_time:s.punch_out_time||null,reason:s.reason||"Bulk marked present by administrator",location:s.location},B=await L.post(route("attendance.bulk-mark-as-present"),F);if(B.status===200){const{data:U}=B.data,{summary:D}=B.data;D.successful>0&&E.success(`Successfully marked ${D.successful} employees as present!`),D.failed>0&&E.warning(`${D.failed} employees failed to be marked present.`),D.skipped>0&&E.info(`${D.skipped} employees were skipped (already have attendance).`),k(),m()}}catch(F){((a=F.response)==null?void 0:a.status)===422?(_(F.response.data.errors||{}),E.error(F.response.data.message||"Please check the form for errors")):E.error(((y=(n=F.response)==null?void 0:n.data)==null?void 0:y.message)||"Failed to bulk mark users as present")}finally{I(!1)}},i=g.filter(t=>s.user_ids.includes(t.id.toString()));return e.jsx(X,{isOpen:p,onClose:m,size:"4xl",radius:d(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ee,{children:t=>e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Bulk Mark as Present"})]}),e.jsxs(W,{variant:"bordered",size:"sm",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)"},children:[s.user_ids.length," selected"]})]})}),e.jsxs("form",{onSubmit:R,children:[e.jsx(te,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Date & Time Configuration"})]}),S&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",S]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(C,{label:"Date",type:"date",value:s.date,onValueChange:a=>f("date",a),isInvalid:!!o.date,errorMessage:o.date,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(G,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(C,{label:"Punch In Time",type:"time",value:s.punch_in_time,onValueChange:a=>f("punch_in_time",a),isInvalid:!!o.punch_in_time,errorMessage:o.punch_in_time,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(z,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(C,{label:"Punch Out Time (Optional)",type:"time",value:s.punch_out_time,onValueChange:a=>f("punch_out_time",a),isInvalid:!!o.punch_out_time,errorMessage:o.punch_out_time,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(z,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employees are still working"})]})]}),e.jsx(V,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Select Employees (",s.user_ids.length," of ",g.length,")"]})]}),e.jsx(Q,{isSelected:r,onValueChange:b,color:"primary",size:"sm",children:"Select All"})]}),e.jsx($,{children:e.jsx(A,{className:"p-4",children:e.jsx(pe,{className:"max-h-64",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:g.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-default-50",children:[e.jsx(Q,{isSelected:s.user_ids.includes(a.id.toString()),onValueChange:n=>v(a.id,n),color:"primary",size:"sm"}),e.jsx(re,{avatarProps:{size:"sm",src:a.profile_image_url,showFallback:!0,name:a.name},description:`ID: ${a.employee_id}`,name:a.name,classNames:{name:"text-sm",description:"text-xs"}})]},a.id))})})})}),o.user_ids&&e.jsx("p",{className:"text-danger text-sm",children:o.user_ids})]}),e.jsx(V,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(C,{label:"Location",value:s.location,onValueChange:a=>f("location",a),isInvalid:!!o.location,errorMessage:o.location,variant:"bordered",size:"sm",radius:d(),startContent:e.jsx(T,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(ne,{label:"Reason (Optional)",placeholder:"Reason for bulk marking employees as present...",value:s.reason,onValueChange:a=>f("reason",a),isInvalid:!!o.reason,errorMessage:o.reason,variant:"bordered",size:"sm",radius:d(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),i.length>0&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(O,{className:"w-5 h-5 mt-0.5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2",style:{color:"var(--theme-foreground)"},children:["Preview - ",i.length," employee",i.length!==1?"s":""," will be marked present"]}),e.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--theme-foreground-600)"},children:["Date: ",M(s.date).format("MMM D, YYYY")," | Time: ",s.punch_in_time,s.punch_out_time&&` to ${s.punch_out_time}`,S&&` (${S})`]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[i.slice(0,10).map(a=>e.jsx(W,{size:"sm",variant:"flat",color:"primary",children:a.name},a.id)),i.length>10&&e.jsxs(W,{size:"sm",variant:"flat",color:"default",children:["+",i.length-10," more"]})]})]})]})})]})}),e.jsxs(ie,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(P,{color:"default",variant:"bordered",onPress:t,radius:d(),size:"sm",isDisabled:N,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx(P,{type:"submit",color:"primary",variant:"solid",isLoading:N,isDisabled:N||s.user_ids.length===0,radius:d(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:N?"Processing...":`Mark ${s.user_ids.length} Employee${s.user_ids.length!==1?"s":""} as Present`})]})]})]})})})},Re=({title:p,allUsers:m})=>{var v;const{auth:u}=le().props;Z("(max-width: 768px)"),Z("(max-width: 640px)");const[h,k]=c.useState(M().format("YYYY-MM-DD")),[l,d]=c.useState({type:null,selectedUsers:[],currentUser:null}),[s,j]=c.useState(0),[o,_]=c.useState({currentMonth:M().format("YYYY-MM")}),N=c.useCallback((b,S=[],R=null)=>{d({type:b,selectedUsers:S,currentUser:R})},[]),I=c.useCallback(()=>{d({type:null,selectedUsers:[],currentUser:null})},[]),r=c.useCallback(b=>{const S=b.target.value;k(S)},[]),x=c.useCallback(()=>{j(b=>b+1)},[]),g=c.useCallback(b=>{N("mark_as_present",[],b)},[N]);c.useMemo(()=>{const b=M(h);return[{title:"Present Today",value:0,icon:e.jsx(Fe,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Employees present"},{title:"Absent Today",value:0,icon:e.jsx(H,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Employees absent"},{title:"Total Employees",value:(m==null?void 0:m.length)||0,icon:e.jsx(ke,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Date",value:b.format("MMM D"),icon:e.jsx(he,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:b.format("dddd")}]},[h,m]);const f=c.useMemo(()=>({open:!!l.type,closeModal:I,selectedDate:h,allUsers:m,refreshTimeSheet:x,selectedUsers:l.selectedUsers,currentUser:l.currentUser}),[l.type,I,h,m,x,l.selectedUsers,l.currentUser]);return(v=u.permissions)!=null&&v.includes("attendance.view"),e.jsxs(e.Fragment,{children:[e.jsx(de,{title:p}),l.type==="mark_as_present"&&e.jsx(Ee,{...f}),l.type==="bulk_mark_as_present"&&e.jsx(Me,{...f}),e.jsx(fe,{handleDateChange:r,selectedDate:h,updateTimeSheet:s,externalFilterData:o,externalEmployee:"",onMarkAsPresent:g})]})};Re.layout=p=>e.jsx(xe,{children:p});export{Re as default};
