import{l as qe,r,n as Ie,ar as Ke,k as Je,j as e,R as le,a as Xe,c as Z,i as Me,d as xe,s as be,f as re,u as Oe,b as ie,t as Ye,v as Qe,F as et,H as tt}from"./app-DHNdVVQv.js";import{T as rt}from"./TimeSheetTable-ToJwMo2E.js";import{I as at,J as st,K as nt,w as We,p as fe,F as we,L as ot,M as it,h as je,N as lt,P as ct,k as dt,c as Se,e as Pe,f as Re,g as Ee,A as ut}from"./Dashboard-CL6aii2i.js";import{S as mt}from"./StatsCards-FBa2xuLX.js";import{M as ht,T as pt,u as ke,L as W}from"./leaflet-l4EY4cFD.js";import"./leaflet-routing-machine-Br4LJET8.js";import{m as K}from"./proxy-D1LloRp0.js";import{c as Ce}from"./createLucideIcon-lQqySTIm.js";import{U as ft}from"./users-D7cy49wP.js";import{M as gt}from"./map-pin-YL2Ywmc2.js";import{c as _e}from"./chunk-D5XJWRAV-BWg0Norf.js";import{d as ee}from"./dayjs.min-BVNpwf10.js";import{i as xt}from"./isBetween-A8ldw0Gs.js";import{F as me}from"./ExclamationTriangleIcon-V9aSIw1P.js";import{F as ae}from"./ClockIcon-CXPi9B2M.js";import{F as Ue}from"./UserGroupIcon-DZQm_A1N.js";import{F as yt}from"./SunIcon-2cwNalAw.js";import{F as Ne}from"./InformationCircleIcon-DIhO3IuJ.js";import{F as Le}from"./UserIcon-Br1hNDUA.js";import{F as vt}from"./XCircleIcon-CVde6m6d.js";import{F as ge}from"./CheckCircleIcon-xAm9Zj2M.js";import{s as Fe}from"./chunk-TLYTI3QM-DgZwzf_H.js";import{c as oe}from"./chunk-IHOGUXIG-q7BxhTVo.js";import{F as bt}from"./ClipboardDocumentListIcon-DyjupcLt.js";import{B as X}from"./react-toastify.esm-CdHJ_9GV.js";import{a as ue,F as wt}from"./MapPinIcon-xKIyQDFo.js";import{F as jt}from"./WifiIcon-CbV_7261.js";import{F as Nt}from"./ShieldCheckIcon-BU8PXtzV.js";import{t as ve,F as Ft}from"./XMarkIcon-XAKSMS26.js";import{m as Te}from"./chunk-O5MCAK4F-CdsGyuFP.js";import"./PageHeader-Ci0Derg-.js";import"./MagnifyingGlassIcon-DeOaUoN6.js";import"./UserPlusIcon-BBv50z-v.js";import"./chunk-SSA7SXE4-CqHXNhTc.js";import"./DocumentArrowDownIcon-2wlIF7PI.js";import"./chunk-JOT4BT4P-DXWsNUV6.js";import"./chunk-Y2AYO5NJ-Bk2TVsbc.js";import"./chunk-F3UDT23P-Buxg80gs.js";import"./chunk-XJ2YRSUP-DWgn52yP.js";import"./useToggleState-C0CIOmtj.js";import"./chunk-YRZGWF2W-CXbBYZmo.js";import"./chunk-APIAPHLK-D0vgkcm2.js";import"./chunk-S574QCAN-BeTtg-tb.js";import"./EnvelopeIcon-DP0OEU5j.js";import"./KeyIcon-DkhQE_I3.js";import"./index-D-zhejwu.js";import"./logo-Pwvcz7fP.js";import"./create-visual-element-D6w-5Lok.js";function kt(s={}){const{as:t,ref:c,max:u=5,total:o,size:h,color:m,radius:f,children:j,isBordered:w,isDisabled:N,isGrid:F,renderCount:P,className:S,classNames:D,...v}=s,p=qe(c),x=t||"div",n=r.useMemo(()=>({size:h,color:m,radius:f,isGrid:F,isBordered:w,isDisabled:N}),[h,m,f,F,w,N]),l=r.useMemo(()=>at({className:S,isGrid:F}),[S,F]),i=st(j),k=u?i.slice(0,u):i,y=o||(u!=null?i.length-u:-1),T=k.map((g,_)=>{const $=_===0,R=_===k.length-1,H={className:Ie($?"ms-0":F?"":"-ms-2",R&&y<1?"hover:-translate-x-0":"")};return r.cloneElement(g,Ke(H))});return{Component:x,context:n,remainingCount:y,clones:T,renderCount:P,getAvatarGroupProps:()=>({ref:p,className:l.base({class:Ie(D==null?void 0:D.base,S)}),role:"group",...v}),getAvatarGroupCountProps:()=>({className:l.count({class:D==null?void 0:D.count})})}}var ze=Je((s,t)=>{const{Component:c,clones:u,context:o,remainingCount:h,getAvatarGroupCountProps:m,getAvatarGroupProps:f,renderCount:j=w=>e.jsx(We,{...m(),name:`+${w}`})}=kt({...s,ref:t});return e.jsx(c,{...f(),children:e.jsxs(nt,{value:o,children:[u,h>0&&j(h)]})})});ze.displayName="HeroUI.AvatarGroup";var Ct=ze;function _t({title:s,titleId:t,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},c),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const It=r.forwardRef(_t);function St({title:s,titleId:t,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},c),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const $e=r.forwardRef(St);function Pt({title:s,titleId:t,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},c),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const Rt=r.forwardRef(Pt);function Et({title:s,titleId:t,...c},u){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:u,"aria-labelledby":t},c),s?r.createElement("title",{id:t},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const Lt=r.forwardRef(Et);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],$t=Ce("clock-4",Tt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dt=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],De=Ce("map",Dt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Mt=Ce("refresh-cw",At);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(s){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=s,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(s){L.DomEvent.stopPropagation(s),L.DomEvent.preventDefault(s),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(s){var t=this.getContainer();this.isFullscreen()?s&&s.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):s&&s.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(s){L.DomUtil.addClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(s){L.DomUtil.removeClass(s,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(s){this._isFullscreen=s;var t=this.getContainer();s?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(s){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var s;if("onfullscreenchange"in document?s="fullscreenchange":"onmozfullscreenchange"in document?s="mozfullscreenchange":"onwebkitfullscreenchange"in document?s="webkitfullscreenchange":"onmsfullscreenchange"in document&&(s="MSFullscreenChange"),s){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,s,t)}),this.on("unload",function(){L.DomEvent.off(document,s,t)})}});L.control.fullscreen=function(s){return new L.Control.Fullscreen(s)};const Y=(s,t)=>{if(s.startsWith("var("))return`color-mix(in srgb, ${s} ${t*100}%, transparent)`;if(s.startsWith("#")){const c=s.replace("#",""),u=parseInt(c.substr(0,2),16),o=parseInt(c.substr(2,2),16),h=parseInt(c.substr(4,2),16);return`rgba(${u}, ${o}, ${h}, ${t})`}return s.replace(/[\d.]+\)$/g,`${t})`)},Ot=()=>{var u;const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",c=parseInt(t);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},q={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:300},Ae={lat:23.8103,lng:90.4125},He=le.memo(({attendanceTypeConfigs:s,theme:t})=>{const c=ke(),u=r.useRef([]);return r.useEffect(()=>{if(!c||!(s!=null&&s.length))return;c.eachLayer(h=>{h.options&&(h.options.isAttendanceBoundary||h.options.isPolygon||h.options.isRoute)&&c.removeLayer(h)}),u.current.forEach(h=>{try{c.removeControl(h)}catch(m){console.warn("Error removing routing control:",m)}}),u.current=[],c.getContainer().querySelectorAll(".leaflet-routing-container").forEach(h=>h.remove());const o=[];if(s.forEach((h,m)=>{var P;const{base_slug:f,config:j,name:w}=h;(P=t==null?void 0:t.customColors)!=null&&P.primary;const N=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],F=N[m%N.length];if(f==="geo_polygon"&&j){const S=j.polygon||[],D=j.polygons||[];if(S.length>=3){const v=S.filter(p=>p.lat&&p.lng);if(v.length>=3){const p=v.map(n=>[parseFloat(n.lat),parseFloat(n.lng)]),x=W.polygon(p,{color:F,fillColor:F,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(c);x.bindPopup(`
                            <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                <strong style="color: ${F};">${w}</strong><br>
                                <small>Geofence Zone</small><br>
                                <small>Points: ${v.length}</small>
                            </div>
                        `),o.push(x.getBounds())}}D.forEach((v,p)=>{const x=v.points||[];if(x.length>=3){const n=x.filter(l=>l.lat&&l.lng);if(n.length>=3){const l=n.map(k=>[parseFloat(k.lat),parseFloat(k.lng)]),i=W.polygon(l,{color:F,fillColor:F,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(c);i.bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${F};">${w}</strong><br>
                                    <small>${v.name||`Zone ${p+1}`}</small>
                                </div>
                            `),o.push(i.getBounds())}}})}if(f==="route_waypoint"&&j){const S=j.waypoints||[],D=j.routes||[];if(S.length>=2){const v=S.filter(p=>p.lat&&p.lng);if(v.length>=2){const p=v.map(x=>W.latLng(parseFloat(x.lat),parseFloat(x.lng)));v.forEach((x,n)=>{const l=n===0,i=n===v.length-1,k=`
                                <div style="
                                    width: 24px;
                                    height: 24px;
                                    border-radius: 50%;
                                    background: ${l?"#10b981":i?"#ef4444":F};
                                    border: 2px solid white;
                                    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-weight: bold;
                                    font-size: 11px;
                                ">
                                    ${n+1}
                                </div>
                            `;W.marker([parseFloat(x.lat),parseFloat(x.lng)],{icon:W.divIcon({html:k,className:"route-waypoint-marker",iconSize:[24,24],iconAnchor:[12,12]}),isAttendanceBoundary:!0}).addTo(c).bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${F};">${w}</strong><br>
                                    <small>Waypoint ${n+1}${x.name?`: ${x.name}`:""}</small>
                                </div>
                            `)});try{const x=W.Routing.control({waypoints:p,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:F,weight:4,opacity:.7,dashArray:"8, 4"}],extendToWaypoints:!0,missingRouteTolerance:0},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(c);u.current.push(x);const n=W.latLngBounds(p);o.push(n)}catch(x){console.warn("Error creating route:",x);const n=W.polyline(p,{color:F,weight:3,opacity:.6,dashArray:"10, 10",isAttendanceBoundary:!0,isRoute:!0}).addTo(c);o.push(n.getBounds())}}}D.forEach((v,p)=>{const x=v.waypoints||[];if(x.length>=2){const n=x.filter(l=>l.lat&&l.lng);if(n.length>=2){const l=n.map(i=>W.latLng(parseFloat(i.lat),parseFloat(i.lng)));try{const i=W.Routing.control({waypoints:l,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:F,weight:4,opacity:.7,dashArray:"8, 4"}]},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(c);u.current.push(i),o.push(W.latLngBounds(l))}catch(i){console.warn("Error creating route:",i)}}}})}}),o.length>0){const h=o.reduce((m,f)=>m?m.extend(f):f,null);h&&h.isValid()&&setTimeout(()=>{c.fitBounds(h,{padding:[50,50],maxZoom:14})},500)}return()=>{u.current.forEach(h=>{try{c.removeControl(h)}catch{}}),u.current=[]}},[c,s,t]),null});He.displayName="AttendanceTypeBoundaries";const Wt=le.memo(({startLocation:s,endLocation:t,theme:c})=>{const u=ke();return r.useEffect(()=>{var h;if(!u||!s||!t)return;const o=W.Routing.control({waypoints:[W.latLng(s.lat,s.lng),W.latLng(t.lat,t.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((h=c==null?void 0:c.customColors)==null?void 0:h.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(u);return()=>{u&&o&&u.removeControl(o)}},[u,s,t,c]),null});Wt.displayName="RoutingMachine";const Be=le.memo(({selectedDate:s,onUsersLoad:t,theme:c,lastUpdate:u,users:o,setUsers:h,setLoading:m,setError:f,setAttendanceTypeConfigs:j})=>{const w=ke(),N=r.useRef([]),F=r.useCallback(async()=>{if(!s){m(!1),h([]),j==null||j([]),t==null||t([]);return}m(!0),f(null);try{const n=route("getUserLocationsForDate",{date:s,_t:Date.now()}),i=(await axios.get(n)).data;if(!i.success||!Array.isArray(i.locations))throw new Error("Unexpected response format from server.");const k=i.locations,y=i.attendance_type_configs||[];JSON.stringify(k)!==JSON.stringify(N.current)&&(h(k),N.current=k),j==null||j(y),t==null||t(k)}catch(n){let l="Error fetching user locations.";n.response?(l+=` Server error (${n.response.status}): ${n.response.statusText}`,typeof n.response.data=="object"&&(l+=`
Details: ${JSON.stringify(n.response.data)}`)):n.request?l+=" No response received from server.":n.message&&(l+=` ${n.message}`),console.error(l,n),f(l),h([]),t==null||t([])}finally{m(!1)}},[s,t,u]);r.useEffect(()=>{F()},[F]);const P=r.useCallback((n,l)=>{const i=q.OFFSET_MULTIPLIER*l;return{lat:n.lat+i,lng:n.lng+i}},[]),S=r.useCallback((n,l)=>Math.abs(n.lat-l.lat)<q.POSITION_THRESHOLD&&Math.abs(n.lng-l.lng)<q.POSITION_THRESHOLD,[]),D=r.useCallback(n=>{if(!n)return null;if(typeof n=="object"&&n.lat&&n.lng){const l=parseFloat(n.lat),i=parseFloat(n.lng);return isNaN(l)||isNaN(i)?null:{lat:l,lng:i}}if(typeof n=="string")try{const l=JSON.parse(n);if(l.lat&&l.lng){const i=parseFloat(l.lat),k=parseFloat(l.lng);return isNaN(i)||isNaN(k)?null:{lat:i,lng:k}}}catch{const i=n.split(",");if(i.length>=2){const k=parseFloat(i[0].trim()),y=parseFloat(i[1].trim());return isNaN(k)||isNaN(y)?null:{lat:k,lng:y}}}return null},[]),v=r.useCallback(n=>{if(!n)return"Not recorded";try{let l;return n.includes("T")?l=new Date(n):l=new Date(`${s}T${n}`),isNaN(l.getTime())?"Invalid time":l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(l){return console.warn("Error formatting time:",l),n}},[s]),p=r.useCallback((n,l="default")=>{var $,R,H,B;const i="var(--theme-primary, #3b82f6)",k="var(--theme-secondary, #8b5cf6)",y="var(--theme-success, #17C964)",T="var(--theme-danger, #ef4444)";let C,A,g="";l==="punchin"?(C=`${y}, #059669`,A=Y(y,.4),g='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚ñ∂</span>'):l==="punchout"?(C=`${T}, #dc2626`,A=Y(T,.4),g='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚óº</span>'):(C=`${i}, ${k}`,A=Y(i,.4));const _=`
            <div style="
                position: relative;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${C});
                border: 3px solid white;
                box-shadow: 0 4px 12px ${A};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${n.profile_image_url||n.profile_image?`<img src="${n.profile_image_url||n.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((R=($=n.name)==null?void 0:$.charAt(0))==null?void 0:R.toUpperCase())||"?"}';" />`:((B=(H=n.name)==null?void 0:H.charAt(0))==null?void 0:B.toUpperCase())||"?"}
                ${g}
            </div>
        `;return W.divIcon({html:_,className:"user-marker-icon",iconSize:q.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),x=r.useCallback((n,l="combined")=>{var M,V,te,a;const i=n.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",k="var(--theme-primary, #3b82f6)",y="var(--theme-secondary, #8b5cf6)",T="var(--theme-success, #17C964)",C="var(--theme-danger, #ef4444)",A="var(--theme-content1, #ffffff)",g="var(--theme-foreground, #1f2937)",_="var(--theme-content3, #6b7280)";let $=null,R="";l==="punchin"&&n.punchin_photo_url?($=n.punchin_photo_url,R="Check In Photo"):l==="punchout"&&n.punchout_photo_url&&($=n.punchout_photo_url,R="Check Out Photo");const H=$?`
            <div style="margin-top: 12px; margin-bottom: 12px;">
                <div style="color: ${_}; font-size: 11px; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px;">
                    ${R}
                </div>
                <img 
                    src="${$}" 
                    style="
                        width: 100%; 
                        max-height: 150px; 
                        object-fit: cover; 
                        border-radius: 8px;
                        border: 1px solid ${Y(k,.2)};
                    " 
                    onerror="this.style.display='none';"
                />
            </div>
        `:"";let B="",U=k;l==="punchin"?(B=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Y(T,.1)};
                    color: ${T};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Y(T,.2)};
                ">CHECK IN</div>
            `,U=T):l==="punchout"&&(B=`
                <div style="
                    display: inline-block;
                    padding: 2px 6px;
                    background: ${Y(C,.1)};
                    color: ${C};
                    border-radius: 4px;
                    font-size: 10px;
                    font-weight: 600;
                    margin-left: 8px;
                    border: 1px solid ${Y(C,.2)};
                ">CHECK OUT</div>
            `,U=C);let E="";return l==="punchin"?E=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${T}; margin-right: 8px;">üìç</span>
                    <span style="color: ${_}; font-size: 13px;">
                        Time: ${v(n.punchin_time)}
                    </span>
                </div>
            `:l==="punchout"?E=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${C}; margin-right: 8px;">üìç</span>
                    <span style="color: ${_}; font-size: 13px;">
                        Time: ${v(n.punchout_time)}
                    </span>
                </div>
            `:E=`
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <span style="color: ${T}; margin-right: 8px;">üìç</span>
                    <span style="color: ${_}; font-size: 13px;">
                        Check In: ${v(n.punchin_time)}
                    </span>
                </div>
                <div style="display: flex; align-items: center;">
                    <span style="color: ${C}; margin-right: 8px;">üìç</span>
                    <span style="color: ${_}; font-size: 13px;">
                        Check Out: ${v(n.punchout_time)}
                    </span>
                </div>
            `,`
            <div style="
                min-width: 250px;
                padding: 16px;
                background: linear-gradient(135deg, ${Y(A,.95)}, ${Y(U,.05)});
                border-radius: 12px;
                border: 1px solid ${Y(U,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
            ">
                <div style="display: flex; align-items: center; margin-bottom: 12px;">
                    <div style="
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${l==="punchin"?T:l==="punchout"?C:k}, ${y});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        margin-right: 12px;
                    ">
                        ${n.profile_image_url||n.profile_image?`<img src="${n.profile_image_url||n.profile_image}" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((V=(M=n.name)==null?void 0:M.charAt(0))==null?void 0:V.toUpperCase())||"?"}';" />`:((a=(te=n.name)==null?void 0:te.charAt(0))==null?void 0:a.toUpperCase())||"?"}
                    </div>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center;">
                            <span style="font-weight: 600; color: ${g}; font-size: 16px;">
                                ${n.name||"Unknown User"}
                            </span>
                            ${B}
                        </div>
                        <div style="color: ${_}; font-size: 12px;">
                            ${n.designation||"No designation"}
                        </div>
                    </div>
                </div>
                ${l==="combined"?`
                <div style="
                    display: inline-block;
                    padding: 4px 8px;
                    background: ${Y(i,.1)};
                    color: ${i};
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 600;
                    margin-bottom: 12px;
                    border: 1px solid ${Y(i,.2)};
                ">
                    ${n.punchout_time?"‚úì Completed":"‚è± Active"}
                </div>`:""}
                ${H}
                <div style="space-y: 8px;">
                    ${E}
                </div>
            </div>
        `},[v]);return r.useEffect(()=>{if(!w||!o.length)return;w.eachLayer(i=>{(i instanceof W.Marker&&i.options.userData||i instanceof W.Polyline&&i.options.userRoute)&&w.removeLayer(i)});const n=[],l=i=>{let k={...i},y=0;const T=10;for(;y<T&&n.some(A=>S(k,A));)k=P(i,y+1),y++;return n.push(k),k};o.forEach(i=>{const k=i.cycles||[];if(k.length>0)k.forEach((y,T)=>{const C=D(y.punchin_location),A=D(y.punchout_location);if(!C&&!A)return;const g=C&&A&&y.is_complete,_={...i,punchin_time:y.punchin_time,punchout_time:y.punchout_time,punchin_photo_url:y.punchin_photo_url,punchout_photo_url:y.punchout_photo_url};if(g){const $=l(C),R=l(A),H=W.marker([$.lat,$.lng],{icon:p(i,"punchin"),userData:!0});H.bindPopup(x(_,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),H.addTo(w);const B=W.marker([R.lat,R.lng],{icon:p(i,"punchout"),userData:!0});B.bindPopup(x(_,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),B.addTo(w),W.polyline([[$.lat,$.lng],[R.lat,R.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const R=l(C||A),H=C?"punchin":"punchout",B=W.marker([R.lat,R.lng],{icon:p(i,H),userData:!0});B.bindPopup(x(_,H),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),B.addTo(w)}});else{const y=D(i.punchin_location),T=D(i.punchout_location);if(!y&&!T)return;if(y&&T&&i.punchout_time){const A=l(y),g=l(T),_=W.marker([A.lat,A.lng],{icon:p(i,"punchin"),userData:!0});_.bindPopup(x(i,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),_.addTo(w);const $=W.marker([g.lat,g.lng],{icon:p(i,"punchout"),userData:!0});$.bindPopup(x(i,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),$.addTo(w),W.polyline([[A.lat,A.lng],[g.lat,g.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(w)}else{const g=l(y||T),_=y?"punchin":"punchout",$=W.marker([g.lat,g.lng],{icon:p(i,_),userData:!0});$.bindPopup(x(i,_),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),$.addTo(w)}}})},[w,o,c,D,S,P,p,x]),null});Be.displayName="UserMarkers";const Ut=s=>r.useMemo(()=>{const t=s.reduce((m,f)=>{const j=f.user_id;return m[j]||(m[j]=[]),m[j].push(f),m},{}),c=Object.keys(t),u=c.length;let o=0,h=0;return c.forEach(m=>{const f=t[m];f.sort((N,F)=>N.punchin_time?F.punchin_time?N.punchin_time.localeCompare(F.punchin_time):-1:1);const j=f[f.length-1];f.some(N=>N.punchin_time)&&(j.punchout_time?h++:o++)}),{checkedIn:o,completed:h,total:u}},[s]),zt=le.memo(({updateMap:s,selectedDate:t})=>{const{themeSettings:c}=Xe(),u=fe("(min-width: 1025px)"),o=fe("(min-width: 641px) and (max-width: 1024px)"),[h,m]=r.useState([]),[f,j]=r.useState([]),[w,N]=r.useState(!0),[F,P]=r.useState(null),[S,D]=r.useState(!1),[v,p]=r.useState(null),[x,n]=r.useState(!0),[l,i]=r.useState(0),k=window.innerWidth<640,[y,T]=r.useState(new Date),C=r.useRef([]),A=r.useRef(null),g=r.useCallback(async()=>{N(!0);try{const U=route("getUserLocationsForDate",{date:t,_t:Date.now()});if(!t){m([]),j([]),C.current=[],i(a=>a+1),T(new Date),p(new Date);return}const E=await fetch(U);if(!E.ok)throw new Error(`HTTP ${E.status}: Failed to refresh user locations`);const M=await E.json(),V=Array.isArray(M.locations)?M.locations:[],te=Array.isArray(M.attendance_type_configs)?M.attendance_type_configs:[];m(V),j(te),C.current=V,i(a=>a+1),T(new Date),p(new Date)}catch(U){console.error("Error refreshing map:",U),m([]),j([]),C.current=[]}finally{N(!1)}},[t]),_=r.useMemo(()=>{if(!t)return"Invalid Date";try{return new Date(t).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[t]),$=Ut(h),R=r.useCallback(async()=>{if(!t){N(!1);return}try{const U=route("check-user-locations-updates",{date:t.split("T")[0]}),E=await fetch(U);if(!E.ok)throw new Error(`HTTP ${E.status}: Failed to check for updates`);const M=await E.json();M.success&&M.last_updated!==A.current&&M.last_updated&&(A.current=M.last_updated,g(),p(new Date)),T(new Date)}catch(U){console.error("Error checking for updates:",U),N(!1)}},[t,g]);r.useEffect(()=>{if(!x)return;R();const U=setInterval(R,5e3);return()=>clearInterval(U)},[x,R]),r.useEffect(()=>{h.length===0&&w&&S&&N(!1)},[h,w,S]),r.useEffect(()=>{if(w){const U=setTimeout(()=>{w&&(console.log("Loading timeout reached, forcing loading to false"),N(!1))},1e4);return()=>clearTimeout(U)}},[w]);const H=r.useMemo(()=>y?y.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[y]),B=r.useCallback(U=>{const E=Array.isArray(U)?U:[];JSON.stringify(E)!==JSON.stringify(C.current)&&(m(E),C.current=E),D(!0),N(!1)},[]);return e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(Z,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(_e,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${u?"p-6":o?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${u?"p-3":o?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(De,{className:`
                                                    ${u?"w-8 h-8":o?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${u?"text-2xl":o?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${u?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${u?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:_})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:H&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",H]})})]})})})}),e.jsx(Me,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(xe,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(mt,{className:"mb-6",stats:[{title:"Total",value:$.total,icon:e.jsx(ft,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:$.checkedIn,icon:e.jsx($t,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:$.completed,icon:e.jsx(gt,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:k})}),e.jsx("div",{className:"p-6 pt-0",children:h.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[w&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(ht,{center:[Ae.lat,Ae.lng],zoom:q.DEFAULT_ZOOM,minZoom:q.MIN_ZOOM,maxZoom:q.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(pt,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:q.MAX_ZOOM,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(He,{attendanceTypeConfigs:f,theme:c}),e.jsx(Be,{users:h,setUsers:m,setLoading:N,setError:P,setAttendanceTypeConfigs:j,lastUpdate:v,selectedDate:t,onUsersLoad:B,theme:c})]},`${s}-${l}`)]}):w?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(De,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",_,".",t&&new Date(t)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(re,{variant:"bordered",color:"primary",size:"md",radius:Ot(),onPress:g,startContent:e.jsx(Mt,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})})})});ee.extend(xt);const he=()=>{var u;if(typeof window>"u")return"lg";const t=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",c=parseInt(t);return c===0?"none":c<=4?"sm":c<=8?"md":c<=16?"lg":"full"},pe=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),Ht=({title:s,items:t,users:c,icon:u,color:o})=>{var v;const[h,m]=r.useState(null),[f,j]=r.useState(null),w=(p,x)=>{m(p.currentTarget),j(x)},N=()=>{m(null),j(null)},F=!!h,P=F?"leave-details-popover":void 0,S=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return e.jsx(ge,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(vt,{className:"w-4 h-4 text-danger"});default:return e.jsx(ae,{className:"w-4 h-4 text-warning"})}},D=p=>{switch(p==null?void 0:p.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(Z,{className:"h-full flex flex-col",radius:he(),style:pe(),onMouseEnter:p=>{p.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${o} 50%, transparent)`,p.currentTarget.style.borderRadius="var(--borderRadius, 12px)",p.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:p=>{p.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",p.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(_e,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${o} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${o} 25%, transparent)`},children:e.jsx(u,{className:"w-6 h-6 stroke-2",style:{color:o},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s})]})}),e.jsx(xe,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:t.map((p,x)=>e.jsxs(le.Fragment,{children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:p.text}),p.leaves&&p.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ue,{className:"w-3 h-3"}),p.leaves.length," employee",p.leaves.length>1?"s":""]})]}),p.leaves&&(()=>{const n=p.leaves.filter(l=>l.leave_type===p.type);return n.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(Ct,{max:4,isBordered:!0,size:"sm",children:n.map((l,i)=>{const k=c.find(y=>String(y.id)===String(l.user_id));return k&&e.jsx(We,{src:k.profile_image_url,name:`${k.name} - on leave`,onClick:y=>w(y,l),className:"cursor-pointer hover:scale-110 transition-transform",fallback:e.jsx(Le,{className:"w-4 h-4"})},i)})})})})()]}),x<t.length-1&&e.jsx(Me,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},x))}),e.jsx(ot,{id:P,open:F,anchorEl:h,onClose:N,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(it,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:f&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(je,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((v=c.find(p=>String(p.id)===String(f.user_id)))==null?void 0:v.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.from_date!==f.to_date?`${new Date(f.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(f.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(f.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:f.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S(f.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(oe,{label:f.status||"Pending",variant:"flat",color:D(f.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},Bt=()=>{const{auth:s}=Oe().props,t=fe("(min-width: 1025px)"),c=fe("(min-width: 641px) and (max-width: 1024px)"),[u,o]=r.useState(!0),[h,m]=r.useState(null),[f,j]=r.useState([]),[w,N]=r.useState([]),[F,P]=r.useState([]),[S,D]=r.useState(null);r.useEffect(()=>{let g=!0;const _=new AbortController;return(async()=>{try{o(!0),m(null);const R=await ie.get(route("updates"),{signal:_.signal,timeout:1e4});g&&R.data&&(j(R.data.users||[]),N(R.data.todayLeaves||[]),P(R.data.upcomingLeaves||[]),D(R.data.upcomingHoliday||null))}catch(R){g&&!_.signal.aborted&&(console.error("Failed to fetch updates:",R),m(R.message),j([]),N([]),P([]),D(null))}finally{g&&o(!1)}})(),()=>{g=!1,_.abort()}},[]);const v=(g,_)=>{let $=_;const R=E=>_.some(V=>String(V.user_id)===String(s.user.id)&&V.leave_type===E)?($=_.filter(V=>String(V.user_id)!==String(s.user.id)),`You ${g==="today"?"are":"will be"} on ${E} leave.`):null,H=_.reduce((E,M)=>{const V=R(M.leave_type);return V&&!E.some(te=>te.type===M.leave_type)&&E.push({text:V,type:M.leave_type}),E},[]),B=$.reduce((E,M)=>(E[M.leave_type]=(E[M.leave_type]||0)+1,E),{}),U=Object.entries(B).map(([E,M])=>({text:`${M} person${M>1?"s":""} ${g==="today"?"is":"will be"} on ${E} leave`,type:E,leaves:$.filter(V=>V.leave_type===E)}));return[...H,...U]},p=ee(),x=p.add(1,"day"),n=x.add(7,"day"),l=w.filter(g=>ee(p).isBetween(ee(g.from_date),ee(g.to_date),"day","[]")),i=F.filter(g=>ee(x).isBetween(ee(g.from_date),ee(g.to_date),"day","[]")),k=F.filter(g=>(ee(g.from_date).isBetween(x,n,"day","[]")||ee(g.to_date).isBetween(x,n,"day","[]"))&&!/week/i.test(g.leave_type)),y=v("today",l),T=v("tomorrow",i),C=v("nextSevenDays",k);y.length===0&&y.push({text:"No one is away today."}),T.length===0&&T.push({text:"No one is away tomorrow."}),C.length===0&&C.push({text:"No one is going to be away in the next seven days."});const A=[{title:"Today",items:y,icon:we,color:"#3b82f6"},{title:"Tomorrow",items:T,icon:ae,color:"#10b981"},{title:"Next Seven Days",items:C,icon:Ue,color:"#f59e0b"}];return u?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((g,_)=>e.jsx("div",{children:e.jsxs(Z,{className:"w-full h-full",radius:he(),style:pe(),children:[e.jsx(Fe,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(Fe,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},_))})}):h?e.jsx("div",{className:`${t?"p-6":c?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(Z,{radius:he(),style:{...pe(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",h]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:A.map((g,_)=>e.jsx("div",{className:"flex",children:e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:_*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(Ht,{title:g.title,items:g.items,users:f,icon:g.icon,color:g.color})})})},g.title))}),S&&e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(Z,{radius:he(),style:pe(),onMouseEnter:g=>{g.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",g.currentTarget.style.borderRadius="var(--borderRadius, 12px)",g.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:g=>{g.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",g.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(_e,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(yt,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(xe,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ne,{className:"w-4 h-4"}),S.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(we,{className:"w-4 h-4"}),new Date(S.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(S.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(It,{className:"w-4 h-4"}),S.description]})]})})})]})})})]})},Gt=({title:s,value:t,icon:c,color:u,isLoaded:o,testId:h})=>e.jsx(K.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(Z,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:m=>{m.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${u} 50%, transparent)`,m.currentTarget.style.borderRadius="var(--borderRadius, 12px)",m.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:m=>{m.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",m.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(Fe,{className:"rounded-lg",isLoaded:o,"data-testid":h,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${s} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:s}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${u} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${u} 25%, transparent)`},children:e.jsx(c,{className:"w-6 h-6 stroke-2",style:{color:u},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof t=="number"?t.toLocaleString():t})})]})})})})}),Vt=()=>{const[s,t]=r.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[c,u]=r.useState(!0),[o,h]=r.useState(null);r.useEffect(()=>{let f=!0;const j=new AbortController;return(async()=>{var N;try{u(!0),h(null);const F=await ie.get(route("stats"),{signal:j.signal,timeout:1e4});if(f&&((N=F.data)!=null&&N.statistics))t(F.data.statistics);else throw new Error("Invalid response structure")}catch(F){f&&!j.signal.aborted&&(console.error("Failed to fetch statistics:",F),h(F.message),t({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{f&&u(!1)}})(),()=>{f=!1,j.abort()}},[]);const m=[{id:"total-daily-works",title:"Total Daily Works",value:s.total,icon:bt,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:s.completed,icon:ge,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:s.pending,icon:ae,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:s.rfi_submissions,icon:je,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return o?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(Z,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",o]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:m.map((f,j)=>e.jsx("div",{className:"w-full",children:e.jsx(Gt,{title:f.title,value:f.value,icon:f.icon,color:f.color,isLoaded:!c,testId:f.testId})},f.id))})})})},Zt=(s,t)=>{let c;return function(...o){const h=()=>{clearTimeout(c),s(...o)};clearTimeout(c),c=setTimeout(h,t)}},qt=()=>{const[s,t]=r.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),c=r.useCallback(()=>{const u=window.innerWidth,o={isMobile:u<=768,isTablet:u>768&&u<=1024,isDesktop:u>1024};t(h=>JSON.stringify(h)!==JSON.stringify(o)?o:h)},[]);return r.useEffect(()=>{c();const u=Zt(c,150);return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[c]),s},z={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Ge=le.memo(()=>{var te;const{auth:s}=Oe().props,t=s.user,{isMobile:c,isTablet:u}=qt(),[o,h]=r.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[m,f]=r.useState({status:z.CHECKING,coordinates:null,error:null,lastUpdate:null}),[j,w]=r.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[N,F]=r.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),[P,S]=r.useState({isOpen:!1,capturedPhoto:null,isCapturing:!1,stream:null,pendingPunchData:null}),D=r.useRef(null),v=r.useRef(null),p=r.useMemo(()=>{const a=t==null?void 0:t.attendance_type;if(!(a!=null&&a.slug))return!1;const d=a.slug.replace(/_\d+$/,"");return["geo_polygon","route_waypoint"].includes(d)},[t==null?void 0:t.attendance_type]),x=r.useCallback(()=>new Promise((a,d)=>{if(!navigator.geolocation){d(new Error("Geolocation is not supported by this browser"));return}const b={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(I=>{const G={latitude:I.coords.latitude,longitude:I.coords.longitude,accuracy:I.coords.accuracy,timestamp:new Date(I.timestamp)};a(G)},I=>{let G="Location unavailable";switch(I.code){case 1:G="Location access denied. Please allow location permission in your browser settings.";break;case 2:G="Location unavailable. Please ensure GPS is enabled.";break;case 3:G="Location request timed out. Please try again.";break;default:G="Unable to retrieve location. Please try again."}d(new Error(G))},b)}),[]),n=r.useCallback(async()=>{f(a=>({...a,status:z.CHECKING,error:null}));try{const a=await x();f({status:z.ACTIVE,coordinates:a,error:null,lastUpdate:new Date})}catch(a){const d=a.message.includes("denied")||a.message.includes("Permission");f({status:d?z.DENIED:z.INACTIVE,coordinates:null,error:a.message,lastUpdate:new Date})}},[x]),l=r.useCallback(async()=>{if(m.status===z.DENIED)try{f(d=>({...d,status:z.CHECKING,error:null}));const a=await x();f({status:z.ACTIVE,coordinates:a,error:null,lastUpdate:new Date}),X.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{f(d=>({...d,status:z.DENIED,error:"Location access still denied. Please check your browser settings."})),X.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[m.status,x]),i=r.useMemo(()=>{if(o.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(me,{className:"w-4 h-4"})};switch(o.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(Rt,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(Lt,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(ae,{className:"w-4 h-4"})}}},[o.currentStatus,o.userOnLeave]),k=r.useMemo(()=>({sessionsToday:o.todayPunches.length,averageSessionTime:o.todayPunches.length>0?Math.round(parseFloat(o.realtimeWorkTime.split(":")[0])/o.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(o.realtimeWorkTime.split(":")[0])/8*100)}),[o.todayPunches,o.realtimeWorkTime]),y=r.useMemo(()=>{var a;switch(m.status){case z.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case z.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (¬±${Math.round(((a=m.coordinates)==null?void 0:a.accuracy)||0)}m)`};case z.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case z.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[m.status,(te=m.coordinates)==null?void 0:te.accuracy]),T=r.useCallback(()=>{const a=new Date;let d=0,b=!1;if(o.todayPunches.forEach(O=>{if(O.punchin_time){let se;try{if(se=new Date(O.punchin_time),isNaN(se.getTime())||typeof O.punchin_time=="string"&&O.punchin_time.includes(":")&&!O.punchin_time.includes("T")){const J=new Date,[de,ne,ye]=O.punchin_time.split(":");se=new Date(J.getFullYear(),J.getMonth(),J.getDate(),parseInt(de),parseInt(ne),parseInt(ye||0))}}catch{console.warn("Invalid punch in time format:",O.punchin_time);return}if(isNaN(se.getTime()))return;if(O.punchout_time){let J;try{if(J=new Date(O.punchout_time),isNaN(J.getTime())||typeof O.punchout_time=="string"&&O.punchout_time.includes(":")&&!O.punchout_time.includes("T")){const ne=new Date,[ye,Ve,Ze]=O.punchout_time.split(":");J=new Date(ne.getFullYear(),ne.getMonth(),ne.getDate(),parseInt(ye),parseInt(Ve),parseInt(Ze||0))}}catch{console.warn("Invalid punch out time format:",O.punchout_time);return}if(isNaN(J.getTime()))return;const de=Math.floor((J-se)/1e3);de>0&&(d+=de)}else{b=!0;const J=Math.floor((a-se)/1e3);J>0&&(d+=J)}}}),!b&&o.totalWorkTime&&o.totalWorkTime!=="00:00:00"){h(O=>({...O,realtimeWorkTime:o.totalWorkTime}));return}(isNaN(d)||d<0)&&(d=0);const I=Math.floor(d/3600),G=Math.floor(d%3600/60),Q=d%60,ce=`${I.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}:${Q.toString().padStart(2,"0")}`;h(O=>({...O,realtimeWorkTime:ce}))},[o.todayPunches,o.totalWorkTime]),C=r.useCallback(async()=>{try{const d=(await ie.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;h(b=>({...b,todayPunches:d.punches||[],totalWorkTime:d.total_production_time||"00:00:00",realtimeWorkTime:d.total_production_time||"00:00:00",userOnLeave:d.isUserOnLeave,lastRefresh:new Date,currentStatus:d.punches&&d.punches.length>0?d.punches[d.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(a){console.error("Error fetching current status:",a),X.error("Failed to fetch attendance status")}},[]),A=r.useCallback(()=>{const a=document.createElement("canvas"),d=a.getContext("2d");return d.textBaseline="top",d.font="14px Arial",d.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:a.toDataURL(),timestamp:Date.now()}},[]),g=r.useCallback(async()=>{try{const a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});D.current&&(D.current.srcObject=a,await D.current.play()),S(d=>({...d,stream:a,isCapturing:!1}))}catch(a){console.error("Camera access error:",a),X.error("Unable to access camera. Please check permissions."),S(d=>({...d,isOpen:!1}))}},[]),_=r.useCallback(()=>{P.stream&&P.stream.getTracks().forEach(a=>a.stop()),S(a=>({...a,stream:null,isOpen:!1,capturedPhoto:null}))},[P.stream]),$=r.useCallback(async()=>{if(!(!D.current||!v.current)){S(a=>({...a,isCapturing:!0}));try{const a=D.current,d=v.current,b=d.getContext("2d");d.width=a.videoWidth,d.height=a.videoHeight,b.drawImage(a,0,0);const I=m.coordinates;if(I){const Q=`üìç ${I.latitude.toFixed(6)}, ${I.longitude.toFixed(6)} | ${new Date().toLocaleString()}`;b.fillStyle="rgba(0, 0, 0, 0.7)",b.fillRect(0,d.height-40,d.width,40),b.fillStyle="#ffffff",b.font="bold 16px Arial",b.textBaseline="middle",b.fillText(Q,10,d.height-20)}const G=d.toDataURL("image/jpeg",.85);S(Q=>({...Q,capturedPhoto:G,isCapturing:!1})),X.success("Photo captured successfully!")}catch(a){console.error("Photo capture error:",a),X.error("Failed to capture photo. Please try again."),S(d=>({...d,isCapturing:!1}))}}},[m.coordinates]),R=r.useCallback(()=>{S(a=>({...a,capturedPhoto:null}))},[]),H=r.useCallback(async()=>{var a,d;if(!P.capturedPhoto||!P.pendingPunchData){X.error("Please capture a photo first.");return}h(b=>({...b,loading:!0})),_();try{const b={...P.pendingPunchData,photo:P.capturedPhoto},I=await ie.post(route("attendance.punch"),b);I.data.status==="success"?(w(G=>({...G,sessionDialogOpen:!0})),setTimeout(()=>{C()},500)):X.error(I.data.message)}catch(b){console.error("Punch operation failed:",b);const I=((d=(a=b.response)==null?void 0:a.data)==null?void 0:d.message)||"Unable to record attendance. Please try again.";X.error(I)}finally{h(b=>({...b,loading:!1})),S(b=>({...b,pendingPunchData:null,capturedPhoto:null}))}},[P.capturedPhoto,P.pendingPunchData,_,C]),B=r.useCallback(async a=>{S(d=>({...d,isOpen:!0,pendingPunchData:a,capturedPhoto:null})),setTimeout(()=>g(),300)},[g]),U=r.useCallback(async()=>{var a,d;if(o.userOnLeave){X.warning("You are on leave today. Cannot punch in/out.");return}if(m.status!==z.ACTIVE){X.error("Location access required for attendance. Please enable GPS and try again.");return}h(b=>({...b,loading:!0}));try{const b=await x(),I=A();let G="Unknown";try{G=(await ie.get(route("getClientIp"))).data.ip}catch(O){console.warn("Could not fetch IP address:",O)}F(O=>({...O,sessionInfo:{ip:G,accuracy:b.accuracy?`${Math.round(b.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const Q={lat:b.latitude,lng:b.longitude,accuracy:b.accuracy,ip:G,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(I),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};if(p){h(O=>({...O,loading:!1})),B(Q);return}const ce=await ie.post(route("attendance.punch"),Q);ce.data.status==="success"?(w(O=>({...O,sessionDialogOpen:!0})),setTimeout(()=>{C()},500)):X.error(ce.data.message)}catch(b){console.error("Punch operation failed:",b);const I=((d=(a=b.response)==null?void 0:a.data)==null?void 0:d.message)||"Unable to record attendance. Please try again.";X.error(I,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{h(b=>({...b,loading:!1}))}},[o.userOnLeave,m.status,x,A,C,p,B]),E=r.useCallback(()=>{y.clickable&&(m.status===z.DENIED?l():m.status===z.INACTIVE&&n())},[y.clickable,m.status,l,n]),M=r.useCallback(a=>{if(!a)return"--:--";try{let d;if(typeof a=="string"&&a.includes(":")&&!a.includes("T")){const b=new Date,[I,G,Q]=a.split(":");d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),parseInt(I),parseInt(G),parseInt(Q||0))}else d=new Date(a);return isNaN(d.getTime())?"--:--":d.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),V=r.useCallback(a=>{var d,b;if(!a)return"Location not available";try{if(typeof a=="object"&&a.lat&&a.lng)return(d=a.address)!=null&&d.trim()?a.address.substring(0,30):`${a.lat.toFixed(4)}, ${a.lng.toFixed(4)}`;if(typeof a=="string")try{const I=JSON.parse(a);if(I.lat&&I.lng)return(b=I.address)!=null&&b.trim()?I.address.substring(0,30):`${I.lat.toFixed(4)}, ${I.lng.toFixed(4)}`}catch{return a.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return r.useEffect(()=>{const a=setInterval(()=>{F(d=>({...d,currentTime:new Date})),o.currentStatus==="punched_in"&&o.todayPunches.length>0&&T()},1e3);return()=>clearInterval(a)},[o.currentStatus,o.todayPunches.length,T]),r.useEffect(()=>{C(),n();const a=()=>{F(I=>({...I,connectionStatus:{...I.connectionStatus,network:!0}})),C()},d=()=>{F(I=>({...I,connectionStatus:{...I.connectionStatus,network:!1}}))},b=()=>{C(),n()};return window.addEventListener("online",a),window.addEventListener("offline",d),window.addEventListener("focus",b),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",d),window.removeEventListener("focus",b)}},[C,n]),r.useEffect(()=>{const a=setInterval(()=>{C()},3e4);return()=>clearInterval(a)},[C]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(Z,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(xe,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(lt,{content:"",color:i.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(ct,{src:(t==null?void 0:t.profile_image_url)||(t==null?void 0:t.profile_image),name:t==null?void 0:t.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate notranslate",style:{color:"var(--theme-foreground)"},"data-name":"true",children:t==null?void 0:t.name}),e.jsxs("p",{className:"text-xs notranslate",style:{color:"var(--theme-foreground-600)"},"data-no-translate":"true",children:["ID: ",(t==null?void 0:t.employee_id)||(t==null?void 0:t.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:N.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:N.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(oe,{color:i.color,variant:"flat",startContent:i.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:i.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ae,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:o.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(dt,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:k.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(re,{color:i.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:U,isDisabled:o.loading||o.userOnLeave||m.status!==z.ACTIVE,isLoading:o.loading,startContent:!o.loading&&i.icon,className:"mb-4 font-semibold",style:{background:o.userOnLeave||m.status!==z.ACTIVE?"var(--theme-default, #71717A)":i.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":i.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":i.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading||o.userOnLeave||m.status!==z.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:o.loading?"Processing...":i.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(ve,{content:y.tooltip,children:e.jsx(oe,{size:"sm",variant:y.variant,color:y.color,startContent:m.status===z.CHECKING?e.jsx(be,{size:"sm",className:"w-3 h-3"}):e.jsx(ue,{className:"w-3 h-3"}),className:`text-xs transition-all ${y.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:y.clickable?E:void 0,children:y.text})}),e.jsx(ve,{content:`Network: ${N.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(oe,{size:"sm",variant:"flat",color:N.connectionStatus.network?"success":"default",startContent:e.jsx(jt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(ve,{content:"Device Security",children:e.jsx(oe,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(Nt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),m.error&&m.status!==z.ACTIVE&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(me,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:m.error})]})}),o.userOnLeave&&e.jsx(Z,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",o.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(o.userOnLeave.from_date).toLocaleDateString()," - ",new Date(o.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(Ye,{children:e.jsx(Qe,{"aria-label":"Today's Activity",startContent:e.jsx(wt,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[k.sessionsToday," sessions ‚Ä¢ ",o.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:o.todayPunches.length>0?o.todayPunches.map((a,d)=>e.jsx(Z,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:M(a.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ue,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:V(a.punchin_location)})]})]})]}),a.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:M(a.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ue,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:V(a.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(ae,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),a.duration&&e.jsx(oe,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:a.duration})]})},d)):e.jsxs(Z,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Ne,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(Se,{isOpen:j.sessionDialogOpen,onOpenChange:a=>w(d=>({...d,sessionDialogOpen:a})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(Pe,{children:a=>e.jsxs(e.Fragment,{children:[e.jsxs(Re,{className:"flex flex-col gap-1 text-center",children:[e.jsx(ge,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Ee,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(Ft,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:N.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(Z,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ue,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:N.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(Z,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",N.sessionInfo.timestamp]})]})})]}),e.jsx(Te,{children:e.jsx(re,{color:"primary",variant:"shadow",fullWidth:!0,onPress:a,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})}),e.jsx(Se,{isOpen:P.isOpen,onClose:_,size:"lg",classNames:{backdrop:"bg-black/80",base:"bg-content1"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs(Pe,{children:[e.jsxs(Re,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Capture Attendance Photo"})]}),e.jsx("p",{className:"text-sm text-default-500 font-normal",children:"Take a photo for verification. Location coordinates will be added automatically."})]}),e.jsxs(Ee,{className:"p-4",children:[e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black",children:[P.capturedPhoto?e.jsx("img",{src:P.capturedPhoto,alt:"Captured",className:"w-full h-auto max-h-[400px] object-contain"}):e.jsx("video",{ref:D,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-[400px] object-contain"}),e.jsx("canvas",{ref:v,className:"hidden"}),m.coordinates&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white text-xs",style:{background:"rgba(0,0,0,0.7)"},children:["üìç ",m.coordinates.latitude.toFixed(6),", ",m.coordinates.longitude.toFixed(6)]})]}),e.jsx("div",{className:"mt-3 p-3 rounded-lg text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-primary"}),P.capturedPhoto?"Review your photo. You can retake if needed.":"Position yourself clearly in the frame and capture the photo."]})})]}),e.jsxs(Te,{className:"flex gap-2",children:[e.jsx(re,{color:"danger",variant:"light",onPress:_,style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Cancel"}),P.capturedPhoto?e.jsxs(e.Fragment,{children:[e.jsx(re,{color:"secondary",variant:"flat",onPress:R,startContent:e.jsx(et,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Retake"}),e.jsxs(re,{color:"success",variant:"shadow",onPress:H,isLoading:o.loading,startContent:!o.loading&&e.jsx(ge,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:["Confirm & ",i.action]})]}):e.jsx(re,{color:"primary",variant:"shadow",onPress:$,isLoading:P.isCapturing,isDisabled:!P.stream,startContent:!P.isCapturing&&e.jsx($e,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Capture Photo"})]})]})})]})});Ge.displayName="PunchStatusCard";function Kt({auth:s}){const[t,c]=r.useState(!1),[u,o]=r.useState(!1),[h,m]=r.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),f={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},j={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},w={hidden:{opacity:0,y:30,scale:.9},visible:v=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:v*.15,ease:"easeOut"}})},N=v=>s.permissions&&s.permissions.includes(v),F=v=>v.some(p=>N(p)),P=v=>v.every(p=>N(p)),S=()=>{c(v=>!v),o(v=>!v)},D=v=>{const p=v.target.value;m(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(p))),o(x=>!x),c(x=>!x)};return e.jsxs(e.Fragment,{children:[e.jsx(tt,{title:"Dashboard"}),e.jsx(K.div,{variants:f,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(K.div,{variants:j,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[P(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Ge,{handlePunchSuccess:S})},"punch-status-card")},"punch-status-grid"),N("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:w,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Vt,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),F(["attendance.view","employees.view"])&&e.jsxs(K.div,{variants:f,initial:"hidden",animate:"visible",children:[e.jsx(K.div,{variants:w,custom:2,children:e.jsx(rt,{selectedDate:h,handleDateChange:D,updateTimeSheet:u})},"timesheet-section"),e.jsx(K.div,{variants:w,custom:3,children:e.jsx(zt,{selectedDate:h,updateMap:t})},"user-locations-section")]}),N("core.updates.view")&&e.jsx(K.div,{variants:w,custom:4,initial:"hidden",animate:"visible",children:e.jsx(Bt,{})},"updates-section")]})})]})}Kt.layout=s=>e.jsx(ut,{children:s});export{Kt as default};
