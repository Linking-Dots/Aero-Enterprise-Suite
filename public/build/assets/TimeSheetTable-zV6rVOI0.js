import{R as Be,r as a,j as e,s as He,A as Ke,b as ee,L as Je,J as Ce,e as G,a as Re,f as Ie,d as Me}from"./app-CXVy-AmZ.js";import{v as Qe,n as Z,p as $e,w as Xe,i as qe}from"./Dashboard-T69k2ogy.js";import{d as x}from"./dayjs.min-DU2q2q_C.js";import{P as Ge}from"./PageHeader-CCmAmwDi.js";import{F as h}from"./ClockIcon-BZdFQI9v.js";import{F as W}from"./CheckCircleIcon-ELAb3fzt.js";import{F as Pe}from"./XCircleIcon-D_wAPF3V.js";import{F as oe}from"./MagnifyingGlassIcon-Bhzw0GfZ.js";import{m as Se}from"./proxy-Cdac7JMG.js";import{F as V}from"./ExclamationTriangleIcon-BatQCU_y.js";import{F as Ze}from"./UserPlusIcon-CUAe2zk7.js";import{i as ie}from"./chunk-SSA7SXE4-DhBPeL1m.js";import{F as Ye}from"./DocumentArrowDownIcon-CpRfy8xn.js";import{F as es}from"./UserGroupIcon-C289kc4l.js";import{F as ss}from"./UserIcon-pC-qbD6I.js";import{l as ts}from"./chunk-JOT4BT4P-B8ZBmXR7.js";import{c as as}from"./chunk-D5XJWRAV-DU87gX_a.js";import{a as rs}from"./chunk-Y2AYO5NJ-Di_MG5Co.js";import{s as ns}from"./chunk-TLYTI3QM-BSLAf0Ky.js";import{t as ls,a as os,b as is,c as F}from"./chunk-F3UDT23P-XfTYxSwz.js";import{t as cs,a as ds}from"./chunk-YRZGWF2W-MHyJPKcB.js";import{p as ms}from"./chunk-EAPQ7RWQ-DSkgqx9G.js";import{u as xs}from"./chunk-S574QCAN-DOLZ_IFv.js";const us=Be.memo(({absentUsers:M,selectedDate:l,getUserLeave:$,isLoaded:_=!1,onMarkAsPresent:k})=>{const[D,C]=a.useState(5),[c,i]=a.useState(""),v=()=>{var Y;const n=((Y=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:Y.trim())||"12px",d=parseInt(n);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},j=a.useMemo(()=>{if(!c.trim())return M;const r=c.toLowerCase();return M.filter(n=>{var g,re,N,E;const d=((g=n.name)==null?void 0:g.toLowerCase())||"",Y=((re=n.employee_id)==null?void 0:re.toString().toLowerCase())||"",te=((N=n.email)==null?void 0:N.toLowerCase())||"",ae=((E=n.phone)==null?void 0:E.toString().toLowerCase())||"";return d.includes(r)||Y.includes(r)||te.includes(r)||ae.includes(r)})},[M,c]),B=()=>{C(r=>r+5)},se=r=>{i(r.target.value),C(5)},R=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return e.jsx(W,{className:"w-4 h-4",style:{color:"var(--theme-success)"}});case"rejected":return e.jsx(Pe,{className:"w-4 h-4",style:{color:"var(--theme-danger)"}});case"pending":return e.jsx(h,{className:"w-4 h-4",style:{color:"var(--theme-warning)"}});default:return e.jsx(h,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}})}},b=r=>{switch(r==null?void 0:r.toLowerCase()){case"approved":return"var(--theme-success)";case"rejected":return"var(--theme-danger)";case"pending":return"var(--theme-warning)";default:return"var(--theme-primary)"}},P=j.length;return _?_&&M.length===0?e.jsxs("div",{className:"h-full",children:[e.jsx(Ge,{title:"Perfect Attendance!",subtitle:`No employees are absent on ${x(l).format("MMMM D, YYYY")}`,icon:e.jsx(W,{className:"w-6 h-6"}),variant:"gradient",actionButtons:[{label:"0",variant:"flat",color:"success",icon:e.jsx(W,{className:"w-4 h-4"}),className:"bg-green-500/10 text-green-500 border-green-500/20"}]}),e.jsxs("div",{role:"region","aria-label":"No absent employees today",className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-success) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4",style:{color:"var(--theme-success)"}}),e.jsx("p",{className:"mb-2 text-sm font-medium",style:{color:"var(--theme-success)",fontFamily:'var(--fontFamily, "Inter")'},children:"Perfect Attendance!"}),e.jsx("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No employees are absent today."}),e.jsx("p",{className:"text-default-500 mt-1 block text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"All employees are either present or on approved leave."})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Pe,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),"Absent Employees (",P,")"]})}),e.jsx("div",{className:"mb-3 flex-shrink-0",children:e.jsx(ie,{type:"text",placeholder:"Search absent employees...",value:c,onChange:se,startContent:e.jsx(oe,{className:"w-4 h-4 text-default-400"}),variant:"bordered",size:"sm",radius:v(),"aria-label":"Search absent employees",classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'}})}),c&&e.jsx("div",{className:"mb-2 flex-shrink-0",children:e.jsxs("p",{className:"text-default-500 text-xs",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[j.length," of ",M.length," employees found"]})}),c&&j.length===0&&e.jsxs("div",{className:"text-center py-8 flex-1 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(oe,{className:"w-8 h-8 text-default-300 mx-auto mb-2"}),e.jsxs("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:['No employees found matching "',c,'"']})]}),e.jsxs("div",{role:"region","aria-label":"Absent employees list",className:"flex-1 overflow-y-auto min-h-0",style:{maxHeight:"calc(100vh - 400px)"},children:[e.jsx(Ke,{children:j.slice(0,D).map(r=>{const n=$(r.id);return e.jsx(Se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"p-3 mb-3 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},onMouseEnter:d=>{d.currentTarget.style.background="color-mix(in srgb, var(--theme-content2) 60%, transparent)"},onMouseLeave:d=>{d.currentTarget.style.background="color-mix(in srgb, var(--theme-content1) 80%, transparent)"},children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(Qe,{src:r.profile_image_url||r.profile_image,name:r.name,isBordered:!0,size:"sm",showFallback:!0,radius:v()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"truncate text-sm font-medium text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:r.name}),r.employee_id&&e.jsxs("p",{className:"block text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["ID: ",r.employee_id]}),n?e.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[e.jsxs("p",{className:"flex items-center gap-1 text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Z,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:n.from_date===n.to_date?n.from_date:`${n.from_date} - ${n.to_date}`})]}),e.jsxs("p",{className:"flex items-center gap-1 text-xs",style:{color:b(n.status),fontFamily:'var(--fontFamily, "Inter")'},children:[R(n.status),e.jsxs("span",{className:"truncate",children:[n.leave_type," Leave"]})]})]}):e.jsxs("p",{className:"flex items-center gap-1 mt-1 text-xs",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(V,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate",children:"Absent without leave"})]})]})]}),n&&e.jsx("div",{className:"px-1.5 py-0.5 ml-2 flex-shrink-0",style:{background:`color-mix(in srgb, ${b(n.status)} 15%, transparent)`,borderColor:`color-mix(in srgb, ${b(n.status)} 30%, transparent)`,borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 6px)"},children:e.jsxs("div",{className:"flex items-center gap-1",children:[R(n.status),e.jsx("span",{className:"font-semibold text-xs",style:{color:b(n.status),fontFamily:'var(--fontFamily, "Inter")'},children:n.status})]})})]}),k&&!n&&e.jsx("div",{className:"flex justify-end",children:e.jsx(ee,{color:"primary",variant:"flat",size:"sm",radius:v(),startContent:e.jsx(Ze,{className:"w-3 h-3"}),onPress:()=>k(r,l),style:{fontFamily:'var(--fontFamily, "Inter")'},className:"text-xs",children:"Mark Present"})})]})},r.id)})}),D<j.length&&e.jsx("div",{className:"text-center mt-4 pb-4 flex-shrink-0",children:e.jsxs(ee,{variant:"bordered",onPress:B,startContent:e.jsx(Je,{className:"w-4 h-4"}),size:"sm",color:"warning",radius:v(),fullWidth:!0,style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Show More (",j.length-D," remaining)"]})})]})]}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h3",{className:"font-semibold flex items-center gap-2 text-lg text-default-700",style:{color:"var(--theme-default)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(h,{className:"w-5 h-5",style:{color:"var(--theme-default)"}}),"Loading Attendance Data..."]})}),e.jsxs("div",{className:"text-center py-12 h-96 flex flex-col items-center justify-center",style:{background:"color-mix(in srgb, var(--theme-default) 5%, transparent)",borderColor:"color-mix(in srgb, var(--theme-default) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(He,{size:"lg",className:"mb-4",style:{color:"var(--theme-primary)"}}),e.jsx("p",{className:"text-default-500 text-sm",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Checking attendance records..."})]})]})}),Ws=({handleDateChange:M,selectedDate:l,updateTimeSheet:$,externalFilterData:_,externalEmployee:k,onMarkAsPresent:D})=>{var ve,je,be,Ne;const{auth:C}=Ce().props,{url:c}=Ce(),i=$e("(min-width: 1025px)"),v=$e("(min-width: 641px) and (max-width: 1024px)"),[j,B]=a.useState([]),[se,R]=a.useState([]),[b,P]=a.useState([]),[r,n]=a.useState(""),[d,Y]=a.useState(0),[te,ae]=a.useState(0),[g,re]=a.useState(10),[N,E]=a.useState(1),[w,ce]=a.useState(k||""),[H,S]=a.useState(!1),[K,hs]=a.useState(0),[fs,de]=a.useState(null),[me,ps]=a.useState(!0),[ne,xe]=a.useState(new Date),[J,T]=a.useState(""),ue=a.useRef(null),f=a.useRef({currentMonth:x().format("YYYY-MM"),employee:k||"",filterData:_||{currentMonth:x().format("YYYY-MM")},selectedDate:l,perPage:10,updateTimeSheet:$,refreshKey:0,currentPage:1}),U=()=>{var u;if(typeof window>"u")return"lg";const o=((u=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:u.trim())||"12px",t=parseInt(o);return t===0?"none":t<=4?"sm":t<=8?"md":t<=16?"lg":"full"},[p,he]=a.useState(_||{currentMonth:x().format("YYYY-MM")}),Q=a.useCallback(async()=>{try{return S(!1),await pe(l,N,g,w,p,!0),c!=="/attendance-employee"&&await ye(l,w),xe(new Date),!0}catch(s){return console.error("Error refreshing timesheet:",s),!1}finally{S(!0)}},[l,N,g,w,p,c]),le=a.useCallback(async()=>{if(l)try{const s=route("check-timesheet-updates",{date:x(l).format("YYYY-MM-DD"),month:p.currentMonth}),o=await fetch(s);if(!o.ok){const u=await o.json().catch(()=>({}));throw new Error(`HTTP ${o.status}: ${u.message||"Failed to check for updates"}`)}const t=await o.json();t.success&&t.last_updated!==ue.current&&t.last_updated&&(ue.current=t.last_updated,await Q(),de(new Date)),xe(new Date)}catch(s){console.error("Error checking for timesheet updates:",s)}},[l,p.currentMonth,Q]),fe=a.useMemo(()=>ne?ne.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[ne]),pe=async(s,o,t,u,m,X=!1)=>{var z,O;if(!s){S(!0),n("No date selected");return}const q=c!=="/attendance-employee"?route("admin.getPresentUsersForDate"):route("getCurrentUserAttendanceForDate");try{S(!1),n("");const y=await G.get(q,{params:{page:o,perPage:t,employee:u,date:x(s).format("YYYY-MM-DD"),currentYear:m!=null&&m.currentMonth?x(m.currentMonth).year():"",currentMonth:m!=null&&m.currentMonth?x(m.currentMonth).format("MM"):"",_t:X?Date.now():void 0}});y.status===200?(B(y.data.attendances||[]),Y(y.data.total||0),ae(y.data.last_page||1),E(y.data.current_page||1),de(new Date),n("")):n(`Unexpected response: ${y.status}`)}catch(y){console.error("Error fetching attendance data:",y),n(((O=(z=y.response)==null?void 0:z.data)==null?void 0:O.message)||"An error occurred while retrieving attendance data."),B([]),Y(0)}finally{S(!0)}},ye=async(s,o)=>{if(c==="/attendance-employee"){P([]),R([]);return}if(!s){P([]),R([]);return}try{const t=await G.get(route("admin.getAbsentUsersForDate"),{params:{date:x(s).format("YYYY-MM-DD"),employee:o||"",_t:Date.now()}});t.status===200?(P(t.data.absent_users||[]),R(t.data.leaves||[])):(console.warn("Unexpected response getting absent users:",t.status),P([]),R([]))}catch(t){console.error("Error fetching absent users:",t),P([]),R([])}},Le=s=>{E(s)};a.useCallback((s,o)=>{he(t=>({...t,[s]:o}))},[]);const Ae=s=>se.find(o=>String(o.user_id)===String(s)),ge=(s,o)=>{if(!s)return null;try{let t;if(typeof s=="string"){const u=x(o).format("YYYY-MM-DD");if(s.match(/^\d{2}:\d{2}:\d{2}$/)){const m=`${u}T${s}`;t=new Date(m)}else if(s.includes("T")||s.includes(" "))t=new Date(s);else if(s.match(/^\d{2}:\d{2}$/)){const m=`${u}T${s}:00`;t=new Date(m)}else t=new Date(`${u}T${s}`)}else t=new Date(s);return isNaN(t.getTime())?(console.warn("Invalid time data:",s),"Invalid time"):t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(t){return console.warn("Error formatting time:",{timeString:s,date:o,error:t}),"Invalid time"}};console.log(C.permissions);const L=((ve=C.permissions)==null?void 0:ve.includes("attendance.view"))||!1;(je=C.permissions)!=null&&je.includes("attendance.own.view");const Ee=((be=C.permissions)==null?void 0:be.includes("attendance.manage"))||!1,Te=((Ne=C.permissions)==null?void 0:Ne.includes("attendance.export"))||Ee||!1;a.useMemo(()=>b,[b]);const Ue=[...!L||c==="/attendance-employee"?[{name:"Date",uid:"date",icon:Z,ariaLabel:"Attendance date"}]:[],...L&&c!=="/attendance-employee"?[{name:"Employee",uid:"employee",icon:ss,ariaLabel:"Employee name and information"}]:[],{name:"Clock In",uid:"clockin_time",icon:h,ariaLabel:"All clock in times"},{name:"Clock Out",uid:"clockout_time",icon:h,ariaLabel:"All clock out times"},{name:"Work Hours",uid:"production_time",icon:h,ariaLabel:"Total working hours"},{name:"Punches",uid:"punch_details",icon:h,ariaLabel:"Number of time punches recorded"}],We=(s,o)=>{var m,X,q,z,O,y,we,Fe;const t="text-xs sm:text-sm md:text-base whitespace-nowrap",u=x(s.date).isSame(x(),"day");switch(o){case"date":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("div",{className:"flex flex-col",children:e.jsx("span",{children:x(s.date).format("MMM D, YYYY")})})]})});case"employee":const _e=i||v?"md":"sm";return e.jsx(F,{className:"whitespace-nowrap",children:e.jsx(xs,{avatarProps:{src:((m=s.user)==null?void 0:m.profile_image_url)||((X=s.user)==null?void 0:X.profile_image),size:_e,name:((q=s.user)==null?void 0:q.name)||"Unnamed User",...Xe({name:((z=s.user)==null?void 0:z.name)||"Unnamed User",size:_e})},description:(O=s.user)!=null&&O.phone?e.jsx(ts,{href:`tel:${(y=s.user)==null?void 0:y.phone}`,size:"sm",className:"text-xs hover:underline",style:{color:"var(--theme-primary)"},children:(we=s.user)==null?void 0:we.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-default-400 italic",children:[e.jsx(qe,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:((Fe=s.user)==null?void 0:Fe.name)||"Unnamed User"})})});case"clockin_time":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-success"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.filter(I=>I.punch_in).map((I,A)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[A+1,"."]}),ge(I.punch_in,s.date)||"Invalid time"]},A)):e.jsx("span",{children:"Not clocked in"})})]})});case"clockout_time":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-danger"}),e.jsx("div",{className:"flex flex-col",children:s.punches&&s.punches.length>0?s.punches.map((I,A)=>e.jsxs("span",{className:"block text-xs",children:[e.jsxs("span",{className:"text-default-400 mr-1",children:[A+1,"."]}),I.punch_out?ge(I.punch_out,s.date)||"Invalid time":"No punch out"]},A)):s.punchin_time?e.jsx("span",{children:u?"Currently working":"Missing punch-out"}):e.jsx("span",{children:"Not started"})})]})});case"production_time":const Oe=s.total_work_minutes>0,ke=s.has_incomplete_punch,Ve=s.punchin_time&&!s.punchout_time&&u;if(Oe){const I=Math.floor(s.total_work_minutes/60),A=Math.floor(s.total_work_minutes%60);return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:`w-4 h-4 ${ke?"text-warning":"text-primary"}`}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:`${I}h ${A}m`}),e.jsx("span",{className:"text-xs text-default-500",children:ke?"Partial data - in progress":"Total worked time"})]})]})})}else{if(Ve)return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"In Progress"}),e.jsx("span",{className:"text-xs text-default-500",children:"Currently working"})]})]})});if(s.punchin_time&&!s.punchout_time&&!u)return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-danger"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-danger",children:"Incomplete punch"}),e.jsx("span",{className:"text-xs text-default-500",children:"Missing punch out"})]})]})})}return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-warning"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-warning",children:"No work time"}),e.jsx("span",{className:"text-xs text-default-500",children:"No attendance"})]})]})});case"punch_details":return e.jsx(F,{className:`${t}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-default-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-xs font-medium",children:[s.punch_count||0," punch",(s.punch_count||0)!==1?"es":""]}),s.complete_punches!==s.punch_count&&e.jsxs("span",{className:"text-xs text-warning",children:[s.complete_punches," complete"]}),s.complete_punches===s.punch_count&&s.punch_count>0&&e.jsx("span",{className:"text-xs text-success",children:"All complete"})]})]})});default:return e.jsx(F,{className:`${t}`,children:"N/A"})}},De=a.useCallback(async()=>{T("excel");try{const s=await G.get(route("attendance.exportExcel"),{params:{date:l},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=o,t.setAttribute("download",`Daily_Timesheet_${x(l).format("YYYY_MM_DD")}.xlsx`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(o),T("")}catch(s){console.error("Error downloading Excel:",s),alert("Failed to download attendance excel."),T("")}},[l]),ze=a.useCallback(async()=>{T("pdf");try{const s=await G.get(route("attendance.exportPdf"),{params:{date:l},responseType:"blob"}),o=window.URL.createObjectURL(new Blob([s.data])),t=document.createElement("a");t.href=o,t.setAttribute("download",`Daily_Timesheet_${x(l).format("YYYY_MM_DD")}.pdf`),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(o),T("")}catch(s){console.error("Error downloading PDF:",s),alert("Failed to download attendance pdf."),T("")}},[l]);return a.useEffect(()=>{if(l){if((w!==f.current.employee||p!==f.current.filterData||l!==f.current.selectedDate||g!==f.current.perPage||$!==f.current.updateTimeSheet||K!==f.current.refreshKey)&&N!==1){f.current={...f.current,employee:w,filterData:p,selectedDate:l,perPage:g,updateTimeSheet:$,refreshKey:K},E(1);return}(async()=>{S(!1);try{await Promise.all([pe(l,N,g,w,p),c!=="/attendance-employee"?ye(l,w):Promise.resolve()])}catch(t){console.error("Error updating attendance data:",t)}finally{S(!0)}})(),f.current={...f.current,employee:w,filterData:p,selectedDate:l,perPage:g,updateTimeSheet:$,refreshKey:K,currentPage:N}}},[l,N,g,w,p,$,K]),a.useEffect(()=>{_&&he(_)},[_]),a.useEffect(()=>{k!==void 0&&ce(k)},[k]),a.useEffect(()=>{JSON.stringify(p)!==JSON.stringify(f.current.filterData)&&(f.current={...f.current,filterData:{...p}},Q())},[p,Q]),a.useEffect(()=>{if(!me||!l)return;le();const s=setInterval(le,5e3);return()=>{clearInterval(s)}},[me,le,l]),e.jsx(e.Fragment,{children:L&&e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Timesheet Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(Se.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(Re,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                        var(--theme-content1, #FAFAFA) 20%, 
                                        var(--theme-content2, #F4F4F5) 10%, 
                                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(as,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${i?"p-6":v?"p-4":"p-3"} w-full`,children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                                ${i?"p-3":v?"p-2.5":"p-2"} 
                                                                rounded-xl flex items-center justify-center
                                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(h,{className:`
                                                                    ${i?"w-8 h-8":v?"w-6 h-6":"w-5 h-5"}
                                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                    ${i?"text-2xl":v?"text-xl":"text-lg"}
                                                                    font-bold text-foreground
                                                                    ${i?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Daily Timesheet"}),e.jsx("p",{className:`
                                                                    ${i?"text-sm":"text-xs"} 
                                                                    text-default-500
                                                                    ${i?"":"truncate"}
                                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:new Date(l).toLocaleString("en-US",{month:i?"long":"short",day:"numeric",year:i?"numeric":void 0})})]})]}),"                                                ",e.jsxs("div",{className:"flex items-center gap-4",children:[fe&&e.jsxs("span",{className:"text-xs text-default-500",children:["Updated: ",fe]}),e.jsx("div",{className:"flex items-center gap-2",children:Te&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{color:"success",variant:"flat",size:i?"md":"sm",radius:U(),startContent:e.jsx(Ye,{className:`
                                                                                ${i?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:De,isDisabled:!H||j.length===0||J!=="",isLoading:J==="excel",style:{fontFamily:'var(--fontFamily, "Inter")'},children:i?"Excel":"XLS"}),e.jsx(ee,{color:"danger",variant:"flat",size:i?"md":"sm",radius:U(),startContent:e.jsx(Ye,{className:`
                                                                                ${i?"w-4 h-4":"w-3.5 h-3.5"}
                                                                            `}),onPress:ze,isDisabled:!H||j.length===0||J!=="",isLoading:J==="pdf",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"PDF"})]})})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Present: ",d]})]}),L&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4 text-warning"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Absent: ",b.length]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Total: ",d+b.length]})]})]})]})})}),e.jsx(Ie,{}),e.jsx(Me,{children:e.jsx("div",{role:"search","aria-label":"Timesheet filters",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:L&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{type:"text",label:"Search Employee",placeholder:"Enter employee name",value:w,onChange:s=>ce(s.target.value),variant:"bordered",size:"sm",radius:U(),startContent:e.jsx(oe,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Search employees"})}),e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{label:"Select Date",type:"date",variant:"bordered",onChange:M,value:new Date(l).toISOString().slice(0,10)||"",size:"sm",radius:U(),startContent:e.jsx(Z,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},"aria-label":"Select date for timesheet"})})]})})})}),e.jsx(Ie,{}),e.jsx(Me,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 h-full",children:[e.jsx("div",{className:`${L?"lg:flex-1 lg:w-0":"w-full"} min-h-0`,children:r?e.jsx(Re,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--theme-danger)"},children:r})]})}):e.jsxs("div",{role:"region","aria-label":"Present employees attendance table",className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("h6",{className:"text-lg font-semibold text-foreground flex items-center gap-2",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(W,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Present Employees (",d,")"]})}),e.jsxs("div",{className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(rs,{orientation:"horizontal",className:"overflow-y-hidden flex-1",children:e.jsx(ns,{className:"rounded-lg",isLoaded:H,children:e.jsxs(ls,{isCompact:!0,removeWrapper:!0,"aria-label":"Employee attendance timesheet table",isHeaderSticky:!0,radius:U(),classNames:{base:"max-h-[520px] overflow-auto",table:"min-h-[200px] w-full",thead:"z-10",tbody:"overflow-y-auto",th:"bg-default-100 text-default-700 font-semibold",td:"text-default-600"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(cs,{columns:Ue,children:s=>e.jsx(ds,{align:"start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]})},s.uid)}),e.jsx(os,{items:j,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(h,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500",children:"No attendance records found"})]}),children:s=>e.jsx(is,{children:o=>We(s,o)},s.id||s.user_id)})]})})}),d>g&&e.jsx("div",{className:"py-4 flex justify-center",children:e.jsx(ms,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",radius:U(),page:N,total:te,onChange:Le,"aria-label":"Timesheet pagination",style:{fontFamily:'var(--fontFamily, "Inter")'}})})]})]})}),L&&e.jsx("div",{className:"lg:w-80 lg:flex-shrink-0 h-full",children:e.jsx(us,{absentUsers:b,selectedDate:l,getUserLeave:Ae,isLoaded:H,onMarkAsPresent:D})})]})})]})})})})})})};export{Ws as T};
