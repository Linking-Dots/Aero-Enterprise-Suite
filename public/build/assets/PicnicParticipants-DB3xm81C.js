import{j as e,u as te,r as a,H as ce}from"./app-B8QYX9Px.js";import{c as pe,F as X,C as ae,G as ue}from"./Grow-DP1KP2ex.js";import{u as re,T as me,B as se,G as xe}from"./logo-BoX8pchB.js";import{I as he,m as c,B as oe,A as ge}from"./App-DkF9RL3Y.js";import{C as ye}from"./Clear-Defissbz.js";import{G as le}from"./GlassDialog-w1fMVGB6.js";import{D as ie}from"./DialogTitle-B_yNWDSa.js";import{D as ne,a as de}from"./DialogContent-DYCSoO7D.js";import{I as Z}from"./InputLabel-CehJzubO.js";import{S as $}from"./Select-8HD_0XQO.js";import{M as W}from"./MenuItem-BN00sQGI.js";import{F as L,T as P}from"./TextField-BAa6JqDO.js";import{A as be}from"./Avatar-BIHQefTu.js";import{L as fe}from"./LoadingButton-BJ0_t8OA.js";import{D as je}from"./DialogContentText-CZB7joVz.js";import{B as Q}from"./Button-CpKhJqSS.js";import{d as Ce}from"./dayjs.min-BHuFkWn-.js";import{C as ve}from"./CardHeader-Bhq2T4qN.js";import{A as Pe}from"./Add-ClmIkhH0.js";import{C as ee}from"./CardContent-B5B4Qw18.js";import{I as Se}from"./InputAdornment-Cc_eLtv_.js";import{T as De,c as Te,a as ke,b as we}from"./TableRow-By0wOMKp.js";import{P as Fe}from"./Pagination-BR8K4mGl.js";import"./create-visual-element-4S4I33NB.js";import"./EnvelopeIcon-B1M8vjD_.js";import"./UserIcon-D9_80nkG.js";import"./ShieldCheckIcon-RZqgNGJW.js";import"./ExclamationTriangleIcon-BW32ASrn.js";import"./Dialog-Bo_XotCr.js";import"./listItemTextClasses-DfTDYmaW.js";import"./LastPage-CQjI2zs7.js";const Ie=pe(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"})),_e=({open:f,closeModal:h,leavesData:g,setLeavesData:I,currentLeave:t,allUsers:y,setTotalRows:_,setLastPage:p,setLeaves:B,handleMonthChange:u,employee:G})=>{const{auth:R}=te().props,o=re(),[j,H]=a.useState((t==null?void 0:t.user_id)||R.user.id),[m,S]=a.useState(g.leaveTypes||[]),[D,T]=a.useState(g.leaveCounts||[]),[C,E]=a.useState((t==null?void 0:t.leave_type)||(m.length>0?m[0].type:"")),[k,w]=a.useState((t==null?void 0:t.from_date)||""),[A,U]=a.useState((t==null?void 0:t.to_date)||""),[Y,V]=a.useState((t==null?void 0:t.no_of_days)||""),[N,q]=a.useState(""),[M,z]=a.useState((t==null?void 0:t.reason)||""),[l,O]=a.useState({}),[s,x]=a.useState(!1),[F,J]=a.useState("");a.useEffect(()=>{g&&(S(g.leaveTypes||[]),T(g.leaveCountsByUser[j]||[]))},[g,j]),a.useEffect(()=>{var d;const r=((d=D==null?void 0:D.find(n=>n.leave_type===C))==null?void 0:d.days_used)||0;J(r);const v=m==null?void 0:m.find(n=>n.type===C);v&&q(v.days-r)},[C,D,m]),a.useEffect(()=>{V(((v,d)=>{if(!v||!d)return"";const n=new Date(v),i=new Date(d);if(n>i)return"";const b=i.getTime()-n.getTime();return Math.ceil(b/(1e3*3600*24))+1})(k,A))},[k,A]);const K=async r=>{r.preventDefault(),x(!0);const v=new Promise(async(d,n)=>{try{const i={route:route().current(),user_id:j,leaveType:C,fromDate:k,toDate:A,daysCount:Y,leaveReason:M,employee:G};t&&(i.id=t.id);const b=await axios.post(route("leave-add"),i);b.status===200&&(I(b.data.leavesData),_(b.data.leavesData.leaveRecords.total),p(b.data.leavesData.leaveRecords.last_page),B(b.data.leavesData.leaveRecords.data),u({target:{value:k.slice(0,7)}}),h(),d([b.data.message||"Leave application submitted successfully"]))}catch(i){console.error(i),x(!1),i.response?(i.response.status===422?(O(i.response.data.errors||{}),n(i.response.data.error||"Failed to submit leave application")):n("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(n("No response received from the server. Please check your internet connection."),console.error(i.request)):(n("An error occurred while setting up the request."),console.error("Error",i.message))}finally{x(!1)}});oe.promise(v,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ae,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:d}){return e.jsx(e.Fragment,{children:d.map((n,i)=>e.jsx("div",{children:n},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:d}){return e.jsx(e.Fragment,{children:d})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})};return e.jsxs(le,{open:f,onClose:h,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(ie,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{variant:"h6",children:"Add Leave"}),e.jsx(he,{onClick:h,sx:{position:"absolute",top:8,right:16},children:e.jsx(ye,{})})]}),e.jsxs("form",{onSubmit:K,children:[e.jsx(ne,{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,md:6,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(Z,{id:"leave-type-label",children:"Leave Type"}),e.jsxs($,{labelId:"leave-type-label",value:C,onChange:r=>E(r.target.value),label:"Leave Type",error:!!l.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e.jsx(W,{value:"",disabled:!0,children:"Select Leave Type"}),m.map(r=>e.jsxs(W,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e.jsx(L,{children:l.leaveType})]})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{label:"From",type:"date",fullWidth:!0,value:k,onChange:r=>w(r.target.value),InputLabelProps:{shrink:!0},error:!!l.fromDate,helperText:l.fromDate})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{label:"To",type:"date",fullWidth:!0,value:A,onChange:r=>U(r.target.value),InputLabelProps:{shrink:!0},error:!!l.toDate,helperText:l.toDate})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{label:"Number of days",type:"text",fullWidth:!0,value:Y,InputProps:{readOnly:!0},error:!!l.daysCount,helperText:l.daysCount})}),e.jsx(c,{item:!0,xs:12,md:6,children:e.jsx(P,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:N,InputProps:{readOnly:!0},error:!!l.remainingLeaves,helperText:l.remainingLeaves})}),R.roles.includes("Administrator")&&route().current()==="leaves"&&e.jsx(c,{item:!0,xs:12,md:6,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(Z,{id:"leave-employee-label",children:"Employee"}),e.jsxs($,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:j||"na",error:!!l.user_id,onChange:r=>H(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e.jsx(W,{value:"na",disabled:!0,children:"Please select"}),y.map(r=>e.jsx(W,{value:r.id,children:e.jsxs(se,{sx:{display:"flex"},children:[e.jsx(be,{src:r.profile_image_url||r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e.jsx(L,{children:l.user_id})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(P,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:M,onChange:r=>z(r.target.value),error:!!l.leaveReason,helperText:l.leaveReason})})]})}),e.jsx(de,{sx:{padding:"16px",justifyContent:"center"},children:e.jsx(fe,{type:"submit",variant:"outlined",color:"primary",loading:s,disabled:s,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Be=({open:f,handleClose:h,leaveIdToDelete:g,setLeavesData:I})=>{const t=re(),y=()=>{const _=new Promise(async(p,B)=>{try{const u=await axios.delete(route("leave-delete",{id:g,route:route().current()}));u.status===200&&(I(u.data.leavesData),p("Leave application deleted successfully"))}catch(u){console.error("Error deleting task:",u),B(u.response.data.error||"Failed to delete leave application")}finally{h()}});oe.promise(_,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(ae,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:p}){return e.jsx(e.Fragment,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:p}){return e.jsx(e.Fragment,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}}})};return e.jsxs(le,{open:f,onClose:h,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ie,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(ne,{children:e.jsx(je,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),e.jsxs(de,{children:[e.jsx(Q,{onClick:h,color:"primary",children:"Cancel"}),e.jsx(Q,{onClick:y,color:"error",autoFocus:!0,children:"Delete"})]})]})},Re=({title:f,allUsers:h})=>{const{auth:g,props:I}=te(),[t,y]=a.useState(null),[_,p]=a.useState(I.leavesData),[B,u]=a.useState(),[G,R]=a.useState(0),[o,j]=a.useState(0),[H,m]=a.useState(null),[S,D]=a.useState(""),[T,C]=a.useState(Ce().format("YYYY-MM")),[E,k]=a.useState(30),[w,A]=a.useState(1),[U,Y]=a.useState(),[V,N]=a.useState(""),q=s=>y(s);a.useCallback((s,x)=>{m(s),y(x)},[]);const M=a.useCallback(()=>{y(null),m(null)},[]),z=s=>D(s.target.value.toLowerCase()),l=s=>{C(s.target.value)},O=async()=>{var s,x;try{const F=await axios.get(route("leaves.paginate"),{params:{page:w,perPage:E,employee:S,month:T}});if(F.status===200){const{data:J,total:K,last_page:r}=F.data.leaves;u(J),R(K),j(r)}}catch(F){console.error("Error fetching leaves data:",F),N(((x=(s=F.response)==null?void 0:s.data)==null?void 0:x.message)||"Error retrieving data.")}};return a.useEffect(()=>{O()},[T,w,E,S]),e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:f}),["add_leave","edit_leave"].includes(t)&&e.jsx(_e,{setTotalRows:R,setLastPage:j,setPicnicParticipants:u,perPage:E,employee:S,currentPage:w,selectedMonth:T,allUsers:h,open:!0,setPicnicParticipantsData:p,closeModal:()=>y(null),leavesData:_,currentPicnicParticipant:t==="edit_leave"?U:null,handleMonthChange:l}),t==="delete_leave"&&e.jsx(Be,{open:!0,handleClose:M,leaveIdToDelete:H,setPicnicParticipantsData:p}),e.jsx(se,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(ue,{in:!0,children:e.jsxs(xe,{children:[e.jsx(ve,{title:"Picnic Participants",sx:{padding:"24px"},action:e.jsx(Q,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e.jsx(Pe,{}),onClick:()=>q("add_leave"),children:"Add Picnic Participant"})}),e.jsx(ee,{children:e.jsxs(c,{container:!0,spacing:2,children:[e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsx(P,{label:"Search",fullWidth:!0,variant:"outlined",placeholder:"Employee...",value:S,onChange:z,size:"small",InputProps:{endAdornment:e.jsx(Se,{position:"end",children:e.jsx(Ie,{})})}})}),e.jsx(c,{item:!0,xs:12,sm:6,md:4,children:e.jsx(P,{label:"Select Month",type:"month",variant:"outlined",onChange:l,value:T,fullWidth:!0,size:"small",InputLabelProps:{shrink:!0}})})]})}),e.jsx(ee,{children:e.jsxs("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[e.jsxs(De,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e.jsx(TableHeader,{columns,children:s=>e.jsx(TableColumn,{align:s.uid==="actions"?"center":"start",children:s.name},s.uid)}),e.jsx(Te,{items:B,children:s=>e.jsx(ke,{children:x=>e.jsx(we,{style:{whiteSpace:"nowrap"},children:renderCell(s,x)})},s.id)})]}),G>10&&e.jsx("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e.jsx(Fe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:w,total:o,onChange:handlePageChange})})]})})]})})})]})};Re.layout=f=>e.jsx(ge,{children:f});export{Re as default};
