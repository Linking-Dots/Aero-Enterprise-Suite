import{u as le,a as l,j as e,b as A,H as me}from"./app-BQYsVGy2.js";import{n as ge,g as ye,r as a}from"./react-core-ZDN6GY9H.js";import{Z as be,u as oe,p as ne,T as ve,o as fe,h as p,j as X,I as $,k as ee,M as j,m as ae,i as B,B as ie,a6 as xe,q as de,r as ce,f as ue,a5 as Ce,s as K,G as Se,C as Pe,e as te}from"./mui-libraries-BtmIKYJi.js";import{r as De,B as pe,A as _e}from"./App-C7wyKuEA.js";import{G as ke}from"./logo-D4s_-5rU.js";import{C as Te}from"./Clear-BspLIeb9.js";import{G as he}from"./GlassDialog-CZaG328G.js";import{L as we}from"./LoadingButton-_ogDhfaH.js";import{d as Ie}from"./dayjs.min-DBQH2Mnd.js";import{A as Le}from"./Add-hG0nqW8F.js";import{i as re,k as Re,m as Fe,n as Ee,o as Be,q as Me,v as Ae,G as qe}from"./ui-libraries-CP3AhJpb.js";import"./utilities-DyZVG5is.js";import"./EnvelopeIcon-B_JLNrsu.js";import"./UserIcon-Vw3xDLqJ.js";import"./ShieldCheckIcon-DfDaQsK0.js";import"./ExclamationTriangleIcon-BAHPm542.js";var M={},se;function We(){if(se)return M;se=1;var g=be();Object.defineProperty(M,"__esModule",{value:!0}),M.default=void 0;var c=g(De()),u=ge();return M.default=(0,c.default)((0,u.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search"),M}var je=We();const Ge=ye(je),He=({open:g,closeModal:c,leavesData:u,setLeavesData:w,currentLeave:s,allUsers:x,setTotalRows:I,setLastPage:h,setLeaves:L,handleMonthChange:m,employee:G})=>{const{auth:R}=le().props,o=oe(),[C,H]=a.useState(s?.user_id||R.user.id),[v,D]=a.useState(u.leaveTypes||[]),[q,_]=a.useState(u.leaveCounts||[]),[S,F]=a.useState(s?.leave_type||(v.length>0?v[0].type:"")),[k,T]=a.useState(s?.from_date||""),[E,U]=a.useState(s?.to_date||""),[Y,Q]=a.useState(s?.no_of_days||""),[N,O]=a.useState(""),[W,z]=a.useState(s?.reason||""),[n,J]=a.useState({}),[r,y]=a.useState(!1),[V,Z]=a.useState("");return a.useEffect(()=>{u&&(D(u.leaveTypes||[]),_(u.leaveCountsByUser[C]||[]))},[u,C]),a.useEffect(()=>{const t=q?.find(d=>d.leave_type===S)?.days_used||0;Z(t);const P=v?.find(d=>d.type===S);P&&O(P.days-t)},[S,q,v]),a.useEffect(()=>{Q(((P,d)=>{if(!P||!d)return"";const b=new Date(P),i=new Date(d);if(b>i)return"";const f=i.getTime()-b.getTime();return Math.ceil(f/(1e3*3600*24))+1})(k,E))},[k,E]),l(he,{open:g,onClose:c,fullWidth:!0,maxWidth:"sm",children:[l(ne,{sx:{display:"flex",alignItems:"center"},children:[e(ve,{variant:"h6",children:"Add Leave"}),e(fe,{onClick:c,sx:{position:"absolute",top:8,right:16},children:e(Te,{})})]}),l("form",{onSubmit:async t=>{t.preventDefault(),y(!0);const P=new Promise(async(d,b)=>{try{const i={route:route().current(),user_id:C,leaveType:S,fromDate:k,toDate:E,daysCount:Y,leaveReason:W,employee:G};s&&(i.id=s.id);const f=await axios.post(route("leave-add"),i);f.status===200&&(w(f.data.leavesData),I(f.data.leavesData.leaveRecords.total),h(f.data.leavesData.leaveRecords.last_page),L(f.data.leavesData.leaveRecords.data),m({target:{value:k.slice(0,7)}}),c(),d([f.data.message||"Leave application submitted successfully"]))}catch(i){console.error(i),y(!1),i.response?(i.response.status===422?(J(i.response.data.errors||{}),b(i.response.data.error||"Failed to submit leave application")):b("An unexpected error occurred. Please try again later."),console.error(i.response.data.error)):i.request?(b("No response received from the server. Please check your internet connection."),console.error(i.request)):(b("An error occurred while setting up the request."),console.error("Error",i.message))}finally{y(!1)}});pe.promise(P,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ue,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:d}){return e(A,{children:d.map((b,i)=>e("div",{children:b},i))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:d}){return e(A,{children:d})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(de,{children:l(p,{container:!0,spacing:2,children:[e(p,{item:!0,xs:12,md:6,children:l(X,{fullWidth:!0,children:[e($,{id:"leave-type-label",children:"Leave Type"}),l(ee,{labelId:"leave-type-label",value:S,onChange:t=>F(t.target.value),label:"Leave Type",error:!!n.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(j,{value:"",disabled:!0,children:"Select Leave Type"}),v.map(t=>l(j,{value:t.type,children:[t.type," ",t.days," Days"]},t.id))]}),e(ae,{children:n.leaveType})]})}),e(p,{item:!0,xs:12,md:6,children:e(B,{label:"From",type:"date",fullWidth:!0,value:k,onChange:t=>T(t.target.value),InputLabelProps:{shrink:!0},error:!!n.fromDate,helperText:n.fromDate})}),e(p,{item:!0,xs:12,md:6,children:e(B,{label:"To",type:"date",fullWidth:!0,value:E,onChange:t=>U(t.target.value),InputLabelProps:{shrink:!0},error:!!n.toDate,helperText:n.toDate})}),e(p,{item:!0,xs:12,md:6,children:e(B,{label:"Number of days",type:"text",fullWidth:!0,value:Y,InputProps:{readOnly:!0},error:!!n.daysCount,helperText:n.daysCount})}),e(p,{item:!0,xs:12,md:6,children:e(B,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:N,InputProps:{readOnly:!0},error:!!n.remainingLeaves,helperText:n.remainingLeaves})}),R.roles.includes("Administrator")&&route().current()==="leaves"&&e(p,{item:!0,xs:12,md:6,children:l(X,{fullWidth:!0,children:[e($,{id:"leave-employee-label",children:"Employee"}),l(ee,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:C||"na",error:!!n.user_id,onChange:t=>H(t.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow}}},children:[e(j,{value:"na",disabled:!0,children:"Please select"}),x.map(t=>e(j,{value:t.id,children:l(ie,{sx:{display:"flex"},children:[e(xe,{src:t.profile_image_url||t.profile_image,alt:t.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),t.name]})},t.id))]}),e(ae,{children:n.user_id})]})}),e(p,{item:!0,xs:12,children:e(B,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:W,onChange:t=>z(t.target.value),error:!!n.leaveReason,helperText:n.leaveReason})})]})}),e(ce,{sx:{padding:"16px",justifyContent:"center"},children:e(we,{type:"submit",variant:"outlined",color:"primary",loading:r,disabled:r,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Ue=({open:g,handleClose:c,leaveIdToDelete:u,setLeavesData:w})=>{const s=oe();return l(he,{open:g,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(ne,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(de,{children:e(Ce,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),l(ce,{children:[e(K,{onClick:c,color:"primary",children:"Cancel"}),e(K,{onClick:()=>{const I=new Promise(async(h,L)=>{try{const m=await axios.delete(route("leave-delete",{id:u,route:route().current()}));m.status===200&&(w(m.data.leavesData),h("Leave application deleted successfully"))}catch(m){console.error("Error deleting task:",m),L(m.response.data.error||"Failed to delete leave application")}finally{c()}});pe.promise(I,{pending:{render(){return l("div",{style:{display:"flex",alignItems:"center"},children:[e(ue,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},success:{render({data:h}){return e(A,{children:h})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}},error:{render({data:h}){return e(A,{children:h})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:s.glassCard.background,border:s.glassCard.border,color:s.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Ye=({title:g,allUsers:c})=>{const{auth:u,props:w}=le(),[s,x]=a.useState(null),[I,h]=a.useState(w.leavesData),[L,m]=a.useState(),[G,R]=a.useState(0),[o,C]=a.useState(0),[H,v]=a.useState(null),[D,q]=a.useState(""),[_,S]=a.useState(Ie().format("YYYY-MM")),[F,k]=a.useState(30),[T,E]=a.useState(1),[U,Y]=a.useState(),[Q,N]=a.useState(""),O=r=>x(r);a.useCallback((r,y)=>{v(r),x(y)},[]);const W=a.useCallback(()=>{x(null),v(null)},[]),z=r=>q(r.target.value.toLowerCase()),n=r=>{S(r.target.value)},J=async()=>{try{const r=await axios.get(route("leaves.paginate"),{params:{page:T,perPage:F,employee:D,month:_}});if(r.status===200){const{data:y,total:V,last_page:Z}=r.data.leaves;m(y),R(V),C(Z)}}catch(r){console.error("Error fetching leaves data:",r),N(r.response?.data?.message||"Error retrieving data.")}};return a.useEffect(()=>{J()},[_,T,F,D]),l(A,{children:[e(me,{title:g}),["add_leave","edit_leave"].includes(s)&&e(He,{setTotalRows:R,setLastPage:C,setPicnicParticipants:m,perPage:F,employee:D,currentPage:T,selectedMonth:_,allUsers:c,open:!0,setPicnicParticipantsData:h,closeModal:()=>x(null),leavesData:I,currentPicnicParticipant:s==="edit_leave"?U:null,handleMonthChange:n}),s==="delete_leave"&&e(Ue,{open:!0,handleClose:W,leaveIdToDelete:H,setPicnicParticipantsData:h}),e(ie,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Se,{in:!0,children:l(ke,{children:[e(Pe,{title:"Picnic Participants",sx:{padding:"24px"},action:e(K,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e(Le,{}),onClick:()=>O("add_leave"),children:"Add Picnic Participant"})}),e(te,{children:l(p,{container:!0,spacing:2,children:[e(p,{item:!0,xs:12,sm:6,md:4,children:e(re,{label:"Search",fullWidth:!0,variant:"bordered",placeholder:"Employee...",value:D,onChange:z,endContent:e(Ge,{})})}),e(p,{item:!0,xs:12,sm:6,md:4,children:e(re,{label:"Select Month",type:"month",variant:"bordered",onChange:n,value:_})})]})}),e(te,{children:l("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[l(Re,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e(Fe,{columns,children:r=>e(Ee,{align:r.uid==="actions"?"center":"start",children:r.name},r.uid)}),e(Be,{items:L,children:r=>e(Me,{children:y=>e(Ae,{style:{whiteSpace:"nowrap"},children:renderCell(r,y)})},r.id)})]}),G>10&&e("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e(qe,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:o,onChange:handlePageChange})})]})})]})})})]})};Ye.layout=g=>e(_e,{children:g});export{Ye as default};
