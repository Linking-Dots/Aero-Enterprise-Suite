import{a,j as e,Q as I,S as M,F as z,b as P}from"./app-D-X2sIvi.js";import{r as i}from"./react-core-DDvupgOx.js";import{e as Q,B as l,k as T,A as G}from"./App-xsKFzUM2.js";import{G as w}from"./logo-BArjMkSi.js";import{a as v}from"./utilities-DT6SRl8s.js";import{u as H,a as q,T as g,f as B}from"./mui-libraries-CyFs7uQU.js";import{F as J}from"./ArrowLeftIcon-D7idcjQ7.js";import{a as O}from"./ShieldCheckIcon-C7bFKizx.js";import{F as V}from"./LockClosedIcon-t8YZGfxe.js";import{F as K,a as _}from"./LockOpenIcon-CK6B9L1F.js";import{F as W}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as X}from"./MapPinIcon-C7XkNQ6g.js";import{F as Y}from"./CheckCircleIcon-CJUGb5Jf.js";import{F as Z}from"./XCircleIcon-DJR5_Dv7.js";import{b,d as y,j as F,h as ee,f as D,e as S,k as se,m as ae,n as c,o as te,q as re,v as n}from"./ui-libraries-CxFzkmxb.js";import"./EnvelopeIcon-D6nUSkik.js";import"./UserIcon-D16nn9o_.js";const ie=({title:m,user:R,devices:L})=>{const $=H();q($.breakpoints.down("sm"));const[r,p]=i.useState(R),[d,k]=i.useState(L||[]),[C,x]=i.useState(!1),[N,o]=i.useState({}),U=async s=>{o(t=>({...t,toggle:!0}));try{(await v.post(route("users.device.toggle"),{user_id:r.id,enabled:s})).status===200&&(p(u=>({...u,single_device_login:s,active_device:s?u.active_device:null})),l.success(s?"Single device login enabled":"Single device login disabled"),f())}catch(t){console.error("Error toggling single device login:",t),l.error("Failed to update device settings")}finally{o(t=>({...t,toggle:!1}))}},j=async()=>{o(s=>({...s,reset:!0}));try{(await v.post(route("users.device.reset"),{user_id:r.id})).status===200&&(p(t=>({...t,active_device:null})),l.success("User device has been reset"),f())}catch(s){console.error("Error resetting user device:",s),l.error("Failed to reset user device")}finally{o(s=>({...s,reset:!1}))}},f=async()=>{x(!0);try{const s=await v.get(route("users.device.list",{user:r.id}));s.status===200&&k(s.data.devices)}catch(s){console.error("Error fetching devices:",s),l.error("Failed to fetch device information")}finally{x(!1)}},A=s=>{const t=s.toLowerCase();return t.includes("mobile")||t.includes("android")||t.includes("iphone")?e(_,{className:"w-5 h-5"}):e(T,{className:"w-5 h-5"})},E=s=>{if(!s)return"Never";const t=new Date(s),h=Math.floor((new Date-t)/(1e3*60*60));return h<1?"Just now":h<24?`${h}h ago`:t.toLocaleDateString()};return i.useEffect(()=>{f()},[]),a(P,{children:[e(I,{title:m}),a("div",{className:"space-y-6",children:[a("div",{className:"flex items-center gap-4 mb-6",children:[e(b,{isIconOnly:!0,variant:"light",onPress:()=>M.visit(route("users.index")),className:"text-default-400 hover:text-foreground",children:e(J,{className:"w-5 h-5"})}),a("div",{children:[e(g,{variant:"h4",className:"font-bold text-foreground",children:"Device Management"}),a(g,{variant:"body2",className:"text-default-500",children:["Manage ",r.name,"'s device access and restrictions"]})]})]}),a(w,{children:[e(y,{className:"flex gap-3",children:a("div",{className:"flex flex-col",children:[e("p",{className:"text-lg font-semibold",children:r.name}),e("p",{className:"text-small text-default-500",children:r.email})]})}),e(F,{}),e(S,{children:a("div",{className:"flex flex-col md:flex-row gap-6",children:[a("div",{className:"flex-1",children:[a("div",{className:"flex items-center justify-between mb-4",children:[a("div",{className:"flex items-center gap-2",children:[e(O,{className:"w-5 h-5 text-primary"}),e("span",{className:"font-medium",children:"Single Device Login"})]}),e(ee,{isSelected:r.single_device_login,onValueChange:U,isDisabled:N.toggle,color:"primary",size:"sm"})]}),r.single_device_login&&a("div",{className:"space-y-3",children:[a("div",{className:"flex items-center gap-2",children:[e("span",{className:"text-sm text-default-600",children:"Status:"}),e(D,{size:"sm",variant:"flat",color:r.active_device?"warning":"success",startContent:r.active_device?e(V,{className:"w-3 h-3"}):e(K,{className:"w-3 h-3"}),children:r.active_device?"Device Locked":"Device Free"})]}),r.active_device&&e(b,{color:"warning",variant:"flat",size:"sm",startContent:e(z,{className:"w-4 h-4"}),onPress:j,isLoading:N.reset,className:"w-full md:w-auto",children:"Reset Device Lock"})]}),!r.single_device_login&&e("div",{className:"text-sm text-default-500",children:"User can login from multiple devices simultaneously"})]}),e("div",{className:"flex-1",children:a("div",{className:"grid grid-cols-2 gap-4",children:[a("div",{className:"text-center p-3 bg-default-100 rounded-lg",children:[e("div",{className:"text-lg font-semibold text-primary",children:d.length}),e("div",{className:"text-xs text-default-500",children:"Device Records"})]}),a("div",{className:"text-center p-3 bg-default-100 rounded-lg",children:[e("div",{className:"text-lg font-semibold text-success",children:d.filter(s=>s.is_active).length}),e("div",{className:"text-xs text-default-500",children:"Active Sessions"})]})]})})]})})]}),a(w,{children:[e(y,{children:a("div",{className:"flex items-center gap-2",children:[e(_,{className:"w-5 h-5"}),e("span",{className:"font-semibold",children:"Device History"})]})}),e(F,{}),e(S,{children:C?e("div",{className:"flex justify-center py-8",children:e(B,{})}):d.length===0?a("div",{className:"text-center py-8",children:[e(W,{className:"w-12 h-12 text-default-300 mx-auto mb-4"}),e(g,{variant:"body1",className:"text-default-500",children:"No device records found"})]}):a(se,{"aria-label":"Device history table",className:"w-full",children:[a(ae,{children:[e(c,{children:"Device"}),e(c,{children:"IP Address"}),e(c,{children:"Location"}),e(c,{children:"Status"}),e(c,{children:"Last Seen"})]}),e(te,{children:d.map(s=>a(re,{children:[e(n,{children:a("div",{className:"flex items-center gap-2",children:[A(s.user_agent),a("div",{children:[e("div",{className:"font-medium text-sm",children:s.device_name||"Unknown Device"}),e("div",{className:"text-xs text-default-500 truncate max-w-48",children:s.user_agent})]})]})}),e(n,{children:e("span",{className:"text-sm font-mono",children:s.ip_address})}),e(n,{children:a("div",{className:"flex items-center gap-1",children:[e(X,{className:"w-3 h-3 text-default-400"}),e("span",{className:"text-sm",children:s.location||"Unknown"})]})}),e(n,{children:e(D,{size:"sm",variant:"flat",color:s.is_active?"success":"default",startContent:s.is_active?e(Y,{className:"w-3 h-3"}):e(Z,{className:"w-3 h-3"}),children:s.is_active?"Active":"Inactive"})}),e(n,{children:a("div",{className:"flex items-center gap-1",children:[e(Q,{className:"w-3 h-3 text-default-400"}),e("span",{className:"text-sm",children:E(s.last_seen_at)})]})})]},s.id))})]})})]})]})]})};ie.layout=m=>e(G,{children:m});export{ie as default};
