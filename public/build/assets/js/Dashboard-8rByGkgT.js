import{j as e,a as G,d as Ce,F as Oe,e as ye,k as we,b as ae,J as je,Z as qe,$ as Ke,a0 as Je,h as ie,U as Xe,L as be,Q as Ye,R as Qe,A as Ie,B as Pe,C as Re,D as Ee,E as Le}from"./vendor-heroui-CinxWHhv.js";import{r,R as ce,J as We,Q as et}from"./vendor-inertia-sUfCHI_5.js";import{T as tt}from"./TimeSheetTable-q01wzxJs.js";import{u as rt,b as Te}from"./app-bN88MMsl.js";import{u as xe,f as Ne,P as Ue,a as Fe,d as at,A as st}from"./Dashboard-CB4o3E3k.js";import{S as nt}from"./StatsCards-cgIiYc8N.js";import{M as ot,T as it,u as _e,L as W}from"./leaflet-AtgV4Uvf.js";import"./leaflet-routing-machine-DxXdop3Y.js";import{e as K}from"./vendor-framer-B7qqn1b6.js";import{c as Se}from"./createLucideIcon-DJAbkOCz.js";import{U as lt}from"./users-8C1qTPe3.js";import{M as ct}from"./map-pin-DeqdV2gE.js";import{d as re}from"./dayjs.min-BJ9zlrPD.js";import{i as dt}from"./isBetween-BmZnC1k9.js";import{a as le}from"./vendor-utils-CrJAVL9K.js";import{F as he}from"./ExclamationTriangleIcon-BarRaUA8.js";import{F as se}from"./ClockIcon-BKLni_N9.js";import{F as ze}from"./UserGroupIcon-CSQScwVa.js";import{F as ut}from"./SunIcon-QPa9r1ID.js";import{F as ke}from"./InformationCircleIcon-Hd0GuQtg.js";import{F as $e}from"./UserIcon-CgrjQ1A2.js";import{F as mt}from"./XCircleIcon-BzKw4V53.js";import{F as ge}from"./CheckCircleIcon-BAvoXTNq.js";import{F as ht}from"./ClipboardDocumentListIcon-CESV3yIX.js";import{s as Y}from"./toastUtils-BVg-E_WQ.js";import{a as me,F as pt}from"./MapPinIcon-DDwLGyCW.js";import{F as ft}from"./WifiIcon-CqOWPiHe.js";import{F as xt}from"./ShieldCheckIcon-Ck-ae4AP.js";import{F as gt}from"./XMarkIcon-twQGc8di.js";import"./vendor-react-FouZbkAE.js";import"./PageHeader-DcavjRv5.js";import"./MagnifyingGlassIcon-BJyUDYwI.js";import"./UserPlusIcon-DxLlp7sC.js";import"./DocumentArrowDownIcon-DCm9Iy1y.js";import"./EnvelopeIcon-CFKoTD3N.js";import"./KeyIcon-BIi5nz4o.js";import"./logo-DFaNDj_M.js";function yt({title:n,titleId:t,...d},m){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":t},d),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12"}))}const vt=r.forwardRef(yt);function bt({title:n,titleId:t,...d},m){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":t},d),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const De=r.forwardRef(bt);function wt({title:n,titleId:t,...d},m){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":t},d),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z"}))}const jt=r.forwardRef(wt);function Nt({title:n,titleId:t,...d},m){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":t},d),n?r.createElement("title",{id:t},n):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const Ft=r.forwardRef(Nt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ct=Se("clock-4",kt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],Ae=Se("map",_t);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],It=Se("refresh-cw",St);L.Control.Fullscreen=L.Control.extend({options:{position:"topleft",title:{false:"View Fullscreen",true:"Exit Fullscreen"}},onAdd:function(n){var t=L.DomUtil.create("div","leaflet-control-fullscreen leaflet-bar leaflet-control");return this.link=L.DomUtil.create("a","leaflet-control-fullscreen-button leaflet-bar-part",t),this.link.href="#",this._map=n,this._map.on("fullscreenchange",this._toggleTitle,this),this._toggleTitle(),L.DomEvent.on(this.link,"click",this._click,this),t},_click:function(n){L.DomEvent.stopPropagation(n),L.DomEvent.preventDefault(n),this._map.toggleFullscreen(this.options)},_toggleTitle:function(){this.link.title=this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen:function(){return this._isFullscreen||!1},toggleFullscreen:function(n){var t=this.getContainer();this.isFullscreen()?n&&n.pseudoFullscreen?this._disablePseudoFullscreen(t):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():this._disablePseudoFullscreen(t):n&&n.pseudoFullscreen?this._enablePseudoFullscreen(t):t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen?t.msRequestFullscreen():this._enablePseudoFullscreen(t)},_enablePseudoFullscreen:function(n){L.DomUtil.addClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!0),this.fire("fullscreenchange")},_disablePseudoFullscreen:function(n){L.DomUtil.removeClass(n,"leaflet-pseudo-fullscreen"),this._setFullscreen(!1),this.fire("fullscreenchange")},_setFullscreen:function(n){this._isFullscreen=n;var t=this.getContainer();n?L.DomUtil.addClass(t,"leaflet-fullscreen-on"):L.DomUtil.removeClass(t,"leaflet-fullscreen-on"),this.invalidateSize()},_onFullscreenChange:function(n){var t=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement;t===this.getContainer()&&!this._isFullscreen?(this._setFullscreen(!0),this.fire("fullscreenchange")):t!==this.getContainer()&&this._isFullscreen&&(this._setFullscreen(!1),this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl:!1});L.Map.addInitHook(function(){this.options.fullscreenControl&&(this.fullscreenControl=new L.Control.Fullscreen(this.options.fullscreenControl),this.addControl(this.fullscreenControl));var n;if("onfullscreenchange"in document?n="fullscreenchange":"onmozfullscreenchange"in document?n="mozfullscreenchange":"onwebkitfullscreenchange"in document?n="webkitfullscreenchange":"onmsfullscreenchange"in document&&(n="MSFullscreenChange"),n){var t=L.bind(this._onFullscreenChange,this);this.whenReady(function(){L.DomEvent.on(document,n,t)}),this.on("unload",function(){L.DomEvent.off(document,n,t)})}});L.control.fullscreen=function(n){return new L.Control.Fullscreen(n)};const Q=(n,t)=>{if(n.startsWith("var("))return`color-mix(in srgb, ${n} ${t*100}%, transparent)`;if(n.startsWith("#")){const d=n.replace("#",""),m=parseInt(d.substr(0,2),16),o=parseInt(d.substr(2,2),16),p=parseInt(d.substr(4,2),16);return`rgba(${m}, ${o}, ${p}, ${t})`}return n.replace(/[\d.]+\)$/g,`${t})`)},Pt=()=>{var m;const t=((m=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:m.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},q={DEFAULT_ZOOM:12,MIN_ZOOM:8,MAX_ZOOM:19,POSITION_THRESHOLD:1e-4,OFFSET_MULTIPLIER:1e-4,MARKER_SIZE:[40,40],POPUP_MAX_WIDTH:160},Me={lat:23.8103,lng:90.4125},Be=ce.memo(({attendanceTypeConfigs:n,theme:t})=>{const d=_e(),m=r.useRef([]);return r.useEffect(()=>{if(!d||!(n!=null&&n.length))return;d.eachLayer(p=>{p.options&&(p.options.isAttendanceBoundary||p.options.isPolygon||p.options.isRoute)&&d.removeLayer(p)}),m.current.forEach(p=>{try{d.removeControl(p)}catch(u){console.warn("Error removing routing control:",u)}}),m.current=[],d.getContainer().querySelectorAll(".leaflet-routing-container").forEach(p=>p.remove());const o=[];if(n.forEach((p,u)=>{var w;const{base_slug:g,config:C,name:N}=p;(w=t==null?void 0:t.customColors)!=null&&w.primary;const F=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],I=F[u%F.length];if(g==="geo_polygon"&&C){const E=C.polygon||[],$=C.polygons||[];if(E.length>=3){const b=E.filter(h=>h.lat&&h.lng);if(b.length>=3){const h=b.map(a=>[parseFloat(a.lat),parseFloat(a.lng)]),y=W.polygon(h,{color:I,fillColor:I,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);y.bindPopup(`
                            <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                <strong style="color: ${I};">${N}</strong><br>
                                <small>Geofence Zone</small><br>
                                <small>Points: ${b.length}</small>
                            </div>
                        `),o.push(y.getBounds())}}$.forEach((b,h)=>{const y=b.points||[];if(y.length>=3){const a=y.filter(c=>c.lat&&c.lng);if(a.length>=3){const c=a.map(k=>[parseFloat(k.lat),parseFloat(k.lng)]),l=W.polygon(c,{color:I,fillColor:I,fillOpacity:.15,weight:2,opacity:.7,isAttendanceBoundary:!0,isPolygon:!0}).addTo(d);l.bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${I};">${N}</strong><br>
                                    <small>${b.name||`Zone ${h+1}`}</small>
                                </div>
                            `),o.push(l.getBounds())}}})}if(g==="route_waypoint"&&C){const E=C.waypoints||[],$=C.routes||[];if(E.length>=2){const b=E.filter(h=>h.lat&&h.lng);if(b.length>=2){const h=b.map(y=>W.latLng(parseFloat(y.lat),parseFloat(y.lng)));b.forEach((y,a)=>{const c=a===0,l=a===b.length-1,k=`
                                <div style="
                                    width: 24px;
                                    height: 24px;
                                    border-radius: 50%;
                                    background: ${c?"#10b981":l?"#ef4444":I};
                                    border: 2px solid white;
                                    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-weight: bold;
                                    font-size: 11px;
                                ">
                                    ${a+1}
                                </div>
                            `;W.marker([parseFloat(y.lat),parseFloat(y.lng)],{icon:W.divIcon({html:k,className:"route-waypoint-marker",iconSize:[24,24],iconAnchor:[12,12]}),isAttendanceBoundary:!0}).addTo(d).bindPopup(`
                                <div style="font-family: var(--fontFamily, 'Inter'); text-align: center; padding: 4px;">
                                    <strong style="color: ${I};">${N}</strong><br>
                                    <small>Waypoint ${a+1}${y.name?`: ${y.name}`:""}</small>
                                </div>
                            `)});try{const y=W.Routing.control({waypoints:h,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:I,weight:4,opacity:.7,dashArray:"8, 4"}],extendToWaypoints:!0,missingRouteTolerance:0},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);m.current.push(y);const a=W.latLngBounds(h);o.push(a)}catch(y){console.warn("Error creating route:",y);const a=W.polyline(h,{color:I,weight:3,opacity:.6,dashArray:"10, 10",isAttendanceBoundary:!0,isRoute:!0}).addTo(d);o.push(a.getBounds())}}}$.forEach((b,h)=>{const y=b.waypoints||[];if(y.length>=2){const a=y.filter(c=>c.lat&&c.lng);if(a.length>=2){const c=a.map(l=>W.latLng(parseFloat(l.lat),parseFloat(l.lng)));try{const l=W.Routing.control({waypoints:c,routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:I,weight:4,opacity:.7,dashArray:"8, 4"}]},show:!1,fitSelectedRoutes:!1,router:W.Routing.osrmv1({serviceUrl:"https://router.project-osrm.org/route/v1"})}).addTo(d);m.current.push(l),o.push(W.latLngBounds(c))}catch(l){console.warn("Error creating route:",l)}}}})}}),o.length>0){const p=o.reduce((u,g)=>u?u.extend(g):g,null);p&&p.isValid()&&setTimeout(()=>{d.fitBounds(p,{padding:[50,50],maxZoom:14})},500)}return()=>{m.current.forEach(p=>{try{d.removeControl(p)}catch{}}),m.current=[]}},[d,n,t]),null});Be.displayName="AttendanceTypeBoundaries";const Rt=ce.memo(({startLocation:n,endLocation:t,theme:d})=>{const m=_e();return r.useEffect(()=>{var p;if(!m||!n||!t)return;const o=W.Routing.control({waypoints:[W.latLng(n.lat,n.lng),W.latLng(t.lat,t.lng)],routeWhileDragging:!1,addWaypoints:!1,createMarker:()=>null,lineOptions:{styles:[{color:((p=d==null?void 0:d.customColors)==null?void 0:p.primary)||"var(--theme-primary, #3b82f6)",weight:4,opacity:.8}]},show:!1}).addTo(m);return()=>{m&&o&&m.removeControl(o)}},[m,n,t,d]),null});Rt.displayName="RoutingMachine";const He=ce.memo(({selectedDate:n,onUsersLoad:t,theme:d,lastUpdate:m,users:o,setUsers:p,setLoading:u,setError:g,setAttendanceTypeConfigs:C})=>{const N=_e(),F=r.useRef([]),I=r.useCallback(async()=>{if(!n){u(!1),p([]),C==null||C([]),t==null||t([]);return}u(!0),g(null);try{const a=route("getUserLocationsForDate",{date:n,_t:Date.now()}),l=(await axios.get(a)).data;if(!l.success||!Array.isArray(l.locations))throw new Error("Unexpected response format from server.");const k=l.locations,v=l.attendance_type_configs||[];JSON.stringify(k)!==JSON.stringify(F.current)&&(p(k),F.current=k),C==null||C(v),t==null||t(k)}catch(a){let c="Error fetching user locations.";a.response?(c+=` Server error (${a.response.status}): ${a.response.statusText}`,typeof a.response.data=="object"&&(c+=`
Details: ${JSON.stringify(a.response.data)}`)):a.request?c+=" No response received from server.":a.message&&(c+=` ${a.message}`),console.error(c,a),g(c),p([]),t==null||t([])}finally{u(!1)}},[n,t,m]);r.useEffect(()=>{I()},[I]);const w=r.useCallback((a,c)=>{const l=q.OFFSET_MULTIPLIER*c;return{lat:a.lat+l,lng:a.lng+l}},[]),E=r.useCallback((a,c)=>Math.abs(a.lat-c.lat)<q.POSITION_THRESHOLD&&Math.abs(a.lng-c.lng)<q.POSITION_THRESHOLD,[]),$=r.useCallback(a=>{if(!a)return null;if(typeof a=="object"&&a.lat&&a.lng){const c=parseFloat(a.lat),l=parseFloat(a.lng);return isNaN(c)||isNaN(l)?null:{lat:c,lng:l}}if(typeof a=="string")try{const c=JSON.parse(a);if(c.lat&&c.lng){const l=parseFloat(c.lat),k=parseFloat(c.lng);return isNaN(l)||isNaN(k)?null:{lat:l,lng:k}}}catch{const l=a.split(",");if(l.length>=2){const k=parseFloat(l[0].trim()),v=parseFloat(l[1].trim());return isNaN(k)||isNaN(v)?null:{lat:k,lng:v}}}return null},[]),b=r.useCallback(a=>{if(!a)return"Not recorded";try{let c;return a.includes("T")?c=new Date(a):c=new Date(`${n}T${a}`),isNaN(c.getTime())?"Invalid time":c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}catch(c){return console.warn("Error formatting time:",c),a}},[n]),h=r.useCallback((a,c="default")=>{var R,T,Z,H;const l="var(--theme-primary, #3b82f6)",k="var(--theme-secondary, #8b5cf6)",v="var(--theme-success, #17C964)",A="var(--theme-danger, #ef4444)";let _,M,f="";c==="punchin"?(_=`${v}, #059669`,M=Q(v,.4),f='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚ñ∂</span>'):c==="punchout"?(_=`${A}, #dc2626`,M=Q(A,.4),f='<span style="position: absolute; top: -4px; right: -4px; font-size: 10px;">‚óº</span>'):(_=`${l}, ${k}`,M=Q(l,.4));const P=`
            <div style="
                position: relative;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: linear-gradient(135deg, ${_});
                border: 3px solid white;
                box-shadow: 0 4px 12px ${M};
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 14px;
                backdrop-filter: blur(10px);
            ">
                ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((T=(R=a.name)==null?void 0:R.charAt(0))==null?void 0:T.toUpperCase())||"?"}';" />`:((H=(Z=a.name)==null?void 0:Z.charAt(0))==null?void 0:H.toUpperCase())||"?"}
                ${f}
            </div>
        `;return W.divIcon({html:P,className:"user-marker-icon",iconSize:q.MARKER_SIZE,iconAnchor:[20,20],popupAnchor:[0,-20]})},[]),y=r.useCallback((a,c="combined")=>{var S,D,z,ee;const l=a.punchout_time?"var(--theme-success, #17C964)":"var(--theme-warning, #F5A524)",k="var(--theme-primary, #3b82f6)",v="var(--theme-secondary, #8b5cf6)",A="var(--theme-success, #17C964)",_="var(--theme-danger, #ef4444)",M="var(--theme-content1, #ffffff)",f="var(--theme-foreground, #1f2937)",P="var(--theme-content3, #6b7280)";let R=null,T="";c==="punchin"&&a.punchin_photo_url?(R=a.punchin_photo_url,T="Check In Photo"):c==="punchout"&&a.punchout_photo_url&&(R=a.punchout_photo_url,T="Check Out Photo");const Z=R?`
            <div style="margin-top: 6px; margin-bottom: 6px; overflow: hidden; border-radius: 4px;">
                <div style="color: ${P}; font-size: 8px; margin-bottom: 2px; text-transform: uppercase; letter-spacing: 0.3px;">
                    ${T}
                </div>
                <img 
                    src="${R}" 
                    data-fullscreen-photo="${R}"
                    style="
                        width: 100%; 
                        height: auto;
                        max-height: 100px;
                        object-fit: contain; 
                        border-radius: 4px;
                        border: 1px solid ${Q(k,.2)};
                        display: block;
                        cursor: pointer;
                    " 
                    onmouseover="this.style.opacity='0.85'"
                    onmouseout="this.style.opacity='1'"
                    onerror="this.style.display='none';"
                    title="Click to view full screen"
                />
            </div>
        `:"";let H="",J=k;c==="punchin"?(H=`
                <div style="
                    display: inline-block;
                    padding: 1px 4px;
                    background: ${Q(A,.1)};
                    color: ${A};
                    border-radius: 3px;
                    font-size: 7px;
                    font-weight: 600;
                    margin-left: 4px;
                    border: 1px solid ${Q(A,.2)};
                ">CHECK IN</div>
            `,J=A):c==="punchout"&&(H=`
                <div style="
                    display: inline-block;
                    padding: 1px 4px;
                    background: ${Q(_,.1)};
                    color: ${_};
                    border-radius: 3px;
                    font-size: 7px;
                    font-weight: 600;
                    margin-left: 4px;
                    border: 1px solid ${Q(_,.2)};
                ">CHECK OUT</div>
            `,J=_);let U="";return c==="punchin"?U=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${A}; margin-right: 4px; font-size: 10px;">üìç</span>
                    <span style="color: ${P}; font-size: 9px;">
                        Time: ${b(a.punchin_time)}
                    </span>
                </div>
            `:c==="punchout"?U=`
                <div style="display: flex; align-items: center;">
                    <span style="color: ${_}; margin-right: 4px; font-size: 10px;">üìç</span>
                    <span style="color: ${P}; font-size: 9px;">
                        Time: ${b(a.punchout_time)}
                    </span>
                </div>
            `:U=`
                <div style="display: flex; align-items: center; margin-bottom: 4px;">
                    <span style="color: ${A}; margin-right: 4px; font-size: 10px;">üìç</span>
                    <span style="color: ${P}; font-size: 9px;">
                        Check In: ${b(a.punchin_time)}
                    </span>
                </div>
                <div style="display: flex; align-items: center;">
                    <span style="color: ${_}; margin-right: 4px; font-size: 10px;">üìç</span>
                    <span style="color: ${P}; font-size: 9px;">
                        Check Out: ${b(a.punchout_time)}
                    </span>
                </div>
            `,`
            <div style="
                min-width: 140px;
                max-width: 160px;
                padding: 8px;
                background: linear-gradient(135deg, ${Q(M,.95)}, ${Q(J,.05)});
                border-radius: 8px;
                border: 1px solid ${Q(J,.2)};
                backdrop-filter: blur(20px);
                font-family: var(--fontFamily, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
                overflow: hidden;
            ">
                <div style="display: flex; align-items: center; margin-bottom: 6px;">
                    <div style="
                        width: 22px;
                        height: 22px;
                        min-width: 22px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, ${c==="punchin"?A:c==="punchout"?_:k}, ${v});
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-weight: bold;
                        font-size: 10px;
                        margin-right: 6px;
                    ">
                        ${a.profile_image_url||a.profile_image?`<img src="${a.profile_image_url||a.profile_image}" style="width: 20px; height: 20px; border-radius: 50%; object-fit: cover;" onerror="this.style.display='none'; this.parentElement.innerHTML='${((D=(S=a.name)==null?void 0:S.charAt(0))==null?void 0:D.toUpperCase())||"?"}';" />`:((ee=(z=a.name)==null?void 0:z.charAt(0))==null?void 0:ee.toUpperCase())||"?"}
                    </div>
                    <div style="flex: 1; min-width: 0; overflow: hidden;">
                        <div style="display: flex; align-items: center; flex-wrap: wrap;">
                            <span style="font-weight: 600; color: ${f}; font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 70px;">
                                ${a.name||"Unknown"}
                            </span>
                            ${H}
                        </div>
                        <div style="color: ${P}; font-size: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            ${a.designation||"No designation"}
                        </div>
                    </div>
                </div>
                ${c==="combined"?`
                <div style="
                    display: inline-block;
                    padding: 2px 4px;
                    background: ${Q(l,.1)};
                    color: ${l};
                    border-radius: 4px;
                    font-size: 8px;
                    font-weight: 600;
                    margin-bottom: 6px;
                    border: 1px solid ${Q(l,.2)};
                ">
                    ${a.punchout_time?"‚úì Completed":"‚è± Active"}
                </div>`:""}
                ${Z}
                <div style="space-y: 4px;">
                    ${U}
                </div>
            </div>
        `},[b]);return r.useEffect(()=>{if(!N||!o.length)return;N.eachLayer(l=>{(l instanceof W.Marker&&l.options.userData||l instanceof W.Polyline&&l.options.userRoute)&&N.removeLayer(l)});const a=[],c=l=>{let k={...l},v=0;const A=10;for(;v<A&&a.some(M=>E(k,M));)k=w(l,v+1),v++;return a.push(k),k};o.forEach(l=>{const k=l.cycles||[];if(k.length>0)k.forEach((v,A)=>{const _=$(v.punchin_location),M=$(v.punchout_location);if(!_&&!M)return;const f=_&&M&&v.is_complete,P={...l,punchin_time:v.punchin_time,punchout_time:v.punchout_time,punchin_photo_url:v.punchin_photo_url,punchout_photo_url:v.punchout_photo_url};if(f){const R=c(_),T=c(M),Z=W.marker([R.lat,R.lng],{icon:h(l,"punchin"),userData:!0});Z.bindPopup(y(P,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),Z.addTo(N);const H=W.marker([T.lat,T.lng],{icon:h(l,"punchout"),userData:!0});H.bindPopup(y(P,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),H.addTo(N),W.polyline([[R.lat,R.lng],[T.lat,T.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(N)}else{const T=c(_||M),Z=_?"punchin":"punchout",H=W.marker([T.lat,T.lng],{icon:h(l,Z),userData:!0});H.bindPopup(y(P,Z),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),H.addTo(N)}});else{const v=$(l.punchin_location),A=$(l.punchout_location);if(!v&&!A)return;if(v&&A&&l.punchout_time){const M=c(v),f=c(A),P=W.marker([M.lat,M.lng],{icon:h(l,"punchin"),userData:!0});P.bindPopup(y(l,"punchin"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),P.addTo(N);const R=W.marker([f.lat,f.lng],{icon:h(l,"punchout"),userData:!0});R.bindPopup(y(l,"punchout"),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(N),W.polyline([[M.lat,M.lng],[f.lat,f.lng]],{color:"var(--theme-primary, #3b82f6)",weight:3,opacity:.7,dashArray:"10, 10",userRoute:!0}).addTo(N)}else{const f=c(v||A),P=v?"punchin":"punchout",R=W.marker([f.lat,f.lng],{icon:h(l,P),userData:!0});R.bindPopup(y(l,P),{maxWidth:q.POPUP_MAX_WIDTH,className:"custom-popup"}),R.addTo(N)}}})},[N,o,d,$,E,w,h,y]),null});He.displayName="UserMarkers";const Et=n=>r.useMemo(()=>{const t=n.reduce((u,g)=>{const C=g.user_id;return u[C]||(u[C]=[]),u[C].push(g),u},{}),d=Object.keys(t),m=d.length;let o=0,p=0;return d.forEach(u=>{const g=t[u];g.sort((F,I)=>F.punchin_time?I.punchin_time?F.punchin_time.localeCompare(I.punchin_time):-1:1);const C=g[g.length-1];g.some(F=>F.punchin_time)&&(C.punchout_time?p++:o++)}),{checkedIn:o,completed:p,total:m}},[n]),Lt=ce.memo(({updateMap:n,selectedDate:t})=>{const{themeSettings:d}=rt(),m=xe("(min-width: 1025px)"),o=xe("(min-width: 641px) and (max-width: 1024px)"),[p,u]=r.useState([]),[g,C]=r.useState([]),[N,F]=r.useState(!0),[I,w]=r.useState(null),[E,$]=r.useState(null),[b,h]=r.useState(!1),[y,a]=r.useState(null),[c,l]=r.useState(!0),[k,v]=r.useState(0),A=window.innerWidth<640,[_,M]=r.useState(new Date),f=r.useRef([]),P=r.useRef(null);r.useRef(null),r.useEffect(()=>{const S=D=>{var ee;const z=(ee=D.target.dataset)==null?void 0:ee.fullscreenPhoto;z&&$(z)};return document.addEventListener("click",S),()=>{document.removeEventListener("click",S)}},[]);const R=r.useCallback(async()=>{F(!0);try{const S=route("getUserLocationsForDate",{date:t,_t:Date.now()});if(!t){u([]),C([]),f.current=[],v(i=>i+1),M(new Date),a(new Date);return}const D=await fetch(S);if(!D.ok)throw new Error(`HTTP ${D.status}: Failed to refresh user locations`);const z=await D.json(),ee=Array.isArray(z.locations)?z.locations:[],s=Array.isArray(z.attendance_type_configs)?z.attendance_type_configs:[];u(ee),C(s),f.current=ee,v(i=>i+1),M(new Date),a(new Date)}catch(S){console.error("Error refreshing map:",S),u([]),C([]),f.current=[]}finally{F(!1)}},[t]),T=r.useMemo(()=>{if(!t)return"Invalid Date";try{return new Date(t).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return"Invalid Date"}},[t]),Z=Et(p),H=r.useCallback(async()=>{if(!t){F(!1);return}try{const S=route("check-user-locations-updates",{date:t.split("T")[0]}),D=await fetch(S);if(!D.ok)throw new Error(`HTTP ${D.status}: Failed to check for updates`);const z=await D.json();z.success&&z.last_updated!==P.current&&z.last_updated&&(P.current=z.last_updated,R(),a(new Date)),M(new Date)}catch(S){console.error("Error checking for updates:",S),F(!1)}},[t,R]);r.useEffect(()=>{if(!c)return;H();const S=setInterval(H,5e3);return()=>clearInterval(S)},[c,H]),r.useEffect(()=>{p.length===0&&N&&b&&F(!1)},[p,N,b]),r.useEffect(()=>{if(N){const S=setTimeout(()=>{N&&(console.log("Loading timeout reached, forcing loading to false"),F(!1))},1e4);return()=>clearTimeout(S)}},[N]);const J=r.useMemo(()=>_?_.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0}):null,[_]),U=r.useCallback(S=>{const D=Array.isArray(S)?S:[];JSON.stringify(D)!==JSON.stringify(f.current)&&(u(D),f.current=D),h(!0),F(!1)},[]);return e.jsxs("div",{className:"flex justify-center p-4",children:[e.jsx(K.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8},className:"w-full max-w-full",children:e.jsxs(G,{className:"w-full transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Ce,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${m?"p-6":o?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                ${m?"p-3":o?"p-2.5":"p-2"} 
                                                rounded-xl flex items-center justify-center
                                            `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(Ae,{className:`
                                                    ${m?"w-8 h-8":o?"w-6 h-6":"w-5 h-5"}
                                                `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                    ${m?"text-2xl":o?"text-xl":"text-lg"}
                                                    font-bold text-foreground
                                                    ${m?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Team Locations"}),e.jsx("p",{className:`
                                                    ${m?"text-sm":"text-xs"} 
                                                    text-default-500
                                                    ${m?"":"truncate"}
                                                `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:T})]})]}),e.jsx("div",{className:"flex items-center gap-4",children:J&&e.jsxs("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["Updated: ",J]})})]})})})}),e.jsx(Oe,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}}),e.jsxs(ye,{className:"p-0",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx("div",{className:"p-6",children:e.jsx(nt,{className:"mb-6",stats:[{title:"Total",value:Z.total,icon:e.jsx(lt,{className:"w-5 h-5"}),color:"text-primary",description:"Total users tracked",iconBg:"bg-primary/20",valueColor:"text-primary",customStyle:{color:"var(--theme-primary)"}},{title:"Active",value:Z.checkedIn,icon:e.jsx(Ct,{className:"w-5 h-5"}),color:"text-warning",description:"Currently working",iconBg:"bg-warning/20",valueColor:"text-warning",customStyle:{color:"var(--theme-warning)"}},{title:"Completed",value:Z.completed,icon:e.jsx(ct,{className:"w-5 h-5"}),color:"text-success",description:"Finished workday",iconBg:"bg-success/20",valueColor:"text-success",customStyle:{color:"var(--theme-success)"}}],compact:A})}),e.jsx("div",{className:"p-6 pt-0",children:p.length>0?e.jsxs("div",{className:"relative h-[70vh] rounded-2xl overflow-hidden border-2 shadow-2xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[N&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center backdrop-blur-xl z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}),e.jsxs(ot,{center:[Me.lat,Me.lng],zoom:q.DEFAULT_ZOOM,minZoom:q.MIN_ZOOM,maxZoom:q.MAX_ZOOM,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,doubleClickZoom:!0,dragging:!0,touchZoom:!0,fullscreenControl:!0,attributionControl:!1,zoomControl:!1,children:[e.jsx(it,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxZoom:q.MAX_ZOOM,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(Be,{attendanceTypeConfigs:g,theme:d}),e.jsx(He,{users:p,setUsers:u,setLoading:F,setError:w,setAttendanceTypeConfigs:C,lastUpdate:y,selectedDate:t,onUsersLoad:U,theme:d})]},`${n}-${k}`)]}):N?e.jsx("div",{className:"h-[70vh] rounded-2xl flex items-center justify-center border-2 shadow-2xl backdrop-blur-xl",style:{borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"text-center",children:[e.jsx(we,{size:"lg",color:"primary"}),e.jsx("p",{className:"mt-4 text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Loading locations..."})]})}):e.jsxs("div",{className:"h-[70vh] rounded-2xl flex flex-col items-center justify-center backdrop-blur-xl border-2 shadow-2xl p-12",style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ae,{className:"w-16 h-16 text-default-300 mb-6"}),e.jsx("h3",{className:"text-xl font-semibold mb-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"No Location Data Available"}),e.jsxs("p",{className:"text-default-500 mb-6 max-w-md text-center",style:{fontFamily:'var(--fontFamily, "Inter")'},children:["No team location data found for ",T,".",t&&new Date(t)>new Date?" This date is in the future.":" Try selecting a different date or refreshing the data."]}),e.jsx(ae,{variant:"bordered",color:"primary",size:"md",radius:Pt(),onPress:R,startContent:e.jsx(It,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Refresh Data"})]})})]})]})}),E&&e.jsxs("div",{className:"fixed top-0 left-0 right-0 bottom-0 flex items-center justify-center",style:{zIndex:99999,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(8px)"},onClick:()=>$(null),children:[e.jsx("button",{className:"absolute top-6 right-6 p-3 rounded-full transition-all hover:bg-white/30",style:{zIndex:1e5,color:"white",background:"rgba(255, 255, 255, 0.15)",border:"2px solid rgba(255, 255, 255, 0.3)"},onClick:S=>{S.stopPropagation(),$(null)},"aria-label":"Close fullscreen",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsxs("div",{className:"flex flex-col items-center justify-center p-4",style:{maxWidth:"95vw",maxHeight:"95vh"},children:[e.jsx("img",{src:E,alt:"Attendance photo",style:{maxWidth:"90vw",maxHeight:"85vh",objectFit:"contain",borderRadius:"12px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.8)"},onClick:S=>S.stopPropagation()}),e.jsx("p",{className:"text-center mt-6 text-base",style:{color:"rgba(255, 255, 255, 0.7)"},children:"Click anywhere to close"})]})]})]})});re.extend(dt);const pe=()=>{var m;if(typeof window>"u")return"lg";const t=((m=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:m.trim())||"12px",d=parseInt(t);return d===0?"none":d<=4?"sm":d<=8?"md":d<=16?"lg":"full"},fe=()=>({background:`linear-gradient(135deg, 
        var(--theme-content1, #FAFAFA) 20%, 
        var(--theme-content2, #F4F4F5) 10%, 
        var(--theme-content3, #F1F3F4) 20%)`,borderColor:"transparent",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",transition:"all 0.2s ease-in-out",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)"}),Tt=({title:n,items:t,users:d,icon:m,color:o})=>{var b;const[p,u]=r.useState(null),[g,C]=r.useState(null),N=(h,y)=>{u(h.currentTarget),C(y)},F=()=>{u(null),C(null)},I=!!p,w=I?"leave-details-popover":void 0,E=h=>{switch(h==null?void 0:h.toLowerCase()){case"approved":return e.jsx(ge,{className:"w-4 h-4 text-success"});case"rejected":return e.jsx(mt,{className:"w-4 h-4 text-danger"});default:return e.jsx(se,{className:"w-4 h-4 text-warning"})}},$=h=>{switch(h==null?void 0:h.toLowerCase()){case"approved":return"success";case"rejected":return"danger";default:return"warning"}};return e.jsxs(G,{className:"h-full flex flex-col",radius:pe(),style:fe(),onMouseEnter:h=>{h.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${o} 50%, transparent)`,h.currentTarget.style.borderRadius="var(--borderRadius, 12px)",h.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:h=>{h.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",h.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Ce,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${o} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${o} 25%, transparent)`},children:e.jsx(m,{className:"w-6 h-6 stroke-2",style:{color:o},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:n})]})}),e.jsx(ye,{className:"flex-1 overflow-auto pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:t.map((h,y)=>e.jsxs(ce.Fragment,{children:[e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:y*.1,duration:.3},className:"flex justify-between items-center py-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 mr-2",children:[e.jsx("p",{className:"text-sm leading-normal text-foreground",style:{fontFamily:'var(--fontFamily, "Inter")'},children:h.text}),h.leaves&&h.leaves.length>0&&e.jsxs("p",{className:"text-xs text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ze,{className:"w-3 h-3"}),h.leaves.length," employee",h.leaves.length>1?"s":""]})]}),h.leaves&&(()=>{const a=h.leaves.filter(c=>c.leave_type===h.type);return a.length>0&&e.jsx("div",{className:"flex gap-1 flex-shrink-0",children:e.jsx(qe,{max:4,isBordered:!0,size:"sm",children:a.map((c,l)=>{const k=d.find(v=>String(v.id)===String(c.user_id));return k&&e.jsx(Ue,{src:k.profile_image_url,name:`${k.name} - on leave`,size:"sm",className:"cursor-pointer hover:scale-110 transition-transform",onClick:v=>N(v,c),fallbackIcon:e.jsx($e,{className:"w-4 h-4"})},l)})})})})()]}),y<t.length-1&&e.jsx(Oe,{style:{borderColor:"var(--theme-divider, #E4E4E7)"}})]},y))}),e.jsx(Ke,{id:w,open:I,anchorEl:p,onClose:F,placement:"bottom-start",style:{borderColor:"var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx(Je,{style:{background:"var(--theme-content1, #FAFAFA)",borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',minWidth:"300px",padding:"16px"},children:g&&e.jsxs("section",{"aria-labelledby":"leave-details-title",children:[e.jsxs("h3",{id:"leave-details-title",className:"text-lg font-semibold flex items-center gap-2 mb-3",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Fe,{className:"w-5 h-5 text-primary"}),"Leave Details"]}),e.jsxs("div",{id:"leave-details-content",className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Employee:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:((b=d.find(h=>String(h.id)===String(g.user_id)))==null?void 0:b.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Duration:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:g.from_date!==g.to_date?`${new Date(g.from_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})} - ${new Date(g.to_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:new Date(g.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-default-500 mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Reason:"}),e.jsx("div",{className:"text-sm font-medium",style:{fontFamily:'var(--fontFamily, "Inter")'},children:g.reason||"No reason provided"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[E(g.status),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-default-500",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Status:"}),e.jsx(ie,{label:g.status||"Pending",variant:"flat",color:$(g.status),size:"sm",className:"ml-2"})]})]})]})]})})})]})},$t=()=>{const{auth:n}=We().props,t=xe("(min-width: 1025px)"),d=xe("(min-width: 641px) and (max-width: 1024px)"),[m,o]=r.useState(!0),[p,u]=r.useState(null),[g,C]=r.useState([]),[N,F]=r.useState([]),[I,w]=r.useState([]),[E,$]=r.useState(null);r.useEffect(()=>{let f=!0;const P=new AbortController;return(async()=>{try{o(!0),u(null);const T=await le.get(route("updates"),{signal:P.signal,timeout:1e4});f&&T.data&&(C(T.data.users||[]),F(T.data.todayLeaves||[]),w(T.data.upcomingLeaves||[]),$(T.data.upcomingHoliday||null))}catch(T){f&&!P.signal.aborted&&(console.error("Failed to fetch updates:",T),u(T.message),C([]),F([]),w([]),$(null))}finally{f&&o(!1)}})(),()=>{f=!1,P.abort()}},[]);const b=(f,P)=>{let R=P;const T=U=>P.some(D=>String(D.user_id)===String(n.user.id)&&D.leave_type===U)?(R=P.filter(D=>String(D.user_id)!==String(n.user.id)),`You ${f==="today"?"are":"will be"} on ${U} leave.`):null,Z=P.reduce((U,S)=>{const D=T(S.leave_type);return D&&!U.some(z=>z.type===S.leave_type)&&U.push({text:D,type:S.leave_type}),U},[]),H=R.reduce((U,S)=>(U[S.leave_type]=(U[S.leave_type]||0)+1,U),{}),J=Object.entries(H).map(([U,S])=>({text:`${S} person${S>1?"s":""} ${f==="today"?"is":"will be"} on ${U} leave`,type:U,leaves:R.filter(D=>D.leave_type===U)}));return[...Z,...J]},h=re(),y=h.add(1,"day"),a=y.add(7,"day"),c=N.filter(f=>re(h).isBetween(re(f.from_date),re(f.to_date),"day","[]")),l=I.filter(f=>re(y).isBetween(re(f.from_date),re(f.to_date),"day","[]")),k=I.filter(f=>(re(f.from_date).isBetween(y,a,"day","[]")||re(f.to_date).isBetween(y,a,"day","[]"))&&!/week/i.test(f.leave_type)),v=b("today",c),A=b("tomorrow",l),_=b("nextSevenDays",k);v.length===0&&v.push({text:"No one is away today."}),A.length===0&&A.push({text:"No one is away tomorrow."}),_.length===0&&_.push({text:"No one is going to be away in the next seven days."});const M=[{title:"Today",items:v,icon:Ne,color:"#3b82f6"},{title:"Tomorrow",items:A,icon:se,color:"#10b981"},{title:"Next Seven Days",items:_,icon:ze,color:"#f59e0b"}];return m?e.jsx("section",{"aria-label":"Employee updates loading",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3",children:[1,2,3].map((f,P)=>e.jsx("div",{children:e.jsxs(G,{className:"w-full h-full",radius:pe(),style:fe(),children:[e.jsx(je,{className:"rounded-lg mb-2",isLoaded:!1,children:e.jsx("div",{className:"h-6 w-2/3 rounded-lg bg-secondary"})}),e.jsx(je,{className:"rounded-lg",isLoaded:!1,children:e.jsx("div",{className:"h-32 w-full rounded-lg bg-secondary-200"})})]})},P))})}):p?e.jsx("div",{className:`${t?"p-6":d?"p-4":"p-3"} flex items-center justify-center min-h-[200px]`,children:e.jsx(G,{radius:pe(),style:{...fe(),borderColor:"color-mix(in srgb, var(--theme-danger) 50%, transparent)",background:`linear-gradient(135deg, 
                            color-mix(in srgb, var(--theme-danger) 5%, var(--theme-content1)) 20%, 
                            color-mix(in srgb, var(--theme-danger) 3%, var(--theme-content2)) 10%, 
                            color-mix(in srgb, var(--theme-danger) 2%, var(--theme-content3)) 20%)`},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-danger)"}}),e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger)",fontFamily:'var(--fontFamily, "Inter")'},children:["Failed to load updates: ",p]})]})})}):e.jsxs("section",{className:"p-4","aria-label":"Employee Updates Dashboard",children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 items-stretch",children:M.map((f,P)=>e.jsx("div",{className:"flex",children:e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:P*.1,duration:.3},className:"w-full",children:e.jsx("div",{className:"flex flex-col flex-grow w-full",children:e.jsx(Tt,{title:f.title,items:f.items,users:g,icon:f.icon,color:f.color})})})},f.title))}),E&&e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.3},children:e.jsx("div",{className:"mt-4",children:e.jsxs(G,{radius:pe(),style:fe(),onMouseEnter:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid color-mix(in srgb, var(--theme-warning) 50%, transparent)",f.currentTarget.style.borderRadius="var(--borderRadius, 12px)",f.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:f=>{f.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",f.currentTarget.style.transform="scale(var(--scale, 1))"},children:[e.jsx(Ce,{className:"pb-2 p-4",style:{background:"transparent"},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsx("div",{className:"p-2 rounded-xl flex items-center justify-center min-w-[48px] min-h-[48px] flex-shrink-0",style:{backgroundColor:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderRadius:"var(--borderRadius, 12px)",border:"var(--borderWidth, 1px) solid color-mix(in srgb, var(--theme-warning) 25%, transparent)"},children:e.jsx(ut,{className:"w-6 h-6 stroke-2",style:{color:"var(--theme-warning)"},"aria-hidden":"true"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground flex-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Upcoming Holiday"})]})}),e.jsx(ye,{className:"pt-0 p-4",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(ke,{className:"w-4 h-4"}),E.title]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(Ne,{className:"w-4 h-4"}),new Date(E.from_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})," - ",new Date(E.to_date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsxs("p",{className:"text-sm text-default-500 flex items-center gap-1 mt-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(vt,{className:"w-4 h-4"}),E.description]})]})})})]})})})]})},Dt=({title:n,value:t,icon:d,color:m,isLoaded:o,testId:p})=>e.jsx(K.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},className:"h-full w-full",children:e.jsx(G,{className:"h-full w-full transition-all duration-200 cursor-pointer shadow-lg",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                    var(--theme-content1, #FAFAFA) 20%, 
                    var(--theme-content2, #F4F4F5) 10%, 
                    var(--theme-content3, #F1F3F4) 20%)`},onMouseEnter:u=>{u.currentTarget.style.border=`var(--borderWidth, 2px) solid color-mix(in srgb, ${m} 50%, transparent)`,u.currentTarget.style.borderRadius="var(--borderRadius, 12px)",u.currentTarget.style.transform="scale(calc(var(--scale, 1) * 1.02))"},onMouseLeave:u=>{u.currentTarget.style.border="var(--borderWidth, 2px) solid transparent",u.currentTarget.style.transform="scale(var(--scale, 1))"},children:e.jsx("div",{className:"p-4 h-full w-full flex flex-col",children:e.jsx(je,{className:"rounded-lg",isLoaded:o,"data-testid":p,style:{borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("div",{className:"flex flex-col gap-2 h-full",role:"region","aria-label":`${n} statistics`,style:{fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-xs font-medium text-default-500 leading-tight flex-1 mr-1",style:{fontFamily:'var(--fontFamily, "Inter")'},children:n}),e.jsx("div",{className:"flex items-center justify-center min-w-[40px] sm:min-w-[48px] min-h-[40px] sm:min-h-[48px] flex-shrink-0",style:{backgroundColor:`color-mix(in srgb, ${m} 15%, transparent)`,borderRadius:"var(--borderRadius, 12px)",border:`var(--borderWidth, 1px) solid color-mix(in srgb, ${m} 25%, transparent)`},children:e.jsx(d,{className:"w-6 h-6 stroke-2",style:{color:m},"aria-hidden":"true"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"text-2xl font-bold text-foreground leading-none","aria-live":"polite",style:{fontFamily:'var(--fontFamily, "Inter")'},children:typeof t=="number"?t.toLocaleString():t})})]})})})})}),At=()=>{const[n,t]=r.useState({total:0,completed:0,pending:0,rfi_submissions:0}),[d,m]=r.useState(!0),[o,p]=r.useState(null);r.useEffect(()=>{let g=!0;const C=new AbortController;return(async()=>{var F;try{m(!0),p(null);const I=await le.get(route("stats"),{signal:C.signal,timeout:1e4});if(g&&((F=I.data)!=null&&F.statistics))t(I.data.statistics);else throw new Error("Invalid response structure")}catch(I){g&&!C.signal.aborted&&(console.error("Failed to fetch statistics:",I),p(I.message),t({total:0,completed:0,pending:0,rfi_submissions:0}))}finally{g&&m(!1)}})(),()=>{g=!1,C.abort()}},[]);const u=[{id:"total-daily-works",title:"Total Daily Works",value:n.total,icon:ht,color:"var(--theme-primary, #006FEE)",testId:"stat-total-works"},{id:"completed-daily-works",title:"Completed Daily Works",value:n.completed,icon:ge,color:"var(--theme-success, #17C964)",testId:"stat-completed-works"},{id:"pending-daily-works",title:"Pending Daily Works",value:n.pending,icon:se,color:"var(--theme-warning, #F5A524)",testId:"stat-pending-works"},{id:"rfi-submissions",title:"RFI Submissions",value:n.rfi_submissions,icon:Fe,color:"var(--theme-secondary, #7C3AED)",testId:"stat-rfi-submissions"}];return o?e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("div",{className:"flex-grow h-full flex items-center justify-center",children:e.jsx(G,{className:"p-4 transition-all duration-200",style:{background:"color-mix(in srgb, var(--theme-danger, #F31260) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger, #F31260) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsxs("p",{className:"text-base",style:{color:"var(--theme-danger, #F31260)"},children:["Failed to load statistics: ",o]})})})}):e.jsx("div",{className:"flex flex-col w-full h-full p-4",children:e.jsx("section",{className:"h-full w-full","aria-label":"Statistics Dashboard",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 h-full max-w-full",children:u.map((g,C)=>e.jsx("div",{className:"w-full",children:e.jsx(Dt,{title:g.title,value:g.value,icon:g.icon,color:g.color,isLoaded:!d,testId:g.testId})},g.id))})})})},Mt=(n,t)=>{let d;return function(...o){const p=()=>{clearTimeout(d),n(...o)};clearTimeout(d),d=setTimeout(p,t)}},Ot=()=>{const[n,t]=r.useState({isMobile:!1,isTablet:!1,isDesktop:!1}),d=r.useCallback(()=>{const m=window.innerWidth,o={isMobile:m<=768,isTablet:m>768&&m<=1024,isDesktop:m>1024};t(p=>JSON.stringify(p)!==JSON.stringify(o)?o:p)},[]);return r.useEffect(()=>{d();const m=Mt(d,150);return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[d]),n},B={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},Ve=ce.memo(()=>{var ee;const{auth:n}=We().props,t=n.user,{isMobile:d,isTablet:m}=Ot(),[o,p]=r.useState({currentStatus:null,todayPunches:[],totalWorkTime:"00:00:00",realtimeWorkTime:"00:00:00",userOnLeave:null,loading:!1,lastRefresh:null}),[u,g]=r.useState({status:B.CHECKING,coordinates:null,error:null,lastUpdate:null}),[C,N]=r.useState({sessionDialogOpen:!1,expandedSections:{punches:!1,stats:!1,validation:!1}}),[F,I]=r.useState({currentTime:new Date,connectionStatus:{network:!0,device:!0},sessionInfo:{ip:"Unknown",accuracy:"N/A",timestamp:null}}),[w,E]=r.useState({isOpen:!1,capturedPhoto:null,isCapturing:!1,stream:null,pendingPunchData:null,facingMode:"user",isSwitching:!1}),$=r.useRef(null),b=r.useRef(null),h=r.useMemo(()=>{const s=t==null?void 0:t.attendance_type;if(!(s!=null&&s.slug))return!1;const i=s.slug.replace(/_\d+$/,"");return["geo_polygon","route_waypoint"].includes(i)},[t==null?void 0:t.attendance_type]),y=r.useCallback(()=>new Promise((s,i)=>{if(!navigator.geolocation){i(new Error("Geolocation is not supported by this browser"));return}const x={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(j=>{const V={latitude:j.coords.latitude,longitude:j.coords.longitude,accuracy:j.coords.accuracy,timestamp:new Date(j.timestamp)};s(V)},j=>{let V="Location unavailable";switch(j.code){case 1:V="Location access denied. Please allow location permission in your browser settings.";break;case 2:V="Location unavailable. Please ensure GPS is enabled.";break;case 3:V="Location request timed out. Please try again.";break;default:V="Unable to retrieve location. Please try again."}i(new Error(V))},x)}),[]),a=r.useCallback(async()=>{g(s=>({...s,status:B.CHECKING,error:null}));try{const s=await y();g({status:B.ACTIVE,coordinates:s,error:null,lastUpdate:new Date})}catch(s){const i=s.message.includes("denied")||s.message.includes("Permission");g({status:i?B.DENIED:B.INACTIVE,coordinates:null,error:s.message,lastUpdate:new Date})}},[y]),c=r.useCallback(async()=>{if(u.status===B.DENIED)try{g(i=>({...i,status:B.CHECKING,error:null}));const s=await y();g({status:B.ACTIVE,coordinates:s,error:null,lastUpdate:new Date}),Y.success("Location access granted successfully!",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-success)",color:"var(--theme-success-foreground)"}})}catch{g(i=>({...i,status:B.DENIED,error:"Location access still denied. Please check your browser settings."})),Y.error("Please enable location in your browser settings manually.",{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}},[u.status,y]),l=r.useMemo(()=>{if(o.userOnLeave)return{color:"warning",text:"On Leave",action:"On Leave",icon:e.jsx(he,{className:"w-4 h-4"})};switch(o.currentStatus){case"punched_in":return{color:"success",text:"Checked In",action:"Check Out",icon:e.jsx(jt,{className:"w-4 h-4"})};case"punched_out":return{color:"primary",text:"Checked Out",action:"Check In",icon:e.jsx(Ft,{className:"w-4 h-4"})};default:return{color:"primary",text:"Ready to Check In",action:"Check In",icon:e.jsx(se,{className:"w-4 h-4"})}}},[o.currentStatus,o.userOnLeave]),k=r.useMemo(()=>({sessionsToday:o.todayPunches.length,averageSessionTime:o.todayPunches.length>0?Math.round(parseFloat(o.realtimeWorkTime.split(":")[0])/o.todayPunches.length*100)/100:0,productivity:Math.min(100,parseFloat(o.realtimeWorkTime.split(":")[0])/8*100)}),[o.todayPunches,o.realtimeWorkTime]),v=r.useMemo(()=>{var s;switch(u.status){case B.CHECKING:return{color:"default",variant:"flat",text:"Checking",clickable:!1,tooltip:"Checking location permissions..."};case B.ACTIVE:return{color:"success",variant:"flat",text:"GPS",clickable:!1,tooltip:`Location: Active (¬±${Math.round(((s=u.coordinates)==null?void 0:s.accuracy)||0)}m)`};case B.DENIED:return{color:"danger",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location access denied. Click to retry."};case B.INACTIVE:return{color:"warning",variant:"bordered",text:"GPS",clickable:!0,tooltip:"Location unavailable. Click to retry."};default:return{color:"default",variant:"flat",text:"GPS",clickable:!1,tooltip:"Location status unknown"}}},[u.status,(ee=u.coordinates)==null?void 0:ee.accuracy]),A=r.useCallback(()=>{const s=new Date;let i=0,x=!1;if(o.todayPunches.forEach(O=>{if(O.punchin_time){let ne;try{if(ne=new Date(O.punchin_time),isNaN(ne.getTime())||typeof O.punchin_time=="string"&&O.punchin_time.includes(":")&&!O.punchin_time.includes("T")){const X=new Date,[ue,oe,ve]=O.punchin_time.split(":");ne=new Date(X.getFullYear(),X.getMonth(),X.getDate(),parseInt(ue),parseInt(oe),parseInt(ve||0))}}catch{console.warn("Invalid punch in time format:",O.punchin_time);return}if(isNaN(ne.getTime()))return;if(O.punchout_time){let X;try{if(X=new Date(O.punchout_time),isNaN(X.getTime())||typeof O.punchout_time=="string"&&O.punchout_time.includes(":")&&!O.punchout_time.includes("T")){const oe=new Date,[ve,Ze,Ge]=O.punchout_time.split(":");X=new Date(oe.getFullYear(),oe.getMonth(),oe.getDate(),parseInt(ve),parseInt(Ze),parseInt(Ge||0))}}catch{console.warn("Invalid punch out time format:",O.punchout_time);return}if(isNaN(X.getTime()))return;const ue=Math.floor((X-ne)/1e3);ue>0&&(i+=ue)}else{x=!0;const X=Math.floor((s-ne)/1e3);X>0&&(i+=X)}}}),!x&&o.totalWorkTime&&o.totalWorkTime!=="00:00:00"){p(O=>({...O,realtimeWorkTime:o.totalWorkTime}));return}(isNaN(i)||i<0)&&(i=0);const j=Math.floor(i/3600),V=Math.floor(i%3600/60),te=i%60,de=`${j.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}:${te.toString().padStart(2,"0")}`;p(O=>({...O,realtimeWorkTime:de}))},[o.todayPunches,o.totalWorkTime]),_=r.useCallback(async()=>{try{const i=(await le.get(route("attendance.current-user-punch"),{params:{t:Date.now()}})).data;p(x=>({...x,todayPunches:i.punches||[],totalWorkTime:i.total_production_time||"00:00:00",realtimeWorkTime:i.total_production_time||"00:00:00",userOnLeave:i.isUserOnLeave,lastRefresh:new Date,currentStatus:i.punches&&i.punches.length>0?i.punches[i.punches.length-1].punchout_time?"punched_out":"punched_in":"not_punched"}))}catch(s){console.error("Error fetching current status:",s),Y.error("Failed to fetch attendance status")}},[]),M=r.useCallback(()=>{const s=document.createElement("canvas"),i=s.getContext("2d");return i.textBaseline="top",i.font="14px Arial",i.fillText("Device fingerprint",2,2),{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,canvasFingerprint:s.toDataURL(),timestamp:Date.now()}},[]),f=r.useCallback(async(s="user")=>{try{w.stream&&w.stream.getTracks().forEach(x=>x.stop());const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:s,width:{ideal:1280},height:{ideal:720}}});$.current&&($.current.srcObject=i,await $.current.play()),E(x=>({...x,stream:i,isCapturing:!1,isSwitching:!1,facingMode:s}))}catch(i){console.error("Camera access error:",i);try{const x=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720}}});$.current&&($.current.srcObject=x,await $.current.play()),E(j=>({...j,stream:x,isCapturing:!1,isSwitching:!1}))}catch{Y.error("Unable to access camera. Please check permissions."),E(j=>({...j,isOpen:!1,isSwitching:!1}))}}},[w.stream]),P=r.useCallback(async()=>{const s=w.facingMode==="environment"?"user":"environment";E(i=>({...i,isSwitching:!0})),await f(s)},[w.facingMode,f]),R=r.useCallback(()=>{w.stream&&w.stream.getTracks().forEach(s=>s.stop()),E(s=>({...s,stream:null,isOpen:!1,capturedPhoto:null,facingMode:"user",isSwitching:!1}))},[w.stream]),T=r.useCallback(async()=>{if(!(!$.current||!b.current)){E(s=>({...s,isCapturing:!0}));try{const s=$.current,i=b.current,x=i.getContext("2d");i.width=s.videoWidth,i.height=s.videoHeight,x.drawImage(s,0,0);const j=u.coordinates;if(j){const te=`üìç ${j.latitude.toFixed(6)}, ${j.longitude.toFixed(6)} | ${new Date().toLocaleString()}`;x.fillStyle="rgba(0, 0, 0, 0.7)",x.fillRect(0,i.height-40,i.width,40),x.fillStyle="#ffffff",x.font="bold 16px Arial",x.textBaseline="middle",x.fillText(te,10,i.height-20)}const V=i.toDataURL("image/jpeg",.85);E(te=>({...te,capturedPhoto:V,isCapturing:!1})),Y.success("Photo captured successfully!")}catch(s){console.error("Photo capture error:",s),Y.error("Failed to capture photo. Please try again."),E(i=>({...i,isCapturing:!1}))}}},[u.coordinates]),Z=r.useCallback(()=>{E(s=>({...s,capturedPhoto:null}))},[]),H=r.useCallback(async()=>{var s,i;if(!w.capturedPhoto||!w.pendingPunchData){Y.error("Please capture a photo first.");return}p(x=>({...x,loading:!0})),R();try{const x={...w.pendingPunchData,photo:w.capturedPhoto},j=await le.post(route("attendance.punch"),x);j.data.status==="success"?(N(V=>({...V,sessionDialogOpen:!0})),setTimeout(()=>{_()},500)):Y.error(j.data.message)}catch(x){console.error("Punch operation failed:",x);const j=((i=(s=x.response)==null?void 0:s.data)==null?void 0:i.message)||"Unable to record attendance. Please try again.";Y.error(j)}finally{p(x=>({...x,loading:!1})),E(x=>({...x,pendingPunchData:null,capturedPhoto:null}))}},[w.capturedPhoto,w.pendingPunchData,R,_]),J=r.useCallback(async s=>{E(i=>({...i,isOpen:!0,pendingPunchData:s,capturedPhoto:null})),setTimeout(()=>f(),300)},[f]),U=r.useCallback(async()=>{var s,i;if(o.userOnLeave){Y.warning("You are on leave today. Cannot punch in/out.");return}if(u.status!==B.ACTIVE){Y.error("Location access required for attendance. Please enable GPS and try again.");return}p(x=>({...x,loading:!0}));try{const x=await y(),j=M();let V="Unknown";try{V=(await le.get(route("getClientIp"))).data.ip}catch(O){console.warn("Could not fetch IP address:",O)}I(O=>({...O,sessionInfo:{ip:V,accuracy:x.accuracy?`${Math.round(x.accuracy)}m`:"N/A",timestamp:new Date().toLocaleString()}}));const te={lat:x.latitude,lng:x.longitude,accuracy:x.accuracy,ip:V,wifi_ssid:"Unknown",device_fingerprint:JSON.stringify(j),user_agent:navigator.userAgent,timestamp:new Date().toISOString()};if(h){p(O=>({...O,loading:!1})),J(te);return}const de=await le.post(route("attendance.punch"),te);de.data.status==="success"?(N(O=>({...O,sessionDialogOpen:!0})),setTimeout(()=>{_()},500)):Y.error(de.data.message)}catch(x){console.error("Punch operation failed:",x);const j=((i=(s=x.response)==null?void 0:s.data)==null?void 0:i.message)||"Unable to record attendance. Please try again.";Y.error(j,{style:{backdropFilter:"blur(16px) saturate(200%)",background:"var(--theme-danger)",color:"var(--theme-danger-foreground)"}})}finally{p(x=>({...x,loading:!1}))}},[o.userOnLeave,u.status,y,M,_,h,J]),S=r.useCallback(()=>{v.clickable&&(u.status===B.DENIED?c():u.status===B.INACTIVE&&a())},[v.clickable,u.status,c,a]),D=r.useCallback(s=>{if(!s)return"--:--";try{let i;if(typeof s=="string"&&s.includes(":")&&!s.includes("T")){const x=new Date,[j,V,te]=s.split(":");i=new Date(x.getFullYear(),x.getMonth(),x.getDate(),parseInt(j),parseInt(V),parseInt(te||0))}else i=new Date(s);return isNaN(i.getTime())?"--:--":i.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}},[]),z=r.useCallback(s=>{var i,x;if(!s)return"Location not available";try{if(typeof s=="object"&&s.lat&&s.lng)return(i=s.address)!=null&&i.trim()?s.address.substring(0,30):`${s.lat.toFixed(4)}, ${s.lng.toFixed(4)}`;if(typeof s=="string")try{const j=JSON.parse(s);if(j.lat&&j.lng)return(x=j.address)!=null&&x.trim()?j.address.substring(0,30):`${j.lat.toFixed(4)}, ${j.lng.toFixed(4)}`}catch{return s.substring(0,30)}return"Location not available"}catch{return"Location not available"}},[]);return r.useEffect(()=>{const s=setInterval(()=>{I(i=>({...i,currentTime:new Date})),o.currentStatus==="punched_in"&&o.todayPunches.length>0&&A()},1e3);return()=>clearInterval(s)},[o.currentStatus,o.todayPunches.length,A]),r.useEffect(()=>{_(),a();const s=()=>{I(j=>({...j,connectionStatus:{...j.connectionStatus,network:!0}})),_()},i=()=>{I(j=>({...j,connectionStatus:{...j.connectionStatus,network:!1}}))},x=()=>{_(),a()};return window.addEventListener("online",s),window.addEventListener("offline",i),window.addEventListener("focus",x),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",i),window.removeEventListener("focus",x)}},[_,a]),r.useEffect(()=>{const s=setInterval(()=>{_()},3e4);return()=>clearInterval(s)},[_]),e.jsxs("div",{className:"flex flex-col w-full h-full p-4",children:[e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex flex-col h-full",children:e.jsx(G,{className:"flex flex-col h-full backdrop-blur-md",style:{background:`linear-gradient(to bottom right, 
                            var(--theme-content1, #FAFAFA) 20%, 
                            var(--theme-content2, #F4F4F5) 10%, 
                            var(--theme-content3, #F1F3F4) 20%)`,borderColor:"var(--theme-divider, #E4E4E7)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading?"var(--disabledOpacity, 0.5)":"1"},children:e.jsxs(ye,{className:"flex flex-col flex-1 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx(Xe,{content:"",color:l.color,placement:"bottom-right",shape:"circle",className:"border-2 border-white",children:e.jsx(Ue,{src:(t==null?void 0:t.profile_image_url)||(t==null?void 0:t.profile_image),name:t==null?void 0:t.name,className:"w-12 h-12"})}),e.jsxs("div",{className:"ml-3 flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm truncate notranslate",style:{color:"var(--theme-foreground)"},"data-name":"true",children:t==null?void 0:t.name}),e.jsxs("p",{className:"text-xs notranslate",style:{color:"var(--theme-foreground-600)"},"data-no-translate":"true",children:["ID: ",(t==null?void 0:t.employee_id)||(t==null?void 0:t.id)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-light leading-none",style:{background:"linear-gradient(135deg, var(--theme-primary), var(--theme-secondary))",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:F.currentTime.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:F.currentTime.toLocaleDateString("en-US",{weekday:"short",day:"numeric"})})]})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(ie,{color:l.color,variant:"flat",startContent:l.icon,className:"px-4 py-2 font-semibold text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:l.text})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs(G,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(se,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-bold font-mono tracking-wide",style:{color:"var(--theme-primary)"},children:o.realtimeWorkTime}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Hours Today"})]}),e.jsxs(G,{className:"p-3 text-center",style:{background:"color-mix(in srgb, var(--theme-secondary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-secondary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(at,{className:"w-5 h-5 mx-auto mb-1",style:{color:"var(--theme-secondary)"}}),e.jsx("div",{className:"text-sm font-bold",style:{color:"var(--theme-secondary)"},children:k.sessionsToday}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"Sessions"})]})]}),e.jsx(ae,{color:l.color,variant:"shadow",size:"lg",fullWidth:!0,onPress:U,isDisabled:o.loading||o.userOnLeave||u.status!==B.ACTIVE,isLoading:o.loading,startContent:!o.loading&&l.icon,className:"mb-4 font-semibold",style:{background:o.userOnLeave||u.status!==B.ACTIVE?"var(--theme-default, #71717A)":l.color==="primary"?"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))":l.color==="success"?"linear-gradient(135deg, var(--theme-success, #17C964), var(--theme-success-600, #12A150))":l.color==="warning"?"linear-gradient(135deg, var(--theme-warning, #F5A524), var(--theme-warning-600, #C4841D))":"linear-gradient(135deg, var(--theme-primary, #006FEE), var(--theme-primary-600, #005BC4))",color:"white",borderRadius:"var(--borderRadius, 8px)",borderWidth:"var(--borderWidth, 2px)",fontFamily:"var(--fontFamily, 'Inter')",opacity:o.loading||o.userOnLeave||u.status!==B.ACTIVE?"var(--disabledOpacity, 0.5)":"1"},children:o.loading?"Processing...":l.action}),e.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[e.jsx(be,{content:v.tooltip,children:e.jsx(ie,{size:"sm",variant:v.variant,color:v.color,startContent:u.status===B.CHECKING?e.jsx(we,{size:"sm",className:"w-3 h-3"}):e.jsx(me,{className:"w-3 h-3"}),className:`text-xs transition-all ${v.clickable?"cursor-pointer hover:scale-105":""}`,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},onClick:v.clickable?S:void 0,children:v.text})}),e.jsx(be,{content:`Network: ${F.connectionStatus.network?"Online":"Offline"}`,children:e.jsx(ie,{size:"sm",variant:"flat",color:F.connectionStatus.network?"success":"default",startContent:e.jsx(ft,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Net"})}),e.jsx(be,{content:"Device Security",children:e.jsx(ie,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(xt,{className:"w-3 h-3"}),className:"text-xs",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Secure"})})]}),u.error&&u.status!==B.ACTIVE&&e.jsx(G,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-danger) 20%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(he,{className:"w-4 h-4 mt-0.5 flex-shrink-0",style:{color:"var(--theme-danger)"}}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-danger-foreground)"},children:u.error})]})}),o.userOnLeave&&e.jsx(G,{className:"p-3 mb-4",style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 30%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-sm",style:{color:"var(--theme-warning-foreground)"},children:["On ",o.userOnLeave.leave_type," Leave"]}),e.jsxs("div",{className:"text-xs",style:{color:"var(--theme-warning-foreground-600)"},children:[new Date(o.userOnLeave.from_date).toLocaleDateString()," - ",new Date(o.userOnLeave.to_date).toLocaleDateString()]})]})]})}),e.jsx("div",{className:"border-t border-divider",children:e.jsx(Ye,{children:e.jsx(Qe,{"aria-label":"Today's Activity",startContent:e.jsx(pt,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),title:e.jsx("span",{className:"font-semibold text-sm",style:{color:"var(--theme-foreground)"},children:"Today's Activity"}),subtitle:e.jsxs("span",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[k.sessionsToday," sessions ‚Ä¢ ",o.realtimeWorkTime]}),children:e.jsx("div",{className:"space-y-2",children:o.todayPunches.length>0?o.todayPunches.map((s,i)=>e.jsx(G,{className:"p-3",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-success",style:{backgroundColor:"var(--theme-success)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-success)"},children:"Check In"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:D(s.punchin_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:z(s.punchin_location)})]})]})]}),s.punchout_time?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--theme-primary)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-primary)"},children:"Check Out"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-foreground)"},children:D(s.punchout_time)}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(me,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-foreground-500)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-foreground-600)"},children:z(s.punchout_location)})]})]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full border-2",style:{borderColor:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs font-semibold",style:{color:"var(--theme-warning)"},children:"Active Session"})]}),e.jsxs("div",{className:"pl-4 space-y-1",children:[e.jsx("div",{className:"text-sm font-mono font-medium",style:{color:"var(--theme-warning)"},children:"--:--"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(se,{className:"w-3 h-3 mt-0.5 flex-shrink-0",style:{color:"var(--theme-warning)"}}),e.jsx("span",{className:"text-xs leading-tight",style:{color:"var(--theme-warning-600)"},children:"In progress"})]})]})]})]})}),s.duration&&e.jsx(ie,{size:"sm",color:"primary",variant:"flat",className:"text-xs",children:s.duration})]})},i)):e.jsxs(G,{className:"p-4 text-center",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(ke,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm",style:{color:"var(--theme-foreground-600)"},children:"No activity recorded today"})]})})},"activity")})})]})})}),e.jsx(Ie,{isOpen:C.sessionDialogOpen,onOpenChange:s=>N(i=>({...i,sessionDialogOpen:s})),size:"sm",backdrop:"blur",classNames:{backdrop:"backdrop-blur-md",base:"border border-default-200",header:"border-b-[1px] border-divider",footer:"border-t-[1px] border-divider"},style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 20%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsx(Pe,{children:s=>e.jsxs(e.Fragment,{children:[e.jsxs(Re,{className:"flex flex-col gap-1 text-center",children:[e.jsx(ge,{className:"w-8 h-8 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("h3",{className:"font-bold text-lg",children:"Attendance Recorded"}),e.jsx("p",{className:"text-sm font-normal opacity-70",children:"Your attendance has been successfully captured"})]}),e.jsxs(Ee,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(G,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(gt,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-primary)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-primary)"},children:F.sessionInfo.ip}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"IP Address"})]}),e.jsxs(G,{className:"p-3 text-center",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:[e.jsx(me,{className:"w-6 h-6 mx-auto mb-2",style:{color:"var(--theme-success)"}}),e.jsx("div",{className:"text-sm font-semibold",style:{color:"var(--theme-success)"},children:F.sessionInfo.accuracy}),e.jsx("div",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:"GPS Accuracy"})]})]}),e.jsx(G,{className:"p-3 mt-4",style:{background:"color-mix(in srgb, var(--theme-success) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsxs("span",{children:["Recorded at: ",F.sessionInfo.timestamp]})]})})]}),e.jsx(Le,{children:e.jsx(ae,{color:"primary",variant:"shadow",fullWidth:!0,onPress:s,className:"font-semibold",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:"var(--fontFamily, 'Inter')"},children:"Continue"})})]})})}),e.jsx(Ie,{isOpen:w.isOpen,onClose:R,size:"lg",classNames:{backdrop:"bg-black/80",base:"bg-content1"},style:{borderRadius:"var(--borderRadius, 12px)",fontFamily:"var(--fontFamily, 'Inter')"},children:e.jsxs(Pe,{children:[e.jsxs(Re,{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary"}),e.jsx("span",{children:"Capture Attendance Photo"})]}),e.jsx("p",{className:"text-sm text-default-500 font-normal",children:"Take a photo for verification. Location coordinates will be added automatically."})]}),e.jsxs(Ee,{className:"p-4",children:[e.jsxs("div",{className:"relative rounded-lg overflow-hidden bg-black",children:[w.capturedPhoto?e.jsx("img",{src:w.capturedPhoto,alt:"Captured",className:"w-full h-auto max-h-[400px] object-contain"}):e.jsxs(e.Fragment,{children:[e.jsx("video",{ref:$,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-auto max-h-[400px] object-contain",style:{transform:w.facingMode==="user"?"scaleX(-1)":"none"}}),e.jsx(ae,{isIconOnly:!0,size:"sm",variant:"flat",className:"absolute top-3 right-3 bg-black/50 text-white hover:bg-black/70",onPress:P,isLoading:w.isSwitching,isDisabled:!w.stream||w.isSwitching,style:{borderRadius:"50%"},children:e.jsx(Te,{className:"w-4 h-4"})}),e.jsx("div",{className:"absolute top-3 left-3 px-2 py-1 rounded-full text-xs text-white bg-black/50",children:w.facingMode==="user"?"ü§≥ Front":"üì∑ Back"})]}),e.jsx("canvas",{ref:b,className:"hidden"}),u.coordinates&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 text-white text-xs",style:{background:"rgba(0,0,0,0.7)"},children:["üìç ",u.coordinates.latitude.toFixed(6),", ",u.coordinates.longitude.toFixed(6)]})]}),e.jsx("div",{className:"mt-3 p-3 rounded-lg text-sm",style:{background:"color-mix(in srgb, var(--theme-primary) 10%, transparent)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-primary"}),w.capturedPhoto?"Review your photo. You can retake if needed.":"Position yourself clearly in the frame and capture the photo."]})})]}),e.jsxs(Le,{className:"flex gap-2",children:[e.jsx(ae,{color:"danger",variant:"light",onPress:R,style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Cancel"}),w.capturedPhoto?e.jsxs(e.Fragment,{children:[e.jsx(ae,{color:"secondary",variant:"flat",onPress:Z,startContent:e.jsx(Te,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Retake"}),e.jsxs(ae,{color:"success",variant:"shadow",onPress:H,isLoading:o.loading,startContent:!o.loading&&e.jsx(ge,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:["Confirm & ",l.action]})]}):e.jsx(ae,{color:"primary",variant:"shadow",onPress:T,isLoading:w.isCapturing,isDisabled:!w.stream,startContent:!w.isCapturing&&e.jsx(De,{className:"w-4 h-4"}),style:{fontFamily:"var(--fontFamily, 'Inter')"},children:"Capture Photo"})]})]})})]})});Ve.displayName="PunchStatusCard";function Wt({auth:n}){const[t,d]=r.useState(!1),[m,o]=r.useState(!1),[p,u]=r.useState(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date)),g={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.6,staggerChildren:.1,ease:"easeOut"}}},C={hidden:{opacity:0,y:20,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{duration:.5,ease:"easeOut"}}},N={hidden:{opacity:0,y:30,scale:.9},visible:b=>({opacity:1,y:0,scale:1,transition:{duration:.6,delay:b*.15,ease:"easeOut"}})},F=b=>n.permissions&&n.permissions.includes(b),I=b=>b.some(h=>F(h)),w=b=>b.every(h=>F(h)),E=()=>{d(b=>!b),o(b=>!b)},$=b=>{const h=b.target.value;u(new Intl.DateTimeFormat("en-CA",{timeZone:"Asia/Dhaka",year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(h))),o(y=>!y),d(y=>!y)};return e.jsxs(e.Fragment,{children:[e.jsx(et,{title:"Dashboard"}),e.jsx(K.div,{variants:g,initial:"hidden",animate:"visible",children:e.jsxs("div",{className:"w-full",children:[e.jsx(K.div,{variants:C,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2",children:[w(["attendance.own.punch","attendance.own.view"])&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:N,custom:0,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(Ve,{handlePunchSuccess:E})},"punch-status-card")},"punch-status-grid"),F("core.dashboard.view")&&e.jsx("div",{className:"h-full",children:e.jsx(K.div,{variants:N,custom:1,whileHover:{scale:1.01,transition:{duration:.2}},className:"h-full",children:e.jsx(At,{})},"statistics-card")},"statistics-grid")]})},"main-grid"),I(["attendance.view","employees.view"])&&e.jsxs(K.div,{variants:g,initial:"hidden",animate:"visible",children:[e.jsx(K.div,{variants:N,custom:2,children:e.jsx(tt,{selectedDate:p,handleDateChange:$,updateTimeSheet:m})},"timesheet-section"),e.jsx(K.div,{variants:N,custom:3,children:e.jsx(Lt,{selectedDate:p,updateMap:t})},"user-locations-section")]}),F("core.updates.view")&&e.jsx(K.div,{variants:N,custom:4,initial:"hidden",animate:"visible",children:e.jsx($t,{})},"updates-section")]})})]})}Wt.layout=n=>e.jsx(st,{children:n});export{Wt as default};
