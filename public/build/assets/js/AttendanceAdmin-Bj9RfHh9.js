import{j as e,a as r,b as pe,Q as ue}from"./app-MpuWwcfc.js";import{r as o,R as fe}from"./react-core-DDvupgOx.js";import{G as le}from"./logo-BrReQqD-.js";import{P as ge}from"./PageHeader-Y4emi-pU.js";import{S as be}from"./StatsCards-6FQCzC9u.js";import{d as V,F as ye,f as K,e as X,B as we,A as xe}from"./App-D_pdjAN2.js";import{d as l}from"./dayjs.min-WGrXCzEl.js";import{u as ce,a as j,B as c,T as F,C as ee,e as G,a1 as ve,d as Ne,o as ke,a2 as Q,G as Me}from"./mui-libraries-DeLqYkpc.js";import{F as B}from"./UserIcon-D16nn9o_.js";import{K as _e,j as Z,J as te,k as $e,m as Fe,n as Re,o as Ce,q as Ye,v as S,t as ae,f as re,L as oe,i as ne,G as Ae}from"./ui-libraries-CxFzkmxb.js";import{R as Se}from"./Refresh-HbjuhpSm.js";import{F as Te}from"./ExclamationTriangleIcon-CsS6HvBt.js";import{F as Pe}from"./XCircleIcon-StDWd-mv.js";import{F as De}from"./CheckCircleIcon-DnGOlVla.js";import{a as W}from"./utilities-DT6SRl8s.js";import{F as Le}from"./CheckCircleIcon-CJUGb5Jf.js";import{F as Ee}from"./XCircleIcon-DJR5_Dv7.js";import{F as We}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as je}from"./ChartBarIcon-Yugn57JF.js";import{F as Be}from"./MagnifyingGlassIcon-yCnY2aj3.js";import{F as se}from"./DocumentArrowDownIcon-Cq-JO3FQ.js";import{F as He}from"./PresentationChartLineIcon-B_Z8Hogu.js";import"./EnvelopeIcon-D6nUSkik.js";import"./ShieldCheckIcon-C7bFKizx.js";function Ie({title:f,titleId:i,...m},g){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":i},m),f?o.createElement("title",{id:i},f):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25M9 16.5v.75m3-3v3M15 12v5.25m-4.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}const T=o.forwardRef(Ie);function Ue({title:f,titleId:i,...m},g){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":i},m),f?o.createElement("title",{id:i},f):null,o.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z",clipRule:"evenodd"}))}const ze=o.forwardRef(Ue),Oe=({loading:f,attendanceData:i,currentYear:m,currentMonth:g,leaveTypes:k,leaveCounts:P,onRefresh:D})=>{const R=ce(),L=j("(min-width: 1025px)");j("(min-width: 641px) and (max-width: 1024px)");const H=j("(max-width: 640px)"),C=l(`${m}-${g}-01`).daysInMonth(),I={"âˆš":{icon:De,color:"text-success",bg:"bg-success-100",label:"âˆš",short:"P"},"â–¼":{icon:Pe,color:"text-danger",bg:"bg-danger-100",label:"â–¼",short:"A"},"#":{icon:Te,color:"text-warning",bg:"bg-warning-100",label:"#",short:"H"},"/":{icon:ze,color:"text-secondary",bg:"bg-secondary-100",label:"/",short:"L"}},U=o.useMemo(()=>[{label:"No.",key:"sl",icon:T,width:60},{label:"Employee",key:"name",icon:B,width:200},...Array.from({length:C},(t,h)=>{const x=h+1,b=l(`${m}-${g}-${x}`);return{label:`${x}`,sublabel:b.format("ddd"),key:`day-${x}`,width:40,isWeekend:b.day()===0||b.day()===6}}),...k?k.map(t=>({label:t.type,key:t.type,icon:V,width:80})):[]],[C,m,g,k]),E=t=>I[t]||{icon:null,color:"text-default-400",bg:"bg-default-50",label:"No Data",short:"-"},z=({data:t,index:h,daysInMonth:x,currentMonth:b,currentYear:p,leaveTypes:M,leaveCounts:w})=>e(le,{className:"mb-4",shadow:"sm",children:r(G,{children:[e(c,{className:"flex items-center gap-3 mb-4",children:e(oe,{avatarProps:{radius:"lg",size:"md",src:t.profile_image_url||t.profile_image,fallback:e(B,{className:"w-6 h-6"})},name:e(F,{variant:"body1",fontWeight:"medium",children:t.name||"Unknown"}),description:r(F,{variant:"caption",color:"textSecondary",children:["Employee #",h+1]})})}),e(Z,{className:"my-3"}),e(c,{className:"grid grid-cols-7 sm:grid-cols-7 xs:grid-cols-4 grid-cols-3 gap-1 mb-4",children:Array.from({length:x},(u,s)=>{const v=s+1,a=l(`${p}-${b}-${v}`).format("YYYY-MM-DD"),_=t[a],O=l(a).day()===0||l(a).day()===6,Y=typeof _=="object"&&_?.status||"â–¼",$=E(Y);return e(ae,{placement:"top",content:r("div",{className:"text-sm space-y-1",children:[r("div",{children:[e("strong",{children:"Status:"})," ",Y]}),r("div",{children:[e("strong",{children:"Punch In:"})," ",_?.punch_in||"-"]}),r("div",{children:[e("strong",{children:"Punch Out:"})," ",_?.punch_out||"-"]}),r("div",{children:[e("strong",{children:"Work Hours:"})," ",_?.total_work_hours||"00:00"]}),r("div",{children:[e("strong",{children:"Remarks:"})," ",_?.remarks||"N/A"]})]}),className:"z-[99999]",children:r(c,{className:`
                                        flex flex-col items-center justify-center p-1 rounded text-xs cursor-pointer
                                        ${O?"bg-default-100":"bg-default-50"}
                                        ${$.bg}
                                    `,children:[e("span",{className:"font-medium",children:v}),e("span",{children:$.icon?e($.icon,{className:`w-3 h-3 ${$.color}`}):e("span",{className:$.color,children:Y})})]})},v)})}),M?.length>0&&e(c,{className:"flex flex-wrap gap-2",children:M.map(u=>{const s=w?.[t.user_id]?.[u.type]||0;return r(re,{size:"sm",variant:"flat",color:s>0?"warning":"default",startContent:e(V,{className:"w-3 h-3"}),children:[u.type,": ",s]},u.type)})})]})});return f?e(c,{className:"flex justify-center items-center h-64",children:e(_e,{className:"w-full h-full rounded-lg"})}):!i||i.length===0?r(c,{className:"flex flex-col items-center justify-center py-8",children:[e(T,{className:"w-12 h-12 text-default-300 mb-4"}),e(F,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}):H?r(pe,{children:[e(ee,{title:r(c,{className:"flex items-center gap-3",children:[e(T,{className:"w-6 h-6 text-primary"}),e(F,{variant:"h6",component:"h1",children:"Attendance Report"})]})}),e(Z,{}),e(G,{sx:{p:0},children:e(te,{className:"max-h-[70vh]",children:i.map((t,h)=>e(z,{data:t,index:h,daysInMonth:C,currentMonth:g,currentYear:m,leaveTypes:k,leaveCounts:P},t.user_id||h))})})]}):r(c,{children:[e(ee,{title:r(c,{className:"flex items-center gap-3",children:[e(T,{className:"w-6 h-6 text-primary"}),r(F,{variant:"h5",component:"h1",sx:{fontSize:{xs:"1.25rem",sm:"1.5rem",md:"1.75rem"},fontWeight:600},children:["Monthly Attendance Report - ",l(`${m}-${g}-01`).format("MMMM YYYY")]})]}),action:e(ve,{direction:"row",spacing:1,children:D&&e(Ne,{title:"Refresh Data",children:e(ke,{onClick:D,disabled:f,sx:{background:Q(R.palette.primary.main,.1),backdropFilter:"blur(10px)",border:`1px solid ${Q(R.palette.primary.main,.2)}`,"&:hover":{background:Q(R.palette.primary.main,.2),transform:"scale(1.05)"},"&:disabled":{opacity:.5}},children:e(Se,{color:"primary"})})})}),sx:{padding:"24px"}}),e(Z,{}),e(G,{children:e(c,{sx:{maxHeight:"84vh",overflowY:"auto"},children:e(te,{className:"max-h-[70vh]",children:r($e,{isCompact:!L,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Monthly Attendance Table",classNames:{wrapper:"min-h-[400px]",table:"min-h-[400px]",thead:"[&>tr]:first:shadow-small",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors"},children:[e(Fe,{columns:U,children:t=>e(Re,{align:t.key==="sl"||t.key.startsWith("day-")?"center":"start",className:"bg-default-100/50 backdrop-blur-md",width:t.width,children:r(c,{className:"flex flex-col items-center gap-1",children:[r(c,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-medium",children:t.label})]}),t.sublabel&&e("span",{className:`text-xs ${t.isWeekend?"text-warning":"text-default-400"}`,children:t.sublabel})]})},t.key)}),e(Ce,{items:i,emptyContent:r(c,{className:"flex flex-col items-center justify-center py-8",children:[e(T,{className:"w-12 h-12 text-default-300 mb-4"}),e(F,{variant:"body1",color:"textSecondary",children:"No attendance data found"})]}),children:t=>e(Ye,{children:h=>{const x=i.findIndex(b=>(b.user_id||b.id)===(t.user_id||t.id));switch(h){case"sl":return e(S,{className:"text-center font-medium",children:x+1});case"name":return e(S,{className:"whitespace-nowrap",children:e(oe,{avatarProps:{radius:"lg",size:L?"md":"sm",src:t.profile_image_url||t.profile_image,fallback:e(B,{className:"w-6 h-6"})},name:t.name||"Unknown User",description:`Employee ID: ${t.employee_id}`||`ID: ${t.user_id}`})});default:if(h.startsWith("day-")){const p=parseInt(h.split("-")[1]),M=l(`${m}-${g}-${p}`).format("YYYY-MM-DD"),w=t[M],u=l(M).day()===0||l(M).day()===6,s=typeof w=="object"&&w?.status||"â–¼",v=E(s);return e(S,{className:`text-center ${u?"bg-default-50":""}`,children:e(ae,{content:r("div",{className:"text-sm space-y-1",children:[r("div",{children:[e("strong",{children:"Status:"})," ",s]}),r("div",{children:[e("strong",{children:"Punch In:"})," ",w?.punch_in||"-"]}),r("div",{children:[e("strong",{children:"Punch Out:"})," ",w?.punch_out||"-"]}),r("div",{children:[e("strong",{children:"Work Hours:"})," ",w?.total_work_hours||"00:00"]}),r("div",{children:[e("strong",{children:"Remarks:"})," ",w?.remarks||"N/A"]})]}),placement:"top",className:"z-[99999]",children:e(c,{className:"flex items-center justify-center cursor-help",children:v.icon?e(v.icon,{className:`w-4 h-4 ${v.color}`}):e("span",{className:`text-xs ${v.color}`,children:s})})})})}const b=k?.find(p=>p.type===h);if(b){const p=P?.[t.user_id]?.[b.type]||0;return e(S,{className:"text-center",children:e(re,{size:"sm",variant:p>0?"flat":"bordered",color:p>0?"warning":"default",className:"min-w-8",children:p})})}return e(S,{children:"-"})}}},t.user_id||t.id)})]})})})})]})},Ge=fe.memo(({title:f})=>{const i=ce(),m=j(i.breakpoints.down("sm")),[g,k]=o.useState(!1),[P,D]=o.useState([]),[R,L]=o.useState([]),[H,C]=o.useState([]),[I,U]=o.useState(0),[E,z]=o.useState(0),[t,h]=o.useState(""),[x,b]=o.useState(30),[p,M]=o.useState(1),[w,u]=o.useState(""),[s,v]=o.useState({currentMonth:l().format("YYYY-MM")}),[a,_]=o.useState({totalEmployees:0,totalWorkingDays:0,totalDaysInMonth:0,holidaysCount:0,weekendsCount:0,presentDays:0,absentDays:0,lateArrivals:0,attendancePercentage:0,averageWorkHours:0,overtimeHours:0,totalWorkHours:0,totalLeaveDays:0,leaveBreakdown:{},presentToday:0,absentToday:0,lateToday:0,month:"",generated_at:null}),O=o.useCallback((n,N)=>{v(y=>({...y,[n]:N}))},[]),Y=async(n=1,N=30,y)=>{k(!0);try{const d=y.currentMonth?l(y.currentMonth).format("MM"):l().format("MM"),q=y.currentMonth?l(y.currentMonth).year():l().year(),A=await W.get(route("attendancesAdmin.paginate"),{params:{page:n,perPage:N,employee:t,currentYear:q,currentMonth:d}});D(A.data.data),U(A.data.total),z(A.data.last_page),C(A.data.leaveTypes),L(A.data.leaveCounts);const J=await W.get(route("attendance.monthlyStats"),{params:{currentYear:q,currentMonth:d}});J.data.success&&_(J.data.data)}catch(d){console.error(d),we.error("Failed to fetch data.",{icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:i.glassCard.background,border:i.glassCard.border,color:i.palette.text.primary}})}finally{k(!1)}},$=n=>{const N=n.target.value.toLowerCase();h(N)};o.useEffect(()=>{Y(p,x,s).then(n=>"")},[p,x,s,t]);const ie=n=>{M(n)},de=async()=>{u("excel");try{const n=s.currentMonth?l(s.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),N=await W.get(route("attendance.exportAdminExcel"),{params:{month:n},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([N.data])),d=document.createElement("a");d.href=y,d.download=`Admin_Attendance_${n}.xlsx`,document.body.appendChild(d),d.click(),u(""),d.remove(),window.URL.revokeObjectURL(y)}catch(n){console.error("Download failed:",n),u(""),alert("Failed to download attendance sheet.")}},me=async()=>{u("pdf");try{const n=s.currentMonth?l(s.currentMonth).format("YYYY-MM"):l().format("YYYY-MM"),N=await W.get(route("attendance.exportAdminPdf"),{params:{month:n},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([N.data],{type:"application/pdf"})),d=document.createElement("a");d.href=y,d.download=`Admin_Attendance_${n}.pdf`,document.body.appendChild(d),d.click(),u(""),d.remove(),window.URL.revokeObjectURL(y)}catch(n){console.error("PDF download failed:",n),u(""),alert("Failed to download attendance PDF.")}},he=o.useMemo(()=>[{title:"Total Employees",value:a.totalEmployees,icon:e(ye,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Working Days",value:a.totalWorkingDays,icon:e(K,{}),color:"text-indigo-600",iconBg:"bg-indigo-500/20",description:`This month (${a.month})`},{title:"Present Today",value:a.presentToday,icon:e(Le,{}),color:"text-green-400",iconBg:"bg-green-500/20",description:a.presentToday>0?`${(a.presentToday/a.totalEmployees*100).toFixed(1)}% of employees`:"No attendance yet"},{title:"Absent Today",value:a.absentToday,icon:e(Ee,{}),color:"text-red-400",iconBg:"bg-red-500/20",description:a.absentToday>0?`${(a.absentToday/a.totalEmployees*100).toFixed(1)}% absent`:"All present"},{title:"Late Today",value:a.lateToday,icon:e(We,{}),color:"text-orange-400",iconBg:"bg-orange-500/20",description:"Late arrivals today"},{title:"Attendance Rate",value:`${a.attendancePercentage}%`,icon:e(je,{}),color:"text-emerald-600",iconBg:"bg-emerald-500/20",description:"Monthly average"},{title:"Avg Work Hours",value:`${a.averageWorkHours}h`,icon:e(X,{}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Daily average this month"},{title:"Overtime",value:`${a.overtimeHours}h`,icon:e(X,{}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:"Total overtime this month"},{title:"Leave Days",value:a.totalLeaveDays,icon:e(B,{}),color:"text-amber-600",iconBg:"bg-amber-500/20",description:"Total leaves this month"}],[a.totalEmployees,a.totalWorkingDays,a.month,a.presentToday,a.absentToday,a.lateToday,a.attendancePercentage,a.averageWorkHours,a.overtimeHours,a.totalLeaveDays]);return r(c,{children:[e(ue,{title:f}),e(c,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Me,{in:!0,children:e(le,{children:e(ge,{title:"Attendance Management",subtitle:"Monitor and manage employee attendance records",icon:e(He,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Excel",icon:e(se,{className:"w-4 h-4 text-primary"}),variant:"bordered",onPress:de,isLoading:w==="excel",className:"border-primary/30 bg-primary/5 hover:bg-primary/10 text-primary"},{label:"PDF",icon:e(se,{className:"w-4 h-4 text-rose-600"}),variant:"bordered",onPress:me,isLoading:w==="pdf",className:"border-rose-600/30 bg-rose-600/5 hover:bg-rose-600/10 text-rose-600"}],children:r("div",{className:"p-6",children:[e(be,{stats:he,className:"mb-6"}),e("div",{className:"mb-6",children:r("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-end",children:[e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(ne,{label:"Search Employee",type:"text",value:t,onChange:$,placeholder:"Enter employee name...",startContent:e(Be,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:m?"sm":"md"})}),e("div",{className:"w-full sm:w-auto sm:min-w-[200px]",children:e(ne,{label:"Month/Year",type:"month",value:s.currentMonth,onChange:n=>O("currentMonth",n.target.value),startContent:e(K,{className:"w-4 h-4"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},size:m?"sm":"md"})})]})}),r(c,{children:[e(Oe,{attendanceData:P,currentYear:s.currentYear,currentMonth:s.currentMonth,leaveTypes:H,leaveCounts:R,loading:g}),I>=30&&e("div",{className:"py-4 px-2 flex justify-center items-center",children:e(Ae,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:p,total:E,onChange:ie,classNames:{wrapper:"bg-white/10 backdrop-blur-md border-white/20",item:"bg-white/5 border-white/10",cursor:"bg-primary/20 backdrop-blur-md"}})})]})]})})})})})]})});Ge.layout=f=>e(xe,{children:f});export{Ge as default};
