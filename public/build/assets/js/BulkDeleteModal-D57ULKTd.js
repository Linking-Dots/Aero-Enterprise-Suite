import{J as ze,a as t,j as e,b as Z}from"./app-B6_7QJR_.js";import{r as l,R as ve}from"./react-core-DDvupgOx.js";import{B as H,d as le,g as ke,e as We,s as ct,p as ut,t as pt}from"./App-bCk4sZyX.js";import{a as me}from"./utilities-DT6SRl8s.js";import{G as ot}from"./logo-aySN_NXf.js";import{u as ge,a as Ee,a2 as oe,o as de,B as o,d as ht,T as h,a1 as mt,e as _e,p as Fe,h as Q,j as Se,I as De,k as Ne,M as ie,m as Te,i as he,a6 as lt,q as Pe,r as Le,f as be,a5 as gt,s as Ue,l as ne,C as qe,$ as Ye,a3 as ft,a4 as yt,a9 as bt,aa as xt,t as vt,ab as wt}from"./mui-libraries-DIRJRVmP.js";import{F as we}from"./TrashIcon-D8Us3Tf_.js";import{F as Oe}from"./PencilIcon-Dhfhztfv.js";import{F as Ve}from"./EllipsisVerticalIcon-BX6PWMxg.js";import{F as Ct}from"./XCircleIcon-StDWd-mv.js";import{F as kt}from"./CheckCircleIcon-DnGOlVla.js";import{F as _t}from"./ClockIcon-DNQ3nlJB.js";import{F as St}from"./ExclamationTriangleIcon-CsS6HvBt.js";import{F as Dt}from"./UserIcon-D16nn9o_.js";import{F as Nt}from"./HeartIcon-BSdzzFKC.js";import{b as Me,v as pe,t as Ge,S as Je,O as Ke,P as Qe,Q as Be,L as Ze,M as Xe,J as et,G as tt,k as Tt,m as $t,n as Ft,o as Pt,q as Lt,f as $e,j as rt}from"./ui-libraries-CxFzkmxb.js";import{C as Ae}from"./Clear-BMIrQfFl.js";import{G as Re}from"./GlassDialog-CqIZEgFP.js";import{L as ye}from"./LoadingButton-B1uvELc3.js";import{F as at}from"./InformationCircleIcon-BNRxDcw3.js";import{F as Rt}from"./XCircleIcon-DJR5_Dv7.js";import{F as He}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as je}from"./CheckCircleIcon-CJUGb5Jf.js";function It({title:d,titleId:m,...k},f){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:f,"aria-labelledby":m},k),d?l.createElement("title",{id:m},d):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Wt=l.forwardRef(It);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Mt=d=>d.replace(/^([A-Z])|[\s-_]+(\w)/g,(m,k,f)=>f?f.toUpperCase():k.toLowerCase()),st=d=>{const m=Mt(d);return m.charAt(0).toUpperCase()+m.slice(1)},it=(...d)=>d.filter((m,k,f)=>!!m&&m.trim()!==""&&f.indexOf(m)===k).join(" ").trim(),Bt=d=>{for(const m in d)if(m.startsWith("aria-")||m==="role"||m==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ut={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=l.forwardRef(({color:d="currentColor",size:m=24,strokeWidth:k=2,absoluteStrokeWidth:f,className:v="",children:x,iconNode:F,...L},g)=>l.createElement("svg",{ref:g,...Ut,width:m,height:m,stroke:d,strokeWidth:f?Number(k)*24/Number(m):k,className:it("lucide",v),...!x&&!Bt(L)&&{"aria-hidden":"true"},...L},[...F.map(([y,u])=>l.createElement(y,u)),...Array.isArray(x)?x:[x]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=(d,m)=>{const k=l.forwardRef(({className:f,...v},x)=>l.createElement(qt,{ref:x,iconNode:m,className:it(`lucide-${Et(st(d))}`,`lucide-${d}`,f),...v}));return k.displayName=st(d),k};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],nt=zt("phone-off",At),Ht=ve.forwardRef(({leaves:d,allUsers:m,handleClickOpen:k,setCurrentLeave:f,openModal:v,setLeaves:x,setCurrentPage:F,currentPage:L,totalRows:g,lastPage:y,perPage:u,selectedMonth:W,employee:D,isAdminView:P=!1,onBulkApprove:w,onBulkReject:T,onBulkDelete:p,canApproveLeaves:b=!1,canEditLeaves:I=!1,canDeleteLeaves:q=!1,fetchLeavesStats:z},G)=>{const{auth:te}=ze().props,R=ge(),V=Ee("(min-width: 1025px)"),re=Ee("(min-width: 641px) and (max-width: 1024px)"),X=Ee("(max-width: 640px)"),[ce,j]=l.useState(!1),[i,C]=l.useState(null),[_,M]=l.useState(new Set);ve.useMemo(()=>Array.from(_).join(", ").replaceAll("_"," "),[_]);const Y=ve.useMemo(()=>{const r=_==="all",s=r||_.size>0,n=r?d.length:_.size;return t("div",{className:"flex flex-col gap-4",children:[e("div",{className:"flex justify-between gap-3 items-end",children:e("div",{className:"flex gap-3",children:s&&p&&t(Me,{color:"danger",variant:"flat",startContent:e(we,{className:"w-4 h-4"}),onPress:()=>{const $=r?d:d.filter(N=>_.has(N.id.toString()));p($)},children:["Delete ",n," selected"]})})}),s&&t("span",{className:"text-default-400 text-small",children:[n," of ",d.length," selected"]})]})},[_,d,p]);te.permissions?.includes("leaves.view"),te.permissions?.includes("leave.own.view");const E={New:{color:"primary",icon:St,bgColor:oe(R.palette.primary.main,.1),textColor:R.palette.primary.main},Pending:{color:"warning",icon:_t,bgColor:oe(R.palette.warning.main,.1),textColor:R.palette.warning.main},Approved:{color:"success",icon:kt,bgColor:oe(R.palette.success.main,.1),textColor:R.palette.success.main},Declined:{color:"danger",icon:Ct,bgColor:oe(R.palette.error.main,.1),textColor:R.palette.error.main}},B=r=>{switch(r?.toLowerCase()){case"casual":return e(ut,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(ct,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(Nt,{className:"w-3 h-3 text-red-500"});case"earned":return e(We,{className:"w-3 h-3 text-green-500"});default:return e(ke,{className:"w-3 h-3 text-primary"})}},S=l.useCallback(r=>{F&&F(r)},[F]),A=l.useCallback(async(r,s)=>{if(r.status===s)return H.info(`Leave is already ${s}.`),Promise.resolve(`The leave status is already updated to ${s}`);const n=`${r.id}-${s}`;if(i===n)return;C(n);const $=new Promise(async(N,ee)=>{try{const ae=await me.post(route("leave-update-status"),{id:r.id,status:s});ae.status===200?(x(fe=>fe.map(xe=>xe.id===r.id?{...xe,status:s}:xe)),z(),N(ae.data.message||"Leave status updated successfully")):ee(ae.data?.message||"Failed to update leave status")}catch(ae){const fe=ae.response?.data?.message||ae.response?.statusText||"Failed to update leave status";ee(fe)}finally{C(null)}});return H.promise($,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),$},[x,i,z]),O=r=>{const s=E[r]||E.New,n=s.icon;return e($e,{size:"sm",variant:"flat",color:s.color,startContent:e(n,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:r})},J=(r,s)=>{const n=new Date(r),$=new Date(s),N=Math.abs($-n),ee=Math.ceil(N/(1e3*60*60*24))+1;return ee===1?"1 day":`${ee} days`},K=r=>new Date(r).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),U=r=>m?.find(s=>String(s.id)===String(r))||{name:"Unknown User",phone:""},Ce=({leave:r,updatingLeave:s,setCurrentLeave:n,openModal:$,handleClickOpen:N,updateLeaveStatus:ee,canEditLeaves:ae,canDeleteLeaves:fe,canApproveLeaves:xe,isAdminView:Ie})=>{const ue=U(r.user_id),dt=J(r.from_date,r.to_date);return E[r.status]||E.New,console.log(Ie?"Admin View":"User View"),e(ot,{className:"mb-2",shadow:"sm",children:t(_e,{className:"p-3",children:[t(o,{className:"flex items-start justify-between mb-3",children:[e(o,{className:"flex items-center gap-3 flex-1",children:Ie&&e(Ze,{avatarProps:{radius:"lg",size:"sm",src:ue?.profile_image_url||ue?.profile_image,showFallback:!0,name:ue?.name||"Unnamed User",isBordered:!0},description:ue?.phone?e(Xe,{href:`tel:${ue?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:ue?.phone}):t("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e(nt,{className:"w-3 h-3"})," No Phone"]}),name:e("span",{className:"text-sm font-medium",children:ue?.name||"Unnamed User"})})}),t(o,{className:"flex items-center gap-2",children:[O(r.status),(ae||fe)&&t(Je,{children:[e(Ke,{children:e(de,{size:"small",children:e(Ve,{className:"w-4 h-4"})})}),t(Qe,{"aria-label":"Leave actions",children:[ae&&e(Be,{startContent:e(Oe,{className:"w-4 h-4"}),onPress:()=>{n(r),$("edit_leave")},children:"Edit Leave"},"edit"),fe&&e(Be,{className:"text-danger",color:"danger",startContent:e(we,{className:"w-4 h-4"}),onPress:()=>N(r.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(rt,{className:"my-3"}),t(mt,{spacing:2,children:[t(o,{className:"flex items-center gap-2",children:[e(ke,{className:"w-4 h-4 text-primary"}),e(h,{variant:"body2",fontWeight:"medium",children:r.leave_type})]}),t(o,{className:"flex items-center gap-2",children:[e(le,{className:"w-4 h-4 text-default-500"}),t(h,{variant:"body2",color:"textSecondary",children:[K(r.from_date)," - ",K(r.to_date)]}),e($e,{size:"sm",variant:"bordered",color:"default",children:dt})]}),r.reason&&t(o,{className:"flex items-start gap-2",children:[e(We,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(h,{variant:"body2",color:"textSecondary",className:"flex-1",children:r.reason})]})]}),Ie&&xe&&t(Z,{children:[e(rt,{className:"my-3"}),e(o,{className:"flex gap-2",children:["Approved","Declined"].map(se=>e(Me,{size:"sm",variant:r.status===se?"solid":"bordered",color:E[se].color,isLoading:s===`${r.id}-${se}`,onPress:()=>{s!==`${r.id}-${se}`&&ee(r,se)},startContent:s!==`${r.id}-${se}`?ve.createElement(E[se].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:se},se))})]})]})})},a=l.useCallback((r,s)=>{const n=U(r.user_id);switch(s){case"employee":return e(pe,{className:"whitespace-nowrap",children:e(Ze,{avatarProps:{radius:"lg",size:"sm",src:n?.profile_image_url||n?.profile_image,showFallback:!0,name:n?.name||"Unnamed User",isBordered:!0},description:n?.phone?e(Xe,{href:`tel:${n?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:n?.phone}):t("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e(nt,{className:"w-3 h-3"})," No Phone"]}),name:e("span",{className:"text-sm font-medium",children:n?.name||"Unnamed User"})})});case"leave_type":return e(pe,{children:t(o,{className:"flex items-center gap-1",children:[B(r.leave_type),e(h,{variant:"body2",className:"text-sm font-medium capitalize",children:r.leave_type})]})});case"from_date":case"to_date":return e(pe,{children:t(o,{className:"flex items-center gap-1",children:[e(le,{className:"w-3 h-3 text-default-500"}),t(o,{children:[e(h,{variant:"body2",className:"text-sm",children:K(r[s])}),s==="from_date"&&e(h,{variant:"caption",className:"text-xs",color:"textSecondary",children:J(r.from_date,r.to_date)})]})]})});case"status":return e(pe,{children:t(o,{className:"flex items-center gap-2",children:[O(r.status),P&&b&&t(Je,{children:[e(Ke,{children:e(Me,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:i&&i.startsWith(`${r.id}-`),children:e(Ve,{className:"w-4 h-4"})})}),e(Qe,{"aria-label":"Status actions",onAction:$=>A(r,$),children:Object.keys(E).map($=>{const N=E[$],ee=N.icon;return e(Be,{startContent:e(ee,{className:"w-4 h-4"}),color:N.color,children:$},$)})})]})]})});case"reason":return e(pe,{children:e(ht,{title:r.reason||"No reason provided",children:e(h,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:r.reason||"No reason provided"})})});case"actions":return e(pe,{children:t(o,{className:"flex items-center gap-1",children:[I&&e(Ge,{content:"Edit Leave",children:e(de,{size:"small",onClick:()=>{i&&i.startsWith(`${r.id}-`)||(f(r),v("edit_leave"))},sx:{background:oe(R.palette.primary.main,.1),"&:hover":{background:oe(R.palette.primary.main,.2)}},children:e(Oe,{className:"w-4 h-4"})})}),q&&e(Ge,{content:"Delete Leave",color:"danger",children:e(de,{size:"small",onClick:()=>{i&&i.startsWith(`${r.id}-`)||(f(r),k(r.id,"delete_leave"))},sx:{background:oe(R.palette.error.main,.1),"&:hover":{background:oe(R.palette.error.main,.2)}},children:e(we,{className:"w-4 h-4"})})})]})});default:return e(pe,{children:r[s]})}},[P,b,V,i,R,f,v,k,A]),c=[...P?[{name:"Employee",uid:"employee",icon:Dt}]:[],{name:"Leave Type",uid:"leave_type",icon:ke},{name:"From Date",uid:"from_date",icon:le},{name:"To Date",uid:"to_date",icon:le},{name:"Status",uid:"status",icon:We},{name:"Reason",uid:"reason",icon:ke},...P?[{name:"Actions",uid:"actions"}]:[]];return X?t(o,{className:"space-y-4",children:[e(et,{className:"max-h-[70vh]",children:d.map(r=>e(Ce,{leave:r,updatingLeave:i,setCurrentLeave:f,openModal:v,handleClickOpen:k,updateLeaveStatus:A,canEditLeaves:I,canDeleteLeaves:q,canApproveLeaves:b,isAdminView:P},r.id))}),g>u&&e(o,{className:"flex justify-center pt-4",children:e(tt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:L,total:y,onChange:S,size:"sm"})})]}):t(o,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(et,{className:"max-h-[70vh]",children:t(Tt,{isStriped:!0,selectionMode:"multiple",selectedKeys:_,onSelectionChange:M,topContent:Y,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e($t,{columns:c,children:r=>e(Ft,{align:r.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:t(o,{className:"flex items-center gap-1",children:[r.icon&&e(r.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:r.name})]})},r.uid)}),e(Pt,{items:d,emptyContent:t(o,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(le,{className:"w-12 h-12 text-default-300 mb-4"}),e(h,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(h,{variant:"body2",color:"textSecondary",children:D?`No leaves found for "${D}"`:"No leave requests for the selected period"})]}),children:r=>e(Lt,{children:s=>a(r,s)},r.id)})]})}),g>u&&t(o,{className:"py-4 flex justify-center",children:[e(tt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:L,total:y,onChange:S,size:re?"sm":"md"}),t("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",L," of ",y," (Total: ",g," records)"]})]})]})});Ht.displayName="LeaveEmployeeTable";const gr=({open:d,closeModal:m,leavesData:k,setLeavesData:f,currentLeave:v,allUsers:x,setTotalRows:F,setLastPage:L,setLeaves:g,handleMonthChange:y,employee:u,selectedMonth:W,addLeaveOptimized:D,updateLeaveOptimized:P,fetchLeavesStats:w})=>{const{auth:T}=ze().props,p=ge(),[b,I]=l.useState(v?.user_id||T.user.id),[q,z]=l.useState(k?.leaveTypes||[]),[G,te]=l.useState([]),[R,V]=l.useState(v?.leave_type||""),re=a=>{if(!a)return new Date().toISOString().split("T")[0];if(typeof a=="string"&&a.match(/^\d{4}-\d{2}-\d{2}$/))return a;if(typeof a=="string"&&a.includes("T")){if(a.includes("T18:00:00")){const r=a.split("T")[0].split("-"),s=parseInt(r[0]),n=parseInt(r[1]),$=parseInt(r[2])+1;return new Date(s,n-1,$).toISOString().split("T")[0]}return a.split("T")[0]}try{const c=new Date(a);if(isNaN(c.getTime()))return new Date().toISOString().split("T")[0];const r=c.getFullYear(),s=String(c.getMonth()+1).padStart(2,"0"),n=String(c.getDate()).padStart(2,"0");return`${r}-${s}-${n}`}catch(c){return console.error("Error formatting date:",c),new Date().toISOString().split("T")[0]}},[X,ce]=l.useState(v?.from_date?re(v.from_date):""),[j,i]=l.useState(v?.to_date?re(v.to_date):""),[C,_]=l.useState(v?.no_of_days||""),[M,Y]=l.useState(""),[E,B]=l.useState(v?.reason||""),[S,A]=l.useState({}),[O,J]=l.useState(!1),[K,U]=l.useState("");return l.useEffect(()=>{if(k){z(k.leaveTypes||[]);const a=k.leaveCountsByUser?.[b]||[];if(te(a),q.length>0&&!R&&!v&&V(q[0].type),v&&!R){const c=k.leaveTypes?.find(r=>r.id===v.leave_type);c&&V(c.type)}}},[k,b,v]),l.useEffect(()=>{if(!R||!G||!q)return;const c=G.find(s=>s.leave_type===R)?.days_used||0;U(c);const r=q.find(s=>s.type===R);if(r){const s=r.days-c;Y(s),v&&C>s&&_(s)}},[R,G,q,v,C]),l.useEffect(()=>{_(((c,r)=>{if(!c||!r)return"";const s=new Date(c),n=new Date(r);if(s>n)return"";const $=n.getTime()-s.getTime();return Math.ceil($/(1e3*3600*24))+1})(X,j))},[X,j]),t(Re,{open:d,onClose:m,fullWidth:!0,maxWidth:"sm",children:[t(Fe,{sx:{display:"flex",alignItems:"center"},children:[e(h,{variant:"h6",children:v?"Edit Leave":"Add Leave"}),e(de,{onClick:m,sx:{position:"absolute",top:8,right:16},children:e(Ae,{})})]}),t("form",{onSubmit:async a=>{a.preventDefault(),J(!0);const c=new Promise(async(r,s)=>{try{const n={route:route().current(),user_id:b,leaveType:R,fromDate:X,toDate:j,daysCount:C,leaveReason:E,employee:u,month:W},$=v?route("leave-update"):route("leave-add");v&&(n.id=v.id);const N=await axios.post($,n);N.status===200||N.status===201?(f(N.data.leavesData),v&&P&&N.data.leave?(P(N.data.leave),w()):D&&N.data.leave?(D(N.data.leave),w(),N.data.pagination&&(F(N.data.pagination.total),L(N.data.pagination.lastPage))):(console.log("Using fallback data update mode"),N.data.leaves&&(g(N.data.leaves.data),F(N.data.leaves.total),L(N.data.leaves.last_page)),N.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(N.data.leavesData)),m(),r([N.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",N.status),s(`Unexpected response status: ${N.status}`))}catch(n){console.error("Full error object:",n),n.response?(console.error("Error response status:",n.response.status),console.error("Error response data:",n.response.data),n.response.status===422?(A(n.response.data.errors||{}),s(n.response.data.error||"Failed to submit leave application")):s(`HTTP Error ${n.response.status}: ${n.response.data.message||"An unexpected error occurred. Please try again later."}`)):n.request?(console.error("No response received:",n.request),s("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",n.message),s("An error occurred while setting up the request."))}finally{J(!1)}});H.promise(c,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},success:{render({data:r}){return e(Z,{children:r.map((s,n)=>e("div",{children:s},n))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},error:{render({data:r}){return e(Z,{children:r})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}}})},children:[e(Pe,{children:t(Q,{container:!0,spacing:2,children:[e(Q,{item:!0,xs:12,md:6,children:t(Se,{fullWidth:!0,children:[e(De,{id:"leave-type-label",children:"Leave Type"}),t(Ne,{labelId:"leave-type-label",value:R||"",onChange:a=>V(a.target.value),label:"Leave Type",error:!!S.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,borderRadius:2,boxShadow:p.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:"Select Leave Type"}),q.map(a=>{const c=G?.find(n=>n.leave_type===a.type),s=(c?a.days-c.days_used:a.days)<=0;return e(ie,{value:a.type,disabled:s,title:s?"No remaining leaves available":"",children:t(o,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),e("span",{children:c?`${c.days_used} / ${a.days} days`:`${a.days} days`})]})},a.id)})]}),e(Te,{children:S.leaveType})]})}),e(Q,{item:!0,xs:12,md:6,children:e(he,{label:"From",type:"date",fullWidth:!0,value:X,onChange:a=>ce(a.target.value),InputLabelProps:{shrink:!0},error:!!S.fromDate,helperText:S.fromDate})}),e(Q,{item:!0,xs:12,md:6,children:e(he,{label:"To",type:"date",fullWidth:!0,value:j,onChange:a=>i(a.target.value),InputLabelProps:{shrink:!0},error:!!S.toDate,helperText:S.toDate})}),e(Q,{item:!0,xs:12,md:6,children:e(he,{label:"Number of days",type:"text",fullWidth:!0,value:C,InputProps:{readOnly:!0},error:!!S.daysCount,helperText:S.daysCount})}),e(Q,{item:!0,xs:12,md:6,children:e(he,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${M} day${M!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:t(h,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",q.find(a=>a.type===R)?.days||0," total"]})},error:!!S.remainingLeaves,helperText:S.remainingLeaves})}),route().current()==="leaves"&&e(Q,{item:!0,xs:12,md:6,children:t(Se,{fullWidth:!0,children:[e(De,{id:"leave-employee-label",children:"Employee"}),t(Ne,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:b||"na",error:!!S.user_id,onChange:a=>I(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,borderRadius:2,boxShadow:p.glassCard.boxShadow}}},children:[e(ie,{value:"na",disabled:!0,children:"Please select"}),x.map(a=>e(ie,{value:a.id,children:t(o,{sx:{display:"flex"},children:[e(lt,{src:a.profile_image_url||a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(Te,{children:S.user_id})]})}),e(Q,{item:!0,xs:12,children:e(he,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:E,onChange:a=>B(a.target.value),error:!!S.leaveReason,helperText:S.leaveReason})})]})}),e(Le,{sx:{padding:"16px",justifyContent:"center"},children:e(ye,{type:"submit",variant:"outlined",color:"primary",loading:O,disabled:O,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},fr=({open:d,closeModal:m,leaveId:k,setLeavesData:f,setLeaves:v,setTotalRows:x,setLastPage:F,setError:L,deleteLeaveOptimized:g,fetchLeavesStats:y})=>{const u=ge(),[W,D]=l.useState(!1);return t(Re,{open:d,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Fe,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Pe,{children:e(gt,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),t(Le,{children:[e(Ue,{onClick:m,color:"primary",disabled:W,children:"Cancel"}),e(Ue,{loading:W,disabled:W,onClick:()=>{if(!k){const T=Promise.reject(new Error("Invalid leave ID"));H.promise(T,{error:"Invalid leave ID provided"});return}D(!0);const w=new Promise(async(T,p)=>{try{const b=await me.delete(route("leave-delete",{id:k,route:route().current()}));b.status===200&&(g?(g(k),x(I=>Math.max(0,I-1)),y&&y()):(f&&f(b.data.leavesData),x&&x(b.data.leaves.total),F&&F(b.data.leaves.last_page),v&&v(b.data.leaves.data),L&&L(!1),y&&y()),T("Leave application deleted successfully"))}catch(b){if(console.error("Error deleting leave:",b),b.response?.status===404){const{leavesData:I}=b.response.data||{};f&&I&&f(I),L&&L(b.response?.data?.message||"Leave not found."),p("Leave not found or already deleted")}else b.response?.status===403?p("You do not have permission to delete this leave"):b.response?.status===422?p("Cannot delete leave with current status"):p(b.response?.data?.error||"Failed to delete leave application")}finally{D(!1),m()}});H.promise(w,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}},success:{render({data:T}){return e(Z,{children:T})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}},error:{render({data:T}){return e(Z,{children:T})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},jt=({selectedDates:d=[],onDatesChange:m,existingLeaves:k=[],publicHolidays:f=[],minDate:v=null,maxDate:x=null,userId:F=null,fetchFromAPI:L=!1})=>{const g=ge(),[y,u]=l.useState(new Date),[W,D]=l.useState({existingLeaves:k,publicHolidays:f}),[P,w]=l.useState(!1),[T,p]=l.useState(null),b=l.useCallback(async i=>{if(!(!L||!F)&&T!==i){w(!0);try{const C=await me.get(route("leaves.bulk.calendar-data"),{params:{user_id:F,year:i}});C.data.success&&(D({existingLeaves:C.data.data.existingLeaves||[],publicHolidays:C.data.data.publicHolidays||[]}),p(i))}catch(C){console.error("Failed to fetch calendar data:",C)}finally{w(!1)}}},[L,F,T]);l.useEffect(()=>{const i=y.getFullYear();b(i)},[b,y.getFullYear()]),l.useEffect(()=>{L&&F&&p(null)},[F,L]);const I=L?W.existingLeaves:k,q=L?W.publicHolidays:f,z=l.useMemo(()=>{const i=y.getFullYear(),C=y.getMonth(),_=new Date(i,C,1),Y=new Date(i,C+1,0).getDate(),E=_.getDay(),B=new Date(i,C,0).getDate(),S=[];for(let U=E-1;U>=0;U--)S.push({date:B-U,isCurrentMonth:!1,fullDate:new Date(i,C-1,B-U)});const A=[];for(let U=1;U<=Y;U++)A.push({date:U,isCurrentMonth:!0,fullDate:new Date(i,C,U)});const J=42-(S.length+A.length),K=[];for(let U=1;U<=J;U++)K.push({date:U,isCurrentMonth:!1,fullDate:new Date(i,C+1,U)});return[...S,...A,...K]},[y]),G=l.useCallback(()=>{u(i=>new Date(i.getFullYear(),i.getMonth()-1,1))},[]),te=l.useCallback(()=>{u(i=>new Date(i.getFullYear(),i.getMonth()+1,1))},[]),R=l.useCallback(()=>{u(new Date)},[]),V=l.useCallback(i=>{if(!i.isCurrentMonth||P)return;const C=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),_=I.some(B=>{if(!B.from_date||!B.to_date)return!1;const S=B.from_date.split("T")[0],A=B.to_date.split("T")[0];return C>=S&&C<=A}),M=q.includes(C);if(_||M||v&&i.fullDate<new Date(v)||x&&i.fullDate>new Date(x))return;const Y=d.includes(C);let E;Y?E=d.filter(B=>B!==C):E=[...d,C],m(E.sort())},[d,m,v,x,P,I,q]),re=l.useCallback(i=>{if(!i.isCurrentMonth)return{selectable:!1};const C=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),_=d.includes(C),M=i.fullDate.toDateString()===new Date().toDateString(),Y=i.fullDate<new Date().setHours(0,0,0,0),E=i.fullDate.getDay()===0||i.fullDate.getDay()===6,B=I.some(O=>{if(!O.from_date||!O.to_date)return!1;const J=O.from_date.split("T")[0],K=O.to_date.split("T")[0];return C>=J&&C<=K}),S=q.includes(C),A=!P&&!B&&!S&&(!v||i.fullDate>=new Date(v))&&(!x||i.fullDate<=new Date(x));return{isSelected:_,isToday:M,isPast:Y,isWeekend:E,hasExistingLeave:B,isPublicHoliday:S,selectable:A}},[d,I,q,v,x,P]),X=l.useCallback((i,C)=>i.isCurrentMonth?P?{color:g.palette.text.disabled,cursor:"not-allowed",backgroundColor:g.palette.action.disabledBackground,opacity:.5,pointerEvents:"none"}:C.isSelected?{backgroundColor:g.palette.primary.main,color:g.palette.primary.contrastText,fontWeight:"bold",border:`2px solid ${g.palette.primary.dark}`,boxShadow:`0 0 0 3px ${g.palette.primary.main}30`,transform:"scale(1.05)",zIndex:10}:C.hasExistingLeave?{backgroundColor:g.palette.error.main,color:g.palette.error.contrastText,border:`2px solid ${g.palette.error.dark}`,fontWeight:500,cursor:"not-allowed"}:C.isPublicHoliday?{backgroundColor:g.palette.warning.main,color:g.palette.warning.contrastText,border:`2px solid ${g.palette.warning.dark}`,fontWeight:500,cursor:"not-allowed"}:C.isToday?{backgroundColor:g.palette.secondary.light,color:g.palette.secondary.contrastText,fontWeight:600,border:`2px solid ${g.palette.secondary.main}`,boxShadow:`0 0 0 2px ${g.palette.secondary.main}40`,"&:hover":{backgroundColor:g.palette.secondary.main,transform:"scale(1.02)"}}:C.isWeekend?{color:g.palette.text.secondary,backgroundColor:g.palette.action.hover,border:`1px solid ${g.palette.divider}`,opacity:.7,"&:hover":{backgroundColor:g.palette.action.selected,opacity:.9}}:C.selectable?{color:g.palette.text.primary,border:"1px solid transparent","&:hover":{backgroundColor:g.palette.primary.main+"15",color:g.palette.primary.main,border:`1px solid ${g.palette.primary.main}30`,transform:"scale(1.02)"}}:{color:g.palette.text.disabled,cursor:"not-allowed",backgroundColor:g.palette.action.disabledBackground,opacity:.6}:{color:g.palette.text.disabled,cursor:"not-allowed",opacity:.3},[g,P]),ce=y.toLocaleDateString("en-US",{month:"long",year:"numeric"}),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t(ot,{variant:"outlined",sx:{width:"100%"},children:[e(qe,{title:t(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(le,{style:{width:20,height:20,color:g.palette.primary.main}}),e(h,{variant:"h6",component:"h3",children:ce}),L&&T&&e(ne,{size:"small",variant:"outlined",color:"primary",label:`Data: ${T}`,sx:{ml:1,fontSize:"0.7rem"}})]}),t(o,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e(de,{size:"small",onClick:G,sx:{color:"text.secondary"},disabled:P,children:e(Wt,{style:{width:16,height:16}})}),e(Ue,{variant:"text",size:"small",onClick:R,sx:{minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem",textTransform:"none"},disabled:P,children:"Today"}),e(de,{size:"small",onClick:te,sx:{color:"text.secondary"},disabled:P,children:e(pt,{style:{width:16,height:16}})})]})]}),sx:{pb:2}}),t(_e,{sx:{pt:0},children:[P&&t(o,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,backgroundColor:g.palette.action.hover,borderRadius:2,mb:3},children:[e(be,{size:24}),t(h,{variant:"body2",sx:{ml:2},children:["Loading calendar data for ",y.getFullYear(),"..."]})]}),t(o,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:[e(ne,{size:"small",variant:"filled",color:"primary",label:"Selected",sx:{fontWeight:600}}),e(ne,{size:"small",variant:"filled",color:"error",label:"Existing Leave",sx:{opacity:.9}}),e(ne,{size:"small",variant:"filled",color:"warning",label:"Holiday",sx:{opacity:.9}}),e(ne,{size:"small",variant:"filled",color:"secondary",label:"Today",sx:{fontWeight:600}}),e(ne,{size:"small",variant:"outlined",color:"default",label:"Weekend",sx:{opacity:.7}})]}),e(o,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:1},children:j.map(i=>e(o,{sx:{textAlign:"center",py:1,fontSize:"0.875rem",fontWeight:"medium",color:"text.secondary"},children:i},i))}),e(o,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5},children:z.map((i,C)=>{const _=re(i),M=X(i,_);return t(o,{onClick:()=>V(i),sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,minHeight:40,cursor:_.selectable?"pointer":"not-allowed",borderRadius:1.5,transition:"all 0.2s ease-in-out",fontSize:"0.875rem",userSelect:"none",...M},role:"button",tabIndex:_.selectable?0:-1,title:_.hasExistingLeave?"Existing leave - cannot select":_.isPublicHoliday?"Public holiday - cannot select":_.selectable?"":"Not selectable","aria-label":`${i.fullDate.toDateString()}${_.isSelected?" (selected)":""}${_.hasExistingLeave?" (existing leave)":""}${_.isPublicHoliday?" (public holiday)":""}`,onKeyDown:Y=>{(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),V(i))},children:[i.date,_.isWeekend&&!_.isSelected&&!_.hasExistingLeave&&!_.isPublicHoliday&&e(o,{sx:{position:"absolute",top:2,right:2,width:4,height:4,borderRadius:"50%",bgcolor:"text.secondary",opacity:.5}})]},C)})}),d.length>0&&t(o,{sx:{mt:3,p:2.5,borderRadius:2,background:`linear-gradient(135deg, ${g.palette.primary.light}20, ${g.palette.primary.main}10)`,border:`1px solid ${g.palette.primary.main}30`,backdropFilter:"blur(8px)",position:"relative",overflow:"hidden"},children:[t(o,{sx:{position:"relative",zIndex:1},children:[t(h,{variant:"body2",color:"primary.main",fontWeight:"600",sx:{mb:1},children:["📅 ",d.length," date",d.length!==1?"s":""," selected"]}),t(o,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[d.slice(0,12).map(i=>e(ne,{size:"small",variant:"filled",color:"primary",label:new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric"}),sx:{fontWeight:500,fontSize:"0.75rem"}},i)),d.length>12&&e(ne,{size:"small",variant:"outlined",color:"primary",label:`+${d.length-12} more`,sx:{fontWeight:500}})]})]}),e(o,{sx:{position:"absolute",top:-10,right:-10,width:60,height:60,borderRadius:"50%",background:`linear-gradient(45deg, ${g.palette.primary.main}15, transparent)`,opacity:.3}})]})]})]})},Yt=({validationResults:d=[],balanceImpact:m=null,isValidating:k=!1})=>{const f=ge();if(d.length===0&&!k)return null;const v=d.filter(u=>u.status==="valid").length,x=d.filter(u=>u.status==="warning").length,F=d.filter(u=>u.status==="conflict").length;d.length;const L=u=>{const W={style:{width:16,height:16}};switch(u){case"valid":return e(je,{...W,style:{...W.style,color:f.palette.success.main}});case"warning":return e(He,{...W,style:{...W.style,color:f.palette.warning.main}});case"conflict":return e(Rt,{...W,style:{...W.style,color:f.palette.error.main}});default:return e(at,{...W,style:{...W.style,color:f.palette.text.disabled}})}},g=u=>{switch(u){case"valid":return"success";case"warning":return"warning";case"conflict":return"error";default:return"default"}},y=u=>new Date(u).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return t(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t(Ye,{variant:"outlined",children:[e(qe,{title:t(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(h,{variant:"h6",children:"Validation Results"}),k&&t(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(be,{size:16}),e(h,{variant:"body2",color:"text.secondary",children:"Validating..."})]})]})}),t(_e,{sx:{pt:0},children:[t(o,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mb:2},children:[t(o,{sx:{textAlign:"center"},children:[e(h,{variant:"h4",color:"success.main",fontWeight:"bold",children:v}),e(h,{variant:"body2",color:"success.main",children:"Valid"})]}),t(o,{sx:{textAlign:"center"},children:[e(h,{variant:"h4",color:"warning.main",fontWeight:"bold",children:x}),e(h,{variant:"body2",color:"warning.main",children:"Warnings"})]}),t(o,{sx:{textAlign:"center"},children:[e(h,{variant:"h4",color:"error.main",fontWeight:"bold",children:F}),e(h,{variant:"body2",color:"error.main",children:"Conflicts"})]})]}),m&&t(o,{sx:{p:2,borderRadius:2,background:f.palette.background.paper,border:`1px solid ${f.palette.divider}`},children:[t(h,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e(at,{style:{width:16,height:16,color:f.palette.primary.main}}),"Leave Balance Impact"]}),t(o,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[t(o,{children:[e(h,{variant:"body2",color:"text.secondary",component:"span",children:"Leave Type:"}),e(h,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:m.leave_type})]}),t(o,{children:[e(h,{variant:"body2",color:"text.secondary",component:"span",children:"Current Balance:"}),t(h,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[m.current_balance," days"]})]}),t(o,{children:[e(h,{variant:"body2",color:"text.secondary",component:"span",children:"Requested Days:"}),t(h,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[m.requested_days," days"]})]}),t(o,{children:[e(h,{variant:"body2",color:"text.secondary",component:"span",children:"Remaining Balance:"}),t(h,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1,color:m.remaining_balance<0?"error.main":"success.main"},children:[m.remaining_balance," days"]})]})]}),m.remaining_balance<0&&e(o,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"error.light",border:1,borderColor:"error.main"},children:t(h,{variant:"body2",color:"error.main",children:["⚠️ This request exceeds your available leave balance by ",Math.abs(m.remaining_balance)," days."]})})]})]})]}),d.length>0&&t(Ye,{variant:"outlined",children:[e(qe,{title:e(h,{variant:"h6",children:"Date-by-Date Results"})}),e(_e,{children:e(o,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:240,overflowY:"auto"},children:d.map((u,W)=>t(o,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2,borderRadius:2,border:1,borderColor:"divider","&:hover":{borderColor:"text.secondary"},transition:"border-color 0.2s"},children:[t(o,{sx:{display:"flex",alignItems:"center",gap:2},children:[L(u.status),t(o,{children:[e(h,{variant:"body2",fontWeight:"medium",children:y(u.date)}),e(h,{variant:"caption",color:"text.secondary",children:u.date})]})]}),t(o,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e(ne,{size:"small",variant:"outlined",color:g(u.status),label:u.status,sx:{textTransform:"capitalize"}}),u.errors&&u.errors.length>0&&e(o,{sx:{textAlign:"right"},children:u.errors.map((D,P)=>e(h,{variant:"caption",color:"error.main",children:D},P))}),u.warnings&&u.warnings.length>0&&e(o,{sx:{textAlign:"right"},children:u.warnings.map((D,P)=>e(h,{variant:"caption",color:"warning.main",children:D},P))})]})]},W))})})]})]})},yr=({open:d,onClose:m,onSuccess:k,allUsers:f=[],leavesData:v={leaveTypes:[],leaveCountsByUser:{}},isAdmin:x=!1,existingLeaves:F=[],publicHolidays:L=[]})=>{const{auth:g}=ze().props,y=ge(),[u,W]=l.useState([]),[D,P]=l.useState(g?.user?.id||""),[w,T]=l.useState(""),[p,b]=l.useState(""),[I,q]=l.useState(!1),[z,G]=l.useState([]),[te,R]=l.useState(!1),[V,re]=l.useState([]),[X,ce]=l.useState(null),[j,i]=l.useState(!1),[C,_]=l.useState(!1),[M,Y]=l.useState(!1),[E,B]=l.useState({});l.useMemo(()=>!F||F.length===0?[]:F.filter(a=>a.user_id===parseInt(D)),[F,D]);const S=l.useMemo(()=>z.length>0?z:v?.leaveTypes||[],[z,v]),A=l.useMemo(()=>z.length>0?z.map(a=>({leave_type:a.type,days_used:a.used,total_days:a.days,remaining_days:a.remaining})):v?.leaveCountsByUser?.[D]||[],[z,v,D]),O=l.useCallback(async a=>{if(a){R(!0);try{const c=await me.get(route("leaves.bulk.leave-types"),{params:{user_id:a,year:new Date().getFullYear()}});c.data.success&&G(c.data.leave_types)}catch(c){console.error("Failed to fetch user leave types:",c),G([])}finally{R(!1)}}},[]);l.useEffect(()=>{d&&D&&x&&O(D)},[D,d,x,O]),l.useEffect(()=>{d||(W([]),P(g?.user?.id||""),T(""),b(""),q(!1),re([]),ce(null),_(!1),B({}),G([]))},[d,g?.user?.id]),l.useEffect(()=>{if(S.length>0&&!w&&d&&D){const a=S.find(c=>{if(z.length>0)return c.remaining>0;const r=A?.find(n=>n.leave_type===c.type);return(r?c.days-r.days_used:c.days)>0});a&&T(a.type)}},[S,A,z,w,d,D]);const J=l.useCallback(async()=>{if(u.length===0){const a=Promise.reject(new Error("No dates selected"));H.promise(a,{error:"Please select at least one date"});return}if(!w){const a=Promise.reject(new Error("No leave type selected"));H.promise(a,{error:"Please select a leave type"});return}if(!p.trim()||p.trim().length<5){const a=new Promise((c,r)=>{r("Please provide a reason for leave (at least 5 characters)")});H.promise(a,{error:{render({data:c}){return e(Z,{children:c})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,color:y.palette.text.primary}}});return}i(!0),B({});try{const a=S.find(r=>r.type===w),c=await me.post(route("leaves.bulk.validate"),{user_id:parseInt(D),dates:u,leave_type_id:a?.id,reason:p.trim()});if(c.data.success){re(c.data.validation_results),ce(c.data.estimated_balance_impact),_(!0);const r=c.data.validation_results.filter($=>$.status==="conflict").length,s=c.data.validation_results.filter($=>$.status==="warning").length,n=Promise.resolve();r>0?H.promise(n,{success:`${r} date(s) have conflicts. Please review before submitting.`}):s>0?H.promise(n,{success:`${s} date(s) have warnings. You may proceed if acceptable.`}):H.promise(n,{success:"All dates validated successfully!"})}}catch(a){console.error("Validation error:",a),a.response?.status===422&&B(a.response.data.errors||{});const c=Promise.reject(a);H.promise(c,{error:a.response?.data?.message||"Failed to validate dates"})}finally{i(!1)}},[u,w,p,D,S]),K=l.useCallback(async()=>{if(!C){const r=Promise.reject(new Error("Not validated"));H.promise(r,{error:"Please validate dates before submitting"});return}if(V.filter(r=>r.status==="conflict").length>0&&!I){const r=new Promise((s,n)=>{n("Please resolve conflicts or enable partial success mode")});H.promise(r,{error:{render({data:s}){return e(Z,{children:s})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,color:y.palette.text.primary}}});return}Y(!0);const c=new Promise(async(r,s)=>{try{const n=S.find(N=>N.type===w),$=await me.post(route("leaves.bulk.store"),{user_id:parseInt(D),dates:u,leave_type_id:n?.id,reason:p.trim(),allow_partial_success:I});$.status===200||$.status===201?(k?.($.data),m(),r([$.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",$.status),s(`Unexpected response status: ${$.status}`))}catch(n){console.error("Full error object:",n),n.response?(console.error("Error response status:",n.response.status),console.error("Error response data:",n.response.data),n.response.status===422?(B(n.response.data.errors||{}),s(n.response.data.error||"Failed to submit bulk leave requests")):s(`HTTP Error ${n.response.status}: ${n.response.data.message||"An unexpected error occurred. Please try again later."}`)):n.request?(console.error("No response received:",n.request),s("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",n.message),s("An error occurred while setting up the request."))}finally{Y(!1)}});H.promise(c,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,color:y.palette.text.primary}},success:{render({data:r}){return e(Z,{children:r.map((s,n)=>e("div",{children:s},n))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,color:y.palette.text.primary}},error:{render({data:r}){return e(Z,{children:r})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,color:y.palette.text.primary}}})},[C,V,I,D,u,w,p,k,m,S,y]),U=u.length>0&&w&&p.trim().length>=5,Ce=C&&(V.filter(a=>a.status==="conflict").length===0||I);return t(Re,{open:d,onClose:m,fullWidth:!0,maxWidth:"lg",children:[t(Fe,{sx:{display:"flex",alignItems:"center",pb:1},children:[t(o,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(le,{style:{width:24,height:24,color:y.palette.primary.main}}),t(o,{children:[e(h,{variant:"h6",component:"h2",children:"Add Bulk Leave"}),e(h,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Select multiple dates and create leave requests in batch"})]})]}),e(de,{onClick:m,sx:{position:"absolute",top:8,right:16},disabled:M,children:e(Ae,{})})]}),e(Pe,{sx:{py:3},children:t(Q,{container:!0,spacing:3,children:[e(Q,{item:!0,xs:12,lg:6,children:t(o,{sx:{position:"sticky",top:0},children:[t(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e(le,{style:{width:20,height:20}}),"Select Dates"]}),e(jt,{selectedDates:u,onDatesChange:a=>{W(a),_(!1)},userId:D,fetchFromAPI:!0})]})}),e(Q,{item:!0,xs:12,lg:6,children:t(o,{sx:{display:"flex",flexDirection:"column",gap:3},children:[t(o,{children:[e(h,{variant:"h6",gutterBottom:!0,children:"Leave Details"}),t(o,{sx:{display:"flex",flexDirection:"column",gap:2},children:[x&&f.length>0&&t(Se,{fullWidth:!0,error:!!E.user_id,children:[e(De,{id:"bulk-employee-label",children:"Employee"}),t(Ne,{labelId:"bulk-employee-label",value:D||"",onChange:a=>{P(a.target.value),T(""),_(!1),G([])},label:"Employee",disabled:M||j,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,borderRadius:2,boxShadow:y.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:"Please select employee"}),f.map(a=>e(ie,{value:a.id,children:t(o,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(lt,{showFallback:!0,src:a.profile_image_url||a.profile_image,name:a.name||"Not assigned",sx:{width:24,height:24}}),a.name]})},a.id))]}),e(Te,{children:E.user_id})]}),t(Se,{fullWidth:!0,error:!!E.leave_type_id,children:[e(De,{id:"bulk-leave-type-label",children:"Leave Type"}),t(Ne,{labelId:"bulk-leave-type-label",value:w||"",onChange:a=>{T(a.target.value),_(!1)},label:"Leave Type",disabled:M||j||te,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:y.glassCard.background,border:y.glassCard.border,borderRadius:2,boxShadow:y.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:te?"Loading leave types...":"Select Leave Type"}),S.map(a=>{let c,r;if(z.length>0)c=a.remaining,r=c<=0;else{const s=A?.find(n=>n.leave_type===a.type);c=s?a.days-s.days_used:a.days,r=c<=0}return e(ie,{value:a.type,disabled:r,title:r?"No remaining leaves available":"",children:t(o,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),t("span",{children:["(",c," remaining)"]})]})},a.id)})]}),e(Te,{children:E.leave_type_id})]}),w&&e(he,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:(()=>{const a=S.find(r=>r.type===w);let c;if(z.length>0&&a)c=a.remaining,a.days;else{const r=A?.find(s=>s.leave_type===w);c=r?a?.days-r.days_used:a?.days,a?.days}return`${c||0} remaining`})(),InputProps:{readOnly:!0,endAdornment:t(h,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",(()=>{const a=S.find(c=>c.type===w);return z.length>0,a?.days})()," total"]})}}),e(he,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:p,onChange:a=>{b(a.target.value),_(!1)},multiline:!0,rows:3,fullWidth:!0,required:!0,error:!!E.reason||p.length>0&&p.length<5,helperText:E.reason||(p.length>0&&p.length<5?"Reason must be at least 5 characters":`${p.length}/500 characters`),inputProps:{maxLength:500},disabled:M||j}),e(ft,{control:e(yt,{checked:I,onChange:a=>q(a.target.checked),size:"small",disabled:M||j}),label:t(o,{children:[e(h,{variant:"body2",children:"Allow partial success"}),e(h,{variant:"caption",color:"text.secondary",children:"Valid dates will be processed even if some dates fail validation"})]})})]})]}),u.length>0&&t(o,{sx:{p:2,borderRadius:2,background:y.palette.background.paper,border:`1px solid ${y.palette.divider}`},children:[e(h,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Selected Dates Summary"}),t(h,{variant:"body1",children:[e("strong",{children:u.length})," date",u.length!==1?"s":""," selected"]}),w&&t(h,{variant:"body2",color:"text.secondary",children:["Leave type: ",w]})]}),e(Yt,{validationResults:V,balanceImpact:X,isValidating:j})]})})]})}),t(Le,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(ye,{variant:"outlined",onClick:m,disabled:M,sx:{borderRadius:"50px"},children:"Cancel"}),t(o,{sx:{display:"flex",gap:1},children:[e(ye,{variant:"outlined",color:"primary",onClick:J,loading:j,disabled:!U||M,startIcon:!j&&e(He,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:j?"Validating...":"Validate Dates"}),e(ye,{variant:"contained",color:"primary",onClick:K,loading:M,disabled:!Ce||j,startIcon:!M&&e(je,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:M?"Creating...":`Create ${u.length} Leave Request${u.length!==1?"s":""}`})]})]})]})},br=({open:d,onClose:m,onSuccess:k,selectedLeaves:f=[],allUsers:v=[]})=>{const x=ge(),[F,L]=l.useState(!1),[g,y]=l.useState({}),u=l.useCallback(w=>v.find(p=>p.id===w)?.name||`User ID: ${w}`,[v]),W=f.filter(w=>w.status&&w.status.toLowerCase()==="approved"),D=W.length===0,P=l.useCallback(async()=>{if(!D){const T=Promise.reject("Cannot delete approved leaves");H.promise(T,{error:"Cannot delete approved leave requests"});return}if(f.length===0){const T=Promise.reject("No leaves selected");H.promise(T,{error:"No leave requests selected for deletion"});return}L(!0);const w=new Promise(async(T,p)=>{try{const b=f.map(q=>q.id),I=await me.delete(route("leaves.bulk.delete"),{data:{leave_ids:b}});I.status===200&&I.data.success?(k?.(I.data),m(),T([I.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",I.status),p(`Unexpected response status: ${I.status}`))}catch(b){console.error("Full error object:",b),b.response?(console.error("Error response status:",b.response.status),console.error("Error response data:",b.response.data),b.response.status===422?(y(b.response.data.errors||{}),p(b.response.data.error||"Failed to delete leave requests")):b.response.status===403?p(b.response.data.error||"You are not authorized to delete these leave requests"):b.response.status===404?p(b.response.data.error||"Some leave requests were not found"):p(`HTTP Error ${b.response.status}: ${b.response.data.message||"An unexpected error occurred. Please try again later."}`)):b.request?(console.error("No response received:",b.request),p("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",b.message),p("An error occurred while setting up the request."))}finally{L(!1)}});H.promise(w,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},success:{render({data:T}){return e(Z,{children:T.map((p,b)=>e("div",{children:p},b))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},error:{render({data:T}){return e(Z,{children:T})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}}})},[f,D,k,m,x]);return t(Re,{open:d,onClose:m,fullWidth:!0,maxWidth:"md",children:[t(Fe,{sx:{display:"flex",alignItems:"center",pb:1},children:[t(o,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(we,{style:{width:24,height:24,color:x.palette.error.main}}),t(o,{children:[e(h,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),t(h,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",f.length," leave request",f.length!==1?"s":""]})]})]}),e(de,{onClick:m,sx:{position:"absolute",top:8,right:16},disabled:F,children:e(Ae,{})})]}),t(Pe,{sx:{py:3},children:[!D&&t(o,{sx:{p:2,mb:3,borderRadius:2,background:x.palette.error.main+"20",border:`1px solid ${x.palette.error.main}40`},children:[t(o,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e(He,{style:{width:20,height:20,color:x.palette.error.main}}),e(h,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),t(h,{variant:"body2",color:"error",children:[W.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),t(h,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e(je,{style:{width:20,height:20}}),"Selected Leave Requests (",f.length,")"]}),e(wt,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${x.palette.divider}`,borderRadius:2,backgroundColor:x.palette.background.paper},children:f.map((w,T)=>{const p=w.status&&w.status.toLowerCase()==="approved";return t(ve.Fragment,{children:[e(bt,{sx:{py:2,opacity:p?.6:1,backgroundColor:p?x.palette.error.main+"10":"transparent"},children:e(xt,{primary:t(o,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e(h,{variant:"subtitle2",children:u(w.user_id)}),e($e,{size:"sm",variant:"flat",color:w.status?.toLowerCase()==="approved"?"success":w.status?.toLowerCase()==="pending"?"warning":w.status?.toLowerCase()==="rejected"?"danger":"default",children:w.status||"Unknown"}),p&&e($e,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:t(o,{children:[t(h,{variant:"body2",color:"text.secondary",children:[w.leave_type," - ",w.from_date," to ",w.to_date]}),t(h,{variant:"body2",color:"text.secondary",children:[w.no_of_days," day",w.no_of_days!==1?"s":""," - ",w.reason]})]})})}),T<f.length-1&&e(vt,{})]},w.id)})}),D&&e(o,{sx:{mt:3,p:2,borderRadius:2,background:x.palette.warning.main+"20",border:`1px solid ${x.palette.warning.main}40`},children:e(h,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"⚠️ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),t(Le,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(ye,{variant:"outlined",onClick:m,disabled:F,sx:{borderRadius:"50px"},children:"Cancel"}),e(ye,{variant:"contained",color:"error",onClick:P,loading:F,disabled:!D||F||f.length===0,startIcon:!F&&e(we,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:F?"Deleting...":`Delete ${f.length} Request${f.length!==1?"s":""}`})]})]})};export{yr as B,fr as D,gr as L,br as a,Ht as b};
