import{j as s,a as i,Q as nr,F as cr,S as dr,b as Ue}from"./app-Dx-HjiV0.js";import{r as a}from"./react-core-DDvupgOx.js";import{G as mr}from"./logo-XpVR0XfY.js";import{G as Te}from"./GlassDialog-CSu7gZxE.js";import{P as hr}from"./PageHeader-CVbskR4q.js";import{S as ur}from"./StatsCards-rWYFLuJV.js";import{F as ne,a as ys,B as y,b as Fe,c as $e,A as pr}from"./App-DzrSbeaT.js";import{a as ce}from"./utilities-DT6SRl8s.js";import{u as gr,a as xs,A as Ge,S as Ns,B as de,T as c,G as br,b as fr,c as Ie,d as we}from"./mui-libraries-DeLqYkpc.js";import{F as me,a as wr}from"./ShieldCheckIcon-C7bFKizx.js";import{F as vr}from"./FunnelIcon-BLg7eNfe.js";import{F as Ss}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as yr}from"./CogIcon-BGTwVSCj.js";import{F as Be}from"./AdjustmentsHorizontalIcon-DKS_UuIh.js";import{F as xr}from"./DocumentArrowDownIcon-Cq-JO3FQ.js";import{b as p,i as M,s as he,l as P,d as ve,e as ye,f as k,g as xe,p as Rs,h as Nr}from"./ui-libraries-CxFzkmxb.js";import{F as Ps}from"./PlusIcon-AKF5lePL.js";import{F as Cs}from"./PencilSquareIcon-CyFSfH55.js";import{F as _s}from"./TrashIcon-D8Us3Tf_.js";import"./EnvelopeIcon-D6nUSkik.js";import"./UserIcon-D16nn9o_.js";const je=d=>Array.isArray(d)?[...d]:[],Ds=d=>d&&typeof d=="object"&&!Array.isArray(d)?{...d}:{},Sr=d=>{const m={roles:je(d.roles),permissions:je(d.permissions),role_has_permissions:je(d.role_has_permissions),permissionsGrouped:Ds(d.permissionsGrouped||d.permissions_grouped),enterprise_modules:Ds(d.enterprise_modules),errors:[]};if(m.roles.length===0&&m.errors.push("No roles data available"),m.permissions.length===0&&m.errors.push("No permissions data available"),m.roles.length>0&&m.permissions.length>0&&m.role_has_permissions.length===0&&m.errors.push("Role-permission relationships missing - this may indicate a cache or database issue"),m.role_has_permissions.length>0){const z=m.roles.map(E=>E.id),ue=m.permissions.map(E=>E.id),x=m.role_has_permissions.filter(E=>!z.includes(E.role_id)||!ue.includes(E.permission_id));x.length>0&&m.errors.push(`${x.length} invalid role-permission relationships found`)}return m},We=(d,m)=>{const[z,ue]=a.useState(d);return a.useEffect(()=>{const x=setTimeout(()=>{ue(d)},m);return()=>{clearTimeout(x)}},[d,m]),z},u={IDLE:"idle",LOADING:"loading",SUCCESS:"success",ERROR:"error"},Rr=d=>{const m=a.useMemo(()=>Sr(d),[d]),z=m.roles,ue=m.permissions,x=m.permissionsGrouped,E=m.role_has_permissions;m.enterprise_modules;const Le=!!d.can_manage_super_admin,As=d.title;d.error;const Ve=m.errors,pe=d.users||[],C=a.useRef(null),Y=a.useRef(Date.now()),qe=gr();xs(qe.breakpoints.down("sm")),xs(qe.breakpoints.down("md"));const[ge,Ms]=a.useState(0),[b,Qe]=a.useState(z),[f,He]=a.useState(ue),[O,Ne]=a.useState(E),[U,ks]=a.useState(z.length>0?z[0].id:null),[S,T]=a.useState(new Set),[g,A]=a.useState(!1),[Z,v]=a.useState({permissions:{},modules:{},roles:u.IDLE,users:u.IDLE}),[Es,Ke]=a.useState(!1),[Fs,Xe]=a.useState(!1),[Pr,Je]=a.useState(!1),[Cr,Ye]=a.useState(!1),[$,Ze]=a.useState(null),[G,es]=a.useState(null),[_r,ss]=a.useState(null),[Dr,rs]=a.useState(null),[Is,ee]=a.useState(!1),[se,as]=a.useState(null),[Se,ts]=a.useState(null),[Re,is]=a.useState(""),[Pe,ls]=a.useState(""),[Ce,os]=a.useState(""),[re,ns]=a.useState("all"),[B,cs]=a.useState("all"),[be,ds]=a.useState("all"),_e=We(Re,300),De=We(Pe,300),Ae=We(Ce,300),[ae,Me]=a.useState(0),[te,ke]=a.useState(0),[ie,Ee]=a.useState(0),[j,Ar]=a.useState(10),[W,Mr]=a.useState(10),[V,kr]=a.useState(10),[ms,w]=a.useState(""),[hs,q]=a.useState(""),[F,le]=a.useState({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0}),[_,Q]=a.useState({name:"",display_name:"",description:"",module:"",guard_name:"web"}),[D,R]=a.useState({}),[Er,us]=a.useState(new Set),[Fr,ps]=a.useState(new Set),[Ir,Lr]=a.useState(!1),n=a.useMemo(()=>b.find(e=>e.id===U)||null,[b,U]),H=a.useCallback(e=>{if(Array.isArray(O)){const r=O.filter(t=>t&&t.role_id===e).map(t=>t.permission_id).filter(Boolean);if(r.length>0)return r}if(Array.isArray(b)){const r=b.find(t=>t&&t.id===e);if(r&&Array.isArray(r.permissions))return r.permissions.map(t=>t.id).filter(Boolean)}return[]},[O,b]);a.useEffect(()=>{if(U){const e=H(U),r=new Set(e);(r.size!==S.size||[...r].some(t=>!S.has(t)))&&T(r)}else S.size>0&&T(new Set)},[U,O,b,H]),a.useMemo(()=>n,[n?.id,n?.name]),a.useMemo(()=>Le,[Le]);const K=a.useMemo(()=>({totalRoles:Array.isArray(b)?b.length:0,totalPermissions:Array.isArray(f)?f.length:0,activeRole:n?.name||"None Selected",grantedPermissions:S.size}),[b,f,n,S]);a.useMemo(()=>[{title:"Total Roles",value:K.totalRoles,icon:s(ne,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:K.totalPermissions,icon:s(me,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Role",value:K.activeRole==="None Selected"?"None":K.activeRole,icon:s(ys,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"Currently selected",customStyle:K.activeRole==="None Selected"?{fontSize:"1rem"}:{}},{title:"Granted",value:K.grantedPermissions,icon:s(vr,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Active permissions"}],[K]);const X=a.useMemo(()=>b.filter(e=>{const r=_e===""||e.name.toLowerCase().includes(_e.toLowerCase())||e.description&&e.description.toLowerCase().includes(_e.toLowerCase()),t=re==="all"||re==="active"&&e.is_active!==!1||re==="inactive"&&e.is_active===!1;return r&&t}),[b,_e,re]),J=a.useMemo(()=>f.filter(e=>{const r=De===""||e.name&&e.name.toLowerCase().includes(De.toLowerCase())||e.display_name&&e.display_name.toLowerCase().includes(De.toLowerCase()),t=B==="all"||e.module===B||e.name&&e.name.startsWith(B);return r&&t}),[f,De,B]),oe=a.useMemo(()=>pe.filter(e=>{const r=Ae===""||e.name?.toLowerCase().includes(Ae.toLowerCase())||e.email?.toLowerCase().includes(Ae.toLowerCase()),t=be==="all"||e.roles&&e.roles.some(l=>l.name===be);return r&&t}),[pe,Ae,be]),Ls=a.useMemo(()=>{const e=ae*j;return X.slice(e,e+j)},[X,ae,j]),zs=a.useMemo(()=>{const e=te*W;return J.slice(e,e+W)},[J,te,W]),Os=a.useMemo(()=>{const e=ie*V;return oe.slice(e,e+V)},[oe,ie,V]),fe=a.useMemo(()=>{const e=new Set;return f.forEach(r=>{r.module?e.add(r.module):r.name&&r.name.includes(".")&&e.add(r.name.split(".")[0])}),Array.from(e).sort()},[f]),Us=a.useMemo(()=>b.map(e=>e.name).sort(),[b]),I=a.useCallback((e,r)=>{if(Array.isArray(O)&&Array.isArray(f)){const t=O.filter(o=>o&&o.role_id===e),l=f.find(o=>o&&o.name===r);if(l&&t.some(o=>o.permission_id===l.id))return!0}if(Array.isArray(b)){const t=b.find(l=>l&&l.id===e);if(t&&Array.isArray(t.permissions))return t.permissions.some(l=>l&&l.name===r)}if(n&&n.id===e&&S.size>0){const t=f.find(l=>l&&l.name===r);if(t)return S.has(t.id)}return!1},[O,f,b,n,S]);a.useCallback(e=>!n||!x[e]?!1:x[e].permissions.every(t=>I(n.id,t.name)),[n,x,I]),a.useCallback(e=>!n||!x[e]?!1:x[e].permissions.some(t=>I(n.id,t.name)),[n,x,I]);const gs=e=>e.name==="Super Administrator"?Le:!0,Ts=a.useCallback(e=>{try{ks(e);const r=H(e);T(new Set(r)),w("")}catch(r){console.error("Error selecting role:",r),w("Failed to select role. Please try again.")}},[H]),$s=a.useCallback(e=>{is(e),Me(0)},[]),Gs=a.useCallback(e=>{ls(e),ke(0)},[]),Bs=a.useCallback(e=>{os(e),Ee(0)},[]),js=a.useCallback(e=>{ns(e),Me(0)},[]),Ws=a.useCallback(e=>{cs(e),ke(0)},[]),Vs=a.useCallback(e=>{ds(e),Ee(0)},[]),bs=a.useCallback((e=null)=>{Ze(e),le({name:e?.name||"",description:e?.description||"",permissions:e?.permissions||[],hierarchy_level:e?.hierarchy_level||10,is_active:e?.is_active??!0}),Ke(!0),R({}),w("")},[]),ze=a.useCallback(()=>{Ke(!1),Ze(null),R({}),w(""),le({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0})},[]),fs=a.useCallback((e=null)=>{es(e),Q({name:e?.name||"",display_name:e?.display_name||"",description:e?.description||"",module:e?.module||fe[0]||"users",guard_name:e?.guard_name||"web"}),Xe(!0),R({}),w("")},[fe]),Oe=a.useCallback(()=>{Xe(!1),es(null),R({}),w(""),Q({name:"",display_name:"",description:"",module:"",guard_name:"web"})},[]);a.useCallback(e=>{ss(e),Je(!0);const r=H(e.id);ps(new Set(r))},[H]),a.useCallback(()=>{Je(!1),ss(null),ps(new Set)},[]);const qs=a.useCallback(e=>{rs(e),Ye(!0);const r=e.roles?new Set(e.roles.map(t=>t.id)):new Set;us(r)},[]);a.useCallback(()=>{Ye(!1),rs(null),us(new Set)},[]);const Qs=a.useCallback(e=>{as(e),ee(!0)},[]),Hs=a.useCallback(e=>{ts(e),ee(!0)},[]),Ks=async()=>{if(se){A(!0);try{await ce.delete(`/api/roles/${se.id}`),y.success("Role deleted successfully"),q("Role deleted successfully"),ee(!1),as(null),Y.current=Date.now()}catch(e){console.error("Error deleting role:",e);const r=e.response?.data?.message||"Failed to delete role";y.error(r),w(r)}finally{A(!1)}}},Xs=async()=>{if(Se){A(!0);try{await ce.delete(`/api/permissions/${Se.id}`),y.success("Permission deleted successfully"),q("Permission deleted successfully"),ee(!1),ts(null),Y.current=Date.now()}catch(e){console.error("Error deleting permission:",e);const r=e.response?.data?.message||"Failed to delete permission";y.error(r),w(r)}finally{A(!1)}}},Js=async()=>{R({}),w("");const e={};if(F.name.trim()||(e.name="Role name is required"),F.name.length>255&&(e.name="Role name must be less than 255 characters"),F.description&&F.description.length>500&&(e.description="Description must be less than 500 characters"),Object.keys(e).length>0){R(e);return}A(!0),v(r=>({...r,roles:u.LOADING}));try{const r=$?`/api/roles/${$.id}`:"/api/roles",l=await ce[$?"put":"post"](r,F);(l.status===200||l.status===201)&&($?(Qe(o=>o.map(h=>h.id===$.id?l.data.role:h)),y.success("Role updated successfully"),q("Role updated successfully")):(Qe(o=>[...o,l.data.role]),y.success("Role created successfully"),q("Role created successfully")),ze(),v(o=>({...o,roles:u.SUCCESS})),setTimeout(()=>{v(o=>({...o,roles:u.IDLE})),q("")},3e3),Y.current=Date.now())}catch(r){if(console.error("Error saving role:",r),v(t=>({...t,roles:u.ERROR})),r.response?.status===422&&r.response.data.errors)R(r.response.data.errors);else{const t=r.response?.data?.message||"Failed to save role";y.error(t),w(t)}setTimeout(()=>{v(t=>({...t,roles:u.IDLE}))},3e3)}finally{A(!1)}},Ys=async()=>{R({}),w("");const e={};if(_.name.trim()||(e.name="Permission name is required"),_.display_name.trim()||(e.display_name="Display name is required"),_.module.trim()||(e.module="Module is required"),Object.keys(e).length>0){R(e);return}A(!0);try{const r=G?`/api/permissions/${G.id}`:"/api/permissions",l=await ce[G?"put":"post"](r,_);(l.status===200||l.status===201)&&(G?(He(o=>o.map(h=>h.id===G.id?l.data.permission:h)),y.success("Permission updated successfully")):(He(o=>[...o,l.data.permission]),y.success("Permission created successfully")),Oe(),Y.current=Date.now())}catch(r){if(console.error("Error saving permission:",r),r.response?.status===422&&r.response.data.errors)R(r.response.data.errors);else{const t=r.response?.data?.message||"Failed to save permission";y.error(t),w(t)}}finally{A(!1)}},Zs=a.useCallback(async e=>{if(!(!n||g)){C.current&&C.current.abort(),C.current=new AbortController,v(r=>({...r,permissions:{...r.permissions,[e]:u.LOADING}}));try{const r=I(n.id,e),t=r?"revoke":"grant",l=await ce.post("/admin/roles/update-permission",{role_id:n.id,permission:e,action:t},{signal:C.current.signal});if(l.status===200){if(l.data.role_has_permissions){Ne(l.data.role_has_permissions);const o=l.data.role_has_permissions.filter(h=>h.role_id===n.id).map(h=>h.permission_id);T(new Set(o))}else{const o=f.find(h=>h.name===e);o&&(r?(Ne(h=>h.filter(L=>!(L.role_id===n.id&&L.permission_id===o.id))),T(h=>{const L=new Set(h);return L.delete(o.id),L})):(Ne(h=>[...h,{role_id:n.id,permission_id:o.id}]),T(h=>new Set([...h,o.id]))))}v(o=>({...o,permissions:{...o.permissions,[e]:u.SUCCESS}})),setTimeout(()=>{v(o=>({...o,permissions:{...o.permissions,[e]:u.IDLE}}))},2e3),y.success(`Permission ${t}ed successfully`),Y.current=Date.now()}}catch(r){r.name!=="AbortError"&&(console.error("Error updating permission:",r),v(t=>({...t,permissions:{...t.permissions,[e]:u.ERROR}})),setTimeout(()=>{v(t=>({...t,permissions:{...t.permissions,[e]:u.IDLE}}))},3e3),y.error(r.response?.data?.message||"Failed to update permission"),w(r.response?.data?.message||"Failed to update permission"))}finally{A(!1)}}},[n,g,I,f]),er=a.useCallback(async e=>{if(!(!n||g)){C.current&&C.current.abort(),C.current=new AbortController,v(r=>({...r,modules:{...r.modules,[e]:u.LOADING}}));try{const r=await ce.post("/admin/roles/update-module",{roleId:n.id,module:e,action:"toggle"},{signal:C.current.signal});if(r.status===200){Ne(r.data.role_has_permissions);const t=r.data.role_has_permissions.filter(l=>l.role_id===n.id).map(l=>l.permission_id);T(new Set(t)),v(l=>({...l,modules:{...l.modules,[e]:u.SUCCESS}})),setTimeout(()=>{v(l=>({...l,modules:{...l.modules,[e]:u.IDLE}}))},2e3),y.success("Module permissions updated successfully"),Y.current=Date.now()}}catch(r){r.name!=="AbortError"&&(console.error("Error updating module permissions:",r),v(t=>({...t,modules:{...t.modules,[e]:u.ERROR}})),setTimeout(()=>{v(t=>({...t,modules:{...t.modules,[e]:u.IDLE}}))},3e3),y.error(r.response?.data?.message||"Failed to update module permissions"),w(r.response?.data?.message||"Failed to update module permissions"))}}},[n,g]);a.useCallback((e,r)=>{le(t=>({...t,[e]:r})),D[e]&&R(t=>({...t,[e]:void 0}))},[D]),a.useEffect(()=>()=>{C.current&&C.current.abort()},[]),a.useEffect(()=>{const e=r=>{if(r.key==="/"&&!r.ctrlKey&&!r.metaKey&&!r.altKey){const t=r.target;if(t.tagName!=="INPUT"&&t.tagName!=="TEXTAREA"&&!t.isContentEditable){r.preventDefault();const l=document.querySelector('input[placeholder*="Search"]');l&&l.focus()}}if(r.key==="Escape"&&(Re||Pe||Ce||B!=="all")&&(is(""),ls(""),os(""),cs("all"),ns("all"),ds("all")),(r.ctrlKey||r.metaKey)&&r.key==="k"){r.preventDefault();const t=document.querySelector('input[placeholder*="Search"]');t&&t.focus()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[Re,Pe,Ce,B,re,be]);const sr=a.useCallback(e=>Z.permissions[e]||u.IDLE,[Z.permissions]),rr=a.useCallback(e=>Z.modules[e]||u.IDLE,[Z.modules]),ar=()=>i(xe,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[i(ve,{className:"p-4 border-b border-white/10",children:[i("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[i(c,{variant:"h6",className:"flex items-center gap-2",children:[s(ne,{className:"w-5 h-5"}),"Roles Management"]}),s(p,{onPress:()=>bs(),startContent:s(Ps,{className:"w-4 h-4"}),className:"bg-gradient-to-r from-blue-500/20 to-purple-500/20 hover:from-blue-500/30 hover:to-purple-500/30 border border-blue-400/30 text-white",variant:"bordered",children:"Add Role"})]}),i("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(M,{label:"Search Roles",variant:"bordered",placeholder:"Search by role name...",value:Re,onValueChange:$s,startContent:s($e,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),i(he,{label:"Status Filter",variant:"bordered",selectedKeys:[re],onSelectionChange:e=>js(Array.from(e)[0]),className:"min-w-[140px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(P,{value:"all",children:"All Status"},"all"),s(P,{value:"active",children:"Active"},"active"),s(P,{value:"inactive",children:"Inactive"},"inactive")]})]})]}),i(ye,{className:"p-0",children:[s("div",{className:"divide-y divide-white/10",children:Ls.map(e=>{const r=H(e.id),t=r.map(l=>f.find(o=>o.id===l)?.name).filter(Boolean).slice(0,3);return s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:i("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[i("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-bold",children:e.name.charAt(0).toUpperCase()}),i("div",{children:[i("div",{className:"flex items-center gap-2",children:[s(c,{variant:"body1",className:"font-medium",children:e.name}),e.name==="Super Administrator"&&s(k,{size:"sm",color:"warning",variant:"flat",children:"System"}),s(k,{size:"sm",color:e.is_active!==!1?"success":"default",variant:"flat",children:e.is_active!==!1?"Active":"Inactive"})]}),e.description&&s(c,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.description}),i("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.map((l,o)=>s(k,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:l},o)),r.length>3&&i(k,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",r.length-3," more"]})]})]})]}),i("div",{className:"flex gap-2",children:[s(we,{content:"Edit Role",children:s(p,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>bs(e),isDisabled:!gs(e),className:"text-blue-400 hover:text-blue-300",children:s(Cs,{className:"w-4 h-4"})})}),s(we,{content:"Delete Role",children:s(p,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Qs(e),isDisabled:!gs(e),className:"text-red-400 hover:text-red-300",children:s(_s,{className:"w-4 h-4"})})})]})]})},e.id)})}),X.length===0&&i("div",{className:"text-center py-12",children:[s(ne,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(c,{variant:"body1",color:"textSecondary",children:"No roles found matching your criteria"})]}),X.length>j&&i("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[i(c,{variant:"body2",color:"textSecondary",children:["Showing ",ae*j+1," to ",Math.min((ae+1)*j,X.length)," of ",X.length," roles"]}),i("div",{className:"flex gap-2",children:[s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:ae===0,onPress:()=>Me(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(ae+1)*j>=X.length,onPress:()=>Me(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),tr=()=>i(xe,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[i(ve,{className:"p-4 border-b border-white/10",children:[i("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:[i(c,{variant:"h6",className:"flex items-center gap-2",children:[s(me,{className:"w-5 h-5"}),"Permissions Management"]}),s(p,{onPress:()=>fs(),startContent:s(Ps,{className:"w-4 h-4"}),className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30 border border-green-400/30 text-white",variant:"bordered",children:"Add Permission"})]}),i("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(M,{label:"Search Permissions",variant:"bordered",placeholder:"Search by permission name...",value:Pe,onValueChange:Gs,startContent:s($e,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),i(he,{label:"Module Filter",variant:"bordered",selectedKeys:[B],onSelectionChange:e=>Ws(Array.from(e)[0]),className:"min-w-[180px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(P,{value:"all",children:"All Modules"},"all"),fe.map(e=>s(P,{value:e,children:e},e))]})]})]}),i(ye,{className:"p-0",children:[s("div",{className:"divide-y divide-white/10",children:zs.map(e=>s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:i("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[i("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center text-white font-bold",children:e.name?e.name.charAt(0).toUpperCase():"P"}),i("div",{children:[i("div",{className:"flex items-center gap-2",children:[s(c,{variant:"body1",className:"font-medium",children:e.display_name||e.name}),s(k,{size:"sm",color:"secondary",variant:"flat",children:e.module||(e.name?e.name.split(".")[0]:"General")})]}),s(c,{variant:"body2",color:"textSecondary",className:"mt-1",children:e.name}),e.description&&s(c,{variant:"body2",color:"textSecondary",className:"mt-1 max-w-md",children:e.description})]})]}),i("div",{className:"flex gap-2",children:[s(we,{content:"Edit Permission",children:s(p,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>fs(e),className:"text-blue-400 hover:text-blue-300",children:s(Cs,{className:"w-4 h-4"})})}),s(we,{content:"Delete Permission",children:s(p,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>Hs(e),className:"text-red-400 hover:text-red-300",children:s(_s,{className:"w-4 h-4"})})})]})]})},e.id))}),J.length===0&&i("div",{className:"text-center py-12",children:[s(me,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(c,{variant:"body1",color:"textSecondary",children:"No permissions found matching your criteria"})]}),J.length>W&&i("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[i(c,{variant:"body2",color:"textSecondary",children:["Showing ",te*W+1," to ",Math.min((te+1)*W,J.length)," of ",J.length," permissions"]}),i("div",{className:"flex gap-2",children:[s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:te===0,onPress:()=>ke(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(te+1)*W>=J.length,onPress:()=>ke(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),ir=()=>i(xe,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[s(ve,{className:"p-4 border-b border-white/10",children:i("div",{className:"flex flex-col gap-4 w-full",children:[i(c,{variant:"h6",className:"flex items-center gap-2",children:[s(Be,{className:"w-5 h-5"}),"Role-Permission Assignment"]}),s(he,{label:"Select Role to Manage",variant:"bordered",selectedKeys:U?[U.toString()]:[],onSelectionChange:e=>{const r=Array.from(e)[0];r&&Ts(parseInt(r))},className:"max-w-md",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:b.map(e=>s(P,{value:e.id.toString(),children:e.name},e.id.toString()))})]})}),s(ye,{className:"p-4",children:n?i("div",{className:"space-y-6",children:[i("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[i("div",{children:[i(c,{variant:"body1",className:"font-medium",children:["Managing permissions for: ",n.name]}),i(c,{variant:"body2",color:"textSecondary",children:[S.size," of ",f.length," permissions granted"]})]}),s(Rs,{value:S.size/f.length*100,size:"sm",color:"primary",className:"w-32","aria-label":`${Math.round(S.size/f.length*100)}% permissions granted`})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(x).map(([e,r])=>{const t=r.permissions||[],l=t.filter(N=>I(n.id,N.name)).length,o=t.length,h=l===o,L=l>0&&l<o;return i(xe,{className:"bg-white/5 border-white/10",children:[i(ve,{className:"pb-2",children:[i("div",{className:"flex items-center justify-between w-full",children:[s(c,{variant:"body1",className:"font-medium capitalize",children:e}),i("div",{className:"flex items-center gap-2",children:[i(k,{size:"sm",variant:"flat",color:h?"success":L?"warning":"default",children:[l,"/",o]}),s(p,{size:"sm",variant:"light",onPress:()=>er(e),isLoading:rr(e)===u.LOADING,className:"text-xs",children:h?"Revoke All":"Grant All"})]})]}),s(Rs,{value:l/o*100,size:"sm",color:h?"success":L?"warning":"default","aria-label":`${l} of ${o} permissions granted for ${e} module`})]}),s(ye,{className:"pt-0",children:s("div",{className:"space-y-2",children:t.map(N=>{const ws=I(n.id,N.name),vs=sr(N.name);return i("div",{className:"flex items-center justify-between p-2 rounded bg-white/5 hover:bg-white/10 transition-colors",children:[i("div",{children:[s(c,{variant:"body2",className:"font-medium",children:N.display_name||N.name}),s(c,{variant:"caption",color:"textSecondary",children:N.name})]}),s(Nr,{size:"sm",isSelected:ws,onValueChange:()=>Zs(N.name),isDisabled:vs===u.LOADING,color:"success","aria-label":`Toggle ${N.display_name||N.name} permission`},`${N.id}-${ws}-${vs}`)]},N.id)})})})]},e)})})]}):i("div",{className:"text-center py-12",children:[s(Be,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(c,{variant:"body1",color:"textSecondary",className:"mb-2",children:"Select a role to manage permissions"}),s(c,{variant:"body2",color:"textSecondary",children:"Choose a role from the dropdown above to assign or revoke permissions"})]})})]}),lr=()=>i(xe,{className:"bg-white/10 backdrop-blur-md border-white/20 mt-4",children:[i(ve,{className:"p-4 border-b border-white/10",children:[s("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full",children:i(c,{variant:"h6",className:"flex items-center gap-2",children:[s(Fe,{className:"w-5 h-5"}),"User-Role Assignment"]})}),i("div",{className:"flex flex-col sm:flex-row gap-4 mt-4",children:[s(M,{label:"Search Users",variant:"bordered",placeholder:"Search by user name or email...",value:Ce,onValueChange:Bs,startContent:s($e,{className:"w-4 h-4"}),className:"flex-1",classNames:{input:"bg-transparent text-white",inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70"}}),i(he,{label:"Filter by Role",variant:"bordered",selectedKeys:[be],onSelectionChange:e=>Vs(Array.from(e)[0]),className:"min-w-[160px]",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15",label:"text-white/70",value:"text-white"},children:[s(P,{value:"all",children:"All Roles"},"all"),Us.map(e=>s(P,{value:e,children:e},e))]})]})]}),i(ye,{className:"p-0",children:[pe&&pe.length>0?s("div",{className:"divide-y divide-white/10",children:Os.map(e=>s("div",{className:"p-4 hover:bg-white/5 transition-colors",children:i("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[i("div",{className:"flex items-center gap-3",children:[s("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center text-white font-bold",children:e.name?.charAt(0).toUpperCase()||"U"}),i("div",{children:[s(c,{variant:"body1",className:"font-medium",children:e.name||"Unknown User"}),s(c,{variant:"body2",color:"textSecondary",children:e.email||"No email"}),s("div",{className:"flex flex-wrap gap-1 mt-2",children:e.roles&&e.roles.length>0?i(Ue,{children:[e.roles.slice(0,3).map((r,t)=>s(k,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:r.name},t)),e.roles.length>3&&i(k,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",e.roles.length-3," more"]})]}):s(k,{size:"sm",variant:"flat",color:"default",className:"text-xs",children:"No roles assigned"})})]})]}),s("div",{className:"flex gap-2",children:s(we,{content:"Assign Roles",children:s(p,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>qs(e),className:"text-orange-400 hover:text-orange-300",children:s(ys,{className:"w-4 h-4"})})})})]})},e.id))}):i("div",{className:"text-center py-12",children:[s(Fe,{className:"w-16 h-16 text-white/30 mx-auto mb-4"}),s(c,{variant:"body1",children:"No users found"}),s(c,{variant:"body2",children:"Users data is not available. Please ensure users are loaded from the backend."})]}),oe.length>V&&i("div",{className:"flex justify-between items-center p-4 border-t border-white/10",children:[i(c,{variant:"body2",children:["Showing ",ie*V+1," to ",Math.min((ie+1)*V,oe.length)," of ",oe.length," users"]}),i("div",{className:"flex gap-2",children:[s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:ie===0,onPress:()=>Ee(e=>Math.max(0,e-1)),className:"text-white",children:"‹"}),s(p,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:(ie+1)*V>=oe.length,onPress:()=>Ee(e=>e+1),className:"text-white",children:"›"})]})]})]})]}),or=()=>i(Ue,{children:[i(Te,{open:Es,onClose:g?void 0:ze,maxWidth:"md",title:i("div",{className:"flex items-center gap-2",children:[s(ne,{className:"w-6 h-6"}),$?"Edit Role":"Create New Role",Z.roles===u.LOADING&&s("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),actions:i("div",{className:"flex gap-3",children:[s(p,{variant:"light",onPress:ze,isDisabled:g,children:"Cancel"}),s(p,{color:"primary",onPress:Js,isLoading:g,children:$?"Update Role":"Create Role"})]}),children:[Z.roles===u.ERROR&&s("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:s("p",{className:"text-danger text-sm",children:"Failed to save role. Please check the form and try again."})}),i("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s("div",{className:"col-span-1",children:s(M,{label:"Role Name",placeholder:"Enter role name",value:F.name,onValueChange:e=>le(r=>({...r,name:e})),isInvalid:!!D.name,errorMessage:D.name,description:"Unique identifier for the role",isRequired:!0,isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:i(he,{label:"Guard Name",placeholder:"Select guard",selectedKeys:[F.guard_name],onSelectionChange:e=>{const r=Array.from(e)[0];le(t=>({...t,guard_name:r}))},isDisabled:g,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:[s(P,{value:"web",children:"Web"},"web"),s(P,{value:"api",children:"API"},"api")]})}),s("div",{className:"col-span-2",children:s(M,{label:"Description",placeholder:"Optional description of role responsibilities",value:F.description,onValueChange:e=>le(r=>({...r,description:e})),isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70"}})})]})]}),s(Te,{open:Fs,onClose:g?void 0:Oe,maxWidth:"md",title:i("div",{className:"flex items-center gap-2",children:[s(me,{className:"w-6 h-6"}),G?"Edit Permission":"Create New Permission"]}),actions:i("div",{className:"flex gap-3",children:[s(p,{variant:"light",onPress:Oe,isDisabled:g,children:"Cancel"}),s(p,{color:"success",onPress:Ys,isLoading:g,children:G?"Update Permission":"Create Permission"})]}),children:i("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[s("div",{className:"col-span-1",children:s(M,{label:"Permission Name",placeholder:"e.g., users.create",value:_.name,onValueChange:e=>Q(r=>({...r,name:e})),isInvalid:!!D.name,errorMessage:D.name,description:"Use format: module.action (e.g., users.create)",isRequired:!0,isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:s(M,{label:"Display Name",placeholder:"Human-readable name",value:_.display_name,onValueChange:e=>Q(r=>({...r,display_name:e})),isInvalid:!!D.display_name,errorMessage:D.display_name,description:"Human-readable name",isRequired:!0,isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-1",children:s(he,{label:"Module",placeholder:"Select module",selectedKeys:_.module?[_.module]:[],onSelectionChange:e=>{const r=Array.from(e)[0];Q(t=>({...t,module:r}))},isInvalid:!!D.module,errorMessage:D.module,isDisabled:g,variant:"bordered",classNames:{trigger:"border-white/20 bg-white/5 hover:border-white/30 data-[open]:border-primary/50",value:"text-white",label:"text-white/70",popoverContent:"bg-black/80 backdrop-blur-xl border border-white/20"},children:fe.map(e=>s(P,{value:e,children:e},e))})}),s("div",{className:"col-span-1",children:s(M,{label:"Guard Name",placeholder:"Usually 'web'",value:_.guard_name,onValueChange:e=>Q(r=>({...r,guard_name:e})),description:"Usually 'web' for web permissions",isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})}),s("div",{className:"col-span-2",children:s(M,{label:"Description",placeholder:"Optional description of what this permission allows",value:_.description,onValueChange:e=>Q(r=>({...r,description:e})),description:"Optional description of what this permission allows",isDisabled:g,variant:"bordered",classNames:{input:"text-white placeholder:text-white/50",inputWrapper:"border-white/20 bg-white/5 hover:border-white/30 focus-within:border-primary/50",label:"text-white/70",description:"text-white/50"}})})]})}),s(Te,{open:Is,onClose:()=>ee(!1),maxWidth:"sm",title:i("div",{className:"flex items-center gap-2",children:[s(Ss,{className:"w-6 h-6 text-danger"}),"Confirm Delete"]}),actions:i("div",{className:"flex gap-3",children:[s(p,{variant:"light",onPress:()=>ee(!1),children:"Cancel"}),i(p,{color:"danger",onPress:se?Ks:Xs,isLoading:g,children:["Delete ",se?"Role":"Permission"]})]}),children:i("p",{className:"text-white/90",children:["Are you sure you want to delete ",se?`the role "${se.name}"`:Se?`the permission "${Se.name}"`:"this item","? This action cannot be undone."]})})]});return i(Ue,{children:[s(nr,{title:As}),s(Ns,{open:!!hs,autoHideDuration:3e3,onClose:()=>q(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s(Ge,{severity:"success",variant:"filled",onClose:()=>q(""),children:hs})}),s(Ns,{open:!!ms,autoHideDuration:5e3,onClose:()=>w(""),anchorOrigin:{vertical:"top",horizontal:"right"},children:s(Ge,{severity:"error",variant:"filled",onClose:()=>w(""),children:ms})}),Ve.length>0&&s(de,{sx:{mb:2},children:s(Ge,{severity:"warning",variant:"outlined",icon:s(Ss,{className:"w-5 h-5"}),action:s(p,{color:"warning",size:"small",onClick:()=>{dr.reload({only:["roles","permissions","users"]})},startContent:s(cr,{className:"w-4 h-4"}),children:"Refresh Data"}),children:i(de,{children:[s(c,{variant:"subtitle2",sx:{mb:1},children:"Data Integrity Issues Detected"}),s(de,{component:"ul",sx:{m:0,pl:2},children:Ve.map((e,r)=>s(c,{component:"li",variant:"body2",sx:{mb:.5},children:e},r))}),s(c,{variant:"body2",sx:{mt:1,fontStyle:"italic"},children:"This may indicate a cache or database synchronization issue on the server."})]})})}),s(de,{sx:{display:"flex",justifyContent:"center",p:2},children:s(br,{in:!0,children:s(mr,{children:s(hr,{title:"Role & Permission Management",subtitle:"Comprehensive access control and permission management system",icon:s(wr,{className:"w-8 h-8"}),variant:"default",actionButtons:[{label:"Export Data",icon:s(xr,{className:"w-4 h-4"}),variant:"bordered",className:"border-[rgba(var(--theme-success-rgb),0.3)] bg-[rgba(var(--theme-success-rgb),0.05)] hover:bg-[rgba(var(--theme-success-rgb),0.1)]"}],children:i("div",{className:"p-6",children:[s(ur,{stats:[{title:"Total Roles",value:b.length,icon:s(ne,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:f.length,icon:s(me,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Users",value:pe.length,icon:s(Fe,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"System users"},{title:"Modules",value:fe.length,icon:s(yr,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Permission modules"}]}),i(de,{sx:{width:"100%",mt:4},children:[s(de,{sx:{borderBottom:1,borderColor:"divider"},children:i(fr,{value:ge,onChange:(e,r)=>Ms(r),"aria-label":"role management tabs",sx:{"& .MuiTab-root":{color:"rgba(255, 255, 255, 0.7)","&.Mui-selected":{color:"#3b82f6"}},"& .MuiTabs-indicator":{backgroundColor:"#3b82f6"}},children:[s(Ie,{label:"Roles Management",icon:s(ne,{className:"w-5 h-5"}),iconPosition:"start"}),s(Ie,{label:"Permissions Management",icon:s(me,{className:"w-5 h-5"}),iconPosition:"start"}),s(Ie,{label:"Role-Permission Assignment",icon:s(Be,{className:"w-5 h-5"}),iconPosition:"start"}),s(Ie,{label:"User-Role Assignment",icon:s(Fe,{className:"w-5 h-5"}),iconPosition:"start"})]})}),ge===0&&s(ar,{}),ge===1&&s(tr,{}),ge===2&&s(ir,{}),ge===3&&s(lr,{})]})]})})})})}),or()]})};Rr.layout=d=>s(pr,{children:d});export{Rr as default};
