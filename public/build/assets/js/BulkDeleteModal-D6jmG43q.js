import{J as He,a as r,j as e,b as Z}from"./app-BkZgXEhy.js";import{r as o,R as xe}from"./react-core-DDvupgOx.js";import{B as j,d as le,g as Ce,e as We,s as lt,k as it,t as dt}from"./App-Dsw2bXHq.js";import{a as he}from"./utilities-DT6SRl8s.js";import{G as st}from"./logo-oqc8HE7F.js";import{u as me,a as Ee,a2 as oe,o as de,B as n,d as ct,T as c,a1 as ut,e as ke,p as $e,h as K,j as Se,I as _e,k as De,M as ie,m as Te,i as pe,a6 as nt,q as Fe,r as Pe,f as ye,a5 as pt,s as ze,l as ne,C as Ue,$ as Oe,a3 as ht,a4 as mt,a9 as gt,aa as ft,t as yt,ab as bt}from"./mui-libraries-DfWBtzq_.js";import{F as ve}from"./TrashIcon-D8Us3Tf_.js";import{F as Ve}from"./PencilIcon-Dhfhztfv.js";import{F as Ge}from"./EllipsisVerticalIcon-BX6PWMxg.js";import{F as xt}from"./XCircleIcon-StDWd-mv.js";import{F as vt}from"./CheckCircleIcon-DnGOlVla.js";import{F as wt}from"./ClockIcon-DNQ3nlJB.js";import{F as Ct}from"./ExclamationTriangleIcon-CsS6HvBt.js";import{F as Me}from"./UserIcon-D16nn9o_.js";import{b as Be,v as ue,t as Je,Q as Qe,N as Ke,O as Ze,P as qe,L as Xe,J as et,G as tt,k as kt,m as St,n as _t,o as Dt,q as Tt,f as Ne,j as rt}from"./ui-libraries-D1L3zk6d.js";import{C as je}from"./Clear-IjhGGvWW.js";import{G as Le}from"./GlassDialog-m5EJHN8d.js";import{L as fe}from"./LoadingButton-DMq9soVC.js";import{F as at}from"./InformationCircleIcon-BNRxDcw3.js";import{F as Nt}from"./XCircleIcon-DJR5_Dv7.js";import{F as Ae}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as Ye}from"./CheckCircleIcon-CJUGb5Jf.js";function $t({title:g,titleId:C,...$},v){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":C},$),g?o.createElement("title",{id:C},g):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Ft=o.forwardRef($t);function Pt({title:g,titleId:C,...$},v){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:v,"aria-labelledby":C},$),g?o.createElement("title",{id:C},g):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"}))}const Lt=o.forwardRef(Pt),Rt=xe.forwardRef(({leaves:g,allUsers:C,handleClickOpen:$,setCurrentLeave:v,openModal:x,setLeaves:w,setCurrentPage:F,currentPage:E,totalRows:h,lastPage:f,perPage:u,selectedMonth:I,employee:_,isAdminView:P=!1,onBulkApprove:y,onBulkReject:T,onBulkDelete:p,canApproveLeaves:m=!1,canEditLeaves:R=!1,canDeleteLeaves:z=!1,fetchLeavesStats:U},G)=>{const{auth:te}=He().props,L=me(),V=Ee("(min-width: 1025px)"),re=Ee("(min-width: 641px) and (max-width: 1024px)"),X=Ee("(max-width: 640px)"),[ce,A]=o.useState(!1),[i,b]=o.useState(null),[k,M]=o.useState(new Set);xe.useMemo(()=>Array.from(k).join(", ").replaceAll("_"," "),[k]);const Y=xe.useMemo(()=>{const t=k==="all",s=t||k.size>0,l=t?g.length:k.size;return r("div",{className:"flex flex-col gap-4",children:[e("div",{className:"flex justify-between gap-3 items-end",children:e("div",{className:"flex gap-3",children:s&&p&&r(Be,{color:"danger",variant:"flat",startContent:e(ve,{className:"w-4 h-4"}),onPress:()=>{const N=t?g:g.filter(D=>k.has(D.id.toString()));p(N)},children:["Delete ",l," selected"]})})}),s&&r("span",{className:"text-default-400 text-small",children:[l," of ",g.length," selected"]})]})},[k,g,p]);te.permissions?.includes("leaves.view"),te.permissions?.includes("leave.own.view");const W={New:{color:"primary",icon:Ct,bgColor:oe(L.palette.primary.main,.1),textColor:L.palette.primary.main},Pending:{color:"warning",icon:wt,bgColor:oe(L.palette.warning.main,.1),textColor:L.palette.warning.main},Approved:{color:"success",icon:vt,bgColor:oe(L.palette.success.main,.1),textColor:L.palette.success.main},Declined:{color:"danger",icon:xt,bgColor:oe(L.palette.error.main,.1),textColor:L.palette.error.main}},B=t=>{switch(t?.toLowerCase()){case"casual":return e(it,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(lt,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(Lt,{className:"w-3 h-3 text-red-500"});case"earned":return e(We,{className:"w-3 h-3 text-green-500"});default:return e(Ce,{className:"w-3 h-3 text-primary"})}},S=o.useCallback(t=>{F&&F(t)},[F]),H=o.useCallback(async(t,s)=>{if(t.status===s)return j.info(`Leave is already ${s}.`),Promise.resolve(`The leave status is already updated to ${s}`);const l=`${t.id}-${s}`;if(i===l)return;b(l);const N=new Promise(async(D,ee)=>{try{const ae=await he.post(route("leave-update-status"),{id:t.id,status:s});ae.status===200?(w(ge=>ge.map(be=>be.id===t.id?{...be,status:s}:be)),U(),D(ae.data.message||"Leave status updated successfully")):ee(ae.data?.message||"Failed to update leave status")}catch(ae){const ge=ae.response?.data?.message||ae.response?.statusText||"Failed to update leave status";ee(ge)}finally{b(null)}});return j.promise(N,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),N},[w,i,U]),O=t=>{const s=W[t]||W.New,l=s.icon;return e(Ne,{size:"sm",variant:"flat",color:s.color,startContent:e(l,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:t})},J=(t,s)=>{const l=new Date(t),N=new Date(s),D=Math.abs(N-l),ee=Math.ceil(D/(1e3*60*60*24))+1;return ee===1?"1 day":`${ee} days`},Q=t=>new Date(t).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),q=t=>C?.find(s=>String(s.id)===String(t))||{name:"Unknown User",phone:""},we=({leave:t,updatingLeave:s,setCurrentLeave:l,openModal:N,handleClickOpen:D,updateLeaveStatus:ee,canEditLeaves:ae,canDeleteLeaves:ge,canApproveLeaves:be,isAdminView:Re})=>{const Ie=q(t.user_id),ot=J(t.from_date,t.to_date);return W[t.status]||W.New,console.log(Re?"Admin View":"User View"),e(st,{className:"mb-2",shadow:"sm",children:r(ke,{className:"p-3",children:[r(n,{className:"flex items-start justify-between mb-3",children:[e(n,{className:"flex items-center gap-3 flex-1",children:Re&&e(Xe,{avatarProps:{radius:"lg",size:"sm",src:Ie?.profile_image,fallback:e(Me,{className:"w-4 h-4"})},name:e(c,{variant:"body2",fontWeight:"medium",children:Ie?.name}),description:e(c,{variant:"caption",color:"textSecondary",children:Ie?.phone})})}),r(n,{className:"flex items-center gap-2",children:[O(t.status),(ae||ge)&&r(Qe,{children:[e(Ke,{children:e(de,{size:"small",children:e(Ge,{className:"w-4 h-4"})})}),r(Ze,{"aria-label":"Leave actions",children:[ae&&e(qe,{startContent:e(Ve,{className:"w-4 h-4"}),onPress:()=>{l(t),N("edit_leave")},children:"Edit Leave"},"edit"),ge&&e(qe,{className:"text-danger",color:"danger",startContent:e(ve,{className:"w-4 h-4"}),onPress:()=>D(t.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(rt,{className:"my-3"}),r(ut,{spacing:2,children:[r(n,{className:"flex items-center gap-2",children:[e(Ce,{className:"w-4 h-4 text-primary"}),e(c,{variant:"body2",fontWeight:"medium",children:t.leave_type})]}),r(n,{className:"flex items-center gap-2",children:[e(le,{className:"w-4 h-4 text-default-500"}),r(c,{variant:"body2",color:"textSecondary",children:[Q(t.from_date)," - ",Q(t.to_date)]}),e(Ne,{size:"sm",variant:"bordered",color:"default",children:ot})]}),t.reason&&r(n,{className:"flex items-start gap-2",children:[e(We,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(c,{variant:"body2",color:"textSecondary",className:"flex-1",children:t.reason})]})]}),Re&&be&&r(Z,{children:[e(rt,{className:"my-3"}),e(n,{className:"flex gap-2",children:["Approved","Declined"].map(se=>e(Be,{size:"sm",variant:t.status===se?"solid":"bordered",color:W[se].color,isLoading:s===`${t.id}-${se}`,onPress:()=>{s!==`${t.id}-${se}`&&ee(t,se)},startContent:s!==`${t.id}-${se}`?xe.createElement(W[se].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:se},se))})]})]})})},a=o.useCallback((t,s)=>{const l=q(t.user_id);switch(s){case"employee":return e(ue,{className:"whitespace-nowrap",children:e(Xe,{avatarProps:{radius:"lg",size:"sm",src:l?.profile_image,fallback:e(Me,{className:"w-4 h-4"})},description:e(c,{variant:"caption",className:"text-xs",children:l?.phone}),name:e(c,{variant:"body2",className:"text-sm font-medium",children:l?.name})})});case"leave_type":return e(ue,{children:r(n,{className:"flex items-center gap-1",children:[B(t.leave_type),e(c,{variant:"body2",className:"text-sm font-medium capitalize",children:t.leave_type})]})});case"from_date":case"to_date":return e(ue,{children:r(n,{className:"flex items-center gap-1",children:[e(le,{className:"w-3 h-3 text-default-500"}),r(n,{children:[e(c,{variant:"body2",className:"text-sm",children:Q(t[s])}),s==="from_date"&&e(c,{variant:"caption",className:"text-xs",color:"textSecondary",children:J(t.from_date,t.to_date)})]})]})});case"status":return e(ue,{children:r(n,{className:"flex items-center gap-2",children:[O(t.status),P&&m&&r(Qe,{children:[e(Ke,{children:e(Be,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:i&&i.startsWith(`${t.id}-`),children:e(Ge,{className:"w-4 h-4"})})}),e(Ze,{"aria-label":"Status actions",onAction:N=>H(t,N),children:Object.keys(W).map(N=>{const D=W[N],ee=D.icon;return e(qe,{startContent:e(ee,{className:"w-4 h-4"}),color:D.color,children:N},N)})})]})]})});case"reason":return e(ue,{children:e(ct,{title:t.reason||"No reason provided",children:e(c,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:t.reason||"No reason provided"})})});case"actions":return e(ue,{children:r(n,{className:"flex items-center gap-1",children:[R&&e(Je,{content:"Edit Leave",children:e(de,{size:"small",onClick:()=>{i&&i.startsWith(`${t.id}-`)||(v(t),x("edit_leave"))},sx:{background:oe(L.palette.primary.main,.1),"&:hover":{background:oe(L.palette.primary.main,.2)}},children:e(Ve,{className:"w-4 h-4"})})}),z&&e(Je,{content:"Delete Leave",color:"danger",children:e(de,{size:"small",onClick:()=>{i&&i.startsWith(`${t.id}-`)||(v(t),$(t.id,"delete_leave"))},sx:{background:oe(L.palette.error.main,.1),"&:hover":{background:oe(L.palette.error.main,.2)}},children:e(ve,{className:"w-4 h-4"})})})]})});default:return e(ue,{children:t[s]})}},[P,m,V,i,L,v,x,$,H]),d=[...P?[{name:"Employee",uid:"employee",icon:Me}]:[],{name:"Leave Type",uid:"leave_type",icon:Ce},{name:"From Date",uid:"from_date",icon:le},{name:"To Date",uid:"to_date",icon:le},{name:"Status",uid:"status",icon:We},{name:"Reason",uid:"reason",icon:Ce},...P?[{name:"Actions",uid:"actions"}]:[]];return X?r(n,{className:"space-y-4",children:[e(et,{className:"max-h-[70vh]",children:g.map(t=>e(we,{leave:t,updatingLeave:i,setCurrentLeave:v,openModal:x,handleClickOpen:$,updateLeaveStatus:H,canEditLeaves:R,canDeleteLeaves:z,canApproveLeaves:m,isAdminView:P},t.id))}),h>u&&e(n,{className:"flex justify-center pt-4",children:e(tt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:E,total:f,onChange:S,size:"sm"})})]}):r(n,{sx:{maxHeight:"84vh",overflowY:"auto"},children:[e(et,{className:"max-h-[70vh]",children:r(kt,{isStriped:!0,selectionMode:"multiple",selectedKeys:k,onSelectionChange:M,topContent:Y,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(St,{columns:d,children:t=>e(_t,{align:t.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:r(n,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:t.name})]})},t.uid)}),e(Dt,{items:g,emptyContent:r(n,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(le,{className:"w-12 h-12 text-default-300 mb-4"}),e(c,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(c,{variant:"body2",color:"textSecondary",children:_?`No leaves found for "${_}"`:"No leave requests for the selected period"})]}),children:t=>e(Tt,{children:s=>a(t,s)},t.id)})]})}),h>u&&r(n,{className:"py-4 flex justify-center",children:[e(tt,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:E,total:f,onChange:S,size:re?"sm":"md"}),r("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",E," of ",f," (Total: ",h," records)"]})]})]})});Rt.displayName="LeaveEmployeeTable";const sr=({open:g,closeModal:C,leavesData:$,setLeavesData:v,currentLeave:x,allUsers:w,setTotalRows:F,setLastPage:E,setLeaves:h,handleMonthChange:f,employee:u,selectedMonth:I,addLeaveOptimized:_,updateLeaveOptimized:P,fetchLeavesStats:y})=>{const{auth:T}=He().props,p=me(),[m,R]=o.useState(x?.user_id||T.user.id),[z,U]=o.useState($?.leaveTypes||[]),[G,te]=o.useState([]),[L,V]=o.useState(x?.leave_type||""),re=a=>{if(!a)return new Date().toISOString().split("T")[0];if(typeof a=="string"&&a.match(/^\d{4}-\d{2}-\d{2}$/))return a;if(typeof a=="string"&&a.includes("T")){if(a.includes("T18:00:00")){const t=a.split("T")[0].split("-"),s=parseInt(t[0]),l=parseInt(t[1]),N=parseInt(t[2])+1;return new Date(s,l-1,N).toISOString().split("T")[0]}return a.split("T")[0]}try{const d=new Date(a);if(isNaN(d.getTime()))return new Date().toISOString().split("T")[0];const t=d.getFullYear(),s=String(d.getMonth()+1).padStart(2,"0"),l=String(d.getDate()).padStart(2,"0");return`${t}-${s}-${l}`}catch(d){return console.error("Error formatting date:",d),new Date().toISOString().split("T")[0]}},[X,ce]=o.useState(x?.from_date?re(x.from_date):""),[A,i]=o.useState(x?.to_date?re(x.to_date):""),[b,k]=o.useState(x?.no_of_days||""),[M,Y]=o.useState(""),[W,B]=o.useState(x?.reason||""),[S,H]=o.useState({}),[O,J]=o.useState(!1),[Q,q]=o.useState("");return o.useEffect(()=>{if($){U($.leaveTypes||[]);const a=$.leaveCountsByUser?.[m]||[];if(te(a),z.length>0&&!L&&!x&&V(z[0].type),x&&!L){const d=$.leaveTypes?.find(t=>t.id===x.leave_type);d&&V(d.type)}}},[$,m,x]),o.useEffect(()=>{if(!L||!G||!z)return;const d=G.find(s=>s.leave_type===L)?.days_used||0;q(d);const t=z.find(s=>s.type===L);if(t){const s=t.days-d;Y(s),x&&b>s&&k(s)}},[L,G,z,x,b]),o.useEffect(()=>{k(((d,t)=>{if(!d||!t)return"";const s=new Date(d),l=new Date(t);if(s>l)return"";const N=l.getTime()-s.getTime();return Math.ceil(N/(1e3*3600*24))+1})(X,A))},[X,A]),r(Le,{open:g,onClose:C,fullWidth:!0,maxWidth:"sm",children:[r($e,{sx:{display:"flex",alignItems:"center"},children:[e(c,{variant:"h6",children:x?"Edit Leave":"Add Leave"}),e(de,{onClick:C,sx:{position:"absolute",top:8,right:16},children:e(je,{})})]}),r("form",{onSubmit:async a=>{a.preventDefault(),J(!0);const d=new Promise(async(t,s)=>{try{const l={route:route().current(),user_id:m,leaveType:L,fromDate:X,toDate:A,daysCount:b,leaveReason:W,employee:u,month:I},N=x?route("leave-update"):route("leave-add");x&&(l.id=x.id);const D=await axios.post(N,l);D.status===200||D.status===201?(v(D.data.leavesData),x&&P&&D.data.leave?(P(D.data.leave),y()):_&&D.data.leave?(_(D.data.leave),y(),D.data.pagination&&(F(D.data.pagination.total),E(D.data.pagination.lastPage))):(console.log("Using fallback data update mode"),D.data.leaves&&(h(D.data.leaves.data),F(D.data.leaves.total),E(D.data.leaves.last_page)),D.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(D.data.leavesData)),C(),t([D.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",D.status),s(`Unexpected response status: ${D.status}`))}catch(l){console.error("Full error object:",l),l.response?(console.error("Error response status:",l.response.status),console.error("Error response data:",l.response.data),l.response.status===422?(H(l.response.data.errors||{}),s(l.response.data.error||"Failed to submit leave application")):s(`HTTP Error ${l.response.status}: ${l.response.data.message||"An unexpected error occurred. Please try again later."}`)):l.request?(console.error("No response received:",l.request),s("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",l.message),s("An error occurred while setting up the request."))}finally{J(!1)}});j.promise(d,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ye,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},success:{render({data:t}){return e(Z,{children:t.map((s,l)=>e("div",{children:s},l))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}},error:{render({data:t}){return e(Z,{children:t})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,color:p.palette.text.primary}}})},children:[e(Fe,{children:r(K,{container:!0,spacing:2,children:[e(K,{item:!0,xs:12,md:6,children:r(Se,{fullWidth:!0,children:[e(_e,{id:"leave-type-label",children:"Leave Type"}),r(De,{labelId:"leave-type-label",value:L||"",onChange:a=>V(a.target.value),label:"Leave Type",error:!!S.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,borderRadius:2,boxShadow:p.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:"Select Leave Type"}),z.map(a=>{const d=G?.find(l=>l.leave_type===a.type),s=(d?a.days-d.days_used:a.days)<=0;return e(ie,{value:a.type,disabled:s,title:s?"No remaining leaves available":"",children:r(n,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),e("span",{children:d?`${d.days_used} / ${a.days} days`:`${a.days} days`})]})},a.id)})]}),e(Te,{children:S.leaveType})]})}),e(K,{item:!0,xs:12,md:6,children:e(pe,{label:"From",type:"date",fullWidth:!0,value:X,onChange:a=>ce(a.target.value),InputLabelProps:{shrink:!0},error:!!S.fromDate,helperText:S.fromDate})}),e(K,{item:!0,xs:12,md:6,children:e(pe,{label:"To",type:"date",fullWidth:!0,value:A,onChange:a=>i(a.target.value),InputLabelProps:{shrink:!0},error:!!S.toDate,helperText:S.toDate})}),e(K,{item:!0,xs:12,md:6,children:e(pe,{label:"Number of days",type:"text",fullWidth:!0,value:b,InputProps:{readOnly:!0},error:!!S.daysCount,helperText:S.daysCount})}),e(K,{item:!0,xs:12,md:6,children:e(pe,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${M} day${M!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:r(c,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",z.find(a=>a.type===L)?.days||0," total"]})},error:!!S.remainingLeaves,helperText:S.remainingLeaves})}),route().current()==="leaves"&&e(K,{item:!0,xs:12,md:6,children:r(Se,{fullWidth:!0,children:[e(_e,{id:"leave-employee-label",children:"Employee"}),r(De,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:m||"na",error:!!S.user_id,onChange:a=>R(a.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:p.glassCard.background,border:p.glassCard.border,borderRadius:2,boxShadow:p.glassCard.boxShadow}}},children:[e(ie,{value:"na",disabled:!0,children:"Please select"}),w.map(a=>e(ie,{value:a.id,children:r(n,{sx:{display:"flex"},children:[e(nt,{src:a.profile_image,alt:a.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),a.name]})},a.id))]}),e(Te,{children:S.user_id})]})}),e(K,{item:!0,xs:12,children:e(pe,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:W,onChange:a=>B(a.target.value),error:!!S.leaveReason,helperText:S.leaveReason})})]})}),e(Pe,{sx:{padding:"16px",justifyContent:"center"},children:e(fe,{type:"submit",variant:"outlined",color:"primary",loading:O,disabled:O,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},nr=({open:g,closeModal:C,leaveId:$,setLeavesData:v,setLeaves:x,setTotalRows:w,setLastPage:F,setError:E,deleteLeaveOptimized:h,fetchLeavesStats:f})=>{const u=me(),[I,_]=o.useState(!1);return r(Le,{open:g,onClose:C,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e($e,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Fe,{children:e(pt,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),r(Pe,{children:[e(ze,{onClick:C,color:"primary",disabled:I,children:"Cancel"}),e(ze,{loading:I,disabled:I,onClick:()=>{if(!$){const T=Promise.reject(new Error("Invalid leave ID"));j.promise(T,{error:"Invalid leave ID provided"});return}_(!0);const y=new Promise(async(T,p)=>{try{const m=await he.delete(route("leave-delete",{id:$,route:route().current()}));m.status===200&&(h?(h($),w(R=>Math.max(0,R-1)),f&&f()):(v&&v(m.data.leavesData),w&&w(m.data.leaves.total),F&&F(m.data.leaves.last_page),x&&x(m.data.leaves.data),E&&E(!1),f&&f()),T("Leave application deleted successfully"))}catch(m){if(console.error("Error deleting leave:",m),m.response?.status===404){const{leavesData:R}=m.response.data||{};v&&R&&v(R),E&&E(m.response?.data?.message||"Leave not found."),p("Leave not found or already deleted")}else m.response?.status===403?p("You do not have permission to delete this leave"):m.response?.status===422?p("Cannot delete leave with current status"):p(m.response?.data?.error||"Failed to delete leave application")}finally{_(!1),C()}});j.promise(y,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ye,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}},success:{render({data:T}){return e(Z,{children:T})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}},error:{render({data:T}){return e(Z,{children:T})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:u.glassCard.background,border:u.glassCard.border,color:u.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},It=({selectedDates:g=[],onDatesChange:C,existingLeaves:$=[],publicHolidays:v=[],minDate:x=null,maxDate:w=null,userId:F=null,fetchFromAPI:E=!1})=>{const h=me(),[f,u]=o.useState(new Date),[I,_]=o.useState({existingLeaves:$,publicHolidays:v}),[P,y]=o.useState(!1),[T,p]=o.useState(null),m=o.useCallback(async i=>{if(!(!E||!F)&&T!==i){y(!0);try{const b=await he.get(route("leaves.bulk.calendar-data"),{params:{user_id:F,year:i}});b.data.success&&(_({existingLeaves:b.data.data.existingLeaves||[],publicHolidays:b.data.data.publicHolidays||[]}),p(i))}catch(b){console.error("Failed to fetch calendar data:",b)}finally{y(!1)}}},[E,F,T]);o.useEffect(()=>{const i=f.getFullYear();m(i)},[m,f.getFullYear()]),o.useEffect(()=>{E&&F&&p(null)},[F,E]);const R=E?I.existingLeaves:$,z=E?I.publicHolidays:v,U=o.useMemo(()=>{const i=f.getFullYear(),b=f.getMonth(),k=new Date(i,b,1),Y=new Date(i,b+1,0).getDate(),W=k.getDay(),B=new Date(i,b,0).getDate(),S=[];for(let q=W-1;q>=0;q--)S.push({date:B-q,isCurrentMonth:!1,fullDate:new Date(i,b-1,B-q)});const H=[];for(let q=1;q<=Y;q++)H.push({date:q,isCurrentMonth:!0,fullDate:new Date(i,b,q)});const J=42-(S.length+H.length),Q=[];for(let q=1;q<=J;q++)Q.push({date:q,isCurrentMonth:!1,fullDate:new Date(i,b+1,q)});return[...S,...H,...Q]},[f]),G=o.useCallback(()=>{u(i=>new Date(i.getFullYear(),i.getMonth()-1,1))},[]),te=o.useCallback(()=>{u(i=>new Date(i.getFullYear(),i.getMonth()+1,1))},[]),L=o.useCallback(()=>{u(new Date)},[]),V=o.useCallback(i=>{if(!i.isCurrentMonth||P)return;const b=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),k=R.some(B=>{if(!B.from_date||!B.to_date)return!1;const S=B.from_date.split("T")[0],H=B.to_date.split("T")[0];return b>=S&&b<=H}),M=z.includes(b);if(k||M||x&&i.fullDate<new Date(x)||w&&i.fullDate>new Date(w))return;const Y=g.includes(b);let W;Y?W=g.filter(B=>B!==b):W=[...g,b],C(W.sort())},[g,C,x,w,P,R,z]),re=o.useCallback(i=>{if(!i.isCurrentMonth)return{selectable:!1};const b=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),k=g.includes(b),M=i.fullDate.toDateString()===new Date().toDateString(),Y=i.fullDate<new Date().setHours(0,0,0,0),W=i.fullDate.getDay()===0||i.fullDate.getDay()===6,B=R.some(O=>{if(!O.from_date||!O.to_date)return!1;const J=O.from_date.split("T")[0],Q=O.to_date.split("T")[0];return b>=J&&b<=Q}),S=z.includes(b),H=!P&&!B&&!S&&(!x||i.fullDate>=new Date(x))&&(!w||i.fullDate<=new Date(w));return{isSelected:k,isToday:M,isPast:Y,isWeekend:W,hasExistingLeave:B,isPublicHoliday:S,selectable:H}},[g,R,z,x,w,P]),X=o.useCallback((i,b)=>i.isCurrentMonth?P?{color:h.palette.text.disabled,cursor:"not-allowed",backgroundColor:h.palette.action.disabledBackground,opacity:.5,pointerEvents:"none"}:b.isSelected?{backgroundColor:h.palette.primary.main,color:h.palette.primary.contrastText,fontWeight:"bold",border:`2px solid ${h.palette.primary.dark}`,boxShadow:`0 0 0 3px ${h.palette.primary.main}30`,transform:"scale(1.05)",zIndex:10}:b.hasExistingLeave?{backgroundColor:h.palette.error.main,color:h.palette.error.contrastText,border:`2px solid ${h.palette.error.dark}`,fontWeight:500,cursor:"not-allowed"}:b.isPublicHoliday?{backgroundColor:h.palette.warning.main,color:h.palette.warning.contrastText,border:`2px solid ${h.palette.warning.dark}`,fontWeight:500,cursor:"not-allowed"}:b.isToday?{backgroundColor:h.palette.secondary.light,color:h.palette.secondary.contrastText,fontWeight:600,border:`2px solid ${h.palette.secondary.main}`,boxShadow:`0 0 0 2px ${h.palette.secondary.main}40`,"&:hover":{backgroundColor:h.palette.secondary.main,transform:"scale(1.02)"}}:b.isWeekend?{color:h.palette.text.secondary,backgroundColor:h.palette.action.hover,border:`1px solid ${h.palette.divider}`,opacity:.7,"&:hover":{backgroundColor:h.palette.action.selected,opacity:.9}}:b.selectable?{color:h.palette.text.primary,border:"1px solid transparent","&:hover":{backgroundColor:h.palette.primary.main+"15",color:h.palette.primary.main,border:`1px solid ${h.palette.primary.main}30`,transform:"scale(1.02)"}}:{color:h.palette.text.disabled,cursor:"not-allowed",backgroundColor:h.palette.action.disabledBackground,opacity:.6}:{color:h.palette.text.disabled,cursor:"not-allowed",opacity:.3},[h,P]),ce=f.toLocaleDateString("en-US",{month:"long",year:"numeric"}),A=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return r(st,{variant:"outlined",sx:{width:"100%"},children:[e(Ue,{title:r(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(le,{style:{width:20,height:20,color:h.palette.primary.main}}),e(c,{variant:"h6",component:"h3",children:ce}),E&&T&&e(ne,{size:"small",variant:"outlined",color:"primary",label:`Data: ${T}`,sx:{ml:1,fontSize:"0.7rem"}})]}),r(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e(de,{size:"small",onClick:G,sx:{color:"text.secondary"},disabled:P,children:e(Ft,{style:{width:16,height:16}})}),e(ze,{variant:"text",size:"small",onClick:L,sx:{minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem",textTransform:"none"},disabled:P,children:"Today"}),e(de,{size:"small",onClick:te,sx:{color:"text.secondary"},disabled:P,children:e(dt,{style:{width:16,height:16}})})]})]}),sx:{pb:2}}),r(ke,{sx:{pt:0},children:[P&&r(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,backgroundColor:h.palette.action.hover,borderRadius:2,mb:3},children:[e(ye,{size:24}),r(c,{variant:"body2",sx:{ml:2},children:["Loading calendar data for ",f.getFullYear(),"..."]})]}),r(n,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:[e(ne,{size:"small",variant:"filled",color:"primary",label:"Selected",sx:{fontWeight:600}}),e(ne,{size:"small",variant:"filled",color:"error",label:"Existing Leave",sx:{opacity:.9}}),e(ne,{size:"small",variant:"filled",color:"warning",label:"Holiday",sx:{opacity:.9}}),e(ne,{size:"small",variant:"filled",color:"secondary",label:"Today",sx:{fontWeight:600}}),e(ne,{size:"small",variant:"outlined",color:"default",label:"Weekend",sx:{opacity:.7}})]}),e(n,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:1},children:A.map(i=>e(n,{sx:{textAlign:"center",py:1,fontSize:"0.875rem",fontWeight:"medium",color:"text.secondary"},children:i},i))}),e(n,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5},children:U.map((i,b)=>{const k=re(i),M=X(i,k);return r(n,{onClick:()=>V(i),sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,minHeight:40,cursor:k.selectable?"pointer":"not-allowed",borderRadius:1.5,transition:"all 0.2s ease-in-out",fontSize:"0.875rem",userSelect:"none",...M},role:"button",tabIndex:k.selectable?0:-1,title:k.hasExistingLeave?"Existing leave - cannot select":k.isPublicHoliday?"Public holiday - cannot select":k.selectable?"":"Not selectable","aria-label":`${i.fullDate.toDateString()}${k.isSelected?" (selected)":""}${k.hasExistingLeave?" (existing leave)":""}${k.isPublicHoliday?" (public holiday)":""}`,onKeyDown:Y=>{(Y.key==="Enter"||Y.key===" ")&&(Y.preventDefault(),V(i))},children:[i.date,k.isWeekend&&!k.isSelected&&!k.hasExistingLeave&&!k.isPublicHoliday&&e(n,{sx:{position:"absolute",top:2,right:2,width:4,height:4,borderRadius:"50%",bgcolor:"text.secondary",opacity:.5}})]},b)})}),g.length>0&&r(n,{sx:{mt:3,p:2.5,borderRadius:2,background:`linear-gradient(135deg, ${h.palette.primary.light}20, ${h.palette.primary.main}10)`,border:`1px solid ${h.palette.primary.main}30`,backdropFilter:"blur(8px)",position:"relative",overflow:"hidden"},children:[r(n,{sx:{position:"relative",zIndex:1},children:[r(c,{variant:"body2",color:"primary.main",fontWeight:"600",sx:{mb:1},children:["📅 ",g.length," date",g.length!==1?"s":""," selected"]}),r(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[g.slice(0,12).map(i=>e(ne,{size:"small",variant:"filled",color:"primary",label:new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric"}),sx:{fontWeight:500,fontSize:"0.75rem"}},i)),g.length>12&&e(ne,{size:"small",variant:"outlined",color:"primary",label:`+${g.length-12} more`,sx:{fontWeight:500}})]})]}),e(n,{sx:{position:"absolute",top:-10,right:-10,width:60,height:60,borderRadius:"50%",background:`linear-gradient(45deg, ${h.palette.primary.main}15, transparent)`,opacity:.3}})]})]})]})},Wt=({validationResults:g=[],balanceImpact:C=null,isValidating:$=!1})=>{const v=me();if(g.length===0&&!$)return null;const x=g.filter(u=>u.status==="valid").length,w=g.filter(u=>u.status==="warning").length,F=g.filter(u=>u.status==="conflict").length;g.length;const E=u=>{const I={style:{width:16,height:16}};switch(u){case"valid":return e(Ye,{...I,style:{...I.style,color:v.palette.success.main}});case"warning":return e(Ae,{...I,style:{...I.style,color:v.palette.warning.main}});case"conflict":return e(Nt,{...I,style:{...I.style,color:v.palette.error.main}});default:return e(at,{...I,style:{...I.style,color:v.palette.text.disabled}})}},h=u=>{switch(u){case"valid":return"success";case"warning":return"warning";case"conflict":return"error";default:return"default"}},f=u=>new Date(u).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return r(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[r(Oe,{variant:"outlined",children:[e(Ue,{title:r(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(c,{variant:"h6",children:"Validation Results"}),$&&r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(ye,{size:16}),e(c,{variant:"body2",color:"text.secondary",children:"Validating..."})]})]})}),r(ke,{sx:{pt:0},children:[r(n,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mb:2},children:[r(n,{sx:{textAlign:"center"},children:[e(c,{variant:"h4",color:"success.main",fontWeight:"bold",children:x}),e(c,{variant:"body2",color:"success.main",children:"Valid"})]}),r(n,{sx:{textAlign:"center"},children:[e(c,{variant:"h4",color:"warning.main",fontWeight:"bold",children:w}),e(c,{variant:"body2",color:"warning.main",children:"Warnings"})]}),r(n,{sx:{textAlign:"center"},children:[e(c,{variant:"h4",color:"error.main",fontWeight:"bold",children:F}),e(c,{variant:"body2",color:"error.main",children:"Conflicts"})]})]}),C&&r(n,{sx:{p:2,borderRadius:2,background:v.palette.background.paper,border:`1px solid ${v.palette.divider}`},children:[r(c,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e(at,{style:{width:16,height:16,color:v.palette.primary.main}}),"Leave Balance Impact"]}),r(n,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[r(n,{children:[e(c,{variant:"body2",color:"text.secondary",component:"span",children:"Leave Type:"}),e(c,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:C.leave_type})]}),r(n,{children:[e(c,{variant:"body2",color:"text.secondary",component:"span",children:"Current Balance:"}),r(c,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[C.current_balance," days"]})]}),r(n,{children:[e(c,{variant:"body2",color:"text.secondary",component:"span",children:"Requested Days:"}),r(c,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[C.requested_days," days"]})]}),r(n,{children:[e(c,{variant:"body2",color:"text.secondary",component:"span",children:"Remaining Balance:"}),r(c,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1,color:C.remaining_balance<0?"error.main":"success.main"},children:[C.remaining_balance," days"]})]})]}),C.remaining_balance<0&&e(n,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"error.light",border:1,borderColor:"error.main"},children:r(c,{variant:"body2",color:"error.main",children:["⚠️ This request exceeds your available leave balance by ",Math.abs(C.remaining_balance)," days."]})})]})]})]}),g.length>0&&r(Oe,{variant:"outlined",children:[e(Ue,{title:e(c,{variant:"h6",children:"Date-by-Date Results"})}),e(ke,{children:e(n,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:240,overflowY:"auto"},children:g.map((u,I)=>r(n,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2,borderRadius:2,border:1,borderColor:"divider","&:hover":{borderColor:"text.secondary"},transition:"border-color 0.2s"},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[E(u.status),r(n,{children:[e(c,{variant:"body2",fontWeight:"medium",children:f(u.date)}),e(c,{variant:"caption",color:"text.secondary",children:u.date})]})]}),r(n,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e(ne,{size:"small",variant:"outlined",color:h(u.status),label:u.status,sx:{textTransform:"capitalize"}}),u.errors&&u.errors.length>0&&e(n,{sx:{textAlign:"right"},children:u.errors.map((_,P)=>e(c,{variant:"caption",color:"error.main",children:_},P))}),u.warnings&&u.warnings.length>0&&e(n,{sx:{textAlign:"right"},children:u.warnings.map((_,P)=>e(c,{variant:"caption",color:"warning.main",children:_},P))})]})]},I))})})]})]})},or=({open:g,onClose:C,onSuccess:$,allUsers:v=[],leavesData:x={leaveTypes:[],leaveCountsByUser:{}},isAdmin:w=!1,existingLeaves:F=[],publicHolidays:E=[]})=>{const{auth:h}=He().props,f=me(),[u,I]=o.useState([]),[_,P]=o.useState(h?.user?.id||""),[y,T]=o.useState(""),[p,m]=o.useState(""),[R,z]=o.useState(!1),[U,G]=o.useState([]),[te,L]=o.useState(!1),[V,re]=o.useState([]),[X,ce]=o.useState(null),[A,i]=o.useState(!1),[b,k]=o.useState(!1),[M,Y]=o.useState(!1),[W,B]=o.useState({});o.useMemo(()=>!F||F.length===0?[]:F.filter(a=>a.user_id===parseInt(_)),[F,_]);const S=o.useMemo(()=>U.length>0?U:x?.leaveTypes||[],[U,x]),H=o.useMemo(()=>U.length>0?U.map(a=>({leave_type:a.type,days_used:a.used,total_days:a.days,remaining_days:a.remaining})):x?.leaveCountsByUser?.[_]||[],[U,x,_]),O=o.useCallback(async a=>{if(a){L(!0);try{const d=await he.get(route("leaves.bulk.leave-types"),{params:{user_id:a,year:new Date().getFullYear()}});d.data.success&&G(d.data.leave_types)}catch(d){console.error("Failed to fetch user leave types:",d),G([])}finally{L(!1)}}},[]);o.useEffect(()=>{g&&_&&w&&O(_)},[_,g,w,O]),o.useEffect(()=>{g||(I([]),P(h?.user?.id||""),T(""),m(""),z(!1),re([]),ce(null),k(!1),B({}),G([]))},[g,h?.user?.id]),o.useEffect(()=>{if(S.length>0&&!y&&g&&_){const a=S.find(d=>{if(U.length>0)return d.remaining>0;const t=H?.find(l=>l.leave_type===d.type);return(t?d.days-t.days_used:d.days)>0});a&&T(a.type)}},[S,H,U,y,g,_]);const J=o.useCallback(async()=>{if(u.length===0){const a=Promise.reject(new Error("No dates selected"));j.promise(a,{error:"Please select at least one date"});return}if(!y){const a=Promise.reject(new Error("No leave type selected"));j.promise(a,{error:"Please select a leave type"});return}if(!p.trim()||p.trim().length<5){const a=new Promise((d,t)=>{t("Please provide a reason for leave (at least 5 characters)")});j.promise(a,{error:{render({data:d}){return e(Z,{children:d})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}}});return}i(!0),B({});try{const a=S.find(t=>t.type===y),d=await he.post(route("leaves.bulk.validate"),{user_id:parseInt(_),dates:u,leave_type_id:a?.id,reason:p.trim()});if(d.data.success){re(d.data.validation_results),ce(d.data.estimated_balance_impact),k(!0);const t=d.data.validation_results.filter(N=>N.status==="conflict").length,s=d.data.validation_results.filter(N=>N.status==="warning").length,l=Promise.resolve();t>0?j.promise(l,{success:`${t} date(s) have conflicts. Please review before submitting.`}):s>0?j.promise(l,{success:`${s} date(s) have warnings. You may proceed if acceptable.`}):j.promise(l,{success:"All dates validated successfully!"})}}catch(a){console.error("Validation error:",a),a.response?.status===422&&B(a.response.data.errors||{});const d=Promise.reject(a);j.promise(d,{error:a.response?.data?.message||"Failed to validate dates"})}finally{i(!1)}},[u,y,p,_,S]),Q=o.useCallback(async()=>{if(!b){const t=Promise.reject(new Error("Not validated"));j.promise(t,{error:"Please validate dates before submitting"});return}if(V.filter(t=>t.status==="conflict").length>0&&!R){const t=new Promise((s,l)=>{l("Please resolve conflicts or enable partial success mode")});j.promise(t,{error:{render({data:s}){return e(Z,{children:s})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}}});return}Y(!0);const d=new Promise(async(t,s)=>{try{const l=S.find(D=>D.type===y),N=await he.post(route("leaves.bulk.store"),{user_id:parseInt(_),dates:u,leave_type_id:l?.id,reason:p.trim(),allow_partial_success:R});N.status===200||N.status===201?($?.(N.data),C(),t([N.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",N.status),s(`Unexpected response status: ${N.status}`))}catch(l){console.error("Full error object:",l),l.response?(console.error("Error response status:",l.response.status),console.error("Error response data:",l.response.data),l.response.status===422?(B(l.response.data.errors||{}),s(l.response.data.error||"Failed to submit bulk leave requests")):s(`HTTP Error ${l.response.status}: ${l.response.data.message||"An unexpected error occurred. Please try again later."}`)):l.request?(console.error("No response received:",l.request),s("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",l.message),s("An error occurred while setting up the request."))}finally{Y(!1)}});j.promise(d,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ye,{}),e("span",{style:{marginLeft:"8px"},children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}},success:{render({data:t}){return e(Z,{children:t.map((s,l)=>e("div",{children:s},l))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}},error:{render({data:t}){return e(Z,{children:t})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}}})},[b,V,R,_,u,y,p,$,C,S,f]),q=u.length>0&&y&&p.trim().length>=5,we=b&&(V.filter(a=>a.status==="conflict").length===0||R);return r(Le,{open:g,onClose:C,fullWidth:!0,maxWidth:"lg",children:[r($e,{sx:{display:"flex",alignItems:"center",pb:1},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(le,{style:{width:24,height:24,color:f.palette.primary.main}}),r(n,{children:[e(c,{variant:"h6",component:"h2",children:"Add Bulk Leave"}),e(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Select multiple dates and create leave requests in batch"})]})]}),e(de,{onClick:C,sx:{position:"absolute",top:8,right:16},disabled:M,children:e(je,{})})]}),e(Fe,{sx:{py:3},children:r(K,{container:!0,spacing:3,children:[e(K,{item:!0,xs:12,lg:6,children:r(n,{sx:{position:"sticky",top:0},children:[r(c,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e(le,{style:{width:20,height:20}}),"Select Dates"]}),e(It,{selectedDates:u,onDatesChange:a=>{I(a),k(!1)},userId:_,fetchFromAPI:!0})]})}),e(K,{item:!0,xs:12,lg:6,children:r(n,{sx:{display:"flex",flexDirection:"column",gap:3},children:[r(n,{children:[e(c,{variant:"h6",gutterBottom:!0,children:"Leave Details"}),r(n,{sx:{display:"flex",flexDirection:"column",gap:2},children:[w&&v.length>0&&r(Se,{fullWidth:!0,error:!!W.user_id,children:[e(_e,{id:"bulk-employee-label",children:"Employee"}),r(De,{labelId:"bulk-employee-label",value:_||"",onChange:a=>{P(a.target.value),T(""),k(!1),G([])},label:"Employee",disabled:M||A,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,borderRadius:2,boxShadow:f.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:"Please select employee"}),v.map(a=>e(ie,{value:a.id,children:r(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(nt,{src:a.profile_image,alt:a.name||"Not assigned",sx:{width:24,height:24}}),a.name]})},a.id))]}),e(Te,{children:W.user_id})]}),r(Se,{fullWidth:!0,error:!!W.leave_type_id,children:[e(_e,{id:"bulk-leave-type-label",children:"Leave Type"}),r(De,{labelId:"bulk-leave-type-label",value:y||"",onChange:a=>{T(a.target.value),k(!1)},label:"Leave Type",disabled:M||A||te,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,borderRadius:2,boxShadow:f.glassCard.boxShadow,maxHeight:300}}},children:[e(ie,{value:"",disabled:!0,children:te?"Loading leave types...":"Select Leave Type"}),S.map(a=>{let d,t;if(U.length>0)d=a.remaining,t=d<=0;else{const s=H?.find(l=>l.leave_type===a.type);d=s?a.days-s.days_used:a.days,t=d<=0}return e(ie,{value:a.type,disabled:t,title:t?"No remaining leaves available":"",children:r(n,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),r("span",{children:["(",d," remaining)"]})]})},a.id)})]}),e(Te,{children:W.leave_type_id})]}),y&&e(pe,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:(()=>{const a=S.find(t=>t.type===y);let d;if(U.length>0&&a)d=a.remaining,a.days;else{const t=H?.find(s=>s.leave_type===y);d=t?a?.days-t.days_used:a?.days,a?.days}return`${d||0} remaining`})(),InputProps:{readOnly:!0,endAdornment:r(c,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",(()=>{const a=S.find(d=>d.type===y);return U.length>0,a?.days})()," total"]})}}),e(pe,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:p,onChange:a=>{m(a.target.value),k(!1)},multiline:!0,rows:3,fullWidth:!0,required:!0,error:!!W.reason||p.length>0&&p.length<5,helperText:W.reason||(p.length>0&&p.length<5?"Reason must be at least 5 characters":`${p.length}/500 characters`),inputProps:{maxLength:500},disabled:M||A}),e(ht,{control:e(mt,{checked:R,onChange:a=>z(a.target.checked),size:"small",disabled:M||A}),label:r(n,{children:[e(c,{variant:"body2",children:"Allow partial success"}),e(c,{variant:"caption",color:"text.secondary",children:"Valid dates will be processed even if some dates fail validation"})]})})]})]}),u.length>0&&r(n,{sx:{p:2,borderRadius:2,background:f.palette.background.paper,border:`1px solid ${f.palette.divider}`},children:[e(c,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Selected Dates Summary"}),r(c,{variant:"body1",children:[e("strong",{children:u.length})," date",u.length!==1?"s":""," selected"]}),y&&r(c,{variant:"body2",color:"text.secondary",children:["Leave type: ",y]})]}),e(Wt,{validationResults:V,balanceImpact:X,isValidating:A})]})})]})}),r(Pe,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(fe,{variant:"outlined",onClick:C,disabled:M,sx:{borderRadius:"50px"},children:"Cancel"}),r(n,{sx:{display:"flex",gap:1},children:[e(fe,{variant:"outlined",color:"primary",onClick:J,loading:A,disabled:!q||M,startIcon:!A&&e(Ae,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:A?"Validating...":"Validate Dates"}),e(fe,{variant:"contained",color:"primary",onClick:Q,loading:M,disabled:!we||A,startIcon:!M&&e(Ye,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:M?"Creating...":`Create ${u.length} Leave Request${u.length!==1?"s":""}`})]})]})]})},lr=({open:g,onClose:C,onSuccess:$,selectedLeaves:v=[],allUsers:x=[]})=>{const w=me(),[F,E]=o.useState(!1),[h,f]=o.useState({}),u=o.useCallback(y=>x.find(p=>p.id===y)?.name||`User ID: ${y}`,[x]),I=v.filter(y=>y.status&&y.status.toLowerCase()==="approved"),_=I.length===0,P=o.useCallback(async()=>{if(!_){const T=Promise.reject("Cannot delete approved leaves");j.promise(T,{error:"Cannot delete approved leave requests"});return}if(v.length===0){const T=Promise.reject("No leaves selected");j.promise(T,{error:"No leave requests selected for deletion"});return}E(!0);const y=new Promise(async(T,p)=>{try{const m=v.map(z=>z.id),R=await he.delete(route("leaves.bulk.delete"),{data:{leave_ids:m}});R.status===200&&R.data.success?($?.(R.data),C(),T([R.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",R.status),p(`Unexpected response status: ${R.status}`))}catch(m){console.error("Full error object:",m),m.response?(console.error("Error response status:",m.response.status),console.error("Error response data:",m.response.data),m.response.status===422?(f(m.response.data.errors||{}),p(m.response.data.error||"Failed to delete leave requests")):m.response.status===403?p(m.response.data.error||"You are not authorized to delete these leave requests"):m.response.status===404?p(m.response.data.error||"Some leave requests were not found"):p(`HTTP Error ${m.response.status}: ${m.response.data.message||"An unexpected error occurred. Please try again later."}`)):m.request?(console.error("No response received:",m.request),p("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",m.message),p("An error occurred while setting up the request."))}finally{E(!1)}});j.promise(y,{pending:{render(){return r("div",{style:{display:"flex",alignItems:"center"},children:[e(ye,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}},success:{render({data:T}){return e(Z,{children:T.map((p,m)=>e("div",{children:p},m))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}},error:{render({data:T}){return e(Z,{children:T})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:w.glassCard.background,border:w.glassCard.border,color:w.palette.text.primary}}})},[v,_,$,C,w]);return r(Le,{open:g,onClose:C,fullWidth:!0,maxWidth:"md",children:[r($e,{sx:{display:"flex",alignItems:"center",pb:1},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(ve,{style:{width:24,height:24,color:w.palette.error.main}}),r(n,{children:[e(c,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),r(c,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",v.length," leave request",v.length!==1?"s":""]})]})]}),e(de,{onClick:C,sx:{position:"absolute",top:8,right:16},disabled:F,children:e(je,{})})]}),r(Fe,{sx:{py:3},children:[!_&&r(n,{sx:{p:2,mb:3,borderRadius:2,background:w.palette.error.main+"20",border:`1px solid ${w.palette.error.main}40`},children:[r(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e(Ae,{style:{width:20,height:20,color:w.palette.error.main}}),e(c,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),r(c,{variant:"body2",color:"error",children:[I.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),r(c,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e(Ye,{style:{width:20,height:20}}),"Selected Leave Requests (",v.length,")"]}),e(bt,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${w.palette.divider}`,borderRadius:2,backgroundColor:w.palette.background.paper},children:v.map((y,T)=>{const p=y.status&&y.status.toLowerCase()==="approved";return r(xe.Fragment,{children:[e(gt,{sx:{py:2,opacity:p?.6:1,backgroundColor:p?w.palette.error.main+"10":"transparent"},children:e(ft,{primary:r(n,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e(c,{variant:"subtitle2",children:u(y.user_id)}),e(Ne,{size:"sm",variant:"flat",color:y.status?.toLowerCase()==="approved"?"success":y.status?.toLowerCase()==="pending"?"warning":y.status?.toLowerCase()==="rejected"?"danger":"default",children:y.status||"Unknown"}),p&&e(Ne,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:r(n,{children:[r(c,{variant:"body2",color:"text.secondary",children:[y.leave_type," - ",y.from_date," to ",y.to_date]}),r(c,{variant:"body2",color:"text.secondary",children:[y.no_of_days," day",y.no_of_days!==1?"s":""," - ",y.reason]})]})})}),T<v.length-1&&e(yt,{})]},y.id)})}),_&&e(n,{sx:{mt:3,p:2,borderRadius:2,background:w.palette.warning.main+"20",border:`1px solid ${w.palette.warning.main}40`},children:e(c,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"⚠️ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),r(Pe,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(fe,{variant:"outlined",onClick:C,disabled:F,sx:{borderRadius:"50px"},children:"Cancel"}),e(fe,{variant:"contained",color:"error",onClick:P,loading:F,disabled:!_||F||v.length===0,startIcon:!F&&e(ve,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:F?"Deleting...":`Delete ${v.length} Request${v.length!==1?"s":""}`})]})]})};export{or as B,nr as D,sr as L,lr as a,Rt as b};
