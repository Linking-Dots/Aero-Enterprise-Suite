import{u as G,j as e,a as F,d as X,b as x,e as E,i as Z,m as ee,n as se,o as c,q as te,r as re,v as u,h as v,w as ae,x as ie,y as oe,z as h,p as ne,A as le,B as de,C as ce,D as ue,t as me,E as pe}from"./vendor-heroui-CinxWHhv.js";import{J as xe,r as n,Q as he,S as p}from"./vendor-inertia-sUfCHI_5.js";import{A as je}from"./Dashboard-B31R4Hfu.js";import{S as fe}from"./StatsCards-Bjx1jlVk.js";import{s as a}from"./toastUtils-BVg-E_WQ.js";import{a as j}from"./vendor-utils-CrJAVL9K.js";import{d as ge}from"./dayjs.min-BJ9zlrPD.js";import{F as R}from"./ClipboardDocumentListIcon-CESV3yIX.js";import{F as ve}from"./CheckCircleIcon-BAvoXTNq.js";import{F as we}from"./XCircleIcon-BzKw4V53.js";import{e as ye}from"./vendor-framer-B7qqn1b6.js";import{F as be}from"./ArrowLeftIcon-eVpI9RZn.js";import{F as _e}from"./DocumentArrowDownIcon-DCm9Iy1y.js";import{F as Re}from"./MagnifyingGlassIcon-BJyUDYwI.js";import{F as Ne}from"./EllipsisVerticalIcon-CqOfKM9J.js";import{F as Se}from"./PrinterIcon-BNArMW4S.js";import"./vendor-react-FouZbkAE.js";import"./app-CVDJTwUF.js";import"./EnvelopeIcon-CFKoTD3N.js";import"./UserGroupIcon-CSQScwVa.js";import"./MapPinIcon-DDwLGyCW.js";import"./ClockIcon-BKLni_N9.js";import"./UserIcon-CgrjQ1A2.js";import"./ShieldCheckIcon-Ck-ae4AP.js";import"./XMarkIcon-twQGc8di.js";import"./KeyIcon-BIi5nz4o.js";import"./logo-DFaNDj_M.js";import"./ExclamationTriangleIcon-BarRaUA8.js";const Ce=({event:t,registrations:k})=>{var P;const{auth:Pe}=xe().props,[l,Fe]=n.useState(k),[m,w]=n.useState(new Set([])),[f,A]=n.useState(""),{isOpen:T,onOpen:N,onClose:g}=G(),[y,b]=n.useState(""),[S,C]=n.useState(""),[z,M]=n.useState(null),B=n.useMemo(()=>{var s,d,i;return[{title:"Total",value:l.total||0,icon:e.jsx(R,{}),color:"text-primary",iconBg:"bg-primary/20",description:"Total registrations"},{title:"Approved",value:((s=l.data)==null?void 0:s.filter(o=>o.status==="approved").length)||0,icon:e.jsx(ve,{}),color:"text-success",iconBg:"bg-success/20",description:"Confirmed attendees"},{title:"Pending",value:((d=l.data)==null?void 0:d.filter(o=>o.status==="pending").length)||0,icon:e.jsx(R,{}),color:"text-warning",iconBg:"bg-warning/20",description:"Awaiting approval"},{title:"Rejected",value:((i=l.data)==null?void 0:i.filter(o=>o.status==="rejected").length)||0,icon:e.jsx(we,{}),color:"text-danger",iconBg:"bg-danger/20",description:"Not approved"}]},[l]),r=()=>{var o;if(typeof window>"u")return"lg";const d=((o=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:o.trim())||"12px",i=parseInt(d);return i===0?"none":i<=4?"sm":i<=8?"md":i<=16?"lg":"full"},[_,L]=n.useState(!1),[Ee,V]=n.useState(!1);n.useEffect(()=>{const s=()=>{L(window.innerWidth<640),V(window.innerWidth<768)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const $=async s=>{try{await j.post(route("events.registrations.approve",[t.id,s.id])),a.success("Registration approved successfully"),p.reload()}catch{a.error("Failed to approve registration")}},D=s=>{M(s),C("reject"),N()},I=async()=>{try{await j.post(route("events.registrations.reject",[t.id,z.id]),{rejection_reason:y}),a.success("Registration rejected"),g(),b(""),p.reload()}catch{a.error("Failed to reject registration")}},O=async s=>{try{await j.post(route("events.registrations.verify-payment",[t.id,s.id])),a.success("Payment verified successfully"),p.reload()}catch{a.error("Failed to verify payment")}},Y=async()=>{if(m.size===0){a.warning("Please select registrations to approve");return}try{await j.post(route("events.registrations.bulk-approve",t.id),{registration_ids:Array.from(m)}),a.success("Registrations approved successfully"),w(new Set([])),p.reload()}catch{a.error("Failed to approve registrations")}},Q=()=>{if(m.size===0){a.warning("Please select registrations to reject");return}C("bulkReject"),N()},K=async()=>{try{await j.post(route("events.registrations.bulk-reject",t.id),{registration_ids:Array.from(m),rejection_reason:y}),a.success("Registrations rejected"),w(new Set([])),g(),b(""),p.reload()}catch{a.error("Failed to reject registrations")}},U=()=>{window.location.href=route("events.registrations.export-csv",t.id)},W=s=>{window.open(route("events.registrations.print-token",[t.id,s.id]),"_blank")},q=s=>{switch(s){case"approved":return"success";case"pending":return"warning";case"rejected":return"danger";case"cancelled":return"default";default:return"default"}},H=(P=l.data)==null?void 0:P.filter(s=>s.name.toLowerCase().includes(f.toLowerCase())||s.email.toLowerCase().includes(f.toLowerCase())||s.token.toLowerCase().includes(f.toLowerCase()));return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:`Registrations - ${t.title}`}),e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"max-w-[1600px] mx-auto",children:e.jsx("div",{className:"p-6",children:e.jsx(ye.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(F,{className:"bg-content1/50 backdrop-blur-md border border-divider/30",style:{borderRadius:"var(--borderRadius, 12px)"},children:[e.jsx(X,{className:"pb-0",children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 p-6 pb-2",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-primary/20",children:e.jsx(R,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Event Registrations"}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:t.title})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{variant:"flat",onPress:()=>p.get(route("events.show",t.id)),startContent:e.jsx(be,{className:"w-5 h-5"}),radius:r(),size:_?"sm":"md",children:!_&&"Back to Event"}),e.jsx(x,{color:"primary",variant:"flat",onPress:U,startContent:e.jsx(_e,{className:"w-5 h-5"}),radius:r(),size:_?"sm":"md",children:"Export CSV"})]})]})})}),e.jsxs(E,{className:"p-6",children:[e.jsx(fe,{stats:B,className:"mb-6"}),e.jsx(F,{className:"bg-content2/50",style:{borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(E,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-4 mb-6",children:[e.jsx(Z,{placeholder:"Search by name, email, or token...",value:f,onChange:s=>A(s.target.value),startContent:e.jsx(Re,{className:"w-4 h-4"}),className:"max-w-md",radius:r()}),m.size>0&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{color:"success",variant:"flat",onPress:Y,radius:r(),children:["Approve Selected (",m.size,")"]}),e.jsxs(x,{color:"danger",variant:"flat",onPress:Q,radius:r(),children:["Reject Selected (",m.size,")"]})]})]}),e.jsxs(ee,{"aria-label":"Event registrations table",selectionMode:"multiple",selectedKeys:m,onSelectionChange:w,children:[e.jsxs(se,{children:[e.jsx(c,{children:"TOKEN"}),e.jsx(c,{children:"NAME"}),e.jsx(c,{children:"EMAIL"}),e.jsx(c,{children:"PHONE"}),e.jsx(c,{children:"SUB-EVENTS"}),e.jsx(c,{children:"STATUS"}),e.jsx(c,{children:"PAYMENT"}),e.jsx(c,{children:"DATE"}),e.jsx(c,{children:"ACTIONS"})]}),e.jsx(te,{items:H||[],children:s=>{var d,i;return e.jsxs(re,{children:[e.jsx(u,{children:e.jsx("span",{className:"font-mono text-sm",children:s.token})}),e.jsx(u,{children:s.name}),e.jsx(u,{children:s.email}),e.jsx(u,{children:s.phone}),e.jsx(u,{children:e.jsxs("div",{className:"text-xs",children:[(d=s.sub_events)==null?void 0:d.slice(0,2).map((o,J)=>e.jsx("div",{children:o.title},J)),((i=s.sub_events)==null?void 0:i.length)>2&&e.jsxs("div",{className:"text-default-400",children:["+",s.sub_events.length-2," more"]})]})}),e.jsx(u,{children:e.jsx(v,{size:"sm",color:q(s.status),variant:"flat",radius:r(),children:s.status})}),e.jsx(u,{children:s.payment_verified?e.jsx(v,{size:"sm",color:"success",variant:"flat",radius:r(),children:"Verified"}):s.payment_proof?e.jsx(v,{size:"sm",color:"warning",variant:"flat",radius:r(),children:"Pending"}):e.jsx(v,{size:"sm",color:"default",variant:"flat",radius:r(),children:"No Proof"})}),e.jsx(u,{children:ge(s.created_at).format("MMM DD, YYYY")}),e.jsx(u,{children:e.jsxs(ae,{children:[e.jsx(ie,{children:e.jsx(x,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(Ne,{className:"w-5 h-5"})})}),e.jsxs(oe,{"aria-label":"Actions",children:[e.jsx(h,{onPress:()=>p.get(route("events.registrations.show",[t.id,s.id])),children:"View Details"},"view"),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{color:"success",onPress:()=>$(s),children:"Approve"},"approve"),e.jsx(h,{color:"danger",onPress:()=>D(s),children:"Reject"},"reject")]}),s.payment_proof&&!s.payment_verified&&e.jsx(h,{color:"primary",onPress:()=>O(s),children:"Verify Payment"},"verify-payment"),e.jsx(h,{startContent:e.jsx(Se,{className:"w-4 h-4"}),onPress:()=>W(s),children:"Print Token"},"print")]})]})})]},s.id)}})]}),l.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(ne,{total:l.last_page,page:l.current_page,onChange:s=>p.get(route("events.registrations.index",t.id),{page:s}),showControls:!0,radius:r()})})]})})]})]})})})})}),e.jsx(le,{isOpen:T,onClose:g,radius:r(),children:e.jsxs(de,{children:[e.jsx(ce,{children:S==="bulkReject"?"Reject Selected Registrations":"Reject Registration"}),e.jsx(ue,{children:e.jsx(me,{label:"Rejection Reason (Optional)",placeholder:"Enter reason for rejection",value:y,onChange:s=>b(s.target.value),rows:4,radius:r()})}),e.jsxs(pe,{children:[e.jsx(x,{variant:"flat",onPress:g,radius:r(),children:"Cancel"}),e.jsx(x,{color:"danger",onPress:S==="bulkReject"?K:I,radius:r(),children:"Reject"})]})]})})]})};Ce.layout=t=>e.jsx(je,{children:t});export{Ce as default};
