import{J as ne,j as e,a,b as L,F as oe,Q as ce}from"./app-Dx-HjiV0.js";import{R as de,r as k,g as me}from"./react-core-DDvupgOx.js";import{g as z,d as Q,h as J,e as se,B as pe,f as ue,p as he,A as fe}from"./App-DzrSbeaT.js";import{G as le}from"./logo-XpVR0XfY.js";import{u as O,a as A,B as r,T as n,e as be,p as xe,o as ge,w as ke,x as ye,y as U,z as M,E as Ne,a7 as ve,q as we,r as De,f as Se,G as Fe}from"./mui-libraries-DeLqYkpc.js";import{F as I,a as V,u as Y,w as Ce}from"./xlsx-DdG13tcJ.js";import{F as q}from"./ClockIcon-DNQ3nlJB.js";import{F as X}from"./CheckCircleIcon-DnGOlVla.js";import{F as Z}from"./MapPinIcon-C7XkNQ6g.js";import{F as ie}from"./CheckCircleIcon-CJUGb5Jf.js";import{F as B}from"./ChartBarIcon-Yugn57JF.js";import{F as We}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{v as N,p as j,f as H,J as K,m as Pe,n as Re,o as $e,q as _e,k as Ee,j as ee,T as te,s as Te,l as ae}from"./ui-libraries-CxFzkmxb.js";import{P as Me}from"./PageHeader-CVbskR4q.js";import{S as Ie}from"./StatsCards-rWYFLuJV.js";import{C as je}from"./Clear-px5i6SxB.js";import{G as ze}from"./GlassDialog-CSu7gZxE.js";import{L as Ae}from"./LoadingButton-C28XDuJL.js";import{D as Be}from"./Download-mF4uThU-.js";import{d as W}from"./dayjs.min-WGrXCzEl.js";import{F as Ge}from"./DocumentArrowDownIcon-Cq-JO3FQ.js";import{F as Le}from"./UserIcon-D16nn9o_.js";import"./utilities-DT6SRl8s.js";import"./EnvelopeIcon-D6nUSkik.js";import"./ShieldCheckIcon-C7bFKizx.js";const Ye=({filteredData:x})=>{const{auth:P}=ne().props;O(),A("(min-width: 1025px)"),A("(min-width: 641px) and (max-width: 1024px)");const C=A("(max-width: 640px)"),R=t=>new Date(t).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),g=t=>t>=100?"success":t>=75?"warning":t>=50?"primary":"danger",v=t=>t>=100?e(X,{className:"w-3 h-3"}):t>=50?e(q,{className:"w-3 h-3"}):e(We,{className:"w-3 h-3"}),o=(t,m)=>{const s="w-3 h-3",c=m>0?"":"text-gray-400";switch(t?.toLowerCase()){case"embankment":return e(J,{className:`${s} text-amber-500 ${c}`});case"structure":return e(I,{className:`${s} text-blue-500 ${c}`});case"pavement":return e(Z,{className:`${s} text-gray-500 ${c}`});default:return e(z,{className:`${s} text-primary ${c}`})}},d=({summary:t})=>{const m=t.totalDailyWorks>0?(t.completed/t.totalDailyWorks*100).toFixed(1):0,s=t.rfiSubmissions>0&&t.completed>0?(t.rfiSubmissions/t.completed*100).toFixed(1):0,c=t.totalDailyWorks-t.completed;return e(le,{className:"mb-2",shadow:"sm",children:a(be,{className:"p-3",children:[a(r,{className:"flex items-start justify-between mb-3",children:[e(r,{className:"flex items-center gap-3 flex-1",children:a(r,{className:"flex flex-col",children:[e(n,{variant:"body2",fontWeight:"bold",className:"text-primary",children:R(t.date)}),a(n,{variant:"caption",color:"textSecondary",children:[t.totalDailyWorks," total works"]})]})}),e(r,{className:"flex items-center gap-2",children:a(H,{size:"sm",variant:"flat",color:g(parseFloat(m)),startContent:v(parseFloat(m)),children:[m,"%"]})})]}),e(ee,{className:"my-3"}),a(r,{className:"space-y-3 mb-3",children:[a(r,{children:[a(r,{className:"flex justify-between items-center mb-1",children:[e(n,{variant:"caption",className:"text-xs",children:"Completion Progress"}),a(n,{variant:"caption",className:"text-xs font-medium",children:[t.completed,"/",t.totalDailyWorks]})]}),e(j,{value:parseFloat(m),color:g(parseFloat(m)),size:"sm",className:"w-full"})]}),t.rfiSubmissions>0&&a(r,{children:[a(r,{className:"flex justify-between items-center mb-1",children:[e(n,{variant:"caption",className:"text-xs",children:"RFI Submission"}),a(n,{variant:"caption",className:"text-xs font-medium",children:[t.rfiSubmissions,"/",t.completed]})]}),e(j,{value:parseFloat(s),color:g(parseFloat(s)),size:"sm",className:"w-full"})]})]}),a(r,{className:"grid grid-cols-3 gap-2",children:[a(r,{className:"flex flex-col items-center p-2 bg-white/5 rounded-lg",children:[o("embankment",t.embankment),e(n,{variant:"caption",className:"text-xs mt-1",children:"Embankment"}),e(n,{variant:"body2",fontWeight:"medium",className:"text-xs",children:t.embankment})]}),a(r,{className:"flex flex-col items-center p-2 bg-white/5 rounded-lg",children:[o("structure",t.structure),e(n,{variant:"caption",className:"text-xs mt-1",children:"Structure"}),e(n,{variant:"body2",fontWeight:"medium",className:"text-xs",children:t.structure})]}),a(r,{className:"flex flex-col items-center p-2 bg-white/5 rounded-lg",children:[o("pavement",t.pavement),e(n,{variant:"caption",className:"text-xs mt-1",children:"Pavement"}),e(n,{variant:"body2",fontWeight:"medium",className:"text-xs",children:t.pavement})]})]}),e(ee,{className:"my-3"}),a(r,{className:"flex justify-between text-xs",children:[a(r,{className:"flex items-center gap-1",children:[e(V,{className:"w-3 h-3 text-warning"}),a("span",{children:["Resubmissions: ",t.resubmissions]})]}),a(r,{className:"flex items-center gap-1",children:[e(q,{className:"w-3 h-3 text-danger"}),a("span",{children:["Pending: ",c]})]})]})]})})},u=de.useCallback((t,m)=>{const s=t.totalDailyWorks>0?(t.completed/t.totalDailyWorks*100).toFixed(1):0,c=t.rfiSubmissions>0&&t.completed>0?(t.rfiSubmissions/t.completed*100).toFixed(1):0,w=t.totalDailyWorks-t.completed;switch(m){case"date":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(Q,{className:"w-3 h-3 text-default-500"}),e(n,{variant:"body2",className:"text-sm font-medium",children:R(t.date)})]})});case"totalDailyWorks":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(z,{className:"w-3 h-3 text-primary"}),e(n,{variant:"body2",className:"text-sm font-bold",children:t.totalDailyWorks})]})});case"resubmissions":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(V,{className:"w-3 h-3 text-warning"}),e(n,{variant:"body2",className:"text-sm",children:t.resubmissions})]})});case"embankment":case"structure":case"pavement":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[o(m,t[m]),e(n,{variant:"body2",className:"text-sm",children:t[m]})]})});case"completed":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(X,{className:"w-3 h-3 text-success"}),e(n,{variant:"body2",className:"text-sm font-medium text-success",children:t.completed})]})});case"pending":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(q,{className:"w-3 h-3 text-danger"}),e(n,{variant:"body2",className:"text-sm font-medium text-danger",children:w})]})});case"completionPercentage":return e(N,{children:a(r,{className:"flex items-center gap-2",children:[e(j,{value:parseFloat(s),color:g(parseFloat(s)),size:"sm",className:"flex-1 min-w-[80px]"}),a(H,{size:"sm",variant:"flat",color:g(parseFloat(s)),startContent:v(parseFloat(s)),children:[s,"%"]})]})});case"rfiSubmissions":return e(N,{children:a(r,{className:"flex items-center gap-1",children:[e(I,{className:"w-3 h-3 text-info"}),e(n,{variant:"body2",className:"text-sm",children:t.rfiSubmissions})]})});case"rfiSubmissionPercentage":return e(N,{children:e(r,{className:"flex items-center gap-2",children:t.rfiSubmissions>0?a(L,{children:[e(j,{value:parseFloat(c),color:g(parseFloat(c)),size:"sm",className:"flex-1 min-w-[80px]"}),a(H,{size:"sm",variant:"flat",color:g(parseFloat(c)),startContent:v(parseFloat(c)),children:[c,"%"]})]}):e(n,{variant:"body2",className:"text-sm text-default-400",children:"-"})})});default:return e(N,{children:t[m]})}},[]),y=[{name:"Date",uid:"date",icon:Q},{name:"Total Daily Works",uid:"totalDailyWorks",icon:z},{name:"Resubmissions",uid:"resubmissions",icon:oe},{name:"Embankment",uid:"embankment",icon:J},{name:"Structure",uid:"structure",icon:I},{name:"Pavement",uid:"pavement",icon:Z},{name:"Completed",uid:"completed",icon:ie},{name:"Pending",uid:"pending",icon:se},{name:"Completion %",uid:"completionPercentage",icon:B},{name:"RFI Submissions",uid:"rfiSubmissions",icon:I},{name:"RFI Submission %",uid:"rfiSubmissionPercentage",icon:B}];return C?e(r,{className:"space-y-4",children:e(K,{className:"max-h-[70vh]",children:x?.map((t,m)=>e(d,{summary:t},m))})}):e(r,{sx:{maxHeight:"70vh",overflowY:"auto"},children:e(K,{className:"max-h-[70vh]",children:a(Ee,{isStriped:!0,selectionMode:"none",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Daily Work Summary Table",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(Pe,{columns:y,children:t=>e(Re,{className:"bg-default-100/80 backdrop-blur-md",children:a(r,{className:"flex items-center gap-1",children:[t.icon&&e(t.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:t.name})]})},t.uid)}),e($e,{items:x||[],emptyContent:a(r,{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(B,{className:"w-12 h-12 text-default-300 mb-4"}),e(n,{variant:"h6",color:"textSecondary",children:"No summary data found"}),e(n,{variant:"body2",color:"textSecondary",children:"No work summary available for the selected period"})]}),children:t=>e(_e,{children:m=>u(t,m)},t.date)})]})})})},qe=({open:x,closeModal:P,filteredData:C,users:R})=>{const[g,v]=k.useState(!1),o=O(),d=[{label:"Date",key:"date"},{label:"Total Daily Works",key:"totalDailyWorks"},{label:"Resubmissions",key:"resubmissions"},{label:"Embankment",key:"embankment"},{label:"Structure",key:"structure"},{label:"Pavement",key:"pavement"},{label:"Completed",key:"completed"},{label:"Pending",key:"pending"},{label:"Completion Percentage",key:"completionPercentage"},{label:"RFI Submissions",key:"rfiSubmissions"},{label:"RFI Submission Percentage",key:"rfiSubmissionPercentage"}],[u,y]=k.useState(d.map(s=>({...s,checked:!0}))),t=s=>{const c=[...u];c[s].checked=!c[s].checked,y(c)},m=async s=>{const c=new Promise((w,h)=>{try{if(!s||s.length===0){h("No columns selected for export.");return}const $=C.map(_=>{const i={},f=_.totalDailyWorks||0,l=_.completed||0,b=_.rfiSubmissions||0,p=f>0?`${f-l}`:"0",D=f>0?`${(l/f*100).toFixed(1)}%`:"0%",S=f>0?`${(b/f*100).toFixed(1)}%`:"0%";return s.forEach(F=>{F.checked&&(F.key==="pending"?i[F.label]=p:F.key==="completionPercentage"?i[F.label]=D:F.key==="rfiSubmissionPercentage"?i[F.label]=S:i[F.label]=_[F.key]||"")}),i});if($.length===0){h("No data available for export.");return}const E=Y.json_to_sheet($),T=Y.book_new();Y.book_append_sheet(T,E,"Daily Work Summary"),Ce(T,"DailyWorkSummary.xlsx"),w("Export successful!"),P()}catch($){h("Failed to export data. Please try again."),console.error("Error exporting data to Excel:",$)}});pe.promise(c,{pending:{render(){return a("div",{style:{display:"flex",alignItems:"center"},children:[e(Se,{}),e("span",{style:{marginLeft:"8px"},children:"Exporting data to Excel ..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:w}){return e(L,{children:w})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:w}){return e(L,{children:w})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})};return a(ze,{open:x,onClose:P,children:[a(xe,{style:{cursor:"move"},id:"draggable-dialog-title",children:[e(n,{children:"Export Daily Works"}),e(ge,{variant:"outlined",color:"primary",onClick:P,sx:{position:"absolute",top:8,right:16},children:e(je,{})})]}),e(we,{children:a(ke,{size:"small",sx:{"& .MuiTableCell-root":{padding:"4px 8px"},"& .MuiCheckbox-root":{padding:"0px"}},children:[e(ye,{children:a(U,{children:[e(M,{children:"Column Label"}),e(M,{align:"center",children:"Include in Export"})]})}),e(Ne,{children:u.map((s,c)=>a(U,{children:[e(M,{children:s.label}),e(M,{align:"center",children:e(ve,{checked:s.checked,onChange:()=>t(c)})})]},s.key))})]})}),e(De,{sx:{display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:e(Ae,{sx:{borderRadius:"50px",padding:"6px 16px"},variant:"outlined",color:"primary",type:"submit",onClick:()=>m(u),startIcon:e(Be,{}),children:"Download"})})]})};var G={exports:{}},He=G.exports,re;function Oe(){return re||(re=1,function(x,P){(function(C,R){x.exports=R()})(He,function(){return function(C,R,g){var v=function(o,d){if(!d||!d.length||d.length===1&&!d[0]||d.length===1&&Array.isArray(d[0])&&!d[0].length)return null;var u;d.length===1&&d[0].length>0&&(d=d[0]),u=(d=d.filter(function(t){return t}))[0];for(var y=1;y<d.length;y+=1)d[y].isValid()&&!d[y][o](u)||(u=d[y]);return u};g.max=function(){var o=[].slice.call(arguments,0);return v("isAfter",o)},g.min=function(){var o=[].slice.call(arguments,0);return v("isBefore",o)}}})}(G)),G.exports}var Qe=Oe();const Je=me(Qe);W.extend(Je);const Ue=({auth:x,title:P,summary:C,jurisdictions:R,inCharges:g})=>{const v=O();A(v.breakpoints.down("sm"));const[o,d]=k.useState(C),[u,y]=k.useState(C),t=o.map(i=>W(i.date)),[m,s]=k.useState(null),c=k.useCallback(i=>{s(i)},[]),w=k.useCallback(()=>{s(null)},[]),[h,$]=k.useState({startDate:W.min(...t),endDate:W.max(...t),status:"all",incharge:"all"}),E=k.useCallback((i,f)=>{$(l=>({...l,[i]:f}))},[]),T=k.useMemo(()=>{const i=u.reduce((D,S)=>D+S.totalDailyWorks,0),f=u.reduce((D,S)=>D+S.completed,0),l=u.reduce((D,S)=>D+S.pending,0),b=u.reduce((D,S)=>D+S.rfiSubmissions,0),p=i>0?(f/i*100).toFixed(1):0;return[{title:"Total Works",value:i,icon:e(B,{className:"w-5 h-5"}),color:"text-blue-600",description:"All logged works"},{title:"Completed",value:f,icon:e(ie,{className:"w-5 h-5"}),color:"text-green-600",description:`${p}% completion rate`},{title:"Pending",value:l,icon:e(se,{className:"w-5 h-5"}),color:"text-orange-600",description:"In progress"},{title:"RFI Submissions",value:b,icon:e(z,{className:"w-5 h-5"}),color:"text-purple-600",description:"Ready for inspection"}]},[u]),_=[...x.roles.includes("Administrator")||x.designation==="Supervision Engineer"?[{label:"Export",icon:e(Ge,{className:"w-4 h-4"}),variant:"flat",color:"success",onPress:()=>c("exportDailyWorkSummary"),className:"bg-gradient-to-r from-green-500/20 to-emerald-500/20 hover:from-green-500/30 hover:to-emerald-500/30"}]:[]];return k.useEffect(()=>{(!h.startDate||!h.endDate)&&$(i=>({...i,startDate:W.min(...t),endDate:W.max(...t)}))},[t]),k.useEffect(()=>{const f=o.filter(l=>W(l.date).isBetween(h.startDate,h.endDate,null,"[]")&&(h.incharge==="all"||!h.incharge||l.incharge===h.incharge)).reduce((l,b)=>{const p=W(b.date).format("YYYY-MM-DD");return l[p]?(l[p].totalDailyWorks+=b.totalDailyWorks,l[p].resubmissions+=b.resubmissions,l[p].embankment+=b.embankment,l[p].structure+=b.structure,l[p].pavement+=b.pavement,l[p].pending+=b.pending,l[p].completed+=b.completed,l[p].rfiSubmissions+=b.rfiSubmissions,l[p].completionPercentage=l[p].totalDailyWorks>0?l[p].completed/l[p].totalDailyWorks*100:0,l[p].rfiSubmissionPercentage=l[p].totalDailyWorks>0?l[p].rfiSubmissions/l[p].totalDailyWorks*100:0):l[p]={...b},l},{});y(Object.values(f))},[h,o]),a(L,{children:[e(ce,{title:P}),m==="exportDailyWorkSummary"&&e(qe,{open:m==="exportDailyWorkSummary",closeModal:w,filteredData:u}),e(r,{sx:{display:"flex",justifyContent:"center",p:2},children:e(Fe,{in:!0,children:e(le,{children:e(Me,{title:"Daily Work Summary",subtitle:"Overview of daily work statistics and progress",icon:e(he,{className:"w-8 h-8 text-blue-600"}),actionButtons:_,children:a("div",{className:"p-6",children:[e(Ie,{stats:T}),e("div",{className:"mb-6 bg-white/5 backdrop-blur-md rounded-lg border border-white/10 p-4",children:a("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[a("div",{className:"flex flex-col sm:flex-row gap-2 items-center",children:[e(ue,{className:"w-5 h-5 text-default-400"}),e(n,{variant:"body2",className:"text-default-600 whitespace-nowrap",children:"Date Range:"}),a("div",{className:"flex gap-2 items-center",children:[e(te,{label:"Start date",value:h.startDate,onChange:i=>E("startDate",i),size:"sm",variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}}),e(n,{variant:"body2",className:"text-default-500",children:"to"}),e(te,{label:"End date",value:h.endDate,onChange:i=>E("endDate",i),size:"sm",variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"}})]})]}),(x.roles.includes("Administrator")||x.designation==="Supervision Engineer")&&a("div",{className:"flex gap-2 items-center",children:[e(Le,{className:"w-5 h-5 text-default-400"}),a(Te,{label:"In Charge",selectedKeys:h.incharge==="all"?[]:[h.incharge],onSelectionChange:i=>{const f=Array.from(i)[0]||"all";E("incharge",f)},size:"sm",variant:"bordered",className:"w-full sm:w-48",classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/15"},children:[e(ae,{value:"all",children:"All"},"all"),g.map(i=>e(ae,{value:i.id,children:i.name},i.id))]})]})]})}),e("div",{className:"bg-white/5 backdrop-blur-md rounded-lg border border-white/10 p-4",children:e(Ye,{filteredData:u,openModal:c})})]})})})})})]})};Ue.layout=x=>e(fe,{children:x});export{Ue as default};
