import{j as e,k as pe,m as es,n as ss,o as rs,q as ts,r as as,v as ls,p as ns,L as Me,b as I,h as K,a as ne,e as oe,d as Qe,H as cr,I as Fe,i as ie,s as Ne,l as Q,K as Cs,f as dr,t as _s}from"./vendor-heroui-CinxWHhv.js";import{r as t,S as ks,Q as mr}from"./vendor-inertia-sUfCHI_5.js";import{u as ur,b as xr}from"./app-B7weFyPg.js";import{r as Le,P as hr,u as As,s as Is,G as Ke,A as fr}from"./Dashboard-CINCscCz.js";import"./GlassCard-RWAi4NQF.js";import{S as pr}from"./StatsCards-C245yd79.js";import{F as he}from"./UserGroupIcon-CSQScwVa.js";import{F as Ls}from"./PencilSquareIcon-DOHXhjaO.js";import{F as Ms}from"./TrashIcon-Dnjv_I7q.js";import{F as fe}from"./KeyIcon-BIi5nz4o.js";import{F as gr}from"./EnvelopeIcon-CFKoTD3N.js";import{a as xe}from"./vendor-utils-CrJAVL9K.js";import{s as F}from"./toastUtils-BVg-E_WQ.js";import{F as br}from"./FunnelIcon-DZ8SUaNX.js";import{F as Ds}from"./ExclamationTriangleIcon-BarRaUA8.js";import{e as vr}from"./vendor-framer-B7qqn1b6.js";import{F as jr}from"./ShieldCheckIcon-Ck-ae4AP.js";import{F as yr}from"./DocumentArrowDownIcon-DCm9Iy1y.js";import{F as Xe}from"./AdjustmentsHorizontalIcon-lemo7t2o.js";import{F as Es}from"./PlusIcon-BO1LbXgZ.js";import{F as Ye}from"./MagnifyingGlassIcon-BJyUDYwI.js";import"./vendor-react-FouZbkAE.js";import"./MapPinIcon-DDwLGyCW.js";import"./ClockIcon-BKLni_N9.js";import"./UserIcon-CgrjQ1A2.js";import"./XMarkIcon-twQGc8di.js";import"./logo-DFaNDj_M.js";import"./CheckCircleIcon-BAvoXTNq.js";const wr=({roles:m=[],permissions:p=[],getRolePermissions:P,onEdit:S,onDelete:N,canManageRole:o,isMobile:T,isTablet:U,pagination:b,onPageChange:Z,loading:D=!1})=>{const L=()=>{var v;if(typeof window>"u")return"lg";const R=((v=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:v.trim())||"12px",C=parseInt(R);return C===0?"none":C<=4?"sm":C<=8?"md":C<=16?"lg":"full"},l=(()=>{const n=[{name:"#",uid:"sl",width:60},{name:"ROLE",uid:"role",width:"auto",minWidth:200},{name:"DESCRIPTION",uid:"description",width:250},{name:"PERMISSIONS",uid:"permissions",width:200},{name:"STATUS",uid:"status",width:100},{name:"ACTIONS",uid:"actions",width:100}];return T?n.filter(R=>["sl","role","status","actions"].includes(R.uid)):U?n.filter(R=>!["description"].includes(R.uid)):n})(),c=(n,R,C)=>{const w=(b!=null&&b.currentPage&&(b!=null&&b.perPage)?Number((b.currentPage-1)*b.perPage):0)+(typeof C=="number"?C:0)+1,O=(P?P(n.id):[]).map(H=>{var z;return(z=p.find(be=>be.id===H))==null?void 0:z.name}).filter(Boolean);switch(R){case"sl":return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:e.jsx("span",{className:"text-sm font-semibold text-foreground",children:w})})});case"role":return e.jsx("div",{className:"min-w-max",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shrink-0",style:{background:"linear-gradient(135deg, var(--theme-primary), color-mix(in srgb, var(--theme-primary) 70%, var(--theme-secondary)))"},children:n.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-semibold text-foreground text-left whitespace-nowrap",children:n.name}),n.name==="Super Administrator"&&e.jsx(K,{size:"sm",color:"warning",variant:"flat",children:"System"})]}),T&&n.description&&e.jsx("p",{className:"text-default-500 text-left text-xs truncate max-w-[150px]",children:n.description})]})]})});case"description":return e.jsx("div",{className:"max-w-[250px]",children:e.jsx("p",{className:"text-sm text-default-600 truncate",children:n.description||e.jsx("span",{className:"text-default-400 italic",children:"No description"})})});case"permissions":return e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[200px]",children:[O.slice(0,3).map((z,be)=>e.jsx(K,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:z},be)),O.length>3&&e.jsxs(K,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",O.length-3," more"]}),O.length===0&&e.jsx("span",{className:"text-default-400 text-xs italic",children:"No permissions"})]});case"status":return e.jsx(K,{size:"sm",color:n.is_active!==!1?"success":"default",variant:"flat",children:n.is_active!==!1?"Active":"Inactive"});case"actions":const H=o?o(n):!0;return e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(Me,{content:"Edit Role",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>S==null?void 0:S(n),isDisabled:!H,className:"text-primary hover:text-primary/80",children:e.jsx(Ls,{className:"w-4 h-4"})})}),e.jsx(Me,{content:"Delete Role",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>N==null?void 0:N(n),isDisabled:!H,className:"text-danger hover:text-danger/80",children:e.jsx(Ms,{className:"w-4 h-4"})})})]});default:return null}},x=()=>!b||D?null:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2",style:{borderTop:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)",background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("span",{className:"text-xs mb-3 sm:mb-0 opacity-70",style:{color:"var(--theme-foreground)"},children:["Showing ",(b.currentPage-1)*b.perPage+1," to ",Math.min(b.currentPage*b.perPage,b.total)," of ",b.total," roles"]}),e.jsx(ns,{total:Math.ceil(b.total/b.perPage),initialPage:b.currentPage,page:b.currentPage,onChange:Z,size:T?"sm":"md",variant:"bordered",showControls:!0})]});return e.jsxs("div",{className:"w-full overflow-hidden flex flex-col relative",style:{maxHeight:"calc(100vh - 400px)",background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:L()},children:[D&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 20%, transparent)",backdropFilter:"blur(8px)",borderRadius:L()},children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6",children:[e.jsx(pe,{size:"lg",color:"primary"}),e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:"Loading roles..."})]})}),e.jsx("div",{className:"overflow-auto grow",children:e.jsxs(es,{"aria-label":"Roles table",removeWrapper:!0,classNames:{base:"bg-transparent min-w-[600px]",th:"backdrop-blur-md font-medium text-xs sticky top-0 z-10 whitespace-nowrap",td:"py-3 whitespace-nowrap",table:"border-collapse table-auto",tr:"hover:opacity-80 transition-all duration-200"},isHeaderSticky:!0,isCompact:T,children:[e.jsx(ss,{columns:l,children:n=>e.jsx(rs,{align:n.uid==="actions"||n.uid==="sl"?"center":"start",width:n.width,minWidth:n.minWidth,className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:n.name},n.uid)}),e.jsx(ts,{items:m||[],emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(he,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No roles found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:"Try adjusting your search or filter criteria"})]}),loadingContent:e.jsx(pe,{}),isLoading:D,children:n=>{const R=m?m.findIndex(C=>C.id===n.id):0;return e.jsx(as,{className:"transition-all duration-200",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:C=>e.jsx(ls,{className:"transition-all duration-300",children:c(n,C,R)})},n.id)}})]})}),x()]})},Nr=({permissions:m=[],onEdit:p,onDelete:P,isMobile:S,isTablet:N,pagination:o,onPageChange:T,loading:U=!1})=>{const b=()=>{var n;if(typeof window>"u")return"lg";const c=((n=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:n.trim())||"12px",x=parseInt(c);return x===0?"none":x<=4?"sm":x<=8?"md":x<=16?"lg":"full"},D=(()=>{const l=[{name:"#",uid:"sl",width:60},{name:"PERMISSION",uid:"permission",width:"auto",minWidth:250},{name:"NAME (KEY)",uid:"name_key",width:280},{name:"DESCRIPTION",uid:"description",width:"auto",minWidth:300},{name:"ACTIONS",uid:"actions",width:100}];return S?l.filter(c=>["sl","permission","actions"].includes(c.uid)):N?l.filter(c=>!["description"].includes(c.uid)):l})(),L=(l,c,x)=>{const C=(o!=null&&o.currentPage&&(o!=null&&o.perPage)?Number((o.currentPage-1)*o.perPage):0)+(typeof x=="number"?x:0)+1;switch(c){case"sl":return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:e.jsx("span",{className:"text-sm font-semibold text-foreground",children:C})})});case"permission":return e.jsx("div",{className:"min-w-max",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shrink-0",style:{background:"linear-gradient(135deg, var(--theme-success), color-mix(in srgb, var(--theme-success) 70%, var(--theme-primary)))"},children:l.name?l.name.charAt(0).toUpperCase():"P"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-semibold text-foreground text-left whitespace-nowrap",children:l.display_name||l.name}),S&&e.jsx("p",{className:"text-default-500 text-left text-xs truncate max-w-[150px]",children:l.name})]})]})});case"name_key":return e.jsx("div",{className:"max-w-[280px]",children:e.jsx("code",{className:"text-xs px-2 py-1 rounded bg-default-100 text-default-700",children:l.name})});case"description":return e.jsx("div",{className:"max-w-[250px]",children:e.jsx("p",{className:"text-sm text-default-600 truncate",children:l.description||e.jsx("span",{className:"text-default-400 italic",children:"No description"})})});case"actions":return e.jsxs("div",{className:"relative flex justify-center items-center gap-2",children:[e.jsx(Me,{content:"Edit Permission",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>p==null?void 0:p(l),className:"text-primary hover:text-primary/80",children:e.jsx(Ls,{className:"w-4 h-4"})})}),e.jsx(Me,{content:"Delete Permission",children:e.jsx(I,{isIconOnly:!0,size:"sm",variant:"light",onPress:()=>P==null?void 0:P(l),className:"text-danger hover:text-danger/80",children:e.jsx(Ms,{className:"w-4 h-4"})})})]});default:return null}},$=()=>!o||U?null:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2",style:{borderTop:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)",background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("span",{className:"text-xs mb-3 sm:mb-0 opacity-70",style:{color:"var(--theme-foreground)"},children:["Showing ",(o.currentPage-1)*o.perPage+1," to ",Math.min(o.currentPage*o.perPage,o.total)," of ",o.total," permissions"]}),e.jsx(ns,{total:Math.ceil(o.total/o.perPage),initialPage:o.currentPage,page:o.currentPage,onChange:T,size:S?"sm":"md",variant:"bordered",showControls:!0})]});return e.jsxs("div",{className:"w-full overflow-hidden flex flex-col relative",style:{maxHeight:"calc(100vh - 400px)",background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:b()},children:[U&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 20%, transparent)",backdropFilter:"blur(8px)",borderRadius:b()},children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6",children:[e.jsx(pe,{size:"lg",color:"primary"}),e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:"Loading permissions..."})]})}),e.jsx("div",{className:"overflow-auto grow",children:e.jsxs(es,{"aria-label":"Permissions table",removeWrapper:!0,classNames:{base:"bg-transparent min-w-[600px]",th:"backdrop-blur-md font-medium text-xs sticky top-0 z-10 whitespace-nowrap",td:"py-3 whitespace-nowrap",table:"border-collapse table-auto",tr:"hover:opacity-80 transition-all duration-200"},isHeaderSticky:!0,isCompact:S,children:[e.jsx(ss,{columns:D,children:l=>e.jsx(rs,{align:l.uid==="actions"||l.uid==="sl"?"center":"start",width:l.width,minWidth:l.minWidth,className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:l.name},l.uid)}),e.jsx(ts,{items:m||[],emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(fe,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No permissions found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:"Try adjusting your search or filter criteria"})]}),loadingContent:e.jsx(pe,{}),isLoading:U,children:l=>{const c=m?m.findIndex(x=>x.id===l.id):0;return e.jsx(as,{className:"transition-all duration-200",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},children:x=>e.jsx(ls,{className:"transition-all duration-300",children:L(l,x,c)})},l.id)}})]})}),$()]})},Sr=({users:m=[],roles:p=[],onRowClick:P,isMobile:S,isTablet:N,pagination:o,onPageChange:T,loading:U=!1})=>{const b=()=>{var n;if(typeof window>"u")return"lg";const c=((n=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:n.trim())||"12px",x=parseInt(c);return x===0?"none":x<=4?"sm":x<=8?"md":x<=16?"lg":"full"},D=(()=>{const l=[{name:"#",uid:"sl",width:60},{name:"USER",uid:"user",width:"auto",minWidth:200},{name:"EMAIL",uid:"email",width:220},{name:"ASSIGNED ROLES",uid:"roles",width:"auto",minWidth:300},{name:"STATUS",uid:"status",width:100}];return S?l.filter(c=>["sl","user","roles"].includes(c.uid)):N?l.filter(c=>!["status"].includes(c.uid)):l})(),L=(l,c,x)=>{const C=(o!=null&&o.currentPage&&(o!=null&&o.perPage)?Number((o.currentPage-1)*o.perPage):0)+(typeof x=="number"?x:0)+1,v=l.roles||[];switch(c){case"sl":return e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"flex items-center justify-center w-8 h-8 bg-white/10 backdrop-blur-md rounded-lg border border-white/20",children:e.jsx("span",{className:"text-sm font-semibold text-foreground",children:C})})});case"user":return e.jsx("div",{className:"min-w-max",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(hr,{src:l.profile_image_url||l.avatar,name:l.name,size:"sm",className:"shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-semibold text-foreground text-left whitespace-nowrap",children:l.name||"Unknown User"}),S&&l.email&&e.jsx("p",{className:"text-default-500 text-left text-xs truncate max-w-[150px]",children:l.email})]})]})});case"email":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gr,{className:"w-4 h-4 text-default-400"}),e.jsx("span",{className:"text-sm text-default-600",children:l.email||"No email"})]});case"roles":return e.jsx("div",{className:"flex flex-wrap gap-1 max-w-[300px]",children:v.length>0?e.jsxs(e.Fragment,{children:[v.slice(0,3).map((ge,w)=>e.jsx(K,{size:"sm",variant:"flat",color:"primary",className:"text-xs",children:ge.name},w)),v.length>3&&e.jsxs(K,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:["+",v.length-3," more"]})]}):e.jsx(K,{size:"sm",variant:"flat",color:"default",className:"text-xs",children:"No roles assigned"})});case"status":return e.jsx(K,{size:"sm",color:l.is_active!==!1?"success":"default",variant:"flat",children:l.is_active!==!1?"Active":"Inactive"});default:return null}},$=()=>!o||U?null:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between px-4 py-2",style:{borderTop:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)",background:"color-mix(in srgb, var(--theme-content2) 30%, transparent)",backdropFilter:"blur(16px)"},children:[e.jsxs("span",{className:"text-xs mb-3 sm:mb-0 opacity-70",style:{color:"var(--theme-foreground)"},children:["Showing ",(o.currentPage-1)*o.perPage+1," to ",Math.min(o.currentPage*o.perPage,o.total)," of ",o.total," users"]}),e.jsx(ns,{total:Math.ceil(o.total/o.perPage),initialPage:o.currentPage,page:o.currentPage,onChange:T,size:S?"sm":"md",variant:"bordered",showControls:!0})]});return e.jsxs("div",{className:"w-full overflow-hidden flex flex-col relative",style:{maxHeight:"calc(100vh - 400px)",background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",backdropFilter:"blur(16px)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:b()},children:[U&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",style:{background:"color-mix(in srgb, var(--theme-content1) 20%, transparent)",backdropFilter:"blur(8px)",borderRadius:b()},children:e.jsxs("div",{className:"flex flex-col items-center gap-4 p-6",children:[e.jsx(pe,{size:"lg",color:"primary"}),e.jsx("span",{className:"text-sm",style:{color:"var(--theme-foreground)"},children:"Loading users..."})]})}),e.jsx("div",{className:"overflow-auto grow",children:e.jsxs(es,{"aria-label":"User roles table",removeWrapper:!0,classNames:{base:"bg-transparent min-w-[600px]",th:"backdrop-blur-md font-medium text-xs sticky top-0 z-10 whitespace-nowrap",td:"py-3 whitespace-nowrap",table:"border-collapse table-auto",tr:"hover:opacity-80 transition-all duration-200"},isHeaderSticky:!0,isCompact:S,children:[e.jsx(ss,{columns:D,children:l=>e.jsx(rs,{align:l.uid==="actions"||l.uid==="sl"?"center":"start",width:l.width,minWidth:l.minWidth,className:"backdrop-blur-md",style:{backgroundColor:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 50%, transparent)"},children:l.name},l.uid)}),e.jsx(ts,{items:m||[],emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(Le,{className:"w-12 h-12 mb-4 opacity-40",style:{color:"var(--theme-foreground)"}}),e.jsx("h6",{className:"text-lg font-semibold mb-2",style:{color:"var(--theme-foreground)"},children:"No users found"}),e.jsx("p",{className:"text-sm opacity-70",style:{color:"var(--theme-foreground)"},children:"Try adjusting your search or filter criteria"})]}),loadingContent:e.jsx(pe,{}),isLoading:U,children:l=>{const c=m?m.findIndex(x=>x.id===l.id):0;return e.jsx(as,{className:"transition-all duration-200 cursor-pointer hover:bg-default-100/50",style:{color:"var(--theme-foreground)",borderBottom:"1px solid color-mix(in srgb, var(--theme-content3) 30%, transparent)"},onClick:()=>P==null?void 0:P(l),children:x=>e.jsx(ls,{className:"transition-all duration-300",children:L(l,x,c)})},l.id)}})]})}),$()]})},Je=m=>Array.isArray(m)?[...m]:[],Fs=m=>m&&typeof m=="object"&&!Array.isArray(m)?{...m}:{},Pr=m=>{const p={roles:Je(m.roles),permissions:Je(m.permissions),role_has_permissions:Je(m.role_has_permissions),permissionsGrouped:Fs(m.permissionsGrouped||m.permissions_grouped),enterprise_modules:Fs(m.enterprise_modules),errors:[]};if(p.roles.length===0&&p.errors.push("No roles data available"),p.permissions.length===0&&p.errors.push("No permissions data available"),p.roles.length>0&&p.permissions.length>0&&p.role_has_permissions.length===0&&p.errors.push("Role-permission relationships missing - this may indicate a cache or database issue"),p.role_has_permissions.length>0){const P=p.roles.map(o=>o.id),S=p.permissions.map(o=>o.id),N=p.role_has_permissions.filter(o=>!P.includes(o.role_id)||!S.includes(o.permission_id));N.length>0&&p.errors.push(`${N.length} invalid role-permission relationships found`)}return p},Ze=(m,p)=>{const[P,S]=t.useState(m);return t.useEffect(()=>{const N=setTimeout(()=>{S(m)},p);return()=>{clearTimeout(N)}},[m,p]),P},j={IDLE:"idle",LOADING:"loading",SUCCESS:"success",ERROR:"error"},Rr=m=>{const p=t.useMemo(()=>Pr(m),[m]),P=p.roles,S=p.permissions,N=p.permissionsGrouped,o=p.role_has_permissions;p.enterprise_modules;const T=!!m.can_manage_super_admin,U=m.title;m.error;const b=p.errors,Z=m.users||[],D=t.useRef(new Map),L=t.useRef(new Map),$=t.useRef(Date.now()),{themeSettings:l}=ur();l==null||l.mode;const c=As("(max-width: 640px)"),x=As("(max-width: 768px)"),n=()=>{var i;if(typeof window>"u")return"lg";const r=((i=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:i.trim())||"12px",a=parseInt(r);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},[R,C]=t.useState(0),[v,ge]=t.useState(P),[w,Te]=t.useState(S),[O,H]=t.useState(o),[z,be]=t.useState(P.length>0?P[0].id:null),[W,ee]=t.useState(new Set),[_,X]=t.useState(!1),[G,A]=t.useState({permissions:{},modules:{},roles:j.IDLE,users:j.IDLE}),[Ts,os]=t.useState(!1),[Os,is]=t.useState(!1),[Cr,cs]=t.useState(!1),[_r,ds]=t.useState(!1),[se,ms]=t.useState(null),[re,us]=t.useState(null),[kr,xs]=t.useState(null),[Ar,hs]=t.useState(null),[zs,ce]=t.useState(!1),[de,fs]=t.useState(null),[Se,ps]=t.useState(null),[Pe,gs]=t.useState(""),[Re,bs]=t.useState(""),[Ce,vs]=t.useState(""),[me,js]=t.useState("all"),[ve,ys]=t.useState("all"),_e=Ze(Pe,300),je=Ze(Re,300),ke=Ze(Ce,300),[Oe,ze]=t.useState(0),[Ue,ws]=t.useState(0),[$e,We]=t.useState(0),[Ae,Ir]=t.useState(10),[Ie,Dr]=t.useState(10),[De,Er]=t.useState(10),[Fr,E]=t.useState(""),[Lr,ye]=t.useState(""),[Y,ue]=t.useState({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0}),[B,te]=t.useState({name:"",display_name:"",description:"",module:"",guard_name:"web"}),[q,V]=t.useState({}),[Mr,Ns]=t.useState(new Set),[Tr,Ss]=t.useState(new Set),[Or,zr]=t.useState(!1),h=t.useMemo(()=>v.find(s=>s.id===z)||null,[v,z]),ae=t.useCallback(s=>{if(Array.isArray(O)){const r=O.filter(a=>a&&a.role_id===s).map(a=>a.permission_id).filter(Boolean);if(r.length>0)return r}if(Array.isArray(v)){const r=v.find(a=>a&&a.id===s);if(r&&Array.isArray(r.permissions))return r.permissions.map(a=>a.id).filter(Boolean)}return[]},[O,v]);t.useEffect(()=>{if(z){const s=ae(z),r=new Set(s);(r.size!==W.size||[...r].some(a=>!W.has(a)))&&ee(r)}else W.size>0&&ee(new Set)},[z,O,v,ae]),t.useMemo(()=>h,[h==null?void 0:h.id,h==null?void 0:h.name]),t.useMemo(()=>T,[T]);const le=t.useMemo(()=>({totalRoles:Array.isArray(v)?v.length:0,totalPermissions:Array.isArray(w)?w.length:0,activeRole:(h==null?void 0:h.name)||"None Selected",grantedPermissions:W.size}),[v,w,h,W]);t.useMemo(()=>[{title:"Total Roles",value:le.totalRoles,icon:e.jsx(he,{}),color:"text-blue-600",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:le.totalPermissions,icon:e.jsx(fe,{}),color:"text-green-600",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Role",value:le.activeRole==="None Selected"?"None":le.activeRole,icon:e.jsx(Is,{}),color:"text-purple-600",iconBg:"bg-purple-500/20",description:"Currently selected",customStyle:le.activeRole==="None Selected"?{fontSize:"1rem"}:{}},{title:"Granted",value:le.grantedPermissions,icon:e.jsx(br,{}),color:"text-orange-600",iconBg:"bg-orange-500/20",description:"Active permissions"}],[le]);const Ge=t.useMemo(()=>v.filter(s=>{const r=_e===""||s.name.toLowerCase().includes(_e.toLowerCase())||s.description&&s.description.toLowerCase().includes(_e.toLowerCase()),a=me==="all"||me==="active"&&s.is_active!==!1||me==="inactive"&&s.is_active===!1;return r&&a}),[v,_e,me]),Ve=t.useMemo(()=>w.filter(s=>je===""||s.name&&s.name.toLowerCase().includes(je.toLowerCase())||s.display_name&&s.display_name.toLowerCase().includes(je.toLowerCase())||s.description&&s.description.toLowerCase().includes(je.toLowerCase())),[w,je]),Be=t.useMemo(()=>Z.filter(s=>{var i,d;const r=ke===""||((i=s.name)==null?void 0:i.toLowerCase().includes(ke.toLowerCase()))||((d=s.email)==null?void 0:d.toLowerCase().includes(ke.toLowerCase())),a=ve==="all"||s.roles&&s.roles.some(y=>y.name===ve);return r&&a}),[Z,ke,ve]),Us=t.useMemo(()=>{const s=Oe*Ae;return Ge.slice(s,s+Ae)},[Ge,Oe,Ae]),$s=t.useMemo(()=>{const s=Ue*Ie;return Ve.slice(s,s+Ie)},[Ve,Ue,Ie]),Ws=t.useMemo(()=>{const s=$e*De;return Be.slice(s,s+De)},[Be,$e,De]),Ee=t.useMemo(()=>{const s=new Set;return w.forEach(r=>{r.module?s.add(r.module):r.name&&r.name.includes(".")&&s.add(r.name.split(".")[0])}),Array.from(s).sort()},[w]),Gs=t.useMemo(()=>v.map(s=>s.name).sort(),[v]),J=t.useCallback((s,r)=>{if(Array.isArray(O)&&Array.isArray(w)){const a=O.filter(d=>d&&d.role_id===s),i=w.find(d=>d&&d.name===r);if(i&&a.some(d=>d.permission_id===i.id))return!0}if(Array.isArray(v)){const a=v.find(i=>i&&i.id===s);if(a&&Array.isArray(a.permissions))return a.permissions.some(i=>i&&i.name===r)}if(h&&h.id===s&&W.size>0){const a=w.find(i=>i&&i.name===r);if(a)return W.has(a.id)}return!1},[O,w,v,h,W]);t.useCallback(s=>!h||!N[s]?!1:N[s].permissions.every(a=>J(h.id,a.name)),[h,N,J]),t.useCallback(s=>!h||!N[s]?!1:N[s].permissions.some(a=>J(h.id,a.name)),[h,N,J]);const Vs=s=>s.name==="Super Administrator"?T:!0,Bs=t.useCallback(s=>{try{be(s);const r=ae(s);ee(new Set(r)),E("")}catch(r){console.error("Error selecting role:",r),E("Failed to select role. Please try again.")}},[ae]),qs=t.useCallback(s=>{gs(s),ze(0)},[]),Hs=t.useCallback(s=>{bs(s),ws(0)},[]),Qs=t.useCallback(s=>{vs(s),We(0)},[]),Ks=t.useCallback(s=>{js(s),ze(0)},[]),Xs=t.useCallback(s=>{ys(s),We(0)},[]),Ps=t.useCallback((s=null)=>{console.log("Opening role modal for role:",s),ms(s),ue({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",permissions:(s==null?void 0:s.permissions)||[],hierarchy_level:(s==null?void 0:s.hierarchy_level)||10,is_active:(s==null?void 0:s.is_active)??!0}),os(!0),V({}),E("")},[]),qe=t.useCallback(()=>{os(!1),ms(null),V({}),E(""),ue({name:"",description:"",permissions:[],hierarchy_level:10,is_active:!0})},[]),Rs=t.useCallback((s=null)=>{us(s),te({name:(s==null?void 0:s.name)||"",display_name:(s==null?void 0:s.display_name)||"",description:(s==null?void 0:s.description)||"",module:(s==null?void 0:s.module)||Ee[0]||"users",guard_name:(s==null?void 0:s.guard_name)||"web"}),is(!0),V({}),E("")},[Ee]),He=t.useCallback(()=>{is(!1),us(null),V({}),E(""),te({name:"",display_name:"",description:"",module:"",guard_name:"web"})},[]);t.useCallback(s=>{xs(s),cs(!0);const r=ae(s.id);Ss(new Set(r))},[ae]),t.useCallback(()=>{cs(!1),xs(null),Ss(new Set)},[]);const Ys=t.useCallback(s=>{hs(s),ds(!0);const r=s.roles?new Set(s.roles.map(a=>a.id)):new Set;Ns(r)},[]);t.useCallback(()=>{ds(!1),hs(null),Ns(new Set)},[]);const Js=t.useCallback(s=>{fs(s),ce(!0)},[]),Zs=t.useCallback(s=>{ps(s),ce(!0)},[]),er=async()=>{var s,r;if(de){X(!0);try{await xe.delete(`/api/roles/${de.id}`),F.success("Role deleted successfully"),ye("Role deleted successfully"),ce(!1),fs(null),$.current=Date.now()}catch(a){console.error("Error deleting role:",a);const i=((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete role";F.error(i),E(i)}finally{X(!1)}}},sr=async()=>{var s,r;if(Se){X(!0);try{await xe.delete(`/api/permissions/${Se.id}`),F.success("Permission deleted successfully"),ye("Permission deleted successfully"),ce(!1),ps(null),$.current=Date.now()}catch(a){console.error("Error deleting permission:",a);const i=((r=(s=a.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to delete permission";F.error(i),E(i)}finally{X(!1)}}},rr=async()=>{var r,a,i;V({}),E("");const s={};if(Y.name.trim()||(s.name="Role name is required"),Y.name.length>255&&(s.name="Role name must be less than 255 characters"),Y.description&&Y.description.length>500&&(s.description="Description must be less than 500 characters"),Object.keys(s).length>0){V(s);return}X(!0),A(d=>({...d,roles:j.LOADING}));try{const d=se?`/api/roles/${se.id}`:"/api/roles",u=await xe[se?"put":"post"](d,Y);(u.status===200||u.status===201)&&(se?(ge(g=>g.map(f=>f.id===se.id?u.data.role:f)),F.success("Role updated successfully"),ye("Role updated successfully")):(ge(g=>[...g,u.data.role]),F.success("Role created successfully"),ye("Role created successfully")),qe(),A(g=>({...g,roles:j.SUCCESS})),setTimeout(()=>{A(g=>({...g,roles:j.IDLE})),ye("")},3e3),$.current=Date.now())}catch(d){if(console.error("Error saving role:",d),A(y=>({...y,roles:j.ERROR})),((r=d.response)==null?void 0:r.status)===422&&d.response.data.errors)V(d.response.data.errors);else{const y=((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save role";F.error(y),E(y)}setTimeout(()=>{A(y=>({...y,roles:j.IDLE}))},3e3)}finally{X(!1)}},tr=async()=>{var r,a,i;V({}),E("");const s={};if(B.name.trim()||(s.name="Permission name is required"),B.display_name.trim()||(s.display_name="Display name is required"),B.module.trim()||(s.module="Module is required"),Object.keys(s).length>0){V(s);return}X(!0);try{const d=re?`/api/permissions/${re.id}`:"/api/permissions",u=await xe[re?"put":"post"](d,B);(u.status===200||u.status===201)&&(re?(Te(g=>g.map(f=>f.id===re.id?u.data.permission:f)),F.success("Permission updated successfully")):(Te(g=>[...g,u.data.permission]),F.success("Permission created successfully")),He(),$.current=Date.now())}catch(d){if(console.error("Error saving permission:",d),((r=d.response)==null?void 0:r.status)===422&&d.response.data.errors)V(d.response.data.errors);else{const y=((i=(a=d.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to save permission";F.error(y),E(y)}}finally{X(!1)}},ar=t.useCallback(async s=>{var a,i,d,y;if(!h||G.permissions[s]===j.LOADING)return;D.current.has(s)&&D.current.get(s).abort();const r=new AbortController;D.current.set(s,r),A(u=>({...u,permissions:{...u.permissions,[s]:j.LOADING}}));try{const u=J(h.id,s),g=u?"revoke":"grant",f=await xe.post("/admin/roles/update-permission",{role_id:h.id,permission:s,action:g},{signal:r.signal});if(f.status===200){if(f.data.role_has_permissions){H(f.data.role_has_permissions);const k=f.data.role_has_permissions.filter(M=>M.role_id===h.id).map(M=>M.permission_id);ee(new Set(k))}else{const k=w.find(M=>M.name===s);k&&(u?(H(M=>M.filter(we=>!(we.role_id===h.id&&we.permission_id===k.id))),ee(M=>{const we=new Set(M);return we.delete(k.id),we})):(H(M=>[...M,{role_id:h.id,permission_id:k.id}]),ee(M=>new Set([...M,k.id]))))}A(k=>({...k,permissions:{...k.permissions,[s]:j.SUCCESS}})),setTimeout(()=>{A(k=>({...k,permissions:{...k.permissions,[s]:j.IDLE}}))},2e3),F.success(`Permission ${g}ed successfully`),$.current=Date.now(),ks.reload({only:["roles","permissions"]})}}catch(u){u.name==="AbortError"||u.name==="CanceledError"||u.code==="ERR_CANCELED"||(console.error("Error updating permission:",u),A(f=>({...f,permissions:{...f.permissions,[s]:j.ERROR}})),setTimeout(()=>{A(f=>({...f,permissions:{...f.permissions,[s]:j.IDLE}}))},3e3),F.error(((i=(a=u.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update permission"),E(((y=(d=u.response)==null?void 0:d.data)==null?void 0:y.message)||"Failed to update permission"))}finally{D.current.delete(s)}},[h,G.permissions,J,w]),lr=t.useCallback(async s=>{var a,i,d,y;if(!h||G.modules[s]===j.LOADING)return;L.current.has(s)&&L.current.get(s).abort();const r=new AbortController;L.current.set(s,r),A(u=>({...u,modules:{...u.modules,[s]:j.LOADING}}));try{const u=await xe.post("/admin/roles/update-module",{roleId:h.id,module:s,action:"toggle"},{signal:r.signal});if(u.status===200){H(u.data.role_has_permissions);const g=u.data.role_has_permissions.filter(f=>f.role_id===h.id).map(f=>f.permission_id);ee(new Set(g)),A(f=>({...f,modules:{...f.modules,[s]:j.SUCCESS}})),setTimeout(()=>{A(f=>({...f,modules:{...f.modules,[s]:j.IDLE}}))},2e3),F.success("Module permissions updated successfully"),$.current=Date.now()}}catch(u){u.name==="AbortError"||u.name==="CanceledError"||u.code==="ERR_CANCELED"||(console.error("Error updating module permissions:",u),A(f=>({...f,modules:{...f.modules,[s]:j.ERROR}})),setTimeout(()=>{A(f=>({...f,modules:{...f.modules,[s]:j.IDLE}}))},3e3),F.error(((i=(a=u.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update module permissions"),E(((y=(d=u.response)==null?void 0:d.data)==null?void 0:y.message)||"Failed to update module permissions"))}finally{L.current.delete(s)}},[h,G.modules]);t.useCallback((s,r)=>{ue(a=>({...a,[s]:r})),q[s]&&V(a=>({...a,[s]:void 0}))},[q]),t.useEffect(()=>()=>{D.current.forEach(s=>s.abort()),D.current.clear(),L.current.forEach(s=>s.abort()),L.current.clear()},[]),t.useEffect(()=>{const s=r=>{if(r.key==="/"&&!r.ctrlKey&&!r.metaKey&&!r.altKey){const a=r.target;if(a.tagName!=="INPUT"&&a.tagName!=="TEXTAREA"&&!a.isContentEditable){r.preventDefault();const i=document.querySelector('input[placeholder*="Search"]');i&&i.focus()}}if(r.key==="Escape"&&(Pe||Re||Ce)&&(gs(""),bs(""),vs(""),js("all"),ys("all")),(r.ctrlKey||r.metaKey)&&r.key==="k"){r.preventDefault();const a=document.querySelector('input[placeholder*="Search"]');a&&a.focus()}};return document.addEventListener("keydown",s),()=>{document.removeEventListener("keydown",s)}},[Pe,Re,Ce,me,ve]);const nr=t.useCallback(s=>G.permissions[s]||j.IDLE,[G.permissions]),or=t.useCallback(s=>G.modules[s]||j.IDLE,[G.modules]),ir=()=>e.jsxs(e.Fragment,{children:[e.jsxs(Ke,{isOpen:Ts,onClose:_?void 0:qe,maxWidth:"md",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-6 h-6"}),se?"Edit Role":"Create New Role",G.roles===j.LOADING&&e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"})]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(I,{variant:"light",onPress:qe,isDisabled:_,children:"Cancel"}),e.jsx(I,{color:"primary",onPress:rr,isLoading:_,children:se?"Update Role":"Create Role"})]}),children:[G.roles===j.ERROR&&e.jsx("div",{className:"mb-4 p-3 bg-danger/10 border border-danger/20 rounded-lg",children:e.jsx("p",{className:"text-danger text-sm",children:"Failed to save role. Please check the form and try again."})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{label:"Role Name",placeholder:"Enter role name",value:Y.name,onValueChange:s=>ue(r=>({...r,name:s})),isInvalid:!!q.name,errorMessage:q.name,description:"Unique identifier for the role",isRequired:!0,isDisabled:_,variant:"bordered",radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500",description:"text-default-400",errorMessage:"text-danger"}})}),e.jsx("div",{className:"col-span-1",children:e.jsxs(Ne,{label:"Guard Name",placeholder:"Select guard",selectedKeys:[Y.guard_name],onSelectionChange:s=>{const r=Array.from(s)[0];ue(a=>({...a,guard_name:r}))},isDisabled:_,variant:"bordered",radius:n(),classNames:{trigger:"border-default-200/20 bg-default-100/50 dark:bg-default-50/10 hover:border-default-300/30 data-[open]:border-primary/50",value:"text-foreground",label:"text-default-500",popoverContent:"bg-content1 dark:bg-content1 backdrop-blur-xl border border-default-200/20"},children:[e.jsx(Q,{value:"web",children:"Web"},"web"),e.jsx(Q,{value:"api",children:"API"},"api")]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(_s,{label:"Description",placeholder:"Optional description of role responsibilities",value:Y.description,onValueChange:s=>ue(r=>({...r,description:s})),isDisabled:_,variant:"bordered",minRows:2,radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500"}})})]})]}),e.jsx(Ke,{isOpen:Os,onClose:_?void 0:He,maxWidth:"md",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-6 h-6"}),re?"Edit Permission":"Create New Permission"]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(I,{variant:"light",onPress:He,isDisabled:_,children:"Cancel"}),e.jsx(I,{color:"success",onPress:tr,isLoading:_,children:re?"Update Permission":"Create Permission"})]}),children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 p-1",children:[e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{label:"Permission Name",placeholder:"e.g., users.create",value:B.name,onValueChange:s=>te(r=>({...r,name:s})),isInvalid:!!q.name,errorMessage:q.name,description:"Use format: module.action (e.g., users.create)",isRequired:!0,isDisabled:_,variant:"bordered",radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500",description:"text-default-400",errorMessage:"text-danger"}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{label:"Display Name",placeholder:"Human-readable name",value:B.display_name,onValueChange:s=>te(r=>({...r,display_name:s})),isInvalid:!!q.display_name,errorMessage:q.display_name,description:"Human-readable name",isRequired:!0,isDisabled:_,variant:"bordered",radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500",description:"text-default-400",errorMessage:"text-danger"}})}),e.jsx("div",{className:"col-span-1",children:e.jsx(Ne,{label:"Module",placeholder:"Select module",selectedKeys:B.module?[B.module]:[],onSelectionChange:s=>{const r=Array.from(s)[0];te(a=>({...a,module:r}))},isInvalid:!!q.module,errorMessage:q.module,isDisabled:_,variant:"bordered",radius:n(),classNames:{trigger:"border-default-200/20 bg-default-100/50 dark:bg-default-50/10 hover:border-default-300/30 data-[open]:border-primary/50",value:"text-foreground",label:"text-default-500",popoverContent:"bg-content1 dark:bg-content1 backdrop-blur-xl border border-default-200/20"},children:Ee.map(s=>e.jsx(Q,{value:s,children:s},s))})}),e.jsx("div",{className:"col-span-1",children:e.jsx(ie,{label:"Guard Name",placeholder:"Usually 'web'",value:B.guard_name,onValueChange:s=>te(r=>({...r,guard_name:s})),description:"Usually 'web' for web permissions",isDisabled:_,variant:"bordered",radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500",description:"text-default-400"}})}),e.jsx("div",{className:"col-span-2",children:e.jsx(_s,{label:"Description",placeholder:"Optional description of what this permission allows",value:B.description,onValueChange:s=>te(r=>({...r,description:s})),description:"Optional description of what this permission allows",isDisabled:_,variant:"bordered",minRows:2,radius:n(),classNames:{inputWrapper:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20 hover:border-default-300/30 focus-within:!border-primary/50",input:"text-foreground placeholder:text-default-400",label:"text-default-500",description:"text-default-400"}})})]})}),e.jsx(Ke,{isOpen:zs,onClose:()=>ce(!1),maxWidth:"sm",title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ds,{className:"w-6 h-6 text-danger"}),"Confirm Delete"]}),actions:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(I,{variant:"light",onPress:()=>ce(!1),children:"Cancel"}),e.jsxs(I,{color:"danger",onPress:de?er:sr,isLoading:_,children:["Delete ",de?"Role":"Permission"]})]}),children:e.jsxs("p",{className:"text-foreground/90",children:["Are you sure you want to delete ",de?`the role "${de.name}"`:Se?`the permission "${Se.name}"`:"this item","? This action cannot be undone."]})})]});return e.jsxs(e.Fragment,{children:[e.jsx(mr,{title:U}),b.length>0&&e.jsx("div",{className:"mb-4 p-4",children:e.jsx(ne,{className:"bg-warning/10 border border-warning/30",radius:n(),children:e.jsxs(oe,{className:"flex flex-row items-start gap-4",children:[e.jsx(Ds,{className:"w-6 h-6 text-warning flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-warning mb-2",children:"Data Integrity Issues Detected"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-default-600",children:b.map((s,r)=>e.jsx("li",{children:s},r))}),e.jsx("p",{className:"text-sm text-default-500 italic mt-2",children:"This may indicate a cache or database synchronization issue on the server."})]}),e.jsx(I,{color:"warning",size:"sm",variant:"flat",onPress:()=>{ks.reload({only:["roles","permissions","users"]})},startContent:e.jsx(xr,{className:"w-4 h-4"}),children:"Refresh Data"})]})})}),e.jsx("div",{className:"flex flex-col w-full h-full p-4",role:"main","aria-label":"Role & Permission Management",children:e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"w-full",children:e.jsx(vr.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:e.jsxs(ne,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg, 
                                        var(--theme-content1, #FAFAFA) 20%, 
                                        var(--theme-content2, #F4F4F5) 10%, 
                                        var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Qe,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg, 
                                            color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%, 
                                            color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${!c&&!x?"p-6":c?"p-3":"p-4"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                            ${!c&&!x?"p-3":c?"p-2":"p-2.5"} 
                                                            rounded-xl flex items-center justify-center
                                                        `,style:{background:"color-mix(in srgb, var(--theme-primary) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-primary) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(jr,{className:`
                                                                ${!c&&!x?"w-8 h-8":c?"w-5 h-5":"w-6 h-6"}
                                                            `,style:{color:"var(--theme-primary)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                                ${!c&&!x?"text-2xl":c?"text-lg":"text-xl"}
                                                                font-bold text-foreground
                                                                ${c||x?"truncate":""}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Role & Permission Management"}),e.jsx("p",{className:`
                                                                ${!c&&!x?"text-sm":"text-xs"} 
                                                                text-default-500
                                                                ${c||x?"truncate":""}
                                                            `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Comprehensive access control and permission management system"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:e.jsx(I,{className:"font-medium",style:{background:"color-mix(in srgb, var(--theme-success) 15%, transparent)",color:"var(--theme-success)",borderRadius:n(),border:"1px solid color-mix(in srgb, var(--theme-success) 30%, transparent)"},startContent:e.jsx(yr,{className:"w-4 h-4"}),children:c?"Export":"Export Data"})})]})})})}),e.jsxs(oe,{className:"p-6",children:[e.jsx(pr,{stats:[{title:"Total Roles",value:v.length,icon:e.jsx(he,{}),color:"text-blue-500",iconBg:"bg-blue-500/20",description:"System roles"},{title:"Permissions",value:w.length,icon:e.jsx(fe,{}),color:"text-green-500",iconBg:"bg-green-500/20",description:"Available permissions"},{title:"Active Users",value:Z.length,icon:e.jsx(Le,{}),color:"text-purple-500",iconBg:"bg-purple-500/20",description:"System users"},{title:"Modules",value:Ee.length,icon:e.jsx(Is,{}),color:"text-orange-500",iconBg:"bg-orange-500/20",description:"Permission modules"}]}),e.jsxs("div",{className:"w-full mt-6",children:[e.jsxs(cr,{selectedKey:R.toString(),onSelectionChange:s=>C(parseInt(s)),"aria-label":"Role management tabs",variant:"underlined",classNames:{tabList:"gap-6 w-full relative rounded-none p-0 border-b",cursor:"w-full",tab:"max-w-fit px-0 h-12 text-default-500",tabContent:""},style:{"--tabs-cursor-bg":"var(--theme-primary)"},children:[e.jsx(Fe,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-5 h-5"}),e.jsx("span",{className:c?"sr-only":"",children:"Roles Management"})]})},"0"),e.jsx(Fe,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{className:c?"sr-only":"",children:"Permissions Management"})]})},"1"),e.jsx(Fe,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-5 h-5"}),e.jsx("span",{className:c?"sr-only":"",children:"Role-Permission Assignment"})]})},"2"),e.jsx(Fe,{title:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-5 h-5"}),e.jsx("span",{className:c?"sr-only":"",children:"User-Role Assignment"})]})},"3")]}),R===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{className:"mb-4",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(he,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),"Roles Management"]}),e.jsx(I,{onPress:()=>Ps(),startContent:e.jsx(Es,{className:"w-4 h-4"}),className:"text-white font-medium",style:{background:"linear-gradient(135deg, var(--theme-primary), color-mix(in srgb, var(--theme-primary) 80%, var(--theme-secondary)))",borderRadius:n()},children:"Add Role"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(ie,{"aria-label":"Search roles",placeholder:"Search by role name...",value:Pe,onValueChange:qs,className:"flex-1 min-w-0",radius:n(),startContent:e.jsx(Ye,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20",base:"flex-1"}}),e.jsxs(Ne,{"aria-label":"Filter by status",placeholder:"All Status",variant:"bordered",selectedKeys:[me],onSelectionChange:s=>Ks(Array.from(s)[0]),className:"w-full sm:w-[140px] sm:flex-shrink-0",radius:n(),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20"},children:[e.jsx(Q,{value:"all",children:"All Status"},"all"),e.jsx(Q,{value:"active",children:"Active"},"active"),e.jsx(Q,{value:"inactive",children:"Inactive"},"inactive")]})]})]})}),e.jsx(wr,{roles:Us,permissions:w,getRolePermissions:ae,onEdit:Ps,onDelete:Js,canManageRole:Vs,isMobile:c,isTablet:x,pagination:{currentPage:Oe+1,perPage:Ae,total:Ge.length},onPageChange:s=>ze(s-1),loading:G.roles===j.LOADING})]}),R===1&&e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{className:"mb-4",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(oe,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(fe,{className:"w-5 h-5",style:{color:"var(--theme-success)"}}),"Permissions Management"]}),e.jsx(I,{onPress:()=>Rs(),startContent:e.jsx(Es,{className:"w-4 h-4"}),className:"text-white font-medium",style:{background:"linear-gradient(135deg, var(--theme-success), color-mix(in srgb, var(--theme-success) 80%, var(--theme-primary)))",borderRadius:n()},children:"Add Permission"})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsx(ie,{"aria-label":"Search permissions",placeholder:"Search by permission name or description...",value:Re,onValueChange:Hs,className:"flex-1 min-w-0",radius:n(),startContent:e.jsx(Ye,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20",base:"flex-1"}})})]})}),e.jsx(Nr,{permissions:$s,onEdit:Rs,onDelete:Zs,isMobile:c,isTablet:x,pagination:{currentPage:Ue+1,perPage:Ie,total:Ve.length},onPageChange:s=>ws(s-1),loading:_})]}),R===2&&e.jsxs(ne,{className:"mt-4",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:[e.jsx(Qe,{className:"p-4 border-b border-default-200/20",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(Xe,{className:"w-5 h-5"}),"Role-Permission Assignment"]}),e.jsx(Ne,{label:"Select Role to Manage",variant:"bordered",selectedKeys:z?[z.toString()]:[],onSelectionChange:s=>{const r=Array.from(s)[0];r&&Bs(parseInt(r))},className:"max-w-md",radius:n(),classNames:{trigger:"bg-default-100/50 dark:bg-default-50/10 backdrop-blur-md border-default-200/20 hover:bg-default-100/70 dark:hover:bg-default-50/20",label:"text-default-500",value:"text-foreground"},children:v.map(s=>e.jsx(Q,{value:s.id.toString(),children:s.name},s.id.toString()))})]})}),e.jsx(oe,{className:"p-4",children:h?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-default-100/50 dark:bg-default-50/10 rounded-lg border border-default-200/20",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-foreground",children:["Managing permissions for: ",h.name]}),e.jsxs("p",{className:"text-sm text-default-500",children:[W.size," of ",w.length," permissions granted"]})]}),e.jsx(Cs,{value:W.size/w.length*100,size:"sm",color:"primary",className:"w-32","aria-label":`${Math.round(W.size/w.length*100)}% permissions granted`})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(N).map(([s,r])=>{const a=r.permissions||[],i=a.filter(g=>J(h.id,g.name)).length,d=a.length,y=i===d,u=i>0&&i<d;return e.jsxs(ne,{className:"bg-default-100/50 dark:bg-default-50/10 border-default-200/20",radius:n(),children:[e.jsxs(Qe,{className:"pb-2",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"font-medium capitalize text-foreground",children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(K,{size:"sm",variant:"flat",color:y?"success":u?"warning":"default",children:[i,"/",d]}),e.jsx(I,{size:"sm",variant:"light",onPress:()=>lr(s),isLoading:or(s)===j.LOADING,className:"text-xs",children:y?"Revoke All":"Grant All"})]})]}),e.jsx(Cs,{value:i/d*100,size:"sm",color:y?"success":u?"warning":"default","aria-label":`${i} of ${d} permissions granted for ${s} module`})]}),e.jsx(oe,{className:"pt-0",children:e.jsx("div",{className:"space-y-2",children:a.map(g=>{const f=J(h.id,g.name),k=nr(g.name);return e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-sm bg-default-100/50 dark:bg-default-50/10 hover:bg-default-100/70 dark:hover:bg-default-50/20 transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:g.display_name||g.name}),e.jsx("p",{className:"text-xs text-default-500",children:g.name})]}),e.jsx(dr,{size:"sm",isSelected:f,onValueChange:()=>ar(g.name),isDisabled:k===j.LOADING,color:"success","aria-label":`Toggle ${g.display_name||g.name} permission`},`${g.id}-${f}-${k}`)]},g.id)})})})]},s)})})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Xe,{className:"w-16 h-16 text-default-300 mx-auto mb-4"}),e.jsx("p",{className:"mb-2 text-default-500",children:"Select a role to manage permissions"}),e.jsx("p",{className:"text-sm text-default-400",children:"Choose a role from the dropdown above to assign or revoke permissions"})]})})]}),R===3&&e.jsxs("div",{className:"mt-4",children:[e.jsx(ne,{className:"mb-4",style:{background:"color-mix(in srgb, var(--theme-content1) 85%, transparent)",border:"1px solid color-mix(in srgb, var(--theme-content2) 50%, transparent)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs(oe,{className:"p-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 w-full mb-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(Le,{className:"w-5 h-5",style:{color:"var(--theme-warning)"}}),"User-Role Assignment"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(ie,{"aria-label":"Search users",placeholder:"Search by user name or email...",value:Ce,onValueChange:Qs,className:"flex-1 min-w-0",radius:n(),startContent:e.jsx(Ye,{className:"w-4 h-4 text-default-400"}),variant:"bordered",classNames:{inputWrapper:"bg-white/10 backdrop-blur-md border-white/20",base:"flex-1"}}),e.jsxs(Ne,{"aria-label":"Filter by role",placeholder:"All Roles",variant:"bordered",selectedKeys:[ve],onSelectionChange:s=>Xs(Array.from(s)[0]),className:"w-full sm:w-[160px] sm:flex-shrink-0",radius:n(),classNames:{trigger:"bg-white/10 backdrop-blur-md border-white/20"},children:[e.jsx(Q,{value:"all",children:"All Roles"},"all"),Gs.map(s=>e.jsx(Q,{value:s,children:s},s))]})]})]})}),e.jsx(Sr,{users:Ws,onRowClick:Ys,isMobile:c,isTablet:x,pagination:{currentPage:$e+1,perPage:De,total:Be.length},onPageChange:s=>We(s-1),loading:_})]})]})]})]})})})})}),ir()]})};Rr.layout=m=>e.jsx(fr,{children:m});export{Rr as default};
