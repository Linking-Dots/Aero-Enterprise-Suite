import{J as Ae,a as t,j as e,b as ne}from"./app-iK4ccFYP.js";import{r as s,R as xe}from"./react-core-DDvupgOx.js";import{B as Y,d as de,g as Se,e as Me,s as ht,p as gt,h as We,c as Oe,t as ft}from"./App--E8cOTcz.js";import{a as pe}from"./utilities-DT6SRl8s.js";import{G as dt}from"./logo-D47JMLDj.js";import{u as me,a as Ee,a2 as _e,d as yt,T as u,a1 as bt,e as De,j as Ne,B as g,I as Te,k as $e,i as ie,a9 as Ve,M as te,l as ae,a6 as xt,p as Pe,o as we,h as se,m as ct,q as Le,r as Ie,f as be,a5 as vt,s as ze,C as qe,$ as Ge,a3 as wt,a4 as Ct,aa as kt,ab as St,t as _t,ac as Dt}from"./mui-libraries-CyFs7uQU.js";import{F as ve}from"./TrashIcon-D8Us3Tf_.js";import{F as Ke}from"./PencilIcon-Dhfhztfv.js";import{F as Je}from"./EllipsisVerticalIcon-BX6PWMxg.js";import{F as Nt}from"./XCircleIcon-StDWd-mv.js";import{F as Tt}from"./CheckCircleIcon-DnGOlVla.js";import{F as $t}from"./ClockIcon-DNQ3nlJB.js";import{F as Ft}from"./ExclamationTriangleIcon-CsS6HvBt.js";import{F as Ue}from"./UserIcon-D16nn9o_.js";import{F as Pt}from"./HeartIcon-BSdzzFKC.js";import{b as fe,v as ue,t as Qe,S as Ze,O as Xe,P as et,Q as Be,L as tt,M as rt,J as at,G as st,k as Lt,m as It,n as Rt,o as Mt,q as Wt,f as Fe,j as nt}from"./ui-libraries-CxFzkmxb.js";import{C as He}from"./Clear-Dn6tl6Dm.js";import{G as Re}from"./GlassDialog-CEoz5u2o.js";import{L as ye}from"./LoadingButton-ZmUpomBU.js";import{F as ot}from"./InformationCircleIcon-BNRxDcw3.js";import{F as Et}from"./XCircleIcon-DJR5_Dv7.js";import{F as je}from"./ExclamationTriangleIcon-C_gcLnRy.js";import{F as Ye}from"./CheckCircleIcon-CJUGb5Jf.js";function Bt({title:l,titleId:p,...S},y){return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:y,"aria-labelledby":p},S),l?s.createElement("title",{id:p},l):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const zt=s.forwardRef(Bt);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ut=l=>l.replace(/^([A-Z])|[\s-_]+(\w)/g,(p,S,y)=>y?y.toUpperCase():S.toLowerCase()),lt=l=>{const p=Ut(l);return p.charAt(0).toUpperCase()+p.slice(1)},ut=(...l)=>l.filter((p,S,y)=>!!p&&p.trim()!==""&&y.indexOf(p)===S).join(" ").trim(),At=l=>{for(const p in l)if(p.startsWith("aria-")||p==="role"||p==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ht={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=s.forwardRef(({color:l="currentColor",size:p=24,strokeWidth:S=2,absoluteStrokeWidth:y,className:b="",children:f,iconNode:F,...P},x)=>s.createElement("svg",{ref:x,...Ht,width:p,height:p,stroke:l,strokeWidth:y?Number(S)*24/Number(p):S,className:ut("lucide",b),...!f&&!At(P)&&{"aria-hidden":"true"},...P},[...F.map(([L,c])=>s.createElement(L,c)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yt=(l,p)=>{const S=s.forwardRef(({className:y,...b},f)=>s.createElement(jt,{ref:f,iconNode:p,className:ut(`lucide-${qt(lt(l))}`,`lucide-${l}`,y),...b}));return S.displayName=lt(l),S};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],it=Yt("phone-off",Ot),Vt=xe.forwardRef(({leaves:l,allUsers:p,handleClickOpen:S,setCurrentLeave:y,openModal:b,setLeaves:f,setCurrentPage:F,currentPage:P,totalRows:x,lastPage:L,perPage:c,selectedMonth:_,employee:B,isAdminView:$=!1,onBulkApprove:T,onBulkReject:v,onBulkDelete:D,canApproveLeaves:o=!1,canEditLeaves:M=!1,canDeleteLeaves:I=!1,fetchLeavesStats:X},ee)=>{const{auth:re}=Ae().props,R=me(),O=Ee("(min-width: 1025px)"),Z=Ee("(min-width: 641px) and (max-width: 1024px)"),oe=Ee("(max-width: 640px)"),[A,h]=s.useState(!1),[n,k]=s.useState(null),[N,K]=s.useState(new Set);xe.useMemo(()=>Array.from(N).join(", ").replaceAll("_"," "),[N]);const V=xe.useMemo(()=>{const i=N==="all",a=i||N.size>0,r=i?l.length:N.size;return t("div",{className:"flex flex-col gap-4",children:[e("div",{className:"flex justify-between gap-3 items-end",children:e("div",{className:"flex gap-3",children:a&&D&&t(fe,{color:"danger",variant:"flat",startContent:e(ve,{className:"w-4 h-4"}),onPress:()=>{const d=i?l:l.filter(w=>N.has(w.id.toString()));D(d)},children:["Delete ",r," selected"]})})}),a&&t("span",{className:"text-default-400 text-small",children:[r," of ",l.length," selected"]})]})},[N,l,D]);re.permissions?.includes("leaves.view"),re.permissions?.includes("leave.own.view");const W={New:{color:"primary",icon:Ft,bgColor:_e(R.palette.primary.main,.1),textColor:R.palette.primary.main},Pending:{color:"warning",icon:$t,bgColor:_e(R.palette.warning.main,.1),textColor:R.palette.warning.main},Approved:{color:"success",icon:Tt,bgColor:_e(R.palette.success.main,.1),textColor:R.palette.success.main},Declined:{color:"danger",icon:Nt,bgColor:_e(R.palette.error.main,.1),textColor:R.palette.error.main}},E=i=>{switch(i?.toLowerCase()){case"casual":return e(gt,{className:"w-3 h-3 text-blue-500"});case"weekend":return e(ht,{className:"w-3 h-3 text-yellow-500"});case"sick":return e(Pt,{className:"w-3 h-3 text-red-500"});case"earned":return e(Me,{className:"w-3 h-3 text-green-500"});default:return e(Se,{className:"w-3 h-3 text-primary"})}},G=s.useCallback(i=>{F&&F(i)},[F]),H=s.useCallback(async(i,a)=>{if(i.status===a)return Y.info(`Leave is already ${a}.`),Promise.resolve(`The leave status is already updated to ${a}`);const r=`${i.id}-${a}`;if(n===r)return;k(r);const d=new Promise(async(w,m)=>{try{const C=await pe.post(route("leave-update-status"),{id:i.id,status:a});C.status===200?(f(Q=>Q.map(q=>q.id===i.id?{...q,status:a}:q)),X(),w(C.data.message||"Leave status updated successfully")):m(C.data?.message||"Failed to update leave status")}catch(C){const Q=C.response?.data?.message||C.response?.statusText||"Failed to update leave status";m(Q)}finally{k(null)}});return Y.promise(d,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),d},[f,n,X]),J=i=>{const a=W[i]||W.New,r=a.icon;return e(Fe,{size:"sm",variant:"flat",color:a.color,startContent:e(r,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:i})},j=(i,a)=>{const r=new Date(i),d=new Date(a),w=Math.abs(d-r),m=Math.ceil(w/(1e3*60*60*24))+1;return m===1?"1 day":`${m} days`},z=i=>new Date(i).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),U=i=>p?.find(a=>String(a.id)===String(i))||{name:"Unknown User",phone:""},he=({leave:i,updatingLeave:a,setCurrentLeave:r,openModal:d,handleClickOpen:w,updateLeaveStatus:m,canEditLeaves:C,canDeleteLeaves:Q,canApproveLeaves:q,isAdminView:ke})=>{const ce=U(i.user_id),mt=j(i.from_date,i.to_date);return W[i.status]||W.New,console.log(ke?"Admin View":"User View"),e(dt,{className:"mb-2",shadow:"sm",children:t(De,{className:"p-3",children:[t("div",{className:"flex items-start justify-between mb-3",children:[e("div",{className:"flex items-center gap-3 flex-1",children:ke&&e(tt,{avatarProps:{radius:"lg",size:"sm",src:ce?.profile_image_url||ce?.profile_image,showFallback:!0,name:ce?.name||"Unnamed User",isBordered:!0},description:ce?.phone?e(rt,{href:`tel:${ce?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:ce?.phone}):t("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e(it,{className:"w-3 h-3"})," No Phone"]}),name:e("span",{className:"text-sm font-medium",children:ce?.name||"Unnamed User"})})}),t("div",{className:"flex items-center gap-2",children:[J(i.status),(C||Q)&&t(Ze,{children:[e(Xe,{children:e(fe,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e(Je,{className:"w-4 h-4"})})}),t(et,{"aria-label":"Leave actions",children:[C&&e(Be,{startContent:e(Ke,{className:"w-4 h-4"}),onPress:()=>{r(i),d("edit_leave")},children:"Edit Leave"},"edit"),Q&&e(Be,{className:"text-danger",color:"danger",startContent:e(ve,{className:"w-4 h-4"}),onPress:()=>w(i.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e(nt,{className:"my-3"}),t(bt,{spacing:2,children:[t("div",{className:"flex items-center gap-2",children:[e(Se,{className:"w-4 h-4 text-primary"}),e(u,{variant:"body2",fontWeight:"medium",children:i.leave_type})]}),t("div",{className:"flex items-center gap-2",children:[e(de,{className:"w-4 h-4 text-default-500"}),t(u,{variant:"body2",color:"textSecondary",children:[z(i.from_date)," - ",z(i.to_date)]}),e(Fe,{size:"sm",variant:"bordered",color:"default",children:mt})]}),i.reason&&t("div",{className:"flex items-start gap-2",children:[e(Me,{className:"w-4 h-4 text-default-500 mt-0.5"}),e(u,{variant:"body2",color:"textSecondary",className:"flex-1",children:i.reason})]})]}),ke&&q&&t(ne,{children:[e(nt,{className:"my-3"}),e("div",{className:"flex gap-2",children:["Approved","Declined"].map(le=>e(fe,{size:"sm",variant:i.status===le?"solid":"bordered",color:W[le].color,isLoading:a===`${i.id}-${le}`,onPress:()=>{a!==`${i.id}-${le}`&&m(i,le)},startContent:a!==`${i.id}-${le}`?xe.createElement(W[le].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:le},le))})]})]})})},ge=s.useCallback((i,a)=>{const r=U(i.user_id);switch(a){case"employee":return e(ue,{className:"whitespace-nowrap",children:e(tt,{avatarProps:{radius:"lg",size:"sm",src:r?.profile_image_url||r?.profile_image,showFallback:!0,name:r?.name||"Unnamed User",isBordered:!0},description:r?.phone?e(rt,{href:`tel:${r?.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:r?.phone}):t("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e(it,{className:"w-3 h-3"})," No Phone"]}),name:e("span",{className:"text-sm font-medium",children:r?.name||"Unnamed User"})})});case"leave_type":return e(ue,{children:t("div",{className:"flex items-center gap-1",children:[E(i.leave_type),e(u,{variant:"body2",className:"text-sm font-medium capitalize",children:i.leave_type})]})});case"from_date":case"to_date":return e(ue,{children:t("div",{className:"flex items-center gap-1",children:[e(de,{className:"w-3 h-3 text-default-500"}),t("div",{children:[e(u,{variant:"body2",className:"text-sm",children:z(i[a])}),a==="from_date"&&e(u,{variant:"caption",className:"text-xs",color:"textSecondary",children:j(i.from_date,i.to_date)})]})]})});case"status":return e(ue,{children:t("div",{className:"flex items-center gap-2",children:[J(i.status),$&&o&&t(Ze,{children:[e(Xe,{children:e(fe,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:n&&n.startsWith(`${i.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e(Je,{className:"w-4 h-4"})})}),e(et,{"aria-label":"Status actions",onAction:d=>H(i,d),children:Object.keys(W).map(d=>{const w=W[d],m=w.icon;return e(Be,{startContent:e(m,{className:"w-4 h-4"}),color:w.color,children:d},d)})})]})]})});case"reason":return e(ue,{children:e(yt,{title:i.reason||"No reason provided",children:e(u,{variant:"caption",className:"max-w-xs truncate cursor-help text-xs",color:"textSecondary",children:i.reason||"No reason provided"})})});case"actions":return e(ue,{children:t("div",{className:"flex items-center gap-1",children:[M&&e(Qe,{content:"Edit Leave",children:e(fe,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:n&&n.startsWith(`${i.id}-`),onPress:()=>{n&&n.startsWith(`${i.id}-`)||(y(i),b("edit_leave"))},className:"min-w-8 h-8",children:e(Ke,{className:"w-4 h-4"})})}),I&&e(Qe,{content:"Delete Leave",color:"danger",children:e(fe,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:n&&n.startsWith(`${i.id}-`),onPress:()=>{n&&n.startsWith(`${i.id}-`)||(y(i),S(i.id,"delete_leave"))},className:"min-w-8 h-8",children:e(ve,{className:"w-4 h-4"})})})]})});default:return e(ue,{children:i[a]})}},[$,o,O,n,R,y,b,S,H]),Ce=[...$?[{name:"Employee",uid:"employee",icon:Ue}]:[],{name:"Leave Type",uid:"leave_type",icon:Se},{name:"From Date",uid:"from_date",icon:de},{name:"To Date",uid:"to_date",icon:de},{name:"Status",uid:"status",icon:Me},{name:"Reason",uid:"reason",icon:Se},...$?[{name:"Actions",uid:"actions"}]:[]];return oe?t("div",{className:"space-y-4",children:[e(at,{className:"max-h-[70vh]",children:l.map(i=>e(he,{leave:i,updatingLeave:n,setCurrentLeave:y,openModal:b,handleClickOpen:S,updateLeaveStatus:H,canEditLeaves:M,canDeleteLeaves:I,canApproveLeaves:o,isAdminView:$},i.id))}),x>c&&e("div",{className:"flex justify-center pt-4",children:e(st,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:L,onChange:G,size:"sm"})})]}):t("div",{className:"max-h-[84vh] overflow-y-auto",children:[e(at,{className:"max-h-[70vh]",children:t(Lt,{isStriped:!0,selectionMode:"multiple",selectedKeys:N,onSelectionChange:K,topContent:V,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e(It,{columns:Ce,children:i=>e(Rt,{align:i.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:t("div",{className:"flex items-center gap-1",children:[i.icon&&e(i.icon,{className:"w-3 h-3"}),e("span",{className:"text-xs font-semibold",children:i.name})]})},i.uid)}),e(Mt,{items:l,emptyContent:t("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e(de,{className:"w-12 h-12 text-default-300 mb-4"}),e(u,{variant:"h6",color:"textSecondary",children:"No leaves found"}),e(u,{variant:"body2",color:"textSecondary",children:B?`No leaves found for "${B}"`:"No leave requests for the selected period"})]}),children:i=>e(Wt,{children:a=>ge(i,a)},i.id)})]})}),x>c&&t("div",{className:"py-4 flex justify-center",children:[e(st,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:P,total:L,onChange:G,size:Z?"sm":"md"}),t("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",P," of ",L," (Total: ",x," records)"]})]})]})});Vt.displayName="LeaveEmployeeTable";const pt=({selectedDepartmentId:l,selectedEmployeeId:p,onDepartmentChange:S,onEmployeeChange:y,allUsers:b=[],departments:f=[],showSearch:F=!0,variant:P="outlined",size:x="medium",disabled:L=!1,required:c=!1,error:_={},label:B={department:"Department",employee:"Employee"},showAllOption:$=!0,autoSelectFirstDepartment:T=!0,className:v="",theme:D})=>{const[o,M]=s.useState(""),[I,X]=s.useState(""),[ee,re]=s.useState(!1);s.useEffect(()=>{if(T&&f.length>0&&!l){const h=f[0];h&&S(h.id)}},[f,l,S,T]);const R=s.useMemo(()=>o.trim()?f.filter(h=>h.name.toLowerCase().includes(o.toLowerCase())||h.id.toString().includes(o)):f,[f,o]),O=s.useMemo(()=>l?b.filter(h=>String(h.department_id)===String(l)):$?b:[],[b,l,$]),Z=s.useMemo(()=>I.trim()?O.filter(h=>h.name.toLowerCase().includes(I.toLowerCase())||h.email?.toLowerCase().includes(I.toLowerCase())||h.id.toString().includes(I)||h.designation?.toLowerCase().includes(I.toLowerCase())):O,[O,I]);s.useEffect(()=>{l&&p&&(O.some(n=>String(n.id)===String(p))||y(""))},[l,p,O,y]);const oe=s.useCallback(h=>{const n=h.target.value;S(n===""?"":parseInt(n)),p&&y(""),M(""),X("")},[S,y,p]),A=s.useCallback(h=>{const n=h.target.value;y(n===""?"":parseInt(n)),X("")},[y]);return t(g,{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${v}`,children:[t(Ne,{variant:P,size:x,error:!!_.department_id,disabled:L,required:c,fullWidth:!0,children:[e(Te,{id:"department-select-label",children:t(g,{className:"flex items-center gap-2",children:[e(We,{className:"w-4 h-4"}),B.department]})}),t($e,{labelId:"department-select-label",value:l?String(l):"",onChange:oe,label:B.department,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:D?.glassCard?.background||"rgba(255, 255, 255, 0.1)",border:D?.glassCard?.border||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,maxHeight:400}},disableAutoFocusItem:!0},children:[F&&e(te,{disableRipple:!0,sx:{py:1,borderBottom:"1px solid rgba(255, 255, 255, 0.1)","&:hover":{backgroundColor:"transparent"},cursor:"default"},onKeyDown:h=>h.stopPropagation(),children:e(ie,{placeholder:"Search departments...",value:o,onChange:h=>{h.stopPropagation(),M(h.target.value)},size:"small",fullWidth:!0,variant:"outlined",autoFocus:!1,InputProps:{startAdornment:e(Ve,{position:"start",children:e(Oe,{className:"w-4 h-4 text-gray-400"})})},onClick:h=>h.stopPropagation(),onMouseDown:h=>h.stopPropagation(),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"}}}})}),$&&e(te,{value:"",children:t(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(We,{className:"w-4 h-4"}),e(u,{children:"All Departments"})]})}),R.map(h=>e(te,{value:String(h.id),children:t(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(We,{className:"w-4 h-4"}),e(u,{children:h.name}),e(ae,{label:b.filter(n=>n.department_id===h.id).length,size:"small",variant:"outlined",sx:{ml:"auto",fontSize:"0.7rem"}})]})},h.id)),R.length===0&&o&&e(te,{disabled:!0,children:t(u,{variant:"body2",color:"text.secondary",children:['No departments found matching "',o,'"']})})]}),_.department_id&&e(u,{variant:"caption",color:"error",sx:{mt:.5},children:_.department_id})]}),t(Ne,{variant:P,size:x,error:!!_.user_id,disabled:L||ee||!l&&!$,required:c,fullWidth:!0,children:[e(Te,{id:"employee-select-label",children:t(g,{className:"flex items-center gap-2",children:[e(Ue,{className:"w-4 h-4"}),B.employee,!l&&!$&&e(u,{variant:"caption",color:"text.secondary",children:"(Select department first)"})]})}),t($e,{labelId:"employee-select-label",value:p?String(p):"",onChange:A,label:B.employee,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:D?.glassCard?.background||"rgba(255, 255, 255, 0.1)",border:D?.glassCard?.border||"1px solid rgba(255, 255, 255, 0.2)",borderRadius:2,maxHeight:400}},disableAutoFocusItem:!0},children:[F&&e(te,{disableRipple:!0,sx:{py:1,borderBottom:"1px solid rgba(255, 255, 255, 0.1)","&:hover":{backgroundColor:"transparent"},cursor:"default"},onKeyDown:h=>h.stopPropagation(),children:e(ie,{placeholder:"Search employees...",value:I,onChange:h=>{h.stopPropagation(),X(h.target.value)},size:"small",fullWidth:!0,variant:"outlined",autoFocus:!1,InputProps:{startAdornment:e(Ve,{position:"start",children:e(Oe,{className:"w-4 h-4 text-gray-400"})})},onClick:h=>h.stopPropagation(),onMouseDown:h=>h.stopPropagation(),sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)","& fieldset":{borderColor:"rgba(255, 255, 255, 0.2)"},"&:hover fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&.Mui-focused fieldset":{borderColor:"rgba(255, 255, 255, 0.5)"}}}})}),$&&e(te,{value:"",children:t(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(Ue,{className:"w-4 h-4"}),e(u,{children:l?"All Employees in Department":"Select Department First"})]})}),Z.map(h=>e(te,{value:String(h.id),children:t(g,{sx:{display:"flex",alignItems:"center",gap:1,width:"100%"},children:[e(xt,{src:h.profile_image_url||h.profile_image,sx:{width:24,height:24},children:h.name?.charAt(0)?.toUpperCase()}),t(g,{sx:{display:"flex",flexDirection:"column",flex:1},children:[e(u,{variant:"body2",sx:{fontWeight:500},children:h.name}),h.designation&&e(u,{variant:"caption",color:"text.secondary",children:h.designation})]}),h.department&&e(ae,{label:h.department,size:"small",variant:"outlined",sx:{fontSize:"0.6rem",height:"20px"}})]})},h.id)),Z.length===0&&e(te,{disabled:!0,children:e(u,{variant:"body2",color:"text.secondary",children:l?"No employees found in selected department":"No employees found"})})]}),_.user_id&&e(u,{variant:"caption",color:"error",sx:{mt:.5},children:_.user_id})]})]})},xr=({open:l,closeModal:p,leavesData:S,setLeavesData:y,currentLeave:b,allUsers:f,departments:F=[],setTotalRows:P,setLastPage:x,setLeaves:L,handleMonthChange:c,employee:_,selectedMonth:B,addLeaveOptimized:$,updateLeaveOptimized:T,fetchLeavesStats:v})=>{const{auth:D}=Ae().props,o=me(),[M,I]=s.useState(b?.user_id||D.user.id),X=()=>b?.user_id?f?.find(d=>d.id===b.user_id)?.department_id||null:D?.user?.department_id||null,[ee,re]=s.useState(X()),[R,O]=s.useState(S?.leaveTypes||[]),[Z,oe]=s.useState([]),[A,h]=s.useState(b?.leave_type||""),n=r=>{if(!r)return new Date().toISOString().split("T")[0];if(typeof r=="string"&&r.match(/^\d{4}-\d{2}-\d{2}$/))return r;if(typeof r=="string"&&r.includes("T")){if(r.includes("T18:00:00")){const w=r.split("T")[0].split("-"),m=parseInt(w[0]),C=parseInt(w[1]),Q=parseInt(w[2])+1;return new Date(m,C-1,Q).toISOString().split("T")[0]}return r.split("T")[0]}try{const d=new Date(r);if(isNaN(d.getTime()))return new Date().toISOString().split("T")[0];const w=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,"0"),C=String(d.getDate()).padStart(2,"0");return`${w}-${m}-${C}`}catch(d){return console.error("Error formatting date:",d),new Date().toISOString().split("T")[0]}},[k,N]=s.useState(b?.from_date?n(b.from_date):""),[K,V]=s.useState(b?.to_date?n(b.to_date):""),[W,E]=s.useState(b?.no_of_days||""),[G,H]=s.useState(""),[J,j]=s.useState(b?.reason||""),[z,U]=s.useState({}),[he,ge]=s.useState(!1),[Ce,i]=s.useState("");return s.useEffect(()=>{if(S){O(S.leaveTypes||[]);const r=S.leaveCountsByUser?.[M]||[];if(oe(r),R.length>0&&!A&&!b&&h(R[0].type),b&&!A){const d=S.leaveTypes?.find(w=>w.id===b.leave_type);d&&h(d.type)}}},[S,M,b]),s.useEffect(()=>{if(b){I(b.user_id);const r=f?.find(d=>d.id===b.user_id);r?.department_id&&re(r.department_id)}},[b,f]),s.useEffect(()=>{if(!A||!Z||!R)return;const d=Z.find(m=>m.leave_type===A)?.days_used||0;i(d);const w=R.find(m=>m.type===A);if(w){const m=w.days-d;H(m),b&&W>m&&E(m)}},[A,Z,R,b,W]),s.useEffect(()=>{E(((d,w)=>{if(!d||!w)return"";const m=new Date(d),C=new Date(w);if(m>C)return"";const Q=C.getTime()-m.getTime();return Math.ceil(Q/(1e3*3600*24))+1})(k,K))},[k,K]),t(Re,{open:l,onClose:p,fullWidth:!0,maxWidth:"sm",children:[t(Pe,{sx:{display:"flex",alignItems:"center"},children:[e(u,{variant:"h6",component:"h2",children:b?"Edit Leave":"Add Leave"}),e(we,{onClick:p,sx:{position:"absolute",top:8,right:16},children:e(He,{})})]}),t("form",{onSubmit:async r=>{r.preventDefault(),ge(!0);const d=new Promise(async(w,m)=>{try{const C={route:route().current(),user_id:M,leaveType:A,fromDate:k,toDate:K,daysCount:W,leaveReason:J,employee:_,month:B},Q=b?route("leave-update"):route("leave-add");b&&(C.id=b.id);const q=await axios.post(Q,C);q.status===200||q.status===201?(y(q.data.leavesData),b&&T&&q.data.leave?(T(q.data.leave),v()):$&&q.data.leave?($(q.data.leave),v(),q.data.pagination&&(P(q.data.pagination.total),x(q.data.pagination.lastPage))):(console.log("Using fallback data update mode"),q.data.leaves&&(L(q.data.leaves.data),P(q.data.leaves.total),x(q.data.leaves.last_page)),q.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(q.data.leavesData)),p(),w([q.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",q.status),m(`Unexpected response status: ${q.status}`))}catch(C){console.error("Full error object:",C),C.response?(console.error("Error response status:",C.response.status),console.error("Error response data:",C.response.data),C.response.status===422?(U(C.response.data.errors||{}),m(C.response.data.error||"Failed to submit leave application")):m(`HTTP Error ${C.response.status}: ${C.response.data.message||"An unexpected error occurred. Please try again later."}`)):C.request?(console.error("No response received:",C.request),m("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",C.message),m("An error occurred while setting up the request."))}finally{ge(!1)}});Y.promise(d,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:w}){return e(ne,{children:w.map((m,C)=>e("div",{children:m},C))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:w}){return e(ne,{children:w})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})},children:[e(Le,{children:t(se,{container:!0,spacing:2,children:[e(se,{item:!0,xs:12,md:6,children:t(Ne,{fullWidth:!0,children:[e(Te,{id:"leave-type-label",children:"Leave Type"}),t($e,{labelId:"leave-type-label",value:A||"",onChange:r=>h(r.target.value),label:"Leave Type",error:!!z.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow,maxHeight:300}}},children:[e(te,{value:"",disabled:!0,children:"Select Leave Type"}),R.map(r=>{const d=Z?.find(C=>C.leave_type===r.type),m=(d?r.days-d.days_used:r.days)<=0;return e(te,{value:r.type,disabled:m,title:m?"No remaining leaves available":"",children:t(g,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:r.type}),e("span",{children:d?`${d.days_used} / ${r.days} days`:`${r.days} days`})]})},r.id)})]}),e(ct,{children:z.leaveType})]})}),e(se,{item:!0,xs:12,md:6,children:e(ie,{label:"From",type:"date",fullWidth:!0,value:k,onChange:r=>N(r.target.value),InputLabelProps:{shrink:!0},error:!!z.fromDate,helperText:z.fromDate})}),e(se,{item:!0,xs:12,md:6,children:e(ie,{label:"To",type:"date",fullWidth:!0,value:K,onChange:r=>V(r.target.value),InputLabelProps:{shrink:!0},error:!!z.toDate,helperText:z.toDate})}),e(se,{item:!0,xs:12,md:6,children:e(ie,{label:"Number of days",type:"text",fullWidth:!0,value:W,InputProps:{readOnly:!0},error:!!z.daysCount,helperText:z.daysCount})}),e(se,{item:!0,xs:12,md:6,children:e(ie,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${G} day${G!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:t(u,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",R.find(r=>r.type===A)?.days||0," total"]})},error:!!z.remainingLeaves,helperText:z.remainingLeaves})}),route().current()==="leaves"&&e(se,{item:!0,xs:12,children:e(pt,{selectedDepartmentId:ee,selectedEmployeeId:M,onDepartmentChange:re,onEmployeeChange:I,allUsers:f,departments:F,showSearch:!0,error:z,theme:o,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e(se,{item:!0,xs:12,children:e(ie,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:J,onChange:r=>j(r.target.value),error:!!z.leaveReason,helperText:z.leaveReason})})]})}),e(Ie,{sx:{padding:"16px",justifyContent:"center"},children:e(ye,{type:"submit",variant:"outlined",color:"primary",loading:he,disabled:he,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},vr=({open:l,closeModal:p,leaveId:S,setLeavesData:y,setLeaves:b,setTotalRows:f,setLastPage:F,setError:P,deleteLeaveOptimized:x,fetchLeavesStats:L})=>{const c=me(),[_,B]=s.useState(!1);return t(Re,{open:l,onClose:p,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(Pe,{id:"alert-dialog-title",children:"Confirm Deletion"}),e(Le,{children:e(vt,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),t(Ie,{children:[e(ze,{onClick:p,color:"primary",disabled:_,children:"Cancel"}),e(ze,{loading:_,disabled:_,onClick:()=>{if(!S){const v=Promise.reject(new Error("Invalid leave ID"));Y.promise(v,{error:"Invalid leave ID provided"});return}B(!0);const T=new Promise(async(v,D)=>{try{const o=await pe.delete(route("leave-delete",{id:S,route:route().current()}));o.status===200&&(x?(x(S),f(M=>Math.max(0,M-1)),L&&L()):(y&&y(o.data.leavesData),f&&f(o.data.leaves.total),F&&F(o.data.leaves.last_page),b&&b(o.data.leaves.data),P&&P(!1),L&&L()),v("Leave application deleted successfully"))}catch(o){if(console.error("Error deleting leave:",o),o.response?.status===404){const{leavesData:M}=o.response.data||{};y&&M&&y(M),P&&P(o.response?.data?.message||"Leave not found."),D("Leave not found or already deleted")}else o.response?.status===403?D("You do not have permission to delete this leave"):o.response?.status===422?D("Cannot delete leave with current status"):D(o.response?.data?.error||"Failed to delete leave application")}finally{B(!1),p()}});Y.promise(T,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},success:{render({data:v}){return e(ne,{children:v})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},error:{render({data:v}){return e(ne,{children:v})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}})},color:"error",autoFocus:!0,children:"Delete"})]})]})},Gt=({selectedDates:l=[],onDatesChange:p,existingLeaves:S=[],publicHolidays:y=[],minDate:b=null,maxDate:f=null,userId:F=null,fetchFromAPI:P=!1})=>{const x=me(),[L,c]=s.useState(new Date),[_,B]=s.useState({existingLeaves:S,publicHolidays:y}),[$,T]=s.useState(!1),[v,D]=s.useState(null),o=s.useCallback(async n=>{if(!(!P||!F)&&v!==n){T(!0);try{const k=await pe.get(route("leaves.bulk.calendar-data"),{params:{user_id:F,year:n}});k.data.success&&(B({existingLeaves:k.data.data.existingLeaves||[],publicHolidays:k.data.data.publicHolidays||[]}),D(n))}catch(k){console.error("Failed to fetch calendar data:",k)}finally{T(!1)}}},[P,F,v]);s.useEffect(()=>{const n=L.getFullYear();o(n)},[o,L.getFullYear()]),s.useEffect(()=>{P&&F&&D(null)},[F,P]);const M=P?_.existingLeaves:S,I=P?_.publicHolidays:y,X=s.useMemo(()=>{const n=L.getFullYear(),k=L.getMonth(),N=new Date(n,k,1),V=new Date(n,k+1,0).getDate(),W=N.getDay(),E=new Date(n,k,0).getDate(),G=[];for(let U=W-1;U>=0;U--)G.push({date:E-U,isCurrentMonth:!1,fullDate:new Date(n,k-1,E-U)});const H=[];for(let U=1;U<=V;U++)H.push({date:U,isCurrentMonth:!0,fullDate:new Date(n,k,U)});const j=42-(G.length+H.length),z=[];for(let U=1;U<=j;U++)z.push({date:U,isCurrentMonth:!1,fullDate:new Date(n,k+1,U)});return[...G,...H,...z]},[L]),ee=s.useCallback(()=>{c(n=>new Date(n.getFullYear(),n.getMonth()-1,1))},[]),re=s.useCallback(()=>{c(n=>new Date(n.getFullYear(),n.getMonth()+1,1))},[]),R=s.useCallback(()=>{c(new Date)},[]),O=s.useCallback(n=>{if(!n.isCurrentMonth||$)return;const k=n.fullDate.getFullYear()+"-"+String(n.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(n.fullDate.getDate()).padStart(2,"0"),N=M.some(E=>{if(!E.from_date||!E.to_date)return!1;const G=E.from_date.split("T")[0],H=E.to_date.split("T")[0];return k>=G&&k<=H}),K=I.includes(k);if(N||K||b&&n.fullDate<new Date(b)||f&&n.fullDate>new Date(f))return;const V=l.includes(k);let W;V?W=l.filter(E=>E!==k):W=[...l,k],p(W.sort())},[l,p,b,f,$,M,I]),Z=s.useCallback(n=>{if(!n.isCurrentMonth)return{selectable:!1};const k=n.fullDate.getFullYear()+"-"+String(n.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(n.fullDate.getDate()).padStart(2,"0"),N=l.includes(k),K=n.fullDate.toDateString()===new Date().toDateString(),V=n.fullDate<new Date().setHours(0,0,0,0),W=n.fullDate.getDay()===0||n.fullDate.getDay()===6,E=M.some(J=>{if(!J.from_date||!J.to_date)return!1;const j=J.from_date.split("T")[0],z=J.to_date.split("T")[0];return k>=j&&k<=z}),G=I.includes(k),H=!$&&!E&&!G&&(!b||n.fullDate>=new Date(b))&&(!f||n.fullDate<=new Date(f));return{isSelected:N,isToday:K,isPast:V,isWeekend:W,hasExistingLeave:E,isPublicHoliday:G,selectable:H}},[l,M,I,b,f,$]),oe=s.useCallback((n,k)=>n.isCurrentMonth?$?{color:x.palette.text.disabled,cursor:"not-allowed",backgroundColor:x.palette.action.disabledBackground,opacity:.5,pointerEvents:"none"}:k.isSelected?{backgroundColor:x.palette.primary.main,color:x.palette.primary.contrastText,fontWeight:"bold",border:`2px solid ${x.palette.primary.dark}`,boxShadow:`0 0 0 3px ${x.palette.primary.main}30`,transform:"scale(1.05)",zIndex:10}:k.hasExistingLeave?{backgroundColor:x.palette.error.main,color:x.palette.error.contrastText,border:`2px solid ${x.palette.error.dark}`,fontWeight:500,cursor:"not-allowed"}:k.isPublicHoliday?{backgroundColor:x.palette.warning.main,color:x.palette.warning.contrastText,border:`2px solid ${x.palette.warning.dark}`,fontWeight:500,cursor:"not-allowed"}:k.isToday?{backgroundColor:x.palette.secondary.light,color:x.palette.secondary.contrastText,fontWeight:600,border:`2px solid ${x.palette.secondary.main}`,boxShadow:`0 0 0 2px ${x.palette.secondary.main}40`,"&:hover":{backgroundColor:x.palette.secondary.main,transform:"scale(1.02)"}}:k.isWeekend?{color:x.palette.text.secondary,backgroundColor:x.palette.action.hover,border:`1px solid ${x.palette.divider}`,opacity:.7,"&:hover":{backgroundColor:x.palette.action.selected,opacity:.9}}:k.selectable?{color:x.palette.text.primary,border:"1px solid transparent","&:hover":{backgroundColor:x.palette.primary.main+"15",color:x.palette.primary.main,border:`1px solid ${x.palette.primary.main}30`,transform:"scale(1.02)"}}:{color:x.palette.text.disabled,cursor:"not-allowed",backgroundColor:x.palette.action.disabledBackground,opacity:.6}:{color:x.palette.text.disabled,cursor:"not-allowed",opacity:.3},[x,$]),A=L.toLocaleDateString("en-US",{month:"long",year:"numeric"}),h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return t(dt,{variant:"outlined",sx:{width:"100%"},children:[e(qe,{title:t(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(de,{style:{width:20,height:20,color:x.palette.primary.main}}),e(u,{variant:"h6",component:"h3",children:A}),P&&v&&e(ae,{size:"small",variant:"outlined",color:"primary",label:`Data: ${v}`,sx:{ml:1,fontSize:"0.7rem"}})]}),t(g,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e(we,{size:"small",onClick:ee,sx:{color:"text.secondary"},disabled:$,children:e(zt,{style:{width:16,height:16}})}),e(ze,{variant:"text",size:"small",onClick:R,sx:{minWidth:"auto",px:1.5,py:.5,fontSize:"0.75rem",textTransform:"none"},disabled:$,children:"Today"}),e(we,{size:"small",onClick:re,sx:{color:"text.secondary"},disabled:$,children:e(ft,{style:{width:16,height:16}})})]})]}),sx:{pb:2}}),t(De,{sx:{pt:0},children:[$&&t(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",py:3,backgroundColor:x.palette.action.hover,borderRadius:2,mb:3},children:[e(be,{size:24}),t(u,{variant:"body2",sx:{ml:2},children:["Loading calendar data for ",L.getFullYear(),"..."]})]}),t(g,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:3},children:[e(ae,{size:"small",variant:"filled",color:"primary",label:"Selected",sx:{fontWeight:600}}),e(ae,{size:"small",variant:"filled",color:"error",label:"Existing Leave",sx:{opacity:.9}}),e(ae,{size:"small",variant:"filled",color:"warning",label:"Holiday",sx:{opacity:.9}}),e(ae,{size:"small",variant:"filled",color:"secondary",label:"Today",sx:{fontWeight:600}}),e(ae,{size:"small",variant:"outlined",color:"default",label:"Weekend",sx:{opacity:.7}})]}),e(g,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5,mb:1},children:h.map(n=>e(g,{sx:{textAlign:"center",py:1,fontSize:"0.875rem",fontWeight:"medium",color:"text.secondary"},children:n},n))}),e(g,{sx:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:.5},children:X.map((n,k)=>{const N=Z(n),K=oe(n,N);return t(g,{onClick:()=>O(n),sx:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",width:40,height:40,minHeight:40,cursor:N.selectable?"pointer":"not-allowed",borderRadius:1.5,transition:"all 0.2s ease-in-out",fontSize:"0.875rem",userSelect:"none",...K},role:"button",tabIndex:N.selectable?0:-1,title:N.hasExistingLeave?"Existing leave - cannot select":N.isPublicHoliday?"Public holiday - cannot select":N.selectable?"":"Not selectable","aria-label":`${n.fullDate.toDateString()}${N.isSelected?" (selected)":""}${N.hasExistingLeave?" (existing leave)":""}${N.isPublicHoliday?" (public holiday)":""}`,onKeyDown:V=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),O(n))},children:[n.date,N.isWeekend&&!N.isSelected&&!N.hasExistingLeave&&!N.isPublicHoliday&&e(g,{sx:{position:"absolute",top:2,right:2,width:4,height:4,borderRadius:"50%",bgcolor:"text.secondary",opacity:.5}})]},k)})}),l.length>0&&t(g,{sx:{mt:3,p:2.5,borderRadius:2,background:`linear-gradient(135deg, ${x.palette.primary.light}20, ${x.palette.primary.main}10)`,border:`1px solid ${x.palette.primary.main}30`,backdropFilter:"blur(8px)",position:"relative",overflow:"hidden"},children:[t(g,{sx:{position:"relative",zIndex:1},children:[t(u,{variant:"body2",color:"primary.main",fontWeight:"600",sx:{mb:1},children:["📅 ",l.length," date",l.length!==1?"s":""," selected"]}),t(g,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[l.slice(0,12).map(n=>e(ae,{size:"small",variant:"filled",color:"primary",label:new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric"}),sx:{fontWeight:500,fontSize:"0.75rem"}},n)),l.length>12&&e(ae,{size:"small",variant:"outlined",color:"primary",label:`+${l.length-12} more`,sx:{fontWeight:500}})]})]}),e(g,{sx:{position:"absolute",top:-10,right:-10,width:60,height:60,borderRadius:"50%",background:`linear-gradient(45deg, ${x.palette.primary.main}15, transparent)`,opacity:.3}})]})]})]})},Kt=({validationResults:l=[],balanceImpact:p=null,isValidating:S=!1})=>{const y=me();if(l.length===0&&!S)return null;const b=l.filter(c=>c.status==="valid").length,f=l.filter(c=>c.status==="warning").length,F=l.filter(c=>c.status==="conflict").length;l.length;const P=c=>{const _={style:{width:16,height:16}};switch(c){case"valid":return e(Ye,{..._,style:{..._.style,color:y.palette.success.main}});case"warning":return e(je,{..._,style:{..._.style,color:y.palette.warning.main}});case"conflict":return e(Et,{..._,style:{..._.style,color:y.palette.error.main}});default:return e(ot,{..._,style:{..._.style,color:y.palette.text.disabled}})}},x=c=>{switch(c){case"valid":return"success";case"warning":return"warning";case"conflict":return"error";default:return"default"}},L=c=>new Date(c).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return t(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[t(Ge,{variant:"outlined",children:[e(qe,{title:t(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e(u,{variant:"h6",children:"Validation Results"}),S&&t(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e(be,{size:16}),e(u,{variant:"body2",color:"text.secondary",children:"Validating..."})]})]})}),t(De,{sx:{pt:0},children:[t(g,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2,mb:2},children:[t(g,{sx:{textAlign:"center"},children:[e(u,{variant:"h4",color:"success.main",fontWeight:"bold",children:b}),e(u,{variant:"body2",color:"success.main",children:"Valid"})]}),t(g,{sx:{textAlign:"center"},children:[e(u,{variant:"h4",color:"warning.main",fontWeight:"bold",children:f}),e(u,{variant:"body2",color:"warning.main",children:"Warnings"})]}),t(g,{sx:{textAlign:"center"},children:[e(u,{variant:"h4",color:"error.main",fontWeight:"bold",children:F}),e(u,{variant:"body2",color:"error.main",children:"Conflicts"})]})]}),p&&t(g,{sx:{p:2,borderRadius:2,background:y.palette.background.paper,border:`1px solid ${y.palette.divider}`},children:[t(u,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[e(ot,{style:{width:16,height:16,color:y.palette.primary.main}}),"Leave Balance Impact"]}),t(g,{sx:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:2},children:[t(g,{children:[e(u,{variant:"body2",color:"text.secondary",component:"span",children:"Leave Type:"}),e(u,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:p.leave_type})]}),t(g,{children:[e(u,{variant:"body2",color:"text.secondary",component:"span",children:"Current Balance:"}),t(u,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[p.current_balance," days"]})]}),t(g,{children:[e(u,{variant:"body2",color:"text.secondary",component:"span",children:"Requested Days:"}),t(u,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1},children:[p.requested_days," days"]})]}),t(g,{children:[e(u,{variant:"body2",color:"text.secondary",component:"span",children:"Remaining Balance:"}),t(u,{variant:"body2",fontWeight:"medium",component:"span",sx:{ml:1,color:p.remaining_balance<0?"error.main":"success.main"},children:[p.remaining_balance," days"]})]})]}),p.remaining_balance<0&&e(g,{sx:{mt:2,p:1.5,borderRadius:1,bgcolor:"error.light",border:1,borderColor:"error.main"},children:t(u,{variant:"body2",color:"error.main",children:["⚠️ This request exceeds your available leave balance by ",Math.abs(p.remaining_balance)," days."]})})]})]})]}),l.length>0&&t(Ge,{variant:"outlined",children:[e(qe,{title:e(u,{variant:"h6",children:"Date-by-Date Results"})}),e(De,{children:e(g,{sx:{display:"flex",flexDirection:"column",gap:1,maxHeight:240,overflowY:"auto"},children:l.map((c,_)=>t(g,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",p:2,borderRadius:2,border:1,borderColor:"divider","&:hover":{borderColor:"text.secondary"},transition:"border-color 0.2s"},children:[t(g,{sx:{display:"flex",alignItems:"center",gap:2},children:[P(c.status),t(g,{children:[e(u,{variant:"body2",fontWeight:"medium",children:L(c.date)}),e(u,{variant:"caption",color:"text.secondary",children:c.date})]})]}),t(g,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:.5},children:[e(ae,{size:"small",variant:"outlined",color:x(c.status),label:c.status,sx:{textTransform:"capitalize"}}),c.errors&&c.errors.length>0&&e(g,{sx:{textAlign:"right"},children:c.errors.map((B,$)=>e(u,{variant:"caption",color:"error.main",children:B},$))}),c.warnings&&c.warnings.length>0&&e(g,{sx:{textAlign:"right"},children:c.warnings.map((B,$)=>e(u,{variant:"caption",color:"warning.main",children:B},$))})]})]},_))})})]})]})},wr=({open:l,onClose:p,onSuccess:S,allUsers:y=[],departments:b=[],leavesData:f={leaveTypes:[],leaveCountsByUser:{}},isAdmin:F=!1,existingLeaves:P=[],publicHolidays:x=[]})=>{const{auth:L}=Ae().props,c=me(),[_,B]=s.useState([]),[$,T]=s.useState(null),[v,D]=s.useState(null),[o,M]=s.useState(""),[I,X]=s.useState(""),[ee,re]=s.useState(!1),[R,O]=s.useState([]),[Z,oe]=s.useState(!1),[A,h]=s.useState([]),[n,k]=s.useState(null),[N,K]=s.useState(!1),[V,W]=s.useState(!1),[E,G]=s.useState(!1),[H,J]=s.useState({});s.useMemo(()=>!P||P.length===0?[]:P.filter(a=>a.user_id===parseInt(v)),[P,v]);const j=s.useMemo(()=>R.length>0?R:f?.leaveTypes||[],[R,f]),z=s.useMemo(()=>R.length>0?R.map(a=>({leave_type:a.type,days_used:a.used,total_days:a.days,remaining_days:a.remaining})):f?.leaveCountsByUser?.[v]||[],[R,f,v]),U=s.useCallback(async a=>{if(a){oe(!0);try{const r=await pe.get(route("leaves.bulk.leave-types"),{params:{user_id:a,year:new Date().getFullYear()}});r.data.success&&O(r.data.leave_types)}catch(r){console.error("Failed to fetch user leave types:",r),O([])}finally{oe(!1)}}},[]);s.useEffect(()=>{(l&&v&&F||l&&v&&!F)&&U(v)},[v,l,F,U]),s.useEffect(()=>{if(l&&L?.user){const a=y?.find(r=>r.id===L.user.id);(a&&a.department_id&&!F||F&&!$&&!v&&a&&a.department_id)&&(T(a.department_id),D(L.user.id))}},[l,L?.user,y,F,$,v]),s.useEffect(()=>{l||(B([]),T(null),D(L?.user?.id||null),M(""),X(""),re(!1),h([]),k(null),W(!1),J({}),O([]))},[l,L?.user?.id]),s.useEffect(()=>{if(j.length>0&&!o&&l&&v){const a=j.find(r=>{if(R.length>0)return r.remaining>0;const d=z?.find(m=>m.leave_type===r.type);return(d?r.days-d.days_used:r.days)>0});a&&M(a.type)}},[j,z,R,o,l,v]);const he=s.useCallback(async()=>{if(_.length===0){const a=Promise.reject(new Error("No dates selected"));Y.promise(a,{error:"Please select at least one date"});return}if(!o){const a=Promise.reject(new Error("No leave type selected"));Y.promise(a,{error:"Please select a leave type"});return}if(!I.trim()||I.trim().length<5){const a=new Promise((r,d)=>{d("Please provide a reason for leave (at least 5 characters)")});Y.promise(a,{error:{render({data:r}){return e(ne,{children:r})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}});return}K(!0),J({});try{const a=j.find(d=>d.type===o),r=await pe.post(route("leaves.bulk.validate"),{user_id:parseInt(v),dates:_,leave_type_id:a?.id,reason:I.trim()});if(r.data.success){h(r.data.validation_results),k(r.data.estimated_balance_impact),W(!0);const d=r.data.validation_results.filter(C=>C.status==="conflict").length,w=r.data.validation_results.filter(C=>C.status==="warning").length,m=Promise.resolve();d>0?Y.promise(m,{success:`${d} date(s) have conflicts. Please review before submitting.`}):w>0?Y.promise(m,{success:`${w} date(s) have warnings. You may proceed if acceptable.`}):Y.promise(m,{success:"All dates validated successfully!"})}}catch(a){console.error("Validation error:",a),a.response?.status===422&&J(a.response.data.errors||{});const r=Promise.reject(a);Y.promise(r,{error:a.response?.data?.message||"Failed to validate dates"})}finally{K(!1)}},[_,o,I,v,j]),ge=s.useCallback(async()=>{if(!V){const d=Promise.reject(new Error("Not validated"));Y.promise(d,{error:"Please validate dates before submitting"});return}if(A.filter(d=>d.status==="conflict").length>0&&!ee){const d=new Promise((w,m)=>{m("Please resolve conflicts or enable partial success mode")});Y.promise(d,{error:{render({data:w}){return e(ne,{children:w})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}});return}G(!0);const r=new Promise(async(d,w)=>{try{const m=j.find(Q=>Q.type===o),C=await pe.post(route("leaves.bulk.store"),{user_id:parseInt(v),dates:_,leave_type_id:m?.id,reason:I.trim(),allow_partial_success:ee});C.status===200||C.status===201?(S?.(C.data),p(),d([C.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",C.status),w(`Unexpected response status: ${C.status}`))}catch(m){console.error("Full error object:",m),m.response?(console.error("Error response status:",m.response.status),console.error("Error response data:",m.response.data),m.response.status===422?(J(m.response.data.errors||{}),w(m.response.data.error||"Failed to submit bulk leave requests")):w(`HTTP Error ${m.response.status}: ${m.response.data.message||"An unexpected error occurred. Please try again later."}`)):m.request?(console.error("No response received:",m.request),w("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",m.message),w("An error occurred while setting up the request."))}finally{G(!1)}});Y.promise(r,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},success:{render({data:d}){return e(ne,{children:d.map((w,m)=>e("div",{children:w},m))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}},error:{render({data:d}){return e(ne,{children:d})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,color:c.palette.text.primary}}})},[V,A,ee,v,_,o,I,S,p,j,c]),Ce=_.length>0&&o&&I.trim().length>=5,i=V&&(A.filter(a=>a.status==="conflict").length===0||ee);return t(Re,{open:l,onClose:p,fullWidth:!0,maxWidth:"lg",children:[t(Pe,{sx:{display:"flex",alignItems:"center",pb:1},children:[t(g,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(de,{style:{width:24,height:24,color:c.palette.primary.main}}),t(g,{children:[e(u,{variant:"h6",component:"h2",children:"Add Bulk Leave"}),e(u,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Select multiple dates and create leave requests in batch"})]})]}),e(we,{onClick:p,sx:{position:"absolute",top:8,right:16},disabled:E,children:e(He,{})})]}),e(Le,{sx:{py:3},children:t(se,{container:!0,spacing:3,children:[e(se,{item:!0,xs:12,lg:6,children:t(g,{sx:{position:"sticky",top:0},children:[t(u,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e(de,{style:{width:20,height:20}}),"Select Dates"]}),e(Gt,{selectedDates:_,onDatesChange:a=>{B(a),W(!1)},userId:v,fetchFromAPI:!0})]})}),e(se,{item:!0,xs:12,lg:6,children:t(g,{sx:{display:"flex",flexDirection:"column",gap:3},children:[t(g,{children:[e(u,{variant:"h6",gutterBottom:!0,children:"Leave Details"}),t(g,{sx:{display:"flex",flexDirection:"column",gap:2},children:[F&&y.length>0&&e(pt,{selectedDepartmentId:$,selectedEmployeeId:v,onDepartmentChange:T,onEmployeeChange:a=>{D(a),M(""),W(!1),O([])},allUsers:y,departments:b,showSearch:!0,error:H,theme:c,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:E||N}),t(Ne,{fullWidth:!0,error:!!H.leave_type_id,children:[e(Te,{id:"bulk-leave-type-label",children:"Leave Type"}),t($e,{labelId:"bulk-leave-type-label",value:o||"",onChange:a=>{M(a.target.value),W(!1)},label:"Leave Type",disabled:E||N||Z,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:c.glassCard.background,border:c.glassCard.border,borderRadius:2,boxShadow:c.glassCard.boxShadow,maxHeight:300}}},children:[e(te,{value:"",disabled:!0,children:Z?"Loading leave types...":"Select Leave Type"}),j.map(a=>{let r,d;if(R.length>0)r=a.remaining,d=r<=0;else{const w=z?.find(m=>m.leave_type===a.type);r=w?a.days-w.days_used:a.days,d=r<=0}return e(te,{value:a.type,disabled:d,title:d?"No remaining leaves available":"",children:t(g,{display:"flex",justifyContent:"space-between",width:"100%",children:[e("span",{children:a.type}),t("span",{children:["(",r," remaining)"]})]})},a.id)})]}),e(ct,{children:H.leave_type_id})]}),o&&e(ie,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:(()=>{const a=j.find(d=>d.type===o);let r;if(R.length>0&&a)r=a.remaining,a.days;else{const d=z?.find(w=>w.leave_type===o);r=d?a?.days-d.days_used:a?.days,a?.days}return`${r||0} remaining`})(),InputProps:{readOnly:!0,endAdornment:t(u,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",(()=>{const a=j.find(r=>r.type===o);return R.length>0,a?.days})()," total"]})}}),e(ie,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:I,onChange:a=>{X(a.target.value),W(!1)},multiline:!0,rows:3,fullWidth:!0,required:!0,error:!!H.reason||I.length>0&&I.length<5,helperText:H.reason||(I.length>0&&I.length<5?"Reason must be at least 5 characters":`${I.length}/500 characters`),inputProps:{maxLength:500},disabled:E||N}),e(wt,{control:e(Ct,{checked:ee,onChange:a=>re(a.target.checked),size:"small",disabled:E||N}),label:t(g,{children:[e(u,{variant:"body2",children:"Allow partial success"}),e(u,{variant:"caption",color:"text.secondary",children:"Valid dates will be processed even if some dates fail validation"})]})})]})]}),_.length>0&&t(g,{sx:{p:2,borderRadius:2,background:c.palette.background.paper,border:`1px solid ${c.palette.divider}`},children:[e(u,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Selected Dates Summary"}),t(u,{variant:"body1",children:[e("strong",{children:_.length})," date",_.length!==1?"s":""," selected"]}),o&&t(u,{variant:"body2",color:"text.secondary",children:["Leave type: ",o]})]}),e(Kt,{validationResults:A,balanceImpact:n,isValidating:N})]})})]})}),t(Ie,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(ye,{variant:"outlined",onClick:p,disabled:E,sx:{borderRadius:"50px"},children:"Cancel"}),t(g,{sx:{display:"flex",gap:1},children:[e(ye,{variant:"outlined",color:"primary",onClick:he,loading:N,disabled:!Ce||E,startIcon:!N&&e(je,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:N?"Validating...":"Validate Dates"}),e(ye,{variant:"contained",color:"primary",onClick:ge,loading:E,disabled:!i||N,startIcon:!E&&e(Ye,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:E?"Creating...":`Create ${_.length} Leave Request${_.length!==1?"s":""}`})]})]})]})},Cr=({open:l,onClose:p,onSuccess:S,selectedLeaves:y=[],allUsers:b=[]})=>{const f=me(),[F,P]=s.useState(!1),[x,L]=s.useState({}),c=s.useCallback(T=>b.find(D=>D.id===T)?.name||`User ID: ${T}`,[b]),_=y.filter(T=>T.status&&T.status.toLowerCase()==="approved"),B=_.length===0,$=s.useCallback(async()=>{if(!B){const v=Promise.reject("Cannot delete approved leaves");Y.promise(v,{error:"Cannot delete approved leave requests"});return}if(y.length===0){const v=Promise.reject("No leaves selected");Y.promise(v,{error:"No leave requests selected for deletion"});return}P(!0);const T=new Promise(async(v,D)=>{try{const o=y.map(I=>I.id),M=await pe.delete(route("leaves.bulk.delete"),{data:{leave_ids:o}});M.status===200&&M.data.success?(S?.(M.data),p(),v([M.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",M.status),D(`Unexpected response status: ${M.status}`))}catch(o){console.error("Full error object:",o),o.response?(console.error("Error response status:",o.response.status),console.error("Error response data:",o.response.data),o.response.status===422?(L(o.response.data.errors||{}),D(o.response.data.error||"Failed to delete leave requests")):o.response.status===403?D(o.response.data.error||"You are not authorized to delete these leave requests"):o.response.status===404?D(o.response.data.error||"Some leave requests were not found"):D(`HTTP Error ${o.response.status}: ${o.response.data.message||"An unexpected error occurred. Please try again later."}`)):o.request?(console.error("No response received:",o.request),D("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",o.message),D("An error occurred while setting up the request."))}finally{P(!1)}});Y.promise(T,{pending:{render(){return t("div",{style:{display:"flex",alignItems:"center"},children:[e(be,{}),e("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}},success:{render({data:v}){return e(ne,{children:v.map((D,o)=>e("div",{children:D},o))})},icon:"🟢",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}},error:{render({data:v}){return e(ne,{children:v})},icon:"🔴",style:{backdropFilter:"blur(16px) saturate(200%)",background:f.glassCard.background,border:f.glassCard.border,color:f.palette.text.primary}}})},[y,B,S,p,f]);return t(Re,{open:l,onClose:p,fullWidth:!0,maxWidth:"md",children:[t(Pe,{sx:{display:"flex",alignItems:"center",pb:1},children:[t(g,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e(ve,{style:{width:24,height:24,color:f.palette.error.main}}),t(g,{children:[e(u,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),t(u,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",y.length," leave request",y.length!==1?"s":""]})]})]}),e(we,{onClick:p,sx:{position:"absolute",top:8,right:16},disabled:F,children:e(He,{})})]}),t(Le,{sx:{py:3},children:[!B&&t(g,{sx:{p:2,mb:3,borderRadius:2,background:f.palette.error.main+"20",border:`1px solid ${f.palette.error.main}40`},children:[t(g,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e(je,{style:{width:20,height:20,color:f.palette.error.main}}),e(u,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),t(u,{variant:"body2",color:"error",children:[_.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),t(u,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e(Ye,{style:{width:20,height:20}}),"Selected Leave Requests (",y.length,")"]}),e(Dt,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${f.palette.divider}`,borderRadius:2,backgroundColor:f.palette.background.paper},children:y.map((T,v)=>{const D=T.status&&T.status.toLowerCase()==="approved";return t(xe.Fragment,{children:[e(kt,{sx:{py:2,opacity:D?.6:1,backgroundColor:D?f.palette.error.main+"10":"transparent"},children:e(St,{primary:t(g,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e(u,{variant:"subtitle2",children:c(T.user_id)}),e(Fe,{size:"sm",variant:"flat",color:T.status?.toLowerCase()==="approved"?"success":T.status?.toLowerCase()==="pending"?"warning":T.status?.toLowerCase()==="rejected"?"danger":"default",children:T.status||"Unknown"}),D&&e(Fe,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:t(g,{children:[t(u,{variant:"body2",color:"text.secondary",children:[T.leave_type," - ",T.from_date," to ",T.to_date]}),t(u,{variant:"body2",color:"text.secondary",children:[T.no_of_days," day",T.no_of_days!==1?"s":""," - ",T.reason]})]})})}),v<y.length-1&&e(_t,{})]},T.id)})}),B&&e(g,{sx:{mt:3,p:2,borderRadius:2,background:f.palette.warning.main+"20",border:`1px solid ${f.palette.warning.main}40`},children:e(u,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"⚠️ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),t(Ie,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e(ye,{variant:"outlined",onClick:p,disabled:F,sx:{borderRadius:"50px"},children:"Cancel"}),e(ye,{variant:"contained",color:"error",onClick:$,loading:F,disabled:!B||F||y.length===0,startIcon:!F&&e(ve,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:F?"Deleting...":`Delete ${y.length} Request${y.length!==1?"s":""}`})]})]})};export{wr as B,vr as D,xr as L,Cr as a,Vt as b};
