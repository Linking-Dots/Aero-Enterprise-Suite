import{j as e,u as ee,A as se,B as ae,C as te,D as re,i as F,s as H,l as k,t as ue,b as d,E as le,h as y,O as Ys,J as pe,N as Qa,L as Ga,P as Ja,a as We,d as Qs,e as He,m as Xa,n as Za,o as et,q as st,r as at,v as tt,p as rt,_ as lt,F as nt,w as it,x as ct,y as ot,z as T}from"./vendor-heroui-CinxWHhv.js";import{r as i,J as dt,S as fe,Q as mt}from"./vendor-inertia-sUfCHI_5.js";import{a as O}from"./vendor-utils-CrJAVL9K.js";import{s as f}from"./toastUtils-BVg-E_WQ.js";import{u as Ye,F as B,a as Ce,P as Se,f as Gs,A as xt}from"./Dashboard-C-UwZ8P5.js";import{S as ht}from"./StatsCards-BMaN9BXf.js";import{g as Y}from"./useThemeRadius-AM-qADuZ.js";import{F as ge,a as ut,b as Re,E as pt,S as ft,C as gt,c as jt}from"./ErrorBoundary-Cq3Sv2JD.js";import{f as yt,g as Qe,A as Je,e as Q}from"./vendor-framer-B7qqn1b6.js";import{b as ta,d as vt}from"./app-bG_kjNHR.js";import{F as Js}from"./ExclamationTriangleIcon-BarRaUA8.js";import{F as A}from"./ClockIcon-BKLni_N9.js";import{F as Fe}from"./CheckCircleIcon-BAvoXTNq.js";import{F as Xs}from"./DocumentIcon-08C5TBVc.js";import{F as Zs}from"./PhotoIcon-D-cYh0Dc.js";import{a as Nt}from"./XMarkIcon-twQGc8di.js";import{a as ne,F as wt}from"./MapPinIcon-DDwLGyCW.js";import{F as Ge}from"./MagnifyingGlassIcon-BJyUDYwI.js";import{F as ea}from"./CheckCircleIcon-CykloG3X.js";import{F as ke}from"./PencilIcon-BsmkHcSS.js";import{F as Ae}from"./XCircleIcon-Cv262LQg.js";import{F as sa}from"./UserIcon-CgrjQ1A2.js";import{F as bt}from"./AdjustmentsHorizontalIcon-lemo7t2o.js";import{F as _t}from"./PlusIcon-BO1LbXgZ.js";import{F as aa}from"./TrashIcon-Dnjv_I7q.js";import{F as Ct}from"./EllipsisVerticalIcon-CqOfKM9J.js";import"./vendor-react-FouZbkAE.js";import"./EnvelopeIcon-CFKoTD3N.js";import"./UserGroupIcon-CSQScwVa.js";import"./ShieldCheckIcon-Ck-ae4AP.js";import"./KeyIcon-BIi5nz4o.js";import"./logo-DFaNDj_M.js";import"./XCircleIcon-BzKw4V53.js";import"./ExclamationTriangleIcon-D3y6aOMr.js";const St=({onRefresh:g,children:x,disabled:L=!1,threshold:w=80,className:Xe=""})=>{const[u,K]=i.useState(!1),[v,U]=i.useState(0),_=i.useRef(null),q=i.useRef(0),ie=i.useRef(0),V=i.useRef(!0),I=yt(0),Ze=Qe(I,[0,w],[0,360]),ye=Qe(I,[0,w/2,w],[0,.5,1]),ve=Qe(I,[0,w],[.5,1]),Ie=i.useCallback(W=>{if(L||u)return;const P=_.current;if(P&&P.scrollTop>0){V.current=!1;return}V.current=!0,q.current=W.touches[0].clientY},[L,u]),es=i.useCallback(W=>{if(L||u||!V.current)return;ie.current=W.touches[0].clientY;const P=ie.current-q.current;if(P>0){const ce=Math.min(P*.4,w*1.5);U(ce),I.set(ce),ce>10&&W.preventDefault()}},[L,u,w,I]),G=i.useCallback(async()=>{if(!(L||u||!V.current)){if(v>=w){K(!0);try{await(g==null?void 0:g())}finally{K(!1)}}U(0),I.set(0)}},[L,u,v,w,g,I]);return e.jsxs("div",{ref:_,className:`relative overflow-auto ${Xe}`,onTouchStart:Ie,onTouchMove:es,onTouchEnd:G,style:{touchAction:v>10?"none":"auto"},children:[e.jsx(Je,{children:(v>0||u)&&e.jsx(Q.div,{className:"absolute left-0 right-0 flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{top:Math.min(v,w)-40,height:40},children:e.jsx(Q.div,{className:`
                                w-10 h-10 rounded-full flex items-center justify-center
                                ${u?"bg-primary/20 border-2 border-primary":v>=w?"bg-success/20 border-2 border-success":"bg-default-100 border-2 border-default-300"}
                            `,style:{scale:u?1:ve,opacity:u?1:ye},children:e.jsx(Q.div,{animate:u?{rotate:360}:{},transition:u?{repeat:1/0,duration:1,ease:"linear"}:{},style:{rotate:u?void 0:Ze},children:e.jsx(ta,{className:`w-5 h-5 ${u?"text-primary":v>=w?"text-success":"text-default-500"}`})})})})}),e.jsx(Q.div,{style:{y:u?w/2:I,transition:u?"transform 0.2s ease-out":void 0},children:x})]})},S=Object.fromEntries(Object.entries(jt).map(([g,x])=>[g,{color:x.color,icon:x.solidIcon||x.icon,label:x.label}])),je=Object.fromEntries(Object.entries(gt).map(([g,x])=>[g,{label:x.label,color:x.color}])),Rt=({objections:g,filters:x,statuses:L,categories:w,creators:Xe,statistics:u})=>{var Ns,ws,bs,_s,Cs,Ss,Rs,Fs,ks,As,Is,Ps,$s,zs,Ds,Es,Ts,Os,Ls,Ms,Bs,Ks,Us,qs,Vs;const{auth:K}=dt().props,v=Ye("(min-width: 1025px)"),U=Ye("(min-width: 641px) and (max-width: 1024px)"),_=Ye("(max-width: 640px)");(Ns=K.roles)!=null&&Ns.includes("Administrator")||(ws=K.roles)!=null&&ws.includes("Super Administrator")||(bs=K.roles)!=null&&bs.includes("Daily Work Manager"),(_s=K.roles)==null||_s.some(s=>["Super Administrator","Administrator","Project Manager","Consultant","HR Manager"].includes(s));const q=i.useRef(null),[ie,V]=i.useState(!1),[I,Ze]=i.useState(!1),[ye,ve]=i.useState(!1),[Ie,es]=i.useState(!1),[G,W]=i.useState((x==null?void 0:x.search)||""),[P,J]=i.useState((g==null?void 0:g.current_page)||1),[ce,ra]=i.useState(new Set),[N,ss]=i.useState(g);i.useEffect(()=>{ss(g)},[g]);const[oe,la]=i.useState(!1),[b,as]=i.useState({status:(x==null?void 0:x.status)||"all",category:(x==null?void 0:x.category)||"all",creator:(x==null?void 0:x.creator)||""}),{isOpen:na,onOpen:ia,onClose:Pe}=ee(),[ca,ts]=i.useState(!1),[$e,ze]=i.useState([]),[c,R]=i.useState({title:"",category:"other",type:"",chainage_from:"",chainage_to:"",specific_chainages:"",chainage_range_from:"",chainage_range_to:"",description:"",reason:"",status:"draft"}),de={Embankment:{label:"Embankment",icon:"ðŸ”ï¸",color:"secondary"},Structure:{label:"Structure",icon:"ðŸ—ï¸",color:"primary"},Pavement:{label:"Pavement",icon:"ðŸ›£ï¸",color:"success"}},oa=s=>{const a=Array.from(s.target.files);ze(t=>[...t,...a]),s.target.value=""},da=s=>{ze(a=>a.filter((t,l)=>l!==s))},rs=()=>{R({title:"",category:"other",type:"",chainage_from:"",chainage_to:"",specific_chainages:"",chainage_range_from:"",chainage_range_to:"",description:"",reason:"",status:"draft"}),ze([])},{isOpen:ma,onOpen:xa,onClose:De}=ee(),[r,ls]=i.useState(null),[me,Ee]=i.useState([]),[$,Ne]=i.useState([]),[ha,ns]=i.useState(!1),[Te,is]=i.useState(!1),[M,Oe]=i.useState(""),[ua,cs]=i.useState(!1),{isOpen:pa,onOpen:fa,onClose:Le}=ee(),[ga,os]=i.useState(!1),[ja,ya]=i.useState(null),[C,z]=i.useState({title:"",category:"other",type:"",chainage_from:"",chainage_to:"",specific_chainages:"",chainage_range_from:"",chainage_range_to:"",description:"",reason:""}),{isOpen:va,onOpen:Na,onClose:Me}=ee(),[wa,ds]=i.useState(!1),[j,ba]=i.useState(null),[we,Be]=i.useState(""),{isOpen:_a,onOpen:Ca,onClose:ms}=ee(),[X,Sa]=i.useState(null),{isOpen:Ra,onOpen:Fa,onClose:Z}=ee(),[n,ka]=i.useState(null),[xs,Aa]=i.useState(u||null);i.useCallback(()=>(q.current&&q.current.abort(),q.current=new AbortController,q.current.signal),[]);const hs=i.useCallback(()=>{const s={};return G&&(s.search=G),b.status&&b.status!=="all"&&(s.status=b.status),b.category&&b.category!=="all"&&(s.category=b.category),b.creator&&(s.creator=b.creator),s.page=P,s},[G,b,P]),be=i.useCallback(async(s=!0)=>{s&&ve(!0);const a=hs();fe.get(route("objections.index"),a,{preserveState:!0,preserveScroll:!0,onFinish:()=>{ve(!1),V(!1)}})},[hs]),_e=i.useCallback(()=>{J(1),be()},[be]),Ia=i.useCallback(async()=>{ie||!_||(V(!0),_e(),f.success("Data refreshed"))},[ie,_,_e]),Ke=i.useRef(null),Pa=s=>{const a=s.target.value;W(a),J(1),Ke.current&&clearTimeout(Ke.current),Ke.current=setTimeout(()=>{be()},300)},us=(s,a)=>{as(t=>({...t,[s]:a})),J(1)},$a=s=>{J(s)},za=s=>{ra(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},ps=s=>{if(!s)return"N/A";try{return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid date"}},fs=s=>{const a=S[s]||S.draft,t=a.icon;return e.jsx(y,{size:"sm",variant:"flat",color:a.color,startContent:e.jsx(t,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:a.label})},Ue=s=>{const a=je[s]||je.other;return e.jsx(y,{size:"sm",variant:"flat",color:a.color,className:"text-xs",children:a.label})},gs=s=>{if(!s)return null;const a=de[s];return a?e.jsx(y,{size:"sm",variant:"flat",color:a.color,className:"text-xs",startContent:e.jsx("span",{className:"text-xs",children:a.icon}),children:a.label}):null},Da=async()=>{var s,a;if(!c.title||!c.description||!c.reason){f.error("Please fill in all required fields");return}ts(!0);try{const t=new FormData;t.append("title",c.title),t.append("category",c.category),c.type&&t.append("type",c.type),t.append("description",c.description),t.append("reason",c.reason),t.append("status",c.status),c.specific_chainages&&t.append("specific_chainages",c.specific_chainages),c.chainage_range_from&&t.append("chainage_range_from",c.chainage_range_from),c.chainage_range_to&&t.append("chainage_range_to",c.chainage_range_to),!c.specific_chainages&&!c.chainage_range_from&&c.chainage_from&&t.append("chainage_from",c.chainage_from),!c.specific_chainages&&!c.chainage_range_to&&c.chainage_to&&t.append("chainage_to",c.chainage_to),$e.forEach(o=>{t.append("files[]",o)});const l=await O.post(route("objections.store"),t,{headers:{"Content-Type":"multipart/form-data"}});f.success(l.data.message||"Objection created successfully"),Pe(),rs(),fe.reload({only:["objections","statistics"]})}catch(t){f.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to create objection")}finally{ts(!1)}},D=async(s,a,t="",l=null)=>{var o,m;console.log("handleSuggestRfis called:",{chainageFrom:s==null?void 0:s.substring(0,50),chainageTo:a,searchQuery:t,objectionType:l}),is(!0);try{const h={};s&&(h.chainage_from=s),a&&(h.chainage_to=a),t&&(h.search=t),l&&(h.type=l),console.log("Calling API with params:",{...h,chainage_from:(o=h.chainage_from)==null?void 0:o.substring(0,50)});const p=await O.get(route("objections.suggestRfis"),{params:h});console.log("API response:",{count:(m=p.data.rfis)==null?void 0:m.length,matchType:p.data.match_type}),Ee(p.data.rfis||[])}catch(h){console.error("Failed to suggest RFIs:",h),Ee([])}finally{is(!1)}},js=()=>{var s,a,t;if(r){const l=r.chainage_summary||{},o=((s=l.specific)==null?void 0:s.join(", "))||"",m=((a=l.range)==null?void 0:a.split(" - ")[0])||r.chainage_from,h=((t=l.range)==null?void 0:t.split(" - ")[1])||r.chainage_to,p=r.type;M?D(null,null,M,p):o?D(o,null,"",p):D(m,h,M,p)}else M&&D(null,null,M)},xe=s=>{var h,p,Ws,Hs;ls(s),Ne(((h=s.daily_works)==null?void 0:h.map(Ya=>String(Ya.id)))||[]),Oe(""),Ee([]);const a=s.chainage_summary||{},t=((p=a.specific)==null?void 0:p.join(", "))||"",l=((Ws=a.range)==null?void 0:Ws.split(" - ")[0])||s.chainage_from,o=((Hs=a.range)==null?void 0:Hs.split(" - ")[1])||s.chainage_to,m=s.type;t?D(t,null,"",m):l&&o?D(l,o,"",m):l&&D(l,null,"",m),xa()},Ea=async()=>{var s,a;if(!r||$.length===0){f.error("Please select at least one RFI");return}ns(!0);try{const t=await O.post(route("objections.attachRfis",r.id),{rfi_ids:$.map(l=>parseInt(l))});f.success(t.data.message||"RFIs attached successfully"),De(),fe.reload({only:["objections"]})}catch(t){f.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to attach RFIs")}finally{ns(!1)}},Ta=async()=>{var s;if($.length===0){f.error("Please select at least one RFI to export");return}cs(!0);try{const t=me.filter(l=>$.includes(String(l.id))).map(l=>({"RFI Number":l.number||"",Date:l.date||"N/A",Chainage:l.location||"N/A",Side:l.side||"N/A","Layer/Qty":l.qty_layer||"N/A",Type:l.type||"N/A",Description:l.description||"N/A",Status:l.status||"N/A","Objection Title":(r==null?void 0:r.title)||"N/A","Objection Chainage":`${(r==null?void 0:r.chainage_from)||""} - ${(r==null?void 0:r.chainage_to)||""}`}));if(typeof window<"u"){const l=await lt(()=>import("./xlsx-DkH2s96g.js"),[]),o=l.utils.json_to_sheet(t),m=l.utils.book_new();l.utils.book_append_sheet(m,o,"Selected RFIs");const h=Object.keys(t[0]||{}).map(()=>({wch:20}));o["!cols"]=h;const p=`selected_rfis_${((s=r==null?void 0:r.title)==null?void 0:s.replace(/[\/\\\s]/g,"_"))||"export"}_${new Date().toISOString().split("T")[0]}`;l.writeFile(m,`${p}.xlsx`),f.success(`Exported ${t.length} RFIs successfully`)}}catch(a){console.error("Export error:",a),f.error("Failed to export RFIs")}finally{cs(!1)}},qe=s=>{ya(s);const a=s.chainage_summary||{},t=a.specific_chainages||[],l=a.chainage_range||{};z({title:s.title||"",category:s.category||"other",type:s.type||"",chainage_from:s.chainage_from||l.from||"",chainage_to:s.chainage_to||l.to||"",specific_chainages:t.join(", ")||"",chainage_range_from:l.from||s.chainage_from||"",chainage_range_to:l.to||s.chainage_to||"",description:s.description||"",reason:s.reason||""}),fa()},Oa=async()=>{var s,a;if(!C.title||!C.description||!C.reason){f.error("Please fill in all required fields");return}os(!0);try{const t=await O.put(route("objections.update",ja.id),C);f.success(t.data.message||"Objection updated successfully"),Le(),fe.reload({only:["objections","statistics"]})}catch(t){f.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to update objection")}finally{os(!1)}},E=(s,a)=>{ls(s),ba(a),Be(""),Na()},La=async()=>{var s,a;if(!(!r||!j)){if(["resolve","reject"].includes(j)&&!we.trim()){f.error("Please provide resolution notes");return}ds(!0);try{let t;switch(j){case"submit":t=await O.post(route("objections.submit",r.id));break;case"review":t=await O.post(route("objections.review",r.id));break;case"resolve":t=await O.post(route("objections.resolve",r.id),{resolution_notes:we});break;case"reject":t=await O.post(route("objections.reject",r.id),{resolution_notes:we});break;default:throw new Error("Invalid action")}f.success(t.data.message||"Status updated successfully"),t.data.objection&&ss(l=>({...l,data:l.data.map(o=>o.id===t.data.objection.id?t.data.objection:o)})),t.data.statistics&&Aa(t.data.statistics),Me(),Be("")}catch(t){f.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to update status")}finally{ds(!1)}}},ys=async s=>{var a,t;if(confirm("Are you sure you want to delete this objection?"))try{const l=await O.delete(route("objections.destroy",s.id));f.success(l.data.message||"Objection deleted successfully"),fe.reload({only:["objections","statistics"]})}catch(l){f.error(((t=(a=l.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to delete objection")}},vs=s=>{switch(s){case"submit":return"Submit for Review";case"review":return"Start Review";case"resolve":return"Resolve Objection";case"reject":return"Reject Objection";default:return"Update Status"}},Ve=s=>{Sa(s),Ca()},Ma=s=>{ka(s),Fa()},he=s=>{var a;return((a=S[s])==null?void 0:a.label)||(s==null?void 0:s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase()))||"Unknown"};i.useEffect(()=>{be()},[b,P]);const Ba=i.useMemo(()=>{const s=xs||{},a=s.total||(N==null?void 0:N.total)||0,t=s.active||0,l=s.resolved||0,o=s.pending||0,m=a>0?Math.round(l/a*100):0;return[{title:"Total Objections",value:a.toLocaleString(),icon:e.jsx(B,{className:"w-5 h-5"}),color:"text-blue-600",bgColor:"bg-blue-50 dark:bg-blue-900/20",description:`${t} active`,trend:t>0?"down":"neutral"},{title:"Active Issues",value:t.toLocaleString(),icon:e.jsx(Js,{className:"w-5 h-5"}),color:t>10?"text-red-600":"text-warning-600",bgColor:t>10?"bg-red-50 dark:bg-red-900/20":"bg-warning-50 dark:bg-warning-900/20",description:t>0?"Require attention":"All clear!",trend:t>10?"down":t>0?"neutral":"up"},{title:"Pending Review",value:o.toLocaleString(),icon:e.jsx(A,{className:"w-5 h-5"}),color:"text-orange-600",bgColor:"bg-orange-50 dark:bg-orange-900/20",description:o>0?"Awaiting action":"All caught up!",trend:o>5?"down":"neutral"},{title:"Resolution Rate",value:`${m}%`,icon:e.jsx(Fe,{className:"w-5 h-5"}),color:m>=80?"text-green-600":m>=50?"text-yellow-600":"text-red-600",bgColor:m>=80?"bg-green-50 dark:bg-green-900/20":m>=50?"bg-yellow-50 dark:bg-yellow-900/20":"bg-red-50 dark:bg-red-900/20",description:`${l} resolved`,trend:m>=80?"up":m>=50?"neutral":"down"}]},[xs,N]),Ka=[{label:"New Objection",icon:e.jsx(_t,{className:"w-4 h-4"}),color:"primary",variant:"solid",onPress:ia}],Ua=[{key:"title",label:"Title"},{key:"category",label:"Category"},{key:"chainage",label:"Chainage Range"},{key:"status",label:"Status"},{key:"affected_rfis",label:"Affected RFIs"},{key:"created_by",label:"Created By"},{key:"created_at",label:"Date"},{key:"actions",label:"Actions"}],qa=(s,a)=>{var t,l,o,m;switch(a){case"title":return e.jsxs("div",{className:"flex items-center gap-2 max-w-[200px]",children:[e.jsx(B,{className:`w-4 h-4 shrink-0 ${s.is_active?"text-warning animate-pulse":"text-success"}`}),e.jsx("span",{className:"font-medium text-sm truncate",title:s.title,children:s.title})]});case"category":return Ue(s.category);case"chainage":return s.chainage_from&&s.chainage_to?e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(ne,{className:"w-3 h-3 text-default-400"}),e.jsxs("span",{children:[s.chainage_from," - ",s.chainage_to]})]}):e.jsx("span",{className:"text-xs text-default-400",children:"Not set"});case"status":return fs(s.status);case"affected_rfis":return e.jsxs(d,{size:"sm",variant:"flat",color:s.daily_works_count>0?"primary":"default",startContent:e.jsx(ge,{className:"w-3 h-3"}),onPress:()=>xe(s),children:[s.daily_works_count||0," RFI(s)"]});case"created_by":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{src:(t=s.created_by)==null?void 0:t.profile_image_url,name:((l=s.created_by)==null?void 0:l.name)||"Unknown",size:"sm",className:"w-6 h-6"}),e.jsx("span",{className:"text-xs truncate max-w-[100px]",children:((o=s.created_by)==null?void 0:o.name)||"Unknown"})]});case"created_at":return e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(Gs,{className:"w-3 h-3 text-default-400"}),e.jsx("span",{children:ps(s.created_at)})]});case"actions":return e.jsxs(it,{children:[e.jsx(ct,{children:e.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",children:e.jsx(Ct,{className:"w-4 h-4"})})}),e.jsxs(ot,{"aria-label":"Objection actions",children:[e.jsx(T,{startContent:e.jsx(Ce,{className:"w-4 h-4"}),onPress:()=>Ma(s),children:"View Details"},"view"),e.jsx(T,{startContent:e.jsx(ge,{className:"w-4 h-4"}),onPress:()=>xe(s),children:"Manage RFIs"},"attach"),s.status==="draft"&&e.jsx(T,{startContent:e.jsx(ke,{className:"w-4 h-4"}),onPress:()=>qe(s),children:"Edit"},"edit"),s.status==="draft"&&e.jsx(T,{startContent:e.jsx(Re,{className:"w-4 h-4"}),color:"primary",onPress:()=>E(s,"submit"),children:"Submit for Review"},"submit"),s.status==="submitted"&&e.jsx(T,{startContent:e.jsx(A,{className:"w-4 h-4"}),color:"warning",onPress:()=>E(s,"review"),children:"Start Review"},"review"),(s.status==="submitted"||s.status==="under_review")&&e.jsx(T,{startContent:e.jsx(Fe,{className:"w-4 h-4"}),color:"success",onPress:()=>E(s,"resolve"),children:"Resolve"},"resolve"),(s.status==="submitted"||s.status==="under_review")&&e.jsx(T,{startContent:e.jsx(Ae,{className:"w-4 h-4"}),color:"danger",onPress:()=>E(s,"reject"),children:"Reject"},"reject"),((m=s.status_logs)==null?void 0:m.length)>0&&e.jsx(T,{startContent:e.jsx(A,{className:"w-4 h-4"}),onPress:()=>Ve(s),children:"View History"},"history"),s.status==="draft"&&e.jsx(T,{startContent:e.jsx(aa,{className:"w-4 h-4"}),color:"danger",className:"text-danger",onPress:()=>ys(s),children:"Delete"},"delete")]})]});default:return"-"}},Va=({objection:s,isExpanded:a,onToggle:t})=>{var o,m,h,p;const l=S[s.status]||S.draft;return l.icon,e.jsxs(We,{radius:Y(),className:`bg-content1 border shadow-sm ${s.is_active?"border-warning/60 bg-warning-50/30 dark:bg-warning-900/10":"border-divider/40"}`,children:[e.jsx(Qs,{className:"p-3 cursor-pointer select-none",onClick:t,children:e.jsxs("div",{className:"flex items-center justify-between w-full gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx(B,{className:`w-5 h-5 shrink-0 ${s.is_active?"text-warning animate-pulse":"text-success"}`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm text-foreground truncate",children:s.title}),e.jsx("p",{className:"text-xs text-default-500 truncate",children:s.chainage_from&&s.chainage_to?`${s.chainage_from} - ${s.chainage_to}`:"No chainage set"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx(y,{size:"sm",variant:"flat",color:l.color,className:"h-5 text-[10px]",children:l.label}),e.jsx("div",{className:`w-5 h-5 rounded-full bg-default-100 flex items-center justify-center transition-transform ${a?"rotate-180":""}`,children:e.jsx(vt,{className:"w-3 h-3 text-default-500"})})]})]})}),e.jsx(Je,{children:a&&e.jsx(Q.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},children:e.jsxs(He,{className:"px-3 pb-3 pt-0",children:[e.jsx(nt,{className:"mb-3"}),e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Category:"}),Ue(s.category)]}),s.type&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Type:"}),gs(s.type)]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Chainage:"}),s.chainage_from&&s.chainage_to?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"w-3 h-3 text-default-400"}),e.jsxs("span",{children:[s.chainage_from," - ",s.chainage_to]})]}):e.jsx("span",{className:"text-default-400",children:"Not set"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Affected RFIs:"}),e.jsxs(d,{size:"sm",variant:"flat",color:s.daily_works_count>0?"primary":"default",className:"h-6 min-h-6 text-[10px]",onPress:()=>xe(s),children:[s.daily_works_count||0," RFI(s)"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Created By:"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Se,{src:(o=s.created_by)==null?void 0:o.profile_image_url,name:(m=s.created_by)==null?void 0:m.name,size:"xs",className:"w-4 h-4"}),e.jsx("span",{children:((h=s.created_by)==null?void 0:h.name)||"Unknown"})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-default-400",children:"Date:"}),e.jsx("span",{children:ps(s.created_at)})]}),s.description&&e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-default-400 block mb-1",children:"Description:"}),e.jsx("p",{className:"text-default-600 text-[11px] line-clamp-3 bg-default-100 p-2 rounded",children:s.description})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4",children:[e.jsx(d,{size:"sm",variant:"flat",color:"primary",startContent:e.jsx(ge,{className:"w-3 h-3"}),onPress:()=>xe(s),children:"Manage RFIs"}),s.status==="draft"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"flat",color:"default",startContent:e.jsx(ke,{className:"w-3 h-3"}),onPress:()=>qe(s),children:"Edit"}),e.jsx(d,{size:"sm",variant:"flat",color:"primary",startContent:e.jsx(Re,{className:"w-3 h-3"}),onPress:()=>E(s,"submit"),children:"Submit"})]}),s.status==="submitted"&&e.jsx(d,{size:"sm",variant:"flat",color:"warning",startContent:e.jsx(A,{className:"w-3 h-3"}),onPress:()=>E(s,"review"),children:"Review"}),s.status==="under_review"&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:"sm",variant:"flat",color:"success",startContent:e.jsx(Fe,{className:"w-3 h-3"}),onPress:()=>E(s,"resolve"),children:"Resolve"}),e.jsx(d,{size:"sm",variant:"flat",color:"danger",startContent:e.jsx(Ae,{className:"w-3 h-3"}),onPress:()=>E(s,"reject"),children:"Reject"})]}),((p=s.status_logs)==null?void 0:p.length)>0&&e.jsx(d,{size:"sm",variant:"flat",color:"default",startContent:e.jsx(A,{className:"w-3 h-3"}),onPress:()=>Ve(s),children:"History"}),s.status==="draft"&&e.jsx(d,{size:"sm",variant:"flat",color:"danger",startContent:e.jsx(aa,{className:"w-3 h-3"}),onPress:()=>ys(s),children:"Delete"})]})]})})})]})},Wa=()=>e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,a)=>e.jsx(pe,{className:"h-12 w-full rounded-lg"},a))}),Ha=()=>e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,a)=>e.jsx(pe,{className:"h-20 w-full rounded-lg"},a))});return e.jsxs(e.Fragment,{children:[e.jsx(mt,{title:"Objections Management"}),e.jsx(se,{isOpen:na,onClose:Pe,size:"lg",scrollBehavior:"inside",shouldBlockScroll:!1,placement:"center",classNames:{base:"max-h-[90vh] m-4",wrapper:"items-center"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-warning"}),"Create New Objection"]}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{label:"Title",placeholder:"Enter objection title",value:c.title,onValueChange:s=>R(a=>({...a,title:s})),isRequired:!0}),e.jsx(H,{label:"Category",selectedKeys:[c.category],onSelectionChange:s=>{const a=Array.from(s)[0]||"other";R(t=>({...t,category:a}))},children:Object.entries(w||je).map(([s,a])=>e.jsx(k,{children:typeof a=="string"?a:a.label},s))}),e.jsx(H,{label:"Work Type",placeholder:"Select work type to filter RFIs",description:"Only RFIs of this type will be matched",selectedKeys:c.type?[c.type]:[],onSelectionChange:s=>{const a=Array.from(s)[0]||"";R(t=>({...t,type:a}))},children:Object.entries(de).map(([s,a])=>e.jsx(k,{startContent:e.jsx("span",{children:a.icon}),children:a.label},s))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:"Chainages (Optional)"}),e.jsx("p",{className:"text-xs text-default-400 mb-2",children:"Add specific chainages (comma-separated) and/or a range"}),e.jsx(F,{label:"Specific Chainages",placeholder:"e.g., K35+897, K36+987, K37+123",description:"Multiple chainages separated by commas",value:c.specific_chainages,onValueChange:s=>R(a=>({...a,specific_chainages:s}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(F,{label:"Range From",placeholder:"e.g., K36+580",value:c.chainage_range_from,onValueChange:s=>R(a=>({...a,chainage_range_from:s}))}),e.jsx(F,{label:"Range To",placeholder:"e.g., K37+540",value:c.chainage_range_to,onValueChange:s=>R(a=>({...a,chainage_range_to:s}))})]})]}),e.jsx(ue,{label:"Description",placeholder:"Describe the objection in detail",value:c.description,onValueChange:s=>R(a=>({...a,description:s})),minRows:3,isRequired:!0}),e.jsx(ue,{label:"Reason",placeholder:"Explain the reason for this objection",value:c.reason,onValueChange:s=>R(a=>({...a,reason:s})),minRows:2,isRequired:!0}),e.jsxs(H,{label:"Status",selectedKeys:[c.status],onSelectionChange:s=>{const a=Array.from(s)[0]||"draft";R(t=>({...t,status:a}))},children:[e.jsx(k,{children:"Save as Draft"},"draft"),e.jsx(k,{children:"Submit Immediately"},"submitted")]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:"Supporting Documents (Optional)"}),e.jsx("p",{className:"text-xs text-default-400",children:"Upload images, PDFs, Word, or Excel files (max 10MB each)"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,application/pdf,.doc,.docx,.xls,.xlsx",onChange:oa,className:"hidden",id:"objection-file-upload"}),e.jsxs("label",{htmlFor:"objection-file-upload",className:"flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-default-300 rounded-lg cursor-pointer hover:border-primary hover:bg-default-50 transition-colors",children:[e.jsx(Xs,{className:"w-5 h-5 text-default-500"}),e.jsx("span",{className:"text-sm text-default-600",children:"Click to select files"})]}),$e.length>0&&e.jsx("div",{className:"space-y-1 mt-2",children:$e.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-default-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.type.startsWith("image/")?e.jsx(Zs,{className:"w-4 h-4 text-success shrink-0"}):e.jsx(Ce,{className:"w-4 h-4 text-primary shrink-0"}),e.jsx("span",{className:"text-xs truncate",children:s.name}),e.jsxs("span",{className:"text-xs text-default-400 shrink-0",children:["(",(s.size/1024).toFixed(1)," KB)"]})]}),e.jsx(d,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",onPress:()=>da(a),children:e.jsx(Nt,{className:"w-4 h-4"})})]},a))})]})]})}),e.jsxs(le,{children:[e.jsx(d,{variant:"light",onPress:()=>{Pe(),rs()},children:"Cancel"}),e.jsx(d,{color:"primary",onPress:Da,isLoading:ca,children:"Create Objection"})]})]})}),e.jsx(se,{isOpen:ma,onClose:De,size:"2xl",scrollBehavior:"inside",shouldBlockScroll:!1,placement:"center",classNames:{base:"max-h-[90vh] m-4",wrapper:"items-center",body:"overflow-x-hidden"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ge,{className:"w-5 h-5 text-primary"}),"Manage Affected RFIs",r&&e.jsxs("span",{className:"text-sm font-normal text-default-500",children:["- ",r.title]}),(r==null?void 0:r.type)&&e.jsxs(y,{size:"sm",variant:"flat",color:((Cs=de[r.type])==null?void 0:Cs.color)||"default",className:"text-xs",children:[(Ss=de[r.type])==null?void 0:Ss.icon," ",r.type," only"]})]}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[(r==null?void 0:r.type)&&e.jsx("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-primary-50 dark:bg-primary-900/20 rounded-lg border border-primary-200 dark:border-primary-800",children:e.jsxs("span",{className:"text-sm text-primary-700 dark:text-primary-300",children:["ðŸ” Filtering RFIs by type: ",e.jsx("strong",{children:r.type})]})}),(r==null?void 0:r.chainage_from)&&(r==null?void 0:r.chainage_to)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-default-100 rounded-lg",children:[e.jsx(ne,{className:"w-5 h-5 text-default-500"}),e.jsxs("span",{className:"text-sm",children:["Chainage Range: ",e.jsx("strong",{children:r.chainage_from})," - ",e.jsx("strong",{children:r.chainage_to})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{placeholder:"Search RFIs by number, location, or description...",value:M,onChange:s=>Oe(s.target.value),onKeyDown:s=>s.key==="Enter"&&js(),startContent:e.jsx(Ge,{className:"w-4 h-4 text-default-400"}),size:"sm",className:"flex-1"}),e.jsx(d,{size:"sm",color:"primary",variant:"flat",isLoading:Te,onPress:js,children:"Search"}),(((Fs=(Rs=r==null?void 0:r.chainage_summary)==null?void 0:Rs.specific)==null?void 0:Fs.length)>0||((ks=r==null?void 0:r.chainage_summary)==null?void 0:ks.range)||(r==null?void 0:r.chainage_from)&&(r==null?void 0:r.chainage_to))&&e.jsx(d,{size:"sm",variant:"flat",isLoading:Te,onPress:()=>{var m,h,p;Oe("");const s=r.chainage_summary||{},a=((m=s.specific)==null?void 0:m.join(", "))||"",t=((h=s.range)==null?void 0:h.split(" - ")[0])||r.chainage_from,l=((p=s.range)==null?void 0:p.split(" - ")[1])||r.chainage_to,o=r.type;a?D(a,null,"",o):D(t,l,"",o)},children:e.jsx(ta,{className:"w-4 h-4"})})]}),((As=r==null?void 0:r.daily_works)==null?void 0:As.length)>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ea,{className:"w-4 h-4 text-success"}),e.jsxs("span",{className:"text-sm font-medium text-success",children:["Currently Attached (",r.daily_works.length,")"]})]}),e.jsx("div",{className:"grid gap-2 max-h-[150px] overflow-auto border border-success/30 rounded-lg p-2 bg-success-50/30 dark:bg-success-900/10",children:r.daily_works.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border border-divider rounded-lg bg-content1",children:[e.jsx(Ys,{value:String(s.id),isSelected:$.includes(String(s.id)),onValueChange:a=>{Ne(a?t=>[...t,String(s.id)]:t=>t.filter(l=>l!==String(s.id)))}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.number}),e.jsxs("div",{className:"text-xs text-default-500 flex items-center gap-2",children:[e.jsx(ne,{className:"w-3 h-3"}),s.location||"No location",s.type&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),s.type]})]})]}),e.jsx(y,{size:"sm",variant:"flat",color:"success",children:"Attached"})]},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-4 h-4 text-default-500"}),e.jsxs("span",{className:"text-sm font-medium",children:[M?"Search Results":"Suggested RFIs",me.length>0&&` (${me.length})`]})]}),Te?e.jsx("div",{className:"grid gap-2 border border-divider rounded-lg p-2",children:[1,2,3].map((s,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 border border-divider rounded-lg",children:[e.jsx(pe,{className:"w-5 h-5 rounded"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsx(pe,{className:"h-4 w-24 rounded"}),e.jsx(pe,{className:"h-3 w-48 rounded"})]})]},a))}):me.length>0?e.jsx(Qa,{value:$,onValueChange:Ne,children:e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto overflow-x-hidden border border-divider rounded-lg p-2",children:me.map(s=>{var t;const a=(t=r==null?void 0:r.daily_works)==null?void 0:t.some(l=>l.id===s.id);return e.jsxs("div",{className:`flex items-start gap-3 p-3 border rounded-lg hover:bg-default-100 overflow-hidden ${a?"border-success/50 bg-success-50/20":"border-divider"}`,children:[e.jsx(Ys,{value:String(s.id),className:"mt-1"}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-sm text-primary",children:s.number}),a&&e.jsx(y,{size:"sm",variant:"flat",color:"success",className:"h-5 text-[10px]",children:"Attached"}),s.type&&e.jsx(y,{size:"sm",variant:"flat",color:"secondary",className:"h-5 text-[10px]",children:s.type})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 text-xs",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-default-400 text-[10px]",children:"Date"}),e.jsx("span",{className:"font-medium",children:s.date||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-default-400 text-[10px]",children:"Chainage"}),e.jsx("span",{className:"font-medium truncate",title:s.location,children:s.location||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-default-400 text-[10px]",children:"Side"}),e.jsx("span",{className:"font-medium",children:s.side||"-"})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-default-400 text-[10px]",children:"Layer/Qty"}),e.jsx("span",{className:"font-medium",children:s.qty_layer||"-"})]})]}),s.description&&e.jsx("p",{className:"text-xs text-default-500 line-clamp-2",children:s.description})]})]},s.id)})})}):e.jsxs("div",{className:"text-center py-8 text-default-500 border border-dashed border-divider rounded-lg",children:[e.jsx(Ce,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:M?"No RFIs found matching your search.":r!=null&&r.chainage_from&&(r!=null&&r.chainage_to)?"No RFIs found in the specified chainage range.":"Use the search box above to find RFIs."}),e.jsx("p",{className:"text-xs mt-1",children:"Try searching by RFI number, location, or description."})]})]})]})}),e.jsx(le,{children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-default-500",children:[$.length," RFI(s) selected"]}),$.length>0&&e.jsx(Ga,{content:"Export selected RFIs to Excel",children:e.jsx(d,{variant:"flat",color:"success",size:"sm",isIconOnly:!0,onPress:Ta,isLoading:ua,children:e.jsx(ut,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"light",onPress:De,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:Ea,isLoading:ha,isDisabled:$.length===0,children:"Save Attachments"})]})]})})]})}),e.jsx(se,{isOpen:pa,onClose:Le,size:"2xl",scrollBehavior:"inside",shouldBlockScroll:!1,placement:"center",classNames:{base:"max-h-[90vh] m-4",wrapper:"items-center"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-primary"}),"Edit Objection"]}),e.jsx(re,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{label:"Title",placeholder:"Enter objection title",value:C.title,onChange:s=>z(a=>({...a,title:s.target.value})),isRequired:!0}),e.jsx(H,{label:"Category",placeholder:"Select category",selectedKeys:[C.category],onChange:s=>z(a=>({...a,category:s.target.value})),children:Object.entries(je).map(([s,a])=>e.jsx(k,{value:s,children:a.label},s))}),e.jsx(H,{label:"Work Type",placeholder:"Select work type to filter RFIs",description:"Only RFIs of this type will be matched",selectedKeys:C.type?[C.type]:[],onChange:s=>z(a=>({...a,type:s.target.value})),children:Object.entries(de).map(([s,a])=>e.jsx(k,{value:s,startContent:e.jsx("span",{children:a.icon}),children:a.label},s))}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-default-700",children:"Chainages (Optional)"}),e.jsx("p",{className:"text-xs text-default-400 mb-2",children:"Add specific chainages (comma-separated) and/or a range"}),e.jsx(F,{label:"Specific Chainages",placeholder:"e.g., K35+897, K36+987, K37+123",description:"Multiple chainages separated by commas",value:C.specific_chainages,onChange:s=>z(a=>({...a,specific_chainages:s.target.value}))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(F,{label:"Range From",placeholder:"e.g., K36+580",value:C.chainage_range_from,onChange:s=>z(a=>({...a,chainage_range_from:s.target.value}))}),e.jsx(F,{label:"Range To",placeholder:"e.g., K37+540",value:C.chainage_range_to,onChange:s=>z(a=>({...a,chainage_range_to:s.target.value}))})]})]}),e.jsx(ue,{label:"Description",placeholder:"Describe the objection in detail",value:C.description,onChange:s=>z(a=>({...a,description:s.target.value})),minRows:3,isRequired:!0}),e.jsx(ue,{label:"Reason",placeholder:"Explain the reason for raising this objection",value:C.reason,onChange:s=>z(a=>({...a,reason:s.target.value})),minRows:2,isRequired:!0})]})}),e.jsxs(le,{children:[e.jsx(d,{variant:"light",onPress:Le,children:"Cancel"}),e.jsx(d,{color:"primary",onPress:Oa,isLoading:ga,children:"Save Changes"})]})]})}),e.jsx(se,{isOpen:va,onClose:Me,size:"lg",placement:"bottom-center",classNames:{base:"max-h-[100dvh] sm:max-h-[90vh] m-0 sm:m-4 mb-0",wrapper:"items-end sm:items-center"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[j==="submit"&&e.jsx(Re,{className:"w-5 h-5 text-primary"}),j==="review"&&e.jsx(A,{className:"w-5 h-5 text-warning"}),j==="resolve"&&e.jsx(Fe,{className:"w-5 h-5 text-success"}),j==="reject"&&e.jsx(Ae,{className:"w-5 h-5 text-danger"}),vs(j)]}),e.jsx(re,{children:r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-default-100 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:r.title}),e.jsx("p",{className:"text-sm text-default-500 mt-1",children:r.description})]}),j==="submit"&&e.jsx("p",{className:"text-sm text-default-600",children:"Are you sure you want to submit this objection for review? Once submitted, you won't be able to edit it."}),j==="review"&&e.jsx("p",{className:"text-sm text-default-600",children:'This will mark the objection as "Under Review". You can then resolve or reject it after investigation.'}),(j==="resolve"||j==="reject")&&e.jsx(ue,{label:j==="resolve"?"Resolution Notes":"Rejection Reason",placeholder:j==="resolve"?"Explain how the objection was resolved...":"Explain why the objection is being rejected...",value:we,onChange:s=>Be(s.target.value),minRows:3,isRequired:!0})]})}),e.jsxs(le,{children:[e.jsx(d,{variant:"light",onPress:Me,children:"Cancel"}),e.jsx(d,{color:j==="reject"?"danger":j==="resolve"?"success":"primary",onPress:La,isLoading:wa,children:vs(j)})]})]})}),e.jsx(se,{isOpen:_a,onClose:ms,size:"2xl",scrollBehavior:"inside",shouldBlockScroll:!1,placement:"center",classNames:{base:"max-h-[90vh] m-4",wrapper:"items-center"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"}),"Status History"]}),e.jsx(re,{children:X&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-default-100 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:X.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("span",{className:"text-sm text-default-500",children:"Current Status:"}),e.jsx(y,{size:"sm",variant:"flat",color:((Is=S[X.status])==null?void 0:Is.color)||"default",children:he(X.status)})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-0 bottom-0 w-0.5 bg-default-200"}),((Ps=X.status_logs)==null?void 0:Ps.length)>0?e.jsx("div",{className:"space-y-4",children:X.status_logs.map((s,a)=>{var o,m;const t=S[s.to_status]||{},l=t.icon||A;return e.jsxs("div",{className:"relative flex gap-4 pl-8",children:[e.jsx("div",{className:`absolute left-0 w-6 h-6 rounded-full flex items-center justify-center ${t.bgColor||"bg-default-100"}`,children:e.jsx(l,{className:`w-3 h-3 ${t.textColor||"text-default-500"}`})}),e.jsx("div",{className:"flex-1 pb-4",children:e.jsxs("div",{className:"bg-content2 rounded-lg p-3 border border-divider/40",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm",children:[e.jsx(y,{size:"sm",variant:"flat",color:((o=S[s.from_status])==null?void 0:o.color)||"default",children:he(s.from_status)}),e.jsx("span",{className:"text-default-400",children:"â†’"}),e.jsx(y,{size:"sm",variant:"flat",color:t.color||"default",children:he(s.to_status)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-xs text-default-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(sa,{className:"w-3 h-3"}),((m=s.changed_by)==null?void 0:m.name)||"System"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-3 h-3"}),new Date(s.changed_at).toLocaleString()]})]}),s.notes&&e.jsx("div",{className:"mt-2 pt-2 border-t border-divider/40",children:e.jsx("p",{className:"text-sm text-default-600",children:s.notes})})]})})]},s.id||a)})}):e.jsxs("div",{className:"text-center py-8 text-default-500",children:[e.jsx(A,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No status changes recorded yet."})]})]})]})}),e.jsx(le,{children:e.jsx(d,{variant:"light",onPress:ms,children:"Close"})})]})}),e.jsx(se,{isOpen:Ra,onClose:Z,size:"4xl",scrollBehavior:"inside",shouldBlockScroll:!1,placement:"center",classNames:{base:"max-h-[95vh] m-2 sm:m-4",wrapper:"items-center",body:"p-3 sm:p-6"},children:e.jsxs(ae,{children:[e.jsxs(te,{className:"flex flex-col sm:flex-row sm:items-center gap-2 pb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:`w-5 h-5 ${n!=null&&n.is_active?"text-warning":"text-success"}`}),e.jsx("span",{className:"font-semibold truncate",children:(n==null?void 0:n.title)||"Objection Details"})]}),n&&e.jsxs("div",{className:"flex items-center gap-2 mt-1 sm:mt-0 sm:ml-auto",children:[fs(n.status),Ue(n.category),gs(n.type)]})]}),e.jsx(re,{children:n&&e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{className:"p-3 bg-default-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-default-500 mb-1",children:[e.jsx(sa,{className:"w-3 h-3"}),e.jsx("span",{children:"Created By"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{src:($s=n.created_by)==null?void 0:$s.profile_image_url,name:((zs=n.created_by)==null?void 0:zs.name)||"Unknown",size:"sm",className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium truncate",children:((Ds=n.created_by)==null?void 0:Ds.name)||"Unknown"})]})]}),e.jsxs("div",{className:"p-3 bg-default-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-default-500 mb-1",children:[e.jsx(Gs,{className:"w-3 h-3"}),e.jsx("span",{children:"Created At"})]}),e.jsx("p",{className:"text-sm font-medium",children:new Date(n.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"p-3 sm:p-4 bg-default-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-default-500 mb-2",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Chainage Information"})]}),n.chainage_summary?e.jsxs("div",{className:"space-y-3",children:[((Es=n.chainage_summary.specific)==null?void 0:Es.length)>0&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-default-500 mb-1.5",children:["Specific Chainages (",n.chainage_summary.specific.length,")"]}),e.jsx(Ja,{className:"max-h-24",hideScrollBar:!0,children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:n.chainage_summary.specific.map((s,a)=>e.jsx(y,{size:"sm",variant:"flat",color:"secondary",className:"text-xs",children:s},a))})})]}),n.chainage_summary.range&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-default-500 mb-1.5",children:"Chainage Range"}),e.jsx(y,{size:"sm",variant:"bordered",color:"primary",startContent:e.jsx(ne,{className:"w-3 h-3"}),children:n.chainage_summary.range})]}),!((Ts=n.chainage_summary.specific)!=null&&Ts.length)&&!n.chainage_summary.range&&e.jsx("p",{className:"text-sm text-default-400",children:"No chainage information specified"})]}):e.jsx("p",{className:"text-sm text-default-400",children:"No chainage information specified"})]}),e.jsxs("div",{className:"p-3 sm:p-4 bg-primary-50/50 dark:bg-primary-900/10 border border-primary/20 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-primary",children:[e.jsx(ge,{className:"w-3 h-3"}),e.jsxs("span",{children:["Affected RFIs (",((Os=n.daily_works)==null?void 0:Os.length)||0,")"]})]}),e.jsx(d,{size:"sm",variant:"flat",color:"primary",onPress:()=>{Z(),xe(n)},children:"Manage"})]}),((Ls=n.daily_works)==null?void 0:Ls.length)>0?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[n.daily_works.slice(0,10).map(s=>e.jsx(y,{size:"sm",variant:"flat",color:"primary",children:s.number},s.id)),n.daily_works.length>10&&e.jsxs(y,{size:"sm",variant:"bordered",color:"default",children:["+",n.daily_works.length-10," more"]})]}):e.jsx("p",{className:"text-sm text-default-500",children:"No RFIs attached to this objection."})]}),n.description&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-default-500"}),"Description"]}),e.jsx("div",{className:"p-3 sm:p-4 bg-default-100 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.description})})]}),n.reason&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Js,{className:"w-4 h-4 text-warning"}),"Reason for Objection"]}),e.jsx("div",{className:"p-3 sm:p-4 bg-warning-50/50 dark:bg-warning-900/10 border border-warning/20 rounded-lg",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.reason})})]}),n.resolution_notes&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[n.status==="resolved"?e.jsx(ea,{className:"w-4 h-4 text-success"}):e.jsx(Ae,{className:"w-4 h-4 text-danger"}),"Resolution Notes"]}),e.jsxs("div",{className:`p-3 sm:p-4 rounded-lg border ${n.status==="resolved"?"bg-success-50/50 dark:bg-success-900/10 border-success/20":"bg-danger-50/50 dark:bg-danger-900/10 border-danger/20"}`,children:[e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:n.resolution_notes}),n.resolved_by&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-divider/40",children:[e.jsx(Se,{src:(Ms=n.resolved_by)==null?void 0:Ms.profile_image_url,name:((Bs=n.resolved_by)==null?void 0:Bs.name)||"Unknown",size:"sm",className:"w-5 h-5"}),e.jsxs("span",{className:"text-xs text-default-500",children:[n.status==="resolved"?"Resolved":"Rejected"," by ",(Ks=n.resolved_by)==null?void 0:Ks.name,n.resolved_at&&e.jsxs(e.Fragment,{children:[" on ",new Date(n.resolved_at).toLocaleDateString()]})]})]})]})]}),((Us=n.media)==null?void 0:Us.length)>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(Zs,{className:"w-4 h-4 text-default-500"}),"Attachments (",n.media.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 sm:gap-3",children:n.media.map(s=>{var t;const a=(t=s.mime_type)==null?void 0:t.startsWith("image/");return e.jsxs("a",{href:s.original_url,target:"_blank",rel:"noopener noreferrer",className:"group relative aspect-square rounded-lg overflow-hidden border border-divider hover:border-primary transition-colors",children:[a?e.jsx("img",{src:s.preview_url||s.original_url,alt:s.file_name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform"}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center bg-default-100 p-2",children:[e.jsx(Xs,{className:"w-8 h-8 text-default-400 mb-1"}),e.jsx("span",{className:"text-[10px] text-center text-default-500 line-clamp-2",children:s.file_name})]}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors flex items-center justify-center",children:e.jsx("span",{className:"opacity-0 group-hover:opacity-100 text-white text-xs bg-black/50 px-2 py-1 rounded",children:"View"})})]},s.id)})})]}),((qs=n.status_logs)==null?void 0:qs.length)>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-default-500"}),"Status History"]}),e.jsx(d,{size:"sm",variant:"light",onPress:()=>{Z(),Ve(n)},children:"View Full History"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.status_logs.slice(-3).map((s,a)=>{var t,l;return e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx(y,{size:"sm",variant:"flat",color:((t=S[s.from_status])==null?void 0:t.color)||"default",children:he(s.from_status)}),e.jsx("span",{className:"text-default-400",children:"â†’"}),e.jsx(y,{size:"sm",variant:"flat",color:((l=S[s.to_status])==null?void 0:l.color)||"default",children:he(s.to_status)})]},s.id||a)})})]})]})}),e.jsxs(le,{className:"flex-col sm:flex-row gap-2",children:[e.jsx(d,{variant:"light",onPress:Z,className:"w-full sm:w-auto",children:"Close"}),(n==null?void 0:n.status)==="draft"&&e.jsx(d,{color:"primary",variant:"flat",startContent:e.jsx(ke,{className:"w-4 h-4"}),onPress:()=>{Z(),qe(n)},className:"w-full sm:w-auto",children:"Edit"}),(n==null?void 0:n.status)==="draft"&&e.jsx(d,{color:"primary",startContent:e.jsx(Re,{className:"w-4 h-4"}),onPress:()=>{Z(),E(n,"submit")},className:"w-full sm:w-auto",children:"Submit for Review"})]})]})}),e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(Q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"w-full max-w-[2000px]",children:e.jsxs(We,{className:"transition-all duration-200",style:{border:"var(--borderWidth, 2px) solid transparent",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))",background:`linear-gradient(135deg,
                                var(--theme-content1, #FAFAFA) 20%,
                                var(--theme-content2, #F4F4F5) 10%,
                                var(--theme-content3, #F1F3F4) 20%)`},children:[e.jsx(Qs,{className:"border-b p-0",style:{borderColor:"var(--theme-divider, #E4E4E7)",background:`linear-gradient(135deg,
                                    color-mix(in srgb, var(--theme-content1) 50%, transparent) 20%,
                                    color-mix(in srgb, var(--theme-content2) 30%, transparent) 10%)`},children:e.jsx("div",{className:`${v?"p-6":U?"p-4":"p-3"} w-full`,children:e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 lg:gap-4",children:[e.jsx("div",{className:`
                                                    ${v?"p-3":U?"p-2.5":"p-2"}
                                                    rounded-xl flex items-center justify-center
                                                `,style:{background:"color-mix(in srgb, var(--theme-warning) 15%, transparent)",borderColor:"color-mix(in srgb, var(--theme-warning) 25%, transparent)",borderWidth:"var(--borderWidth, 2px)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsx(B,{className:`
                                                        ${v?"w-8 h-8":U?"w-6 h-6":"w-5 h-5"}
                                                    `,style:{color:"var(--theme-warning)"}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h4",{className:`
                                                        ${v?"text-2xl":U?"text-xl":"text-lg"}
                                                        font-bold text-foreground
                                                        ${v?"":"truncate"}
                                                    `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Objections Management"}),e.jsx("p",{className:`
                                                        ${v?"text-sm":"text-xs"}
                                                        text-default-500
                                                        ${v?"":"truncate"}
                                                    `,style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Track and manage RFI objections across projects"})]})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-4 w-full lg:w-auto",children:e.jsx("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-wrap justify-end w-full lg:w-auto",children:Ka.map((s,a)=>e.jsx(d,{size:v?"md":"sm",variant:s.variant||"flat",color:s.color||"primary",startContent:!_&&s.icon,isIconOnly:_,onPress:s.onPress,className:`${s.className||""} font-medium ${_?"min-w-9 h-9":""}`,"aria-label":s.label,style:{fontFamily:'var(--fontFamily, "Inter")',borderRadius:"var(--borderRadius, 12px)"},children:_?s.icon:s.label},a))})})]})})})}),e.jsxs(He,{className:"pt-6",children:[e.jsx("div",{className:"relative",children:e.jsx(ht,{stats:Ba,onRefresh:_e,isLoading:Ie})}),e.jsxs("div",{className:"mb-4 space-y-4",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-3 items-stretch lg:items-center",children:[e.jsx(d,{size:"sm",variant:oe?"solid":"bordered",color:oe?"primary":"default",onPress:()=>la(!oe),radius:Y(),className:`shrink-0 min-h-10 ${oe?"":"border-divider/50"}`,startContent:e.jsx(bt,{className:"w-4 h-4"}),style:{fontFamily:'var(--fontFamily, "Inter")'},children:_?"":"Filters"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(F,{type:"text",placeholder:"Search by title, description, or chainage...",value:G,onChange:Pa,variant:"bordered",size:"sm",radius:Y(),startContent:e.jsx(Ge,{className:"w-4 h-4 text-default-400 shrink-0"}),classNames:{input:"text-foreground text-sm",inputWrapper:"min-h-10 bg-content2/50 border-divider/50 hover:border-divider"},style:{fontFamily:'var(--fontFamily, "Inter")'}})})]}),e.jsx(Je,{children:oe&&e.jsx(Q.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"overflow-hidden",children:e.jsx("div",{className:"p-3 rounded-lg border",style:{background:"var(--theme-content2, rgba(244, 244, 245, 0.8))",borderColor:"var(--theme-divider, rgba(228, 228, 231, 0.5))"},children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-end",children:[e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px]",children:e.jsxs(H,{label:"Status",placeholder:"All",selectedKeys:b.status?[b.status]:["all"],onSelectionChange:s=>{const a=Array.from(s)[0]||"all";us("status",a)},variant:"bordered",size:"sm",radius:Y(),classNames:{trigger:"min-h-10",value:"text-foreground text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(k,{value:"all",children:"All Statuses"},"all"),Object.entries(L||S).map(([s,a])=>e.jsx(k,{value:s,children:typeof a=="string"?a:a.label},s))]})}),e.jsx("div",{className:"w-full sm:w-auto sm:min-w-[160px]",children:e.jsxs(H,{label:"Category",placeholder:"All",selectedKeys:b.category?[b.category]:["all"],onSelectionChange:s=>{const a=Array.from(s)[0]||"all";us("category",a)},variant:"bordered",size:"sm",radius:Y(),classNames:{trigger:"min-h-10",value:"text-foreground text-sm"},style:{fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx(k,{value:"all",children:"All Categories"},"all"),Object.entries(w||je).map(([s,a])=>e.jsx(k,{value:s,children:typeof a=="string"?a:a.label},s))]})}),e.jsx(d,{size:"sm",variant:"flat",color:"danger",radius:Y(),className:"min-h-10",onPress:()=>{as({status:"all",category:"all",creator:""}),W(""),J(1)},style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Clear"})]})})})})]}),e.jsx(We,{radius:Y(),className:"bg-content2/50 backdrop-blur-md border border-divider/30",style:{fontFamily:'var(--fontFamily, "Inter")',borderRadius:"var(--borderRadius, 12px)",backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)"},children:e.jsx(He,{className:"p-4",children:e.jsxs(pt,{fallbackTitle:"Unable to load objections",fallbackDescription:"There was an error loading the objections. Please try refreshing.",onRetry:_e,children:[ye?_?Ha():Wa():_?e.jsx(St,{onRefresh:Ia,disabled:ye,children:e.jsx("div",{className:"flex flex-col gap-2",children:((Vs=N==null?void 0:N.data)==null?void 0:Vs.length)>0?N.data.map(s=>e.jsx(ft,{children:e.jsx(Va,{objection:s,isExpanded:ce.has(s.id),onToggle:()=>za(s.id)})},s.id)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 mx-auto text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500 font-medium",children:"No objections found"}),e.jsx("p",{className:"text-default-400 text-sm mt-1",children:"Create your first objection to get started"})]})})}):e.jsxs(Xa,{"aria-label":"Objections table",removeWrapper:!0,classNames:{base:"overflow-auto",table:"min-w-full",th:"bg-default-100 text-default-600 text-xs font-semibold uppercase",td:"py-3"},children:[e.jsx(Za,{columns:Ua,children:s=>e.jsx(et,{children:s.label},s.key)}),e.jsx(st,{items:(N==null?void 0:N.data)||[],emptyContent:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 mx-auto text-default-300 mb-4"}),e.jsx("p",{className:"text-default-500 font-medium",children:"No objections found"}),e.jsx("p",{className:"text-default-400 text-sm mt-1",children:"Create your first objection to get started"})]}),children:s=>e.jsx(at,{className:s.is_active?"bg-warning-50/50 dark:bg-warning-900/10":"",children:a=>e.jsx(tt,{children:qa(s,a)})},s.id)})]}),(N==null?void 0:N.last_page)>1&&e.jsx("div",{className:"flex justify-center mt-4 pt-4 border-t border-divider/30",children:e.jsx(rt,{total:N.last_page,page:N.current_page,onChange:$a,size:_?"sm":"md",showControls:!0,showShadow:!0,color:"primary"})})]})})})]})]})})})]})};Rt.layout=g=>e.jsx(xt,{children:g});export{Rt as default};
