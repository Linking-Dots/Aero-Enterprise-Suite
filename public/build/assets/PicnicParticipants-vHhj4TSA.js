import{J as K,r as a,j as e,b as O,Q as $}from"./app-CFOXYWdD.js";import{u as V,g as L,G as ee}from"./logo-AMLCgbkx.js";import{s as J,o as te,B as X,A as ae}from"./App-D44H3aE5.js";import{G as Z}from"./GlassDialog-CB1Z5Bs0.js";import{d as re}from"./dayjs.min-DTClqbqG.js";import{c as se}from"./chunk-D5XJWRAV-Bs0mRdwq.js";import{t as le,a as oe,b as ie,c as ne}from"./chunk-F3UDT23P-DfyL8aGa.js";import{t as de}from"./chunk-YRZGWF2W-CVS3z9wo.js";import{t as ce}from"./chunk-TSPNSPCL-CDimUInN.js";import{p as ue}from"./chunk-EAPQ7RWQ-CTPnoxCw.js";import"./create-visual-element-DL7V4SzU.js";import"./EnvelopeIcon-DJsx2AYc.js";import"./UserIcon-B8KaJTnW.js";import"./ShieldCheckIcon-DfAiaKpT.js";import"./chunk-SSA7SXE4-B38lyIff.js";import"./ExclamationTriangleIcon-Kx82ewut.js";import"./index-CaGcrq76.js";import"./useHasTabbableChild-Bti5CcwH.js";import"./index-CokAva9Y.js";const pe=({open:b,closeModal:m,leavesData:h,setLeavesData:_,currentLeave:t,allUsers:x,setTotalRows:k,setLastPage:d,setLeaves:F,handleMonthChange:c,employee:B})=>{const{auth:w}=K().props,{isDark:z}=V();L();const[y,G]=a.useState((t==null?void 0:t.user_id)||w.user.id),[u,v]=a.useState(h.leaveTypes||[]),[C,P]=a.useState(h.leaveCounts||[]),[f,I]=a.useState((t==null?void 0:t.leave_type)||(u.length>0?u[0].type:"")),[D,S]=a.useState((t==null?void 0:t.from_date)||""),[E,M]=a.useState((t==null?void 0:t.to_date)||""),[A,Q]=a.useState((t==null?void 0:t.no_of_days)||""),[W,U]=a.useState(""),[R,Y]=a.useState((t==null?void 0:t.reason)||""),[l,H]=a.useState({}),[s,p]=a.useState(!1),[T,N]=a.useState("");a.useEffect(()=>{h&&(v(h.leaveTypes||[]),P(h.leaveCountsByUser[y]||[]))},[h,y]),a.useEffect(()=>{var n;const r=((n=C==null?void 0:C.find(i=>i.leave_type===f))==null?void 0:n.days_used)||0;N(r);const j=u==null?void 0:u.find(i=>i.type===f);j&&U(j.days-r)},[f,C,u]),a.useEffect(()=>{Q(((j,n)=>{if(!j||!n)return"";const i=new Date(j),o=new Date(n);if(i>o)return"";const g=o.getTime()-i.getTime();return Math.ceil(g/(1e3*3600*24))+1})(D,E))},[D,E]);const q=async r=>{r.preventDefault(),p(!0);const j=new Promise(async(n,i)=>{try{const o={route:route().current(),user_id:y,leaveType:f,fromDate:D,toDate:E,daysCount:A,leaveReason:R,employee:B};t&&(o.id=t.id);const g=await axios.post(route("leave-add"),o);g.status===200&&(_(g.data.leavesData),k(g.data.leavesData.leaveRecords.total),d(g.data.leavesData.leaveRecords.last_page),F(g.data.leavesData.leaveRecords.data),c({target:{value:D.slice(0,7)}}),m(),n([g.data.message||"Leave application submitted successfully"]))}catch(o){console.error(o),p(!1),o.response?(o.response.status===422?(H(o.response.data.errors||{}),i(o.response.data.error||"Failed to submit leave application")):i("An unexpected error occurred. Please try again later."),console.error(o.response.data.error)):o.request?(i("No response received from the server. Please check your internet connection."),console.error(o.request)):(i("An error occurred while setting up the request."),console.error("Error",o.message))}finally{p(!1)}});X.promise(j,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(CircularProgress,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}},success:{render({data:n}){return e.jsx(e.Fragment,{children:n.map((i,o)=>e.jsx("div",{children:i},o))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}},error:{render({data:n}){return e.jsx(e.Fragment,{children:n})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}}})};return e.jsxs(Z,{open:b,onClose:m,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(DialogTitle,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Typography,{variant:"h6",children:"Add Leave"}),e.jsx(IconButton,{onClick:m,sx:{position:"absolute",top:8,right:16},children:e.jsx(ClearIcon,{})})]}),e.jsxs("form",{onSubmit:q,children:[e.jsx(DialogContent,{children:e.jsxs(Grid,{container:!0,spacing:2,children:[e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsxs(FormControl,{fullWidth:!0,children:[e.jsx(InputLabel,{id:"leave-type-label",children:"Leave Type"}),e.jsxs(J,{labelId:"leave-type-label",value:f,onChange:r=>I(r.target.value),label:"Leave Type",error:!!l.leaveType,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,borderRadius:2,boxShadow:theme.glassCard.boxShadow}}},children:[e.jsx(MenuItem,{value:"",disabled:!0,children:"Select Leave Type"}),u.map(r=>e.jsxs(MenuItem,{value:r.type,children:[r.type," ",r.days," Days"]},r.id))]}),e.jsx(FormHelperText,{children:l.leaveType})]})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"From",type:"date",fullWidth:!0,value:D,onChange:r=>S(r.target.value),InputLabelProps:{shrink:!0},error:!!l.fromDate,helperText:l.fromDate})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"To",type:"date",fullWidth:!0,value:E,onChange:r=>M(r.target.value),InputLabelProps:{shrink:!0},error:!!l.toDate,helperText:l.toDate})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"Number of days",type:"text",fullWidth:!0,value:A,InputProps:{readOnly:!0},error:!!l.daysCount,helperText:l.daysCount})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:W,InputProps:{readOnly:!0},error:!!l.remainingLeaves,helperText:l.remainingLeaves})}),w.roles.includes("Administrator")&&route().current()==="leaves"&&e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsxs(FormControl,{fullWidth:!0,children:[e.jsx(InputLabel,{id:"leave-employee-label",children:"Employee"}),e.jsxs(J,{variant:"outlined",fullWidth:!0,labelId:"leave-employee-label",value:y||"na",error:!!l.user_id,onChange:r=>G(r.target.value),label:"Employee",MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,borderRadius:2,boxShadow:theme.glassCard.boxShadow}}},children:[e.jsx(MenuItem,{value:"na",disabled:!0,children:"Please select"}),x.map(r=>e.jsx(MenuItem,{value:r.id,children:e.jsxs(Box,{sx:{display:"flex"},children:[e.jsx(te,{src:r.profile_image_url||r.profile_image,alt:r.name||"Not assigned",sx:{borderRadius:"50%",width:23,height:23,display:"flex",mr:1}}),r.name]})},r.id))]}),e.jsx(FormHelperText,{children:l.user_id})]})}),e.jsx(Grid,{item:!0,xs:12,children:e.jsx(TextField,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:R,onChange:r=>Y(r.target.value),error:!!l.leaveReason,helperText:l.leaveReason})})]})}),e.jsx(DialogActions,{sx:{padding:"16px",justifyContent:"center"},children:e.jsx(LoadingButton,{type:"submit",variant:"outlined",color:"primary",loading:s,disabled:s,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},me=({open:b,handleClose:m,leaveIdToDelete:h,setLeavesData:_})=>{const t=V(),x=()=>{const k=new Promise(async(d,F)=>{try{const c=await axios.delete(route("leave-delete",{id:h,route:route().current()}));c.status===200&&(_(c.data.leavesData),d("Leave application deleted successfully"))}catch(c){console.error("Error deleting task:",c),F(c.response.data.error||"Failed to delete leave application")}finally{m()}});X.promise(k,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(CircularProgress,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},success:{render({data:d}){return e.jsx(e.Fragment,{children:d})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}},error:{render({data:d}){return e.jsx(e.Fragment,{children:d})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:t.glassCard.background,border:t.glassCard.border,color:t.palette.text.primary}}})};return e.jsxs(Z,{open:b,onClose:m,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(DialogTitle,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(DialogContent,{children:e.jsx(DialogContentText,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),e.jsxs(DialogActions,{children:[e.jsx(O,{onClick:m,color:"primary",children:"Cancel"}),e.jsx(O,{onClick:x,color:"error",autoFocus:!0,children:"Delete"})]})]})},he=({title:b,allUsers:m})=>{const{auth:h,props:_}=K(),[t,x]=a.useState(null),[k,d]=a.useState(_.leavesData),[F,c]=a.useState(),[B,w]=a.useState(0),[z,y]=a.useState(0),[G,u]=a.useState(null),[v,C]=a.useState(""),[P,f]=a.useState(re().format("YYYY-MM")),[I,D]=a.useState(30),[S,E]=a.useState(1),[M,A]=a.useState(),[Q,W]=a.useState(""),U=s=>x(s);a.useCallback((s,p)=>{u(s),x(p)},[]);const R=a.useCallback(()=>{x(null),u(null)},[]),Y=s=>C(s.target.value.toLowerCase()),l=s=>{f(s.target.value)},H=async()=>{var s,p;try{const T=await axios.get(route("leaves.paginate"),{params:{page:S,perPage:I,employee:v,month:P}});if(T.status===200){const{data:N,total:q,last_page:r}=T.data.leaves;c(N),w(q),y(r)}}catch(T){console.error("Error fetching leaves data:",T),W(((p=(s=T.response)==null?void 0:s.data)==null?void 0:p.message)||"Error retrieving data.")}};return a.useEffect(()=>{H()},[P,S,I,v]),e.jsxs(e.Fragment,{children:[e.jsx($,{title:b}),["add_leave","edit_leave"].includes(t)&&e.jsx(pe,{setTotalRows:w,setLastPage:y,setPicnicParticipants:c,perPage:I,employee:v,currentPage:S,selectedMonth:P,allUsers:m,open:!0,setPicnicParticipantsData:d,closeModal:()=>x(null),leavesData:k,currentPicnicParticipant:t==="edit_leave"?M:null,handleMonthChange:l}),t==="delete_leave"&&e.jsx(me,{open:!0,handleClose:R,leaveIdToDelete:G,setPicnicParticipantsData:d}),e.jsx(Box,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(Grow,{in:!0,children:e.jsxs(ee,{children:[e.jsx(se,{title:"Picnic Participants",sx:{padding:"24px"},action:e.jsx(O,{title:"Add Picnic Participant",variant:"outlined",color:"success",startIcon:e.jsx(Add,{}),onClick:()=>U("add_leave"),children:"Add Picnic Participant"})}),e.jsx(CardContent,{children:e.jsxs(Grid,{container:!0,spacing:2,children:[e.jsx(Grid,{item:!0,xs:12,sm:6,md:4,children:e.jsx(TextField,{label:"Search",fullWidth:!0,variant:"outlined",placeholder:"Employee...",value:v,onChange:Y,size:"small",InputProps:{endAdornment:e.jsx(InputAdornment,{position:"end",children:e.jsx(SearchIcon,{})})}})}),e.jsx(Grid,{item:!0,xs:12,sm:6,md:4,children:e.jsx(TextField,{label:"Select Month",type:"month",variant:"outlined",onChange:l,value:P,fullWidth:!0,size:"small",InputLabelProps:{shrink:!0}})})]})}),e.jsx(CardContent,{children:e.jsxs("div",{style:{maxHeight:"84vh",overflowY:"auto"},children:[e.jsxs(le,{isStriped:!0,selectionMode:"multiple",selectionBehavior:"toggle",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Picnic Participant Employee Table",children:[e.jsx(de,{columns,children:s=>e.jsx(ce,{align:s.uid==="actions"?"center":"start",children:s.name},s.uid)}),e.jsx(oe,{items:F,children:s=>e.jsx(ie,{children:p=>e.jsx(ne,{style:{whiteSpace:"nowrap"},children:renderCell(s,p)})},s.id)})]}),B>10&&e.jsx("div",{className:"py-2 px-2 flex justify-center items-end",style:{height:"100%"},children:e.jsx(ue,{initialPage:1,isCompact:!0,showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:S,total:z,onChange:handlePageChange})})]})})]})})})]})};he.layout=b=>e.jsx(ae,{children:b});export{he as default};
