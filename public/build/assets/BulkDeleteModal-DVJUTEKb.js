import{r,R as he,J as $e,j as e,b as X,a as oe,d as je,e as De,H as Pe,c as Re}from"./app-CFOXYWdD.js";import{u as de,G as Ve,g as Qe}from"./logo-AMLCgbkx.js";import{u as Ne,B as Y,t as _e,v as Ie,w as Be,x as ze,y as Ce,f as le,r as Le,i as ye,g as ke,d as Q,M as Xe,K as Ze,s as ve,l as ie,j as Se,o as es,N as ss,e as ts}from"./App-D44H3aE5.js";import{F as fe}from"./TrashIcon-DmAagIVq.js";import{F as qe}from"./PencilIcon-BxC4n9WJ.js";import{F as We}from"./EllipsisVerticalIcon-C5p9jyC7.js";import{F as as}from"./XCircleIcon-BKBoDII1.js";import{F as rs}from"./CheckCircleIcon-CutA81AR.js";import{F as ns}from"./ClockIcon-DU4Nz-xo.js";import{F as ls}from"./ExclamationTriangleIcon-BgutF-yh.js";import{c as Ke}from"./createLucideIcon-U2MVd2gI.js";import{F as Te}from"./UserIcon-B8KaJTnW.js";import{F as is}from"./HeartIcon-Bo9q8bqL.js";import{c as ne,t as os,a as ds,b as cs}from"./chunk-F3UDT23P-DfyL8aGa.js";import{u as He}from"./chunk-S574QCAN-C6iBC3Hs.js";import{l as Ae}from"./chunk-JOT4BT4P-DD-bNesh.js";import{p as Ye}from"./chunk-EAPQ7RWQ-CTPnoxCw.js";import{t as ms}from"./chunk-YRZGWF2W-CVS3z9wo.js";import{t as us}from"./chunk-TSPNSPCL-CDimUInN.js";import{G as we}from"./GlassDialog-CB1Z5Bs0.js";import{c as Fe}from"./chunk-D5XJWRAV-Bs0mRdwq.js";import{F as Oe}from"./InformationCircleIcon-CWXmBAdb.js";import{F as xs}from"./XCircleIcon-CXS-JZ21.js";import{F as Ee}from"./ExclamationTriangleIcon-Kx82ewut.js";import{F as Me}from"./CheckCircleIcon-WfVI_0Z3.js";import{X as ps}from"./x-CPfZajGW.js";import{i as Ue}from"./chunk-SSA7SXE4-B38lyIff.js";function hs({title:m,titleId:f,...y},g){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:g,"aria-labelledby":f},y),m?r.createElement("title",{id:f},m):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const fs=r.forwardRef(hs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],ys=Ke("calendar",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],Ge=Ke("phone-off",bs),be=(m,f)=>{const y=m.replace("#",""),g=parseInt(y.substring(0,2),16),d=parseInt(y.substring(2,4),16),x=parseInt(y.substring(4,6),16);return`rgba(${g}, ${d}, ${x}, ${f})`},js=he.forwardRef(({leaves:m,allUsers:f,handleClickOpen:y,setCurrentLeave:g,openModal:d,setLeaves:x,setCurrentPage:D,currentPage:T,totalRows:G,lastPage:u,perPage:j,selectedMonth:C,employee:z,isAdminView:k=!1,onBulkApprove:v,onBulkReject:p,onBulkDelete:N,canApproveLeaves:o=!1,canEditLeaves:F=!1,canDeleteLeaves:w=!1,fetchLeavesStats:K},J)=>{var ue,re;const{auth:Z}=$e().props,M=de(!1,"OCEAN"),$=Ne("(min-width: 1025px)"),q=Ne("(min-width: 641px) and (max-width: 1024px)"),b=Ne("(max-width: 640px)"),[E,te]=r.useState(!1),[i,_]=r.useState(null),[c,H]=r.useState(new Set);he.useMemo(()=>Array.from(c).join(", ").replaceAll("_"," "),[c]);const ee=he.useMemo(()=>{const s=c==="all",t=s||c.size>0,a=s?m.length:c.size;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex justify-between gap-3 items-end",children:e.jsx("div",{className:"flex gap-3",children:t&&N&&e.jsxs(X,{color:"danger",variant:"flat",startContent:e.jsx(fe,{className:"w-4 h-4"}),onPress:()=>{const l=s?m:m.filter(n=>c.has(n.id.toString()));N(l)},children:["Delete ",a," selected"]})})}),t&&e.jsxs("span",{className:"text-default-400 text-small",children:[a," of ",m.length," selected"]})]})},[c,m,N]);(ue=Z.permissions)!=null&&ue.includes("leaves.view"),(re=Z.permissions)!=null&&re.includes("leave.own.view");const R={New:{color:"primary",icon:ls,bgColor:be(M.colors.primary,.1),textColor:M.colors.primary},Pending:{color:"warning",icon:ns,bgColor:be("#f59e0b",.1),textColor:"#f59e0b"},Approved:{color:"success",icon:rs,bgColor:be("#10b981",.1),textColor:"#10b981"},Declined:{color:"danger",icon:as,bgColor:be("#ef4444",.1),textColor:"#ef4444"}},I=s=>{switch(s==null?void 0:s.toLowerCase()){case"casual":return e.jsx(Ze,{className:"w-3 h-3 text-blue-500"});case"weekend":return e.jsx(Xe,{className:"w-3 h-3 text-yellow-500"});case"sick":return e.jsx(is,{className:"w-3 h-3 text-red-500"});case"earned":return e.jsx(ke,{className:"w-3 h-3 text-green-500"});default:return e.jsx(ye,{className:"w-3 h-3 text-primary"})}},O=r.useCallback(s=>{D&&D(s)},[D]),W=r.useCallback(async(s,t)=>{if(s.status===t)return Y.info(`Leave is already ${t}.`),Promise.resolve(`The leave status is already updated to ${t}`);const a=`${s.id}-${t}`;if(i===a)return;_(a);const l=new Promise(async(n,h)=>{var U,P,ae,xe;try{const B=await oe.post(route("leave-update-status"),{id:s.id,status:t});B.status===200?(x(pe=>pe.map(se=>se.id===s.id?{...se,status:t}:se)),K(),n(B.data.message||"Leave status updated successfully")):h(((U=B.data)==null?void 0:U.message)||"Failed to update leave status")}catch(B){const pe=((ae=(P=B.response)==null?void 0:P.data)==null?void 0:ae.message)||((xe=B.response)==null?void 0:xe.statusText)||"Failed to update leave status";h(pe)}finally{_(null)}});return Y.promise(l,{pending:"Updating leave status...",success:"Leave status updated successfully!",error:"Failed to update leave status"}),l},[x,i,K]),V=s=>{const t=R[s]||R.New,a=t.icon;return e.jsx(Q,{size:"sm",variant:"flat",color:t.color,startContent:e.jsx(a,{className:"w-3 h-3"}),classNames:{base:"h-6",content:"text-xs font-medium"},children:s})},A=(s,t)=>{const a=new Date(s),l=new Date(t),n=Math.abs(l-a),h=Math.ceil(n/(1e3*60*60*24))+1;return h===1?"1 day":`${h} days`},S=s=>new Date(s).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),L=s=>(f==null?void 0:f.find(t=>String(t.id)===String(s)))||{name:"Unknown User",phone:""},ce=({leave:s,updatingLeave:t,setCurrentLeave:a,openModal:l,handleClickOpen:n,updateLeaveStatus:h,canEditLeaves:U,canDeleteLeaves:P,canApproveLeaves:ae,isAdminView:xe})=>{const B=L(s.user_id),pe=A(s.from_date,s.to_date);return R[s.status]||R.New,e.jsx(Ve,{className:"mb-2",shadow:"sm",children:e.jsxs(je,{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-3 flex-1",children:xe&&e.jsx(He,{avatarProps:{radius:"lg",size:"sm",src:(B==null?void 0:B.profile_image_url)||(B==null?void 0:B.profile_image),showFallback:!0,name:(B==null?void 0:B.name)||"Unnamed User",isBordered:!0},description:B!=null&&B.phone?e.jsx(Ae,{href:`tel:${B==null?void 0:B.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:B==null?void 0:B.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Ge,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(B==null?void 0:B.name)||"Unnamed User"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[V(s.status),(U||P)&&e.jsxs(Ie,{children:[e.jsx(Be,{children:e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",className:"min-w-8 h-8",children:e.jsx(We,{className:"w-4 h-4"})})}),e.jsxs(ze,{"aria-label":"Leave actions",children:[U&&e.jsx(Ce,{startContent:e.jsx(qe,{className:"w-4 h-4"}),onPress:()=>{a(s),l("edit_leave")},children:"Edit Leave"},"edit"),P&&e.jsx(Ce,{className:"text-danger",color:"danger",startContent:e.jsx(fe,{className:"w-4 h-4"}),onPress:()=>n(s.id,"delete_leave"),children:"Delete Leave"},"delete")]})]})]})]}),e.jsx(De,{className:"my-3"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:s.leave_type})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-default-500"}),e.jsxs("span",{className:"text-sm text-default-500",children:[S(s.from_date)," - ",S(s.to_date)]}),e.jsx(Q,{size:"sm",variant:"bordered",color:"default",children:pe})]}),s.reason&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-default-500 mt-0.5"}),e.jsx("span",{className:"text-sm text-default-500 flex-1",children:s.reason})]})]}),xe&&ae&&e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"my-3"}),e.jsx("div",{className:"flex gap-2",children:["Approved","Declined"].map(se=>e.jsx(X,{size:"sm",variant:s.status===se?"solid":"bordered",color:R[se].color,isLoading:t===`${s.id}-${se}`,onPress:()=>{t!==`${s.id}-${se}`&&h(s,se)},startContent:t!==`${s.id}-${se}`?he.createElement(R[se].icon,{className:"w-3 h-3"}):null,classNames:{base:"flex-1"},children:se},se))})]})]})})},me=r.useCallback((s,t)=>{const a=L(s.user_id);switch(t){case"employee":return e.jsx(ne,{className:"whitespace-nowrap",children:e.jsx(He,{avatarProps:{radius:"lg",size:"sm",src:(a==null?void 0:a.profile_image_url)||(a==null?void 0:a.profile_image),showFallback:!0,name:(a==null?void 0:a.name)||"Unnamed User",isBordered:!0},description:a!=null&&a.phone?e.jsx(Ae,{href:`tel:${a==null?void 0:a.phone}`,size:"sm",className:"text-xs text-blue-500 hover:underline",children:a==null?void 0:a.phone}):e.jsxs("span",{className:"flex items-center gap-1 text-xs text-gray-400 italic",children:[e.jsx(Ge,{className:"w-3 h-3"})," No Phone"]}),name:e.jsx("span",{className:"text-sm font-medium",children:(a==null?void 0:a.name)||"Unnamed User"})})});case"leave_type":return e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[I(s.leave_type),e.jsx("span",{className:"text-sm font-medium capitalize",children:s.leave_type})]})});case"from_date":case"to_date":return e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"w-3 h-3 text-default-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:S(s[t])}),t==="from_date"&&e.jsx("div",{className:"text-xs text-default-500",children:A(s.from_date,s.to_date)})]})]})});case"status":return e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[V(s.status),k&&o&&e.jsxs(Ie,{children:[e.jsx(Be,{children:e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",isDisabled:i&&i.startsWith(`${s.id}-`),onPress:()=>{},className:"min-w-8 h-8",children:e.jsx(We,{className:"w-4 h-4"})})}),e.jsx(ze,{"aria-label":"Status actions",onAction:l=>W(s,l),children:Object.keys(R).map(l=>{const n=R[l],h=n.icon;return e.jsx(Ce,{startContent:e.jsx(h,{className:"w-4 h-4"}),color:n.color,children:l},l)})})]})]})});case"reason":return e.jsx(ne,{children:e.jsx(_e,{content:s.reason||"No reason provided",children:e.jsx("span",{className:"max-w-xs truncate cursor-help text-xs text-default-500",children:s.reason||"No reason provided"})})});case"actions":return e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[F&&e.jsx(_e,{content:"Edit Leave",children:e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",color:"primary",isDisabled:i&&i.startsWith(`${s.id}-`),onPress:()=>{i&&i.startsWith(`${s.id}-`)||(g(s),d("edit_leave"))},className:"min-w-8 h-8",children:e.jsx(qe,{className:"w-4 h-4"})})}),w&&e.jsx(_e,{content:"Delete Leave",color:"danger",children:e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",color:"danger",isDisabled:i&&i.startsWith(`${s.id}-`),onPress:()=>{i&&i.startsWith(`${s.id}-`)||(g(s),y(s.id,"delete_leave"))},className:"min-w-8 h-8",children:e.jsx(fe,{className:"w-4 h-4"})})})]})});default:return e.jsx(ne,{children:s[t]})}},[k,o,$,i,M,g,d,y,W]),ge=[...k?[{name:"Employee",uid:"employee",icon:Te}]:[],{name:"Leave Type",uid:"leave_type",icon:ye},{name:"From Date",uid:"from_date",icon:le},{name:"To Date",uid:"to_date",icon:le},{name:"Status",uid:"status",icon:ke},{name:"Reason",uid:"reason",icon:ye},...k?[{name:"Actions",uid:"actions"}]:[]];return b?e.jsxs("div",{className:"space-y-4",children:[e.jsx(Le,{className:"max-h-[70vh]",children:m.map(s=>e.jsx(ce,{leave:s,updatingLeave:i,setCurrentLeave:g,openModal:d,handleClickOpen:y,updateLeaveStatus:W,canEditLeaves:F,canDeleteLeaves:w,canApproveLeaves:o,isAdminView:k},s.id))}),G>j&&e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx(Ye,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:u,onChange:O,size:"sm"})})]}):e.jsxs("div",{className:"max-h-[84vh] overflow-y-auto",children:[e.jsx(Le,{className:"max-h-[70vh]",children:e.jsxs(os,{isStriped:!0,selectionMode:"multiple",selectedKeys:c,onSelectionChange:H,topContent:ee,topContentPlacement:"outside",isCompact:!0,isHeaderSticky:!0,removeWrapper:!0,"aria-label":"Leave Management Table",disabledBehavior:"selection",classNames:{wrapper:"min-h-[200px]",table:"min-h-[300px]",thead:"[&>tr]:first:shadow-small bg-default-100/80",tbody:"divide-y divide-default-200/50",tr:"group hover:bg-default-50/50 transition-colors h-12",td:"py-2 px-3 text-sm",th:"py-2 px-3 text-xs font-semibold"},children:[e.jsx(ms,{columns:ge,children:s=>e.jsx(us,{align:s.uid==="actions"?"center":"start",className:"bg-default-100/80 backdrop-blur-md",children:e.jsxs("div",{className:"flex items-center gap-1",children:[s.icon&&e.jsx(s.icon,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-semibold",children:s.name})]})},s.uid)}),e.jsx(ds,{items:m,emptyContent:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(le,{className:"w-12 h-12 text-default-300 mb-4"}),e.jsx("h6",{className:"text-lg font-semibold text-default-500",children:"No leaves found"}),e.jsx("p",{className:"text-sm text-default-500",children:z?`No leaves found for "${z}"`:"No leave requests for the selected period"})]}),children:s=>e.jsx(cs,{children:t=>me(s,t)},s.id)})]})}),G>j&&e.jsxs("div",{className:"py-4 flex justify-center",children:[e.jsx(Ye,{showControls:!0,showShadow:!0,color:"primary",variant:"bordered",page:T,total:u,onChange:O,size:q?"sm":"md"}),e.jsxs("div",{className:"ml-4 text-xs text-gray-500",children:["Page ",T," of ",u," (Total: ",G," records)"]})]})]})});js.displayName="LeaveEmployeeTable";const Je=({selectedDepartmentId:m,selectedEmployeeId:f,onDepartmentChange:y,onEmployeeChange:g,allUsers:d=[],departments:x=[],showSearch:D=!0,variant:T="outlined",size:G="medium",disabled:u=!1,required:j=!1,error:C={},label:z={department:"Department",employee:"Employee"},showAllOption:k=!0,autoSelectFirstDepartment:v=!0,className:p="",theme:N})=>{const[o,F]=r.useState(""),[w,K]=r.useState(""),[J,Z]=r.useState(!1);r.useEffect(()=>{if(v&&x.length>0&&!m){const b=x[0];b&&y(b.id)}},[x,m,y,v]);const M=r.useMemo(()=>o.trim()?x.filter(b=>b.name.toLowerCase().includes(o.toLowerCase())||b.id.toString().includes(o)):x,[x,o]),$=r.useMemo(()=>m?d.filter(b=>String(b.department_id)===String(m)):k?d:[],[d,m,k]),q=r.useMemo(()=>w.trim()?$.filter(b=>{var E,te;return b.name.toLowerCase().includes(w.toLowerCase())||((E=b.email)==null?void 0:E.toLowerCase().includes(w.toLowerCase()))||b.id.toString().includes(w)||((te=b.designation)==null?void 0:te.toLowerCase().includes(w.toLowerCase()))}):$,[$,w]);return r.useEffect(()=>{m&&f&&($.some(E=>String(E.id)===String(f))||g(""))},[m,f,$,g]),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 ${p}`,children:[e.jsx("div",{children:e.jsxs(ve,{label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),z.department]}),selectedKeys:m?[String(m)]:[],onSelectionChange:b=>{const E=Array.from(b)[0];y(E===""?"":parseInt(E)),f&&g(""),F(""),K("")},isDisabled:u,isRequired:j,isInvalid:!!C.department_id,errorMessage:C.department_id,variant:T,children:[k&&e.jsx(ie,{value:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"All Departments"})]})},""),M.map(b=>e.jsx(ie,{value:String(b.id),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:b.name})]}),e.jsx(Q,{size:"sm",variant:"bordered",className:"ml-auto text-xs",children:d.filter(E=>E.department_id===b.id).length})]})},String(b.id)))]})}),e.jsx("div",{children:e.jsxs(ve,{label:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),z.employee,!m&&!k&&e.jsx("span",{className:"text-xs text-gray-500",children:"(Select department first)"})]}),selectedKeys:f?[String(f)]:[],onSelectionChange:b=>{const E=Array.from(b)[0];g(E===""?"":parseInt(E)),K("")},isDisabled:u||J||!m&&!k,isRequired:j,isInvalid:!!C.user_id,errorMessage:C.user_id,variant:T,children:[k&&e.jsx(ie,{value:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:m?"All Employees in Department":"Select Department First"})]})},""),q.map(b=>e.jsx(ie,{value:String(b.id),children:e.jsxs("div",{className:"flex items-center gap-2 w-full",children:[e.jsx(es,{src:b.profile_image_url||b.profile_image,size:"sm",name:b.name,showFallback:!0}),e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("span",{className:"text-sm font-medium",children:b.name}),b.designation&&e.jsx("span",{className:"text-xs text-gray-500",children:b.designation})]}),b.department&&e.jsx(Q,{size:"sm",variant:"bordered",className:"text-xs h-5",children:b.department})]})},String(b.id))),q.length===0&&e.jsx(ie,{isDisabled:!0,children:e.jsx("span",{className:"text-sm text-gray-500",children:m?"No employees found in selected department":"No employees found"})},"no-employees")]})})]})},Js=({open:m,closeModal:f,leavesData:y,setLeavesData:g,currentLeave:d,allUsers:x,departments:D=[],setTotalRows:T,setLastPage:G,setLeaves:u,handleMonthChange:j,employee:C,selectedMonth:z,addLeaveOptimized:k,updateLeaveOptimized:v,fetchLeavesStats:p})=>{var s;const{auth:N}=$e().props,o=de(),[F,w]=r.useState((d==null?void 0:d.user_id)||N.user.id),K=()=>{var t;if(d!=null&&d.user_id){const a=x==null?void 0:x.find(l=>l.id===d.user_id);return(a==null?void 0:a.department_id)||null}return((t=N==null?void 0:N.user)==null?void 0:t.department_id)||null},[J,Z]=r.useState(K()),[M,$]=r.useState((y==null?void 0:y.leaveTypes)||[]),[q,b]=r.useState([]),[E,te]=r.useState((d==null?void 0:d.leave_type)||""),i=t=>{if(!t)return new Date().toISOString().split("T")[0];if(typeof t=="string"&&t.match(/^\d{4}-\d{2}-\d{2}$/))return t;if(typeof t=="string"&&t.includes("T")){if(t.includes("T18:00:00")){const l=t.split("T")[0].split("-"),n=parseInt(l[0]),h=parseInt(l[1]),U=parseInt(l[2])+1;return new Date(n,h-1,U).toISOString().split("T")[0]}return t.split("T")[0]}try{const a=new Date(t);if(isNaN(a.getTime()))return new Date().toISOString().split("T")[0];const l=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),h=String(a.getDate()).padStart(2,"0");return`${l}-${n}-${h}`}catch(a){return console.error("Error formatting date:",a),new Date().toISOString().split("T")[0]}},[_,c]=r.useState(d!=null&&d.from_date?i(d.from_date):""),[H,ee]=r.useState(d!=null&&d.to_date?i(d.to_date):""),[R,I]=r.useState((d==null?void 0:d.no_of_days)||""),[O,W]=r.useState(""),[V,A]=r.useState((d==null?void 0:d.reason)||""),[S,L]=r.useState({}),[ce,me]=r.useState(!1),[ge,ue]=r.useState("");r.useEffect(()=>{var t,a;if(y){$(y.leaveTypes||[]);const l=((t=y.leaveCountsByUser)==null?void 0:t[F])||[];if(b(l),M.length>0&&!E&&!d&&te(M[0].type),d&&!E){const n=(a=y.leaveTypes)==null?void 0:a.find(h=>h.id===d.leave_type);n&&te(n.type)}}},[y,F,d]),r.useEffect(()=>{if(d){w(d.user_id);const t=x==null?void 0:x.find(a=>a.id===d.user_id);t!=null&&t.department_id&&Z(t.department_id)}},[d,x]),r.useEffect(()=>{if(!E||!q||!M)return;const t=q.find(n=>n.leave_type===E),a=(t==null?void 0:t.days_used)||0;ue(a);const l=M.find(n=>n.type===E);if(l){const n=l.days-a;W(n),d&&R>n&&I(n)}},[E,q,M,d,R]),r.useEffect(()=>{I(((a,l)=>{if(!a||!l)return"";const n=new Date(a),h=new Date(l);if(n>h)return"";const U=h.getTime()-n.getTime();return Math.ceil(U/(1e3*3600*24))+1})(_,H))},[_,H]);const re=async t=>{t.preventDefault(),me(!0);const a=new Promise(async(l,n)=>{try{const h={route:route().current(),user_id:F,leaveType:E,fromDate:_,toDate:H,daysCount:R,leaveReason:V,employee:C,month:z},U=d?route("leave-update"):route("leave-add");d&&(h.id=d.id);const P=await axios.post(U,h);P.status===200||P.status===201?(g(P.data.leavesData),d&&v&&P.data.leave?(v(P.data.leave),p()):k&&P.data.leave?(k(P.data.leave),p(),P.data.pagination&&(T(P.data.pagination.total),G(P.data.pagination.lastPage))):(console.log("Using fallback data update mode"),P.data.leaves&&(u(P.data.leaves.data),T(P.data.leaves.total),G(P.data.leaves.last_page)),P.data.leavesData&&typeof updateLeavesData=="function"&&updateLeavesData(P.data.leavesData)),f(),l([P.data.message||"Leave application submitted successfully"])):(console.error("Unexpected response status:",P.status),n(`Unexpected response status: ${P.status}`))}catch(h){console.error("Full error object:",h),h.response?(console.error("Error response status:",h.response.status),console.error("Error response data:",h.response.data),h.response.status===422?(L(h.response.data.errors||{}),n(h.response.data.error||"Failed to submit leave application")):n(`HTTP Error ${h.response.status}: ${h.response.data.message||"An unexpected error occurred. Please try again later."}`)):h.request?(console.error("No response received:",h.request),n("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",h.message),n("An error occurred while setting up the request."))}finally{me(!1)}});Y.promise(a,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(CircularProgress,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Submitting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},success:{render({data:l}){return e.jsx(e.Fragment,{children:l.map((n,h)=>e.jsx("div",{children:n},h))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}},error:{render({data:l}){return e.jsx(e.Fragment,{children:l})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,color:o.palette.text.primary}}})};return e.jsxs(we,{open:m,onClose:f,fullWidth:!0,maxWidth:"sm",children:[e.jsxs(DialogTitle,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Typography,{variant:"h6",component:"h2",children:d?"Edit Leave":"Add Leave"}),e.jsx(IconButton,{onClick:f,sx:{position:"absolute",top:8,right:16},children:e.jsx(ClearIcon,{})})]}),e.jsxs("form",{onSubmit:re,children:[e.jsx(DialogContent,{children:e.jsxs(Grid,{container:!0,spacing:2,children:[e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsxs(FormControl,{fullWidth:!0,children:[e.jsx(InputLabel,{id:"leave-type-label",children:"Leave Type"}),e.jsxs(ve,{labelId:"leave-type-label",value:E||"",onChange:t=>te(t.target.value),label:"Leave Type",error:!!S.leaveType,disabled:!1,MenuProps:{PaperProps:{sx:{backdropFilter:"blur(16px) saturate(200%)",background:o.glassCard.background,border:o.glassCard.border,borderRadius:2,boxShadow:o.glassCard.boxShadow,maxHeight:300}}},children:[e.jsx(MenuItem,{value:"",disabled:!0,children:"Select Leave Type"}),M.map(t=>{const a=q==null?void 0:q.find(h=>h.leave_type===t.type),n=(a?t.days-a.days_used:t.days)<=0;return e.jsx(MenuItem,{value:t.type,disabled:n,title:n?"No remaining leaves available":"",children:e.jsxs(Box,{display:"flex",justifyContent:"space-between",width:"100%",children:[e.jsx("span",{children:t.type}),e.jsx("span",{children:a?`${a.days_used} / ${t.days} days`:`${t.days} days`})]})},t.id)})]}),e.jsx(FormHelperText,{children:S.leaveType})]})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"From",type:"date",fullWidth:!0,value:_,onChange:t=>c(t.target.value),InputLabelProps:{shrink:!0},error:!!S.fromDate,helperText:S.fromDate})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"To",type:"date",fullWidth:!0,value:H,onChange:t=>ee(t.target.value),InputLabelProps:{shrink:!0},error:!!S.toDate,helperText:S.toDate})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"Number of days",type:"text",fullWidth:!0,value:R,InputProps:{readOnly:!0},error:!!S.daysCount,helperText:S.daysCount})}),e.jsx(Grid,{item:!0,xs:12,md:6,children:e.jsx(TextField,{label:"Remaining Leaves",type:"text",fullWidth:!0,value:`${O} day${O!==1?"s":""}`,InputProps:{readOnly:!0,endAdornment:e.jsxs(Typography,{variant:"caption",color:"textSecondary",sx:{ml:1},children:["of ",((s=M.find(t=>t.type===E))==null?void 0:s.days)||0," total"]})},error:!!S.remainingLeaves,helperText:S.remainingLeaves})}),route().current()==="leaves"&&e.jsx(Grid,{item:!0,xs:12,children:e.jsx(Je,{selectedDepartmentId:J,selectedEmployeeId:F,onDepartmentChange:Z,onEmployeeChange:w,allUsers:x,departments:D,showSearch:!0,error:S,theme:o,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!0,required:!0})}),e.jsx(Grid,{item:!0,xs:12,children:e.jsx(TextField,{label:"Leave Reason",multiline:!0,rows:4,fullWidth:!0,value:V,onChange:t=>A(t.target.value),error:!!S.leaveReason,helperText:S.leaveReason})})]})}),e.jsx(DialogActions,{sx:{padding:"16px",justifyContent:"center"},children:e.jsx(LoadingButton,{type:"submit",variant:"outlined",color:"primary",loading:ce,disabled:ce,sx:{borderRadius:"50px"},children:"Submit"})})]})]})},Qs=({open:m,closeModal:f,leaveId:y,setLeavesData:g,setLeaves:d,setTotalRows:x,setLastPage:D,setError:T,deleteLeaveOptimized:G,fetchLeavesStats:u})=>{const{isDark:j}=de();Qe();const[C,z]=r.useState(!1),k=()=>{if(!y){const p=Promise.reject(new Error("Invalid leave ID"));Y.promise(p,{error:"Invalid leave ID provided"});return}z(!0);const v=new Promise(async(p,N)=>{var o,F,w,K,J,Z,M;try{const $=await oe.delete(route("leave-delete",{id:y,route:route().current()}));$.status===200&&(G?(G(y),x(q=>Math.max(0,q-1)),u&&u()):(g&&g($.data.leavesData),x&&x($.data.leaves.total),D&&D($.data.leaves.last_page),d&&d($.data.leaves.data),T&&T(!1),u&&u()),p("Leave application deleted successfully"))}catch($){if(console.error("Error deleting leave:",$),((o=$.response)==null?void 0:o.status)===404){const{leavesData:q}=$.response.data||{};g&&q&&g(q),T&&T(((w=(F=$.response)==null?void 0:F.data)==null?void 0:w.message)||"Leave not found."),N("Leave not found or already deleted")}else((K=$.response)==null?void 0:K.status)===403?N("You do not have permission to delete this leave"):((J=$.response)==null?void 0:J.status)===422?N("Cannot delete leave with current status"):N(((M=(Z=$.response)==null?void 0:Z.data)==null?void 0:M.error)||"Failed to delete leave application")}finally{z(!1),f()}});Y.promise(v,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(CircularProgress,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave application..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}},success:{render({data:p}){return e.jsx(e.Fragment,{children:p})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}},error:{render({data:p}){return e.jsx(e.Fragment,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:theme.glassCard.background,border:theme.glassCard.border,color:theme.palette.text.primary}}})};return e.jsxs(we,{open:m,onClose:f,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(DialogTitle,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(DialogContent,{children:e.jsx(DialogContentText,{id:"alert-dialog-description",children:"Are you sure you want to delete this leave? This action cannot be undone."})}),e.jsxs(DialogActions,{children:[e.jsx(X,{onClick:f,color:"primary",disabled:C,children:"Cancel"}),e.jsx(X,{loading:C,disabled:C,onClick:k,color:"error",autoFocus:!0,children:"Delete"})]})]})},vs=({selectedDates:m=[],onDatesChange:f,existingLeaves:y=[],publicHolidays:g=[],minDate:d=null,maxDate:x=null,userId:D=null,fetchFromAPI:T=!1})=>{const G=de(),[u,j]=r.useState(new Date),[C,z]=r.useState({existingLeaves:y,publicHolidays:g}),[k,v]=r.useState(!1),[p,N]=r.useState(null),o=r.useCallback(async i=>{if(!(!T||!D)&&p!==i){v(!0);try{const _=await oe.get(route("leaves.bulk.calendar-data"),{params:{user_id:D,year:i}});_.data.success&&(z({existingLeaves:_.data.data.existingLeaves||[],publicHolidays:_.data.data.publicHolidays||[]}),N(i))}catch(_){console.error("Failed to fetch calendar data:",_)}finally{v(!1)}}},[T,D,p]);r.useEffect(()=>{const i=u.getFullYear();o(i)},[o,u.getFullYear()]),r.useEffect(()=>{T&&D&&N(null)},[D,T]);const F=T?C.existingLeaves:y,w=T?C.publicHolidays:g,K=r.useMemo(()=>{const i=u.getFullYear(),_=u.getMonth(),c=new Date(i,_,1),ee=new Date(i,_+1,0).getDate(),R=c.getDay(),I=new Date(i,_,0).getDate(),O=[];for(let L=R-1;L>=0;L--)O.push({date:I-L,isCurrentMonth:!1,fullDate:new Date(i,_-1,I-L)});const W=[];for(let L=1;L<=ee;L++)W.push({date:L,isCurrentMonth:!0,fullDate:new Date(i,_,L)});const A=42-(O.length+W.length),S=[];for(let L=1;L<=A;L++)S.push({date:L,isCurrentMonth:!1,fullDate:new Date(i,_+1,L)});return[...O,...W,...S]},[u]),J=r.useCallback(()=>{j(i=>new Date(i.getFullYear(),i.getMonth()-1,1))},[]),Z=r.useCallback(()=>{j(i=>new Date(i.getFullYear(),i.getMonth()+1,1))},[]),M=r.useCallback(()=>{j(new Date)},[]),$=r.useCallback(i=>{if(!i.isCurrentMonth||k)return;const _=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),c=F.some(I=>{if(!I.from_date||!I.to_date)return!1;const O=I.from_date.split("T")[0],W=I.to_date.split("T")[0];return _>=O&&_<=W}),H=w.includes(_);if(c||H||d&&i.fullDate<new Date(d)||x&&i.fullDate>new Date(x))return;const ee=m.includes(_);let R;ee?R=m.filter(I=>I!==_):R=[...m,_],f(R.sort())},[m,f,d,x,k,F,w]),q=r.useCallback(i=>{if(!i.isCurrentMonth)return{selectable:!1};const _=i.fullDate.getFullYear()+"-"+String(i.fullDate.getMonth()+1).padStart(2,"0")+"-"+String(i.fullDate.getDate()).padStart(2,"0"),c=m.includes(_),H=i.fullDate.toDateString()===new Date().toDateString(),ee=i.fullDate<new Date().setHours(0,0,0,0),R=i.fullDate.getDay()===0||i.fullDate.getDay()===6,I=F.some(V=>{if(!V.from_date||!V.to_date)return!1;const A=V.from_date.split("T")[0],S=V.to_date.split("T")[0];return _>=A&&_<=S}),O=w.includes(_),W=!k&&!I&&!O&&(!d||i.fullDate>=new Date(d))&&(!x||i.fullDate<=new Date(x));return{isSelected:c,isToday:H,isPast:ee,isWeekend:R,hasExistingLeave:I,isPublicHoliday:O,selectable:W}},[m,F,w,d,x,k]),b=r.useCallback((i,_)=>({}),[G,k]),E=u.toLocaleDateString("en-US",{month:"long",year:"numeric"}),te=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return e.jsxs(Ve,{className:"w-full",children:[e.jsx(Fe,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-5 h-5 text-primary"}),e.jsx("h3",{className:"text-lg font-semibold",children:E}),T&&p&&e.jsxs(Q,{size:"sm",variant:"bordered",color:"primary",className:"ml-2 text-xs",children:["Data: ",p]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",onClick:J,isDisabled:k,children:e.jsx(fs,{className:"w-4 h-4"})}),e.jsx(X,{size:"sm",variant:"light",onClick:M,isDisabled:k,className:"px-3 py-1 text-xs",children:"Today"}),e.jsx(X,{isIconOnly:!0,size:"sm",variant:"light",onClick:Z,isDisabled:k,children:e.jsx(ss,{className:"w-4 h-4"})})]})]})}),e.jsxs(je,{className:"pt-0",children:[k&&e.jsxs("div",{className:"flex justify-center items-center py-6 bg-default-100 rounded-lg mb-6",children:[e.jsx(Pe,{size:"sm"}),e.jsxs("span",{className:"ml-2 text-sm text-default-600",children:["Loading calendar data for ",u.getFullYear(),"..."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx(Q,{size:"sm",color:"primary",variant:"solid",className:"font-medium",children:"Selected"}),e.jsx(Q,{size:"sm",color:"danger",variant:"solid",children:"Existing Leave"}),e.jsx(Q,{size:"sm",color:"warning",variant:"solid",children:"Holiday"}),e.jsx(Q,{size:"sm",color:"secondary",variant:"solid",className:"font-medium",children:"Today"}),e.jsx(Q,{size:"sm",color:"default",variant:"bordered",children:"Weekend"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:te.map(i=>e.jsx("div",{className:"text-center py-2 text-sm font-medium text-default-600",children:i},i))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:K.map((i,_)=>{const c=q(i);return b(i,c),e.jsxs("div",{onClick:()=>$(i),className:`
                                    relative flex items-center justify-center w-10 h-10 min-h-10
                                    rounded-lg transition-all duration-200 text-sm select-none
                                    ${c.selectable?"cursor-pointer":"cursor-not-allowed"}
                                    ${i.isCurrentMonth?"":"opacity-30 text-default-400"}
                                    ${k?"opacity-50 pointer-events-none bg-default-100":""}
                                    ${c.isSelected?"bg-primary text-primary-foreground font-bold border-2 border-primary-600 shadow-lg scale-105 z-10":""}
                                    ${c.hasExistingLeave&&!c.isSelected?"bg-danger text-danger-foreground border-2 border-danger-600 font-medium cursor-not-allowed":""}
                                    ${c.isPublicHoliday&&!c.isSelected&&!c.hasExistingLeave?"bg-warning text-warning-foreground border-2 border-warning-600 font-medium cursor-not-allowed":""}
                                    ${c.isToday&&!c.isSelected&&!c.hasExistingLeave&&!c.isPublicHoliday?"bg-secondary-200 text-secondary-800 font-semibold border-2 border-secondary-500 shadow-md":""}
                                    ${c.isWeekend&&!c.isSelected&&!c.hasExistingLeave&&!c.isPublicHoliday&&!c.isToday?"text-default-500 bg-default-50 border border-default-200 opacity-70":""}
                                    ${!c.selectable&&!c.hasExistingLeave&&!c.isPublicHoliday&&!c.isToday&&!c.isWeekend?"text-default-400 cursor-not-allowed bg-default-100 opacity-60":""}
                                    ${c.selectable&&!c.isSelected&&!c.hasExistingLeave&&!c.isPublicHoliday&&!c.isToday&&!c.isWeekend?"text-default-900 border border-transparent hover:bg-primary-50 hover:text-primary hover:border-primary-200 hover:scale-105":""}
                                `,role:"button",tabIndex:c.selectable?0:-1,title:c.hasExistingLeave?"Existing leave - cannot select":c.isPublicHoliday?"Public holiday - cannot select":c.selectable?"":"Not selectable","aria-label":`${i.fullDate.toDateString()}${c.isSelected?" (selected)":""}${c.hasExistingLeave?" (existing leave)":""}${c.isPublicHoliday?" (public holiday)":""}`,onKeyDown:H=>{(H.key==="Enter"||H.key===" ")&&(H.preventDefault(),$(i))},children:[i.date,c.isWeekend&&!c.isSelected&&!c.hasExistingLeave&&!c.isPublicHoliday&&e.jsx("div",{className:"absolute top-1 right-1 w-1 h-1 rounded-full bg-default-500 opacity-50"})]},_)})}),m.length>0&&e.jsxs("div",{className:"mt-6 p-4 rounded-lg bg-gradient-to-br from-primary-50 to-primary-100 border border-primary-200 relative overflow-hidden",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("p",{className:"text-sm font-semibold text-primary-700 mb-2",children:["ðŸ“… ",m.length," date",m.length!==1?"s":""," selected"]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[m.slice(0,12).map(i=>e.jsx(Q,{size:"sm",color:"primary",variant:"solid",className:"font-medium text-xs",children:new Date(i).toLocaleDateString("en-US",{month:"short",day:"numeric"})},i)),m.length>12&&e.jsxs(Q,{size:"sm",color:"primary",variant:"bordered",className:"font-medium",children:["+",m.length-12," more"]})]})]}),e.jsx("div",{className:"absolute -top-2 -right-2 w-15 h-15 rounded-full bg-primary-200 opacity-30"})]})]})]})},ws=({validationResults:m=[],balanceImpact:f=null,isValidating:y=!1})=>{if(de(),m.length===0&&!y)return null;const g=m.filter(u=>u.status==="valid").length,d=m.filter(u=>u.status==="warning").length,x=m.filter(u=>u.status==="conflict").length;m.length;const D=u=>{const j={className:"w-4 h-4"};switch(u){case"valid":return e.jsx(Me,{...j,className:"w-4 h-4 text-success"});case"warning":return e.jsx(Ee,{...j,className:"w-4 h-4 text-warning"});case"conflict":return e.jsx(xs,{...j,className:"w-4 h-4 text-danger"});default:return e.jsx(Oe,{...j,className:"w-4 h-4 text-default-400"})}},T=u=>{switch(u){case"valid":return"success";case"warning":return"warning";case"conflict":return"danger";default:return"default"}},G=u=>new Date(u).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs(Re,{children:[e.jsx(Fe,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Validation Results"}),y&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{size:"sm"}),e.jsx("span",{className:"text-sm text-default-600",children:"Validating..."})]})]})}),e.jsxs(je,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-2xl font-bold text-success",children:g}),e.jsx("p",{className:"text-sm text-success",children:"Valid"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-2xl font-bold text-warning",children:d}),e.jsx("p",{className:"text-sm text-warning",children:"Warnings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-2xl font-bold text-danger",children:x}),e.jsx("p",{className:"text-sm text-danger",children:"Conflicts"})]})]}),f&&e.jsxs("div",{className:"p-4 rounded-lg bg-default-50 border border-default-200",children:[e.jsxs("h4",{className:"text-sm font-medium mb-4 flex items-center gap-2",children:[e.jsx(Oe,{className:"w-4 h-4 text-primary"}),"Leave Balance Impact"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-default-600",children:"Leave Type:"}),e.jsx("span",{className:"text-sm font-medium ml-2",children:f.leave_type})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-default-600",children:"Current Balance:"}),e.jsxs("span",{className:"text-sm font-medium ml-2",children:[f.current_balance," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-default-600",children:"Requested Days:"}),e.jsxs("span",{className:"text-sm font-medium ml-2",children:[f.requested_days," days"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-default-600",children:"Remaining Balance:"}),e.jsxs("span",{className:`text-sm font-medium ml-2 ${f.remaining_balance<0?"text-danger":"text-success"}`,children:[f.remaining_balance," days"]})]})]}),f.remaining_balance<0&&e.jsx("div",{className:"mt-4 p-3 rounded-md bg-danger-50 border border-danger-200",children:e.jsxs("p",{className:"text-sm text-danger",children:["âš ï¸ This request exceeds your available leave balance by ",Math.abs(f.remaining_balance)," days."]})})]})]})]}),m.length>0&&e.jsxs(Re,{children:[e.jsx(Fe,{children:e.jsx("h3",{className:"text-lg font-semibold",children:"Date-by-Date Results"})}),e.jsx(je,{children:e.jsx("div",{className:"flex flex-col gap-2 max-h-60 overflow-y-auto",children:m.map((u,j)=>e.jsxs("div",{className:"flex items-start justify-between p-4 rounded-lg border border-default-200 hover:border-default-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[D(u.status),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:G(u.date)}),e.jsx("p",{className:"text-xs text-default-500",children:u.date})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx(Q,{size:"sm",variant:"bordered",color:T(u.status),className:"capitalize",children:u.status}),u.errors&&u.errors.length>0&&e.jsx("div",{className:"text-right",children:u.errors.map((C,z)=>e.jsx("p",{className:"text-xs text-danger",children:C},z))}),u.warnings&&u.warnings.length>0&&e.jsx("div",{className:"text-right",children:u.warnings.map((C,z)=>e.jsx("p",{className:"text-xs text-warning",children:C},z))})]})]},j))})})]})]})},Xs=({open:m,onClose:f,onSuccess:y,allUsers:g=[],departments:d=[],leavesData:x={leaveTypes:[],leaveCountsByUser:{}},isAdmin:D=!1,existingLeaves:T=[],publicHolidays:G=[]})=>{var re;const{auth:u}=$e().props,j=de(),[C,z]=r.useState([]),[k,v]=r.useState(null),[p,N]=r.useState(null),[o,F]=r.useState(""),[w,K]=r.useState(""),[J,Z]=r.useState(!1),[M,$]=r.useState([]),[q,b]=r.useState(!1),[E,te]=r.useState([]),[i,_]=r.useState(null),[c,H]=r.useState(!1),[ee,R]=r.useState(!1),[I,O]=r.useState(!1),[W,V]=r.useState({});r.useMemo(()=>!T||T.length===0?[]:T.filter(s=>s.user_id===parseInt(p)),[T,p]);const A=r.useMemo(()=>M.length>0?M:(x==null?void 0:x.leaveTypes)||[],[M,x]),S=r.useMemo(()=>{var s;return M.length>0?M.map(t=>({leave_type:t.type,days_used:t.used,total_days:t.days,remaining_days:t.remaining})):((s=x==null?void 0:x.leaveCountsByUser)==null?void 0:s[p])||[]},[M,x,p]),L=r.useCallback(async s=>{if(s){b(!0);try{const t=await oe.get(route("leaves.bulk.leave-types"),{params:{user_id:s,year:new Date().getFullYear()}});t.data.success&&$(t.data.leave_types)}catch(t){console.error("Failed to fetch user leave types:",t),$([])}finally{b(!1)}}},[]);r.useEffect(()=>{(m&&p&&D||m&&p&&!D)&&L(p)},[p,m,D,L]),r.useEffect(()=>{if(m&&(u!=null&&u.user)){const s=g==null?void 0:g.find(t=>t.id===u.user.id);(s&&s.department_id&&!D||D&&!k&&!p&&s&&s.department_id)&&(v(s.department_id),N(u.user.id))}},[m,u==null?void 0:u.user,g,D,k,p]),r.useEffect(()=>{var s;m||(z([]),v(null),N(((s=u==null?void 0:u.user)==null?void 0:s.id)||null),F(""),K(""),Z(!1),te([]),_(null),R(!1),V({}),$([]))},[m,(re=u==null?void 0:u.user)==null?void 0:re.id]),r.useEffect(()=>{if(A.length>0&&!o&&m&&p){const s=A.find(t=>{if(M.length>0)return t.remaining>0;const a=S==null?void 0:S.find(n=>n.leave_type===t.type);return(a?t.days-a.days_used:t.days)>0});s&&F(s.type)}},[A,S,M,o,m,p]);const ce=r.useCallback(async()=>{var s,t,a;if(C.length===0){const l=Promise.reject(new Error("No dates selected"));Y.promise(l,{error:"Please select at least one date"});return}if(!o){const l=Promise.reject(new Error("No leave type selected"));Y.promise(l,{error:"Please select a leave type"});return}if(!w.trim()||w.trim().length<5){const l=new Promise((n,h)=>{h("Please provide a reason for leave (at least 5 characters)")});Y.promise(l,{error:{render({data:n}){return e.jsx(e.Fragment,{children:n})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:j.glassCard.background,border:j.glassCard.border,color:j.palette.text.primary}}});return}H(!0),V({});try{const l=A.find(h=>h.type===o),n=await oe.post(route("leaves.bulk.validate"),{user_id:parseInt(p),dates:C,leave_type_id:l==null?void 0:l.id,reason:w.trim()});if(n.data.success){te(n.data.validation_results),_(n.data.estimated_balance_impact),R(!0);const h=n.data.validation_results.filter(ae=>ae.status==="conflict").length,U=n.data.validation_results.filter(ae=>ae.status==="warning").length,P=Promise.resolve();h>0?Y.promise(P,{success:`${h} date(s) have conflicts. Please review before submitting.`}):U>0?Y.promise(P,{success:`${U} date(s) have warnings. You may proceed if acceptable.`}):Y.promise(P,{success:"All dates validated successfully!"})}}catch(l){console.error("Validation error:",l),((s=l.response)==null?void 0:s.status)===422&&V(l.response.data.errors||{});const n=Promise.reject(l);Y.promise(n,{error:((a=(t=l.response)==null?void 0:t.data)==null?void 0:a.message)||"Failed to validate dates"})}finally{H(!1)}},[C,o,w,p,A]),me=r.useCallback(async()=>{if(!ee){const a=Promise.reject(new Error("Not validated"));Y.promise(a,{error:"Please validate dates before submitting"});return}if(E.filter(a=>a.status==="conflict").length>0&&!J){const a=new Promise((l,n)=>{n("Please resolve conflicts or enable partial success mode")});Y.promise(a,{error:{render({data:l}){return e.jsx(e.Fragment,{children:l})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:j.glassCard.background,border:j.glassCard.border,color:j.palette.text.primary}}});return}O(!0);const t=new Promise(async(a,l)=>{try{const n=A.find(U=>U.type===o),h=await oe.post(route("leaves.bulk.store"),{user_id:parseInt(p),dates:C,leave_type_id:n==null?void 0:n.id,reason:w.trim(),allow_partial_success:J});h.status===200||h.status===201?(y==null||y(h.data),f(),a([h.data.message||"Bulk leave requests created successfully"])):(console.error("Unexpected response status:",h.status),l(`Unexpected response status: ${h.status}`))}catch(n){console.error("Full error object:",n),n.response?(console.error("Error response status:",n.response.status),console.error("Error response data:",n.response.data),n.response.status===422?(V(n.response.data.errors||{}),l(n.response.data.error||"Failed to submit bulk leave requests")):l(`HTTP Error ${n.response.status}: ${n.response.data.message||"An unexpected error occurred. Please try again later."}`)):n.request?(console.error("No response received:",n.request),l("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",n.message),l("An error occurred while setting up the request."))}finally{O(!1)}});Y.promise(t,{pending:{render(){return e.jsxs("div",{className:"flex items-center",children:[e.jsx(Pe,{size:"sm"}),e.jsx("span",{className:"ml-2",children:"Creating bulk leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:j.glassCard.background,border:j.glassCard.border,color:j.palette.text.primary}},success:{render({data:a}){return e.jsx(e.Fragment,{children:a.map((l,n)=>e.jsx("div",{children:l},n))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:j.glassCard.background,border:j.glassCard.border,color:j.palette.text.primary}},error:{render({data:a}){return e.jsx(e.Fragment,{children:a})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:j.glassCard.background,border:j.glassCard.border,color:j.palette.text.primary}}})},[ee,E,J,p,C,o,w,y,f,A,j]),ge=C.length>0&&o&&w.trim().length>=5,ue=ee&&(E.filter(s=>s.status==="conflict").length===0||J);return e.jsxs(we,{open:m,onClose:f,fullWidth:!0,maxWidth:"lg",children:[e.jsxs("div",{className:"flex items-center p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(le,{style:{width:24,height:24,color:j.colors.primary}}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Add Bulk Leave"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-0.5",children:"Select multiple dates and create leave requests in batch"})]})]}),e.jsx(X,{isIconOnly:!0,variant:"light",onPress:f,isDisabled:I,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(ps,{size:20})})]}),e.jsx("div",{className:"py-6 px-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"sticky top-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx(le,{style:{width:20,height:20}}),"Select Dates"]}),e.jsx(vs,{selectedDates:C,onDatesChange:s=>{z(s),R(!1)},userId:p,fetchFromAPI:!0})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Leave Details"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[D&&g.length>0&&e.jsx(Je,{selectedDepartmentId:k,selectedEmployeeId:p,onDepartmentChange:v,onEmployeeChange:s=>{N(s),F(""),R(!1),$([])},allUsers:g,departments:d,showSearch:!0,error:W,theme:j,variant:"outlined",showAllOption:!1,autoSelectFirstDepartment:!1,required:!0,disabled:I||c}),e.jsx("div",{children:e.jsx(ve,{label:"Leave Type",selectedKeys:o?[o]:[],onSelectionChange:s=>{const t=Array.from(s)[0];F(t),R(!1)},isDisabled:I||c||q,isInvalid:!!W.leave_type_id,errorMessage:W.leave_type_id,children:q?e.jsx(ie,{isDisabled:!0,children:"Loading leave types..."},"loading"):A.map(s=>{let t,a;if(M.length>0)t=s.remaining,a=t<=0;else{const l=S==null?void 0:S.find(n=>n.leave_type===s.type);t=l?s.days-l.days_used:s.days,a=t<=0}return e.jsx(ie,{value:s.type,isDisabled:a,title:a?"No remaining leaves available":"",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{children:s.type}),e.jsxs("span",{children:["(",t," remaining)"]})]})},s.type)})})}),o&&e.jsx(Ue,{label:"Remaining Leaves",value:(()=>{const s=A.find(l=>l.type===o);let t,a;if(M.length>0&&s)t=s.remaining,a=s.days;else{const l=S==null?void 0:S.find(n=>n.leave_type===o);t=l?(s==null?void 0:s.days)-l.days_used:s==null?void 0:s.days,a=s==null?void 0:s.days}return`${t||0} remaining of ${a||0} total`})(),isReadOnly:!0}),e.jsx(Ue,{label:"Reason for Leave",placeholder:"Please provide a detailed reason for your leave request...",value:w,onChange:s=>{K(s.target.value),R(!1)},isRequired:!0,isInvalid:!!W.reason||w.length>0&&w.length<5,errorMessage:W.reason||(w.length>0&&w.length<5?"Reason must be at least 5 characters":`${w.length}/500 characters`),maxLength:500,isDisabled:I||c}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ts,{isSelected:J,onValueChange:Z,size:"sm",isDisabled:I||c}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Allow partial success"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Valid dates will be processed even if some dates fail validation"})]})]})]})]}),C.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Selected Dates Summary"}),e.jsxs("p",{className:"text-base font-medium text-gray-900 dark:text-white",children:[e.jsx("strong",{children:C.length})," date",C.length!==1?"s":""," selected"]}),o&&e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Leave type: ",o]})]}),e.jsx(ws,{validationResults:E,balanceImpact:i,isValidating:c})]})})]})}),e.jsxs("div",{className:"flex justify-between items-center p-6 border-t border-gray-200 dark:border-gray-700 gap-4",children:[e.jsx(X,{variant:"bordered",onPress:f,isDisabled:I,className:"rounded-full",children:"Cancel"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(X,{variant:"bordered",color:"primary",onPress:ce,isLoading:c,isDisabled:!ge||I,startContent:!c&&e.jsx(Ee,{style:{width:16,height:16}}),className:"rounded-full",children:c?"Validating...":"Validate Dates"}),e.jsx(X,{variant:"solid",color:"primary",onPress:me,isLoading:I,isDisabled:!ue||c,startContent:!I&&e.jsx(Me,{style:{width:16,height:16}}),className:"rounded-full",children:I?"Creating...":`Create ${C.length} Leave Request${C.length!==1?"s":""}`})]})]})]})},Zs=({open:m,onClose:f,onSuccess:y,selectedLeaves:g=[],allUsers:d=[]})=>{const x=de(),[D,T]=r.useState(!1),[G,u]=r.useState({}),j=r.useCallback(v=>{const p=d.find(N=>N.id===v);return(p==null?void 0:p.name)||`User ID: ${v}`},[d]),C=g.filter(v=>v.status&&v.status.toLowerCase()==="approved"),z=C.length===0,k=r.useCallback(async()=>{if(!z){const p=Promise.reject("Cannot delete approved leaves");Y.promise(p,{error:"Cannot delete approved leave requests"});return}if(g.length===0){const p=Promise.reject("No leaves selected");Y.promise(p,{error:"No leave requests selected for deletion"});return}T(!0);const v=new Promise(async(p,N)=>{try{const o=g.map(w=>w.id),F=await oe.delete(route("leaves.bulk.delete"),{data:{leave_ids:o}});F.status===200&&F.data.success?(y==null||y(F.data),f(),p([F.data.message||"Leave requests deleted successfully"])):(console.error("Unexpected response status:",F.status),N(`Unexpected response status: ${F.status}`))}catch(o){console.error("Full error object:",o),o.response?(console.error("Error response status:",o.response.status),console.error("Error response data:",o.response.data),o.response.status===422?(u(o.response.data.errors||{}),N(o.response.data.error||"Failed to delete leave requests")):o.response.status===403?N(o.response.data.error||"You are not authorized to delete these leave requests"):o.response.status===404?N(o.response.data.error||"Some leave requests were not found"):N(`HTTP Error ${o.response.status}: ${o.response.data.message||"An unexpected error occurred. Please try again later."}`)):o.request?(console.error("No response received:",o.request),N("No response received from the server. Please check your internet connection.")):(console.error("Request setup error:",o.message),N("An error occurred while setting up the request."))}finally{T(!1)}});Y.promise(v,{pending:{render(){return e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(CircularProgress,{}),e.jsx("span",{style:{marginLeft:"8px"},children:"Deleting leave requests..."})]})},icon:!1,style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},success:{render({data:p}){return e.jsx(e.Fragment,{children:p.map((N,o)=>e.jsx("div",{children:N},o))})},icon:"ðŸŸ¢",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}},error:{render({data:p}){return e.jsx(e.Fragment,{children:p})},icon:"ðŸ”´",style:{backdropFilter:"blur(16px) saturate(200%)",background:x.glassCard.background,border:x.glassCard.border,color:x.palette.text.primary}}})},[g,z,y,f,x]);return e.jsxs(we,{open:m,onClose:f,fullWidth:!0,maxWidth:"md",children:[e.jsxs(DialogTitle,{sx:{display:"flex",alignItems:"center",pb:1},children:[e.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2,flex:1},children:[e.jsx(fe,{style:{width:24,height:24,color:x.palette.error.main}}),e.jsxs(Box,{children:[e.jsx(Typography,{variant:"h6",component:"h2",children:"Delete Leave Requests"}),e.jsxs(Typography,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:["Confirm deletion of ",g.length," leave request",g.length!==1?"s":""]})]})]}),e.jsx(IconButton,{onClick:f,sx:{position:"absolute",top:8,right:16},disabled:D,children:e.jsx(ClearIcon,{})})]}),e.jsxs(DialogContent,{sx:{py:3},children:[!z&&e.jsxs(Box,{sx:{p:2,mb:3,borderRadius:2,background:x.palette.error.main+"20",border:`1px solid ${x.palette.error.main}40`},children:[e.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[e.jsx(Ee,{style:{width:20,height:20,color:x.palette.error.main}}),e.jsx(Typography,{variant:"subtitle2",color:"error",children:"Cannot Delete Approved Leaves"})]}),e.jsxs(Typography,{variant:"body2",color:"error",children:[C.length," of the selected leave requests are already approved and cannot be deleted. Only pending or rejected leaves can be deleted."]})]}),e.jsxs(Typography,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(Me,{style:{width:20,height:20}}),"Selected Leave Requests (",g.length,")"]}),e.jsx(List,{sx:{maxHeight:300,overflow:"auto",border:`1px solid ${x.palette.divider}`,borderRadius:2,backgroundColor:x.palette.background.paper},children:g.map((v,p)=>{var o,F,w;const N=v.status&&v.status.toLowerCase()==="approved";return e.jsxs(he.Fragment,{children:[e.jsx(ListItem,{sx:{py:2,opacity:N?.6:1,backgroundColor:N?x.palette.error.main+"10":"transparent"},children:e.jsx(ListItemText,{primary:e.jsxs(Box,{sx:{display:"flex",alignItems:"center",gap:2,flexWrap:"wrap"},children:[e.jsx(Typography,{variant:"subtitle2",children:j(v.user_id)}),e.jsx(Q,{size:"sm",variant:"flat",color:((o=v.status)==null?void 0:o.toLowerCase())==="approved"?"success":((F=v.status)==null?void 0:F.toLowerCase())==="pending"?"warning":((w=v.status)==null?void 0:w.toLowerCase())==="rejected"?"danger":"default",children:v.status||"Unknown"}),N&&e.jsx(Q,{size:"sm",variant:"flat",color:"danger",children:"Cannot Delete"})]}),secondary:e.jsxs(Box,{children:[e.jsxs(Typography,{variant:"body2",color:"text.secondary",children:[v.leave_type," - ",v.from_date," to ",v.to_date]}),e.jsxs(Typography,{variant:"body2",color:"text.secondary",children:[v.no_of_days," day",v.no_of_days!==1?"s":""," - ",v.reason]})]})})}),p<g.length-1&&e.jsx(De,{})]},v.id)})}),z&&e.jsx(Box,{sx:{mt:3,p:2,borderRadius:2,background:x.palette.warning.main+"20",border:`1px solid ${x.palette.warning.main}40`},children:e.jsx(Typography,{variant:"body2",color:"warning.main",sx:{fontWeight:500},children:"âš ï¸ This action cannot be undone. The selected leave requests will be permanently deleted."})})]}),e.jsxs(DialogActions,{sx:{padding:"16px 24px",justifyContent:"space-between",gap:2},children:[e.jsx(LoadingButton,{variant:"outlined",onClick:f,disabled:D,sx:{borderRadius:"50px"},children:"Cancel"}),e.jsx(LoadingButton,{variant:"contained",color:"error",onClick:k,loading:D,disabled:!z||D||g.length===0,startIcon:!D&&e.jsx(fe,{style:{width:16,height:16}}),sx:{borderRadius:"50px"},children:D?"Deleting...":`Delete ${g.length} Request${g.length!==1?"s":""}`})]})]})};export{Xs as B,Qs as D,Js as L,Zs as a,js as b};
