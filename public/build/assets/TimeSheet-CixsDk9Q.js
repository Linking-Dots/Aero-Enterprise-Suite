import{r as l,j as e,d as z,e as B,s as ie,b as $,f as J,k as T,a as X,H as ne}from"./app-pD_wu89V.js";import{m as U,n as ee,o as se,p as te,s as oe,l as le,g as O,h as P,F as K,y as de,u as q,i as ce,A as me}from"./App-CRM6cl4K.js";import{T as ue}from"./TimeSheetTable-lQFPTGFx.js";import{B as E,c as V}from"./react-toastify.esm-C27KsvjR.js";import{d as R}from"./dayjs.min-rp7taIUb.js";import{c as pe,l as he,a as fe,e as xe,M as ye,T as ge,u as ve,L as ae}from"./leaflet-DLVJCefa.js";import{F as G}from"./MapPinIcon-D5mtTiNR.js";import{F as Q}from"./GlobeAltIcon-ZhHKhsy3.js";import{F as be}from"./ExclamationTriangleIcon-15Ad1eJs.js";import{i as M}from"./chunk-SSA7SXE4-3IB5G6nQ.js";import{F as Y}from"./UserPlusIcon-gvx5Ce0l.js";import{F as W}from"./InformationCircleIcon-fzpOx4ox.js";import{u as L}from"./chunk-S574QCAN--4TIc_-v.js";import{m as re}from"./chunk-O5MCAK4F-C3dXtnET.js";import{c as Z}from"./chunk-XJ2YRSUP-BD0rQ9-z.js";import{t as je}from"./chunk-QESP63UR-ChMG7OPe.js";import{F as _e}from"./CheckCircleIcon-C_3bxj69.js";import{F as Ne}from"./ChartBarIcon-B1C7t8DE.js";import"./EnvelopeIcon-CmPuakPp.js";import"./UserIcon-Cfmi-WA6.js";import"./ShieldCheckIcon-DBXonrEk.js";import"./KeyIcon-DlRXzuov.js";import"./logo-Bbo1y25b.js";import"./proxy-gXg16laI.js";import"./create-visual-element-D1-nXtfK.js";import"./features-animation-0oxZq0dW.js";import"./PageHeader-C357prN8.js";import"./XCircleIcon-DFIWdgx-.js";import"./DocumentArrowDownIcon-FG1N39W2.js";import"./chunk-JOT4BT4P-CGFDtRfM.js";import"./chunk-TLYTI3QM-C1mD0htV.js";import"./chunk-F3UDT23P-CCJj5y-2.js";import"./chunk-YRZGWF2W-DHn3bfG7.js";import"./chunk-TSPNSPCL-EuOH3nL_.js";import"./chunk-EAPQ7RWQ-CVx5NIeJ.js";import"./useToggleState-DJ71yigm.js";import"./index-Bxb4KmuW.js";const we=pe(function({position:d,...c},p){const F=new he.Marker(d,c);return fe(F,xe(p,{overlayContainer:F}))},function(d,c,p){c.position!==p.position&&d.setLatLng(c.position),c.icon!=null&&c.icon!==p.icon&&d.setIcon(c.icon),c.zIndexOffset!=null&&c.zIndexOffset!==p.zIndexOffset&&d.setZIndexOffset(c.zIndexOffset),c.opacity!=null&&c.opacity!==p.opacity&&d.setOpacity(c.opacity),d.dragging!=null&&c.draggable!==p.draggable&&(c.draggable===!0?d.dragging.enable():d.dragging.disable())});delete ae.Icon.Default.prototype._getIconUrl;ae.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const N={CHECKING:"checking",ACTIVE:"active",DENIED:"denied",INACTIVE:"inactive"},ke=({onLocationSelect:b})=>(ve({click(d){const{lat:c,lng:p}=d.latlng;b({latitude:c,longitude:p,accuracy:10,source:"manual"})}}),null),Fe=({onLocationChange:b,initialLocation:d=null,className:c="",style:p={}})=>{const F=()=>{var g;if(typeof window>"u")return"lg";const h=((g=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:g.trim())||"12px",v=parseInt(h);return v===0?"none":v<=4?"sm":v<=8?"md":v<=16?"lg":"full"},[o,x]=l.useState({status:N.CHECKING,coordinates:d||{latitude:23.8103,longitude:90.4125},error:null,accuracy:null}),[t,i]=l.useState({latitude:"",longitude:""}),y=l.useCallback(()=>new Promise((r,h)=>{if(!navigator.geolocation){h(new Error("Geolocation is not supported by this browser"));return}const v={enableHighAccuracy:!0,timeout:15e3,maximumAge:3e4};navigator.geolocation.getCurrentPosition(g=>{const f={latitude:g.coords.latitude,longitude:g.coords.longitude,accuracy:g.coords.accuracy,source:"gps"};r(f)},g=>{let f="Location unavailable";switch(g.code){case 1:f="Location access denied. Please allow location permission.";break;case 2:f="Location unavailable. Please ensure GPS is enabled.";break;case 3:f="Location request timed out.";break;default:f="Unable to retrieve location."}h(new Error(f))},v)}),[]);l.useEffect(()=>{if(d){x(r=>({...r,status:N.ACTIVE,coordinates:d,accuracy:d.accuracy||null}));return}x(r=>({...r,status:N.CHECKING})),y().then(r=>{x({status:N.ACTIVE,coordinates:r,error:null,accuracy:r.accuracy}),b==null||b(r)}).catch(r=>{const h=r.message.includes("denied");x({status:h?N.DENIED:N.INACTIVE,coordinates:{latitude:23.8103,longitude:90.4125},error:r.message,accuracy:null})})},[d]);const j=l.useCallback(r=>{x(h=>({...h,coordinates:r,status:N.ACTIVE,accuracy:r.accuracy||10})),b==null||b(r)},[]),w=l.useCallback(()=>{const r=parseFloat(t.latitude),h=parseFloat(t.longitude);if(isNaN(r)||isNaN(h)||r<-90||r>90||h<-180||h>180){x(g=>({...g,error:"Invalid coordinates. Latitude must be between -90 and 90, longitude between -180 and 180."}));return}j({latitude:r,longitude:h,accuracy:50,source:"manual"}),i({latitude:"",longitude:""})},[t,j]),I=l.useCallback(()=>{x(r=>({...r,status:N.CHECKING,error:null})),y().then(r=>{x({status:N.ACTIVE,coordinates:r,error:null,accuracy:r.accuracy}),b==null||b(r)}).catch(r=>{const h=r.message.includes("denied");x(v=>({...v,status:h?N.DENIED:N.INACTIVE,error:r.message}))})},[y]);return e.jsxs("div",{className:`space-y-4 ${c}`,style:p,children:[e.jsx(z,{style:{background:"color-mix(in srgb, var(--theme-content1) 80%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(B,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Location Selection"})]}),o.status===N.CHECKING&&e.jsx(ie,{size:"sm"}),(o.status===N.DENIED||o.status===N.INACTIVE)&&e.jsx($,{size:"sm",color:"primary",variant:"flat",onPress:I,startContent:e.jsx(Q,{className:"w-3 h-3"}),children:"Get GPS"})]}),o.coordinates&&e.jsxs("div",{className:"text-xs space-y-1",style:{color:"var(--theme-foreground-600)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Lat:"})," ",o.coordinates.latitude.toFixed(6),",",e.jsx("strong",{children:" Lng:"})," ",o.coordinates.longitude.toFixed(6)]}),o.accuracy&&e.jsxs("div",{children:[e.jsx("strong",{children:"Accuracy:"})," ±",Math.round(o.accuracy),"m"]})]}),o.error&&e.jsxs("div",{className:"flex items-start gap-2 mt-2 p-2 rounded",style:{background:"color-mix(in srgb, var(--theme-danger) 10%, transparent)",color:"var(--theme-danger)"},children:[e.jsx(be,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-xs",children:o.error})]})]})}),e.jsx(z,{style:{borderRadius:"var(--borderRadius, 8px)",overflow:"hidden"},children:e.jsx("div",{style:{height:"300px",width:"100%"},children:o.coordinates&&e.jsxs(ye,{center:[o.coordinates.latitude,o.coordinates.longitude],zoom:16,style:{height:"100%",width:"100%"},children:[e.jsx(ge,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(we,{position:[o.coordinates.latitude,o.coordinates.longitude]}),e.jsx(ke,{onLocationSelect:j})]})})}),e.jsx(z,{style:{background:"color-mix(in srgb, var(--theme-content2) 60%, transparent)",borderColor:"color-mix(in srgb, var(--theme-divider) 50%, transparent)",borderWidth:"var(--borderWidth, 1px)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsxs(B,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Q,{className:"w-4 h-4",style:{color:"var(--theme-secondary)"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--theme-foreground)"},children:"Manual Coordinates"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[e.jsx(M,{size:"sm",label:"Latitude",placeholder:"23.8103",value:t.latitude,onValueChange:r=>i(h=>({...h,latitude:r})),variant:"bordered",radius:F()}),e.jsx(M,{size:"sm",label:"Longitude",placeholder:"90.4125",value:t.longitude,onValueChange:r=>i(h=>({...h,longitude:r})),variant:"bordered",radius:F()}),e.jsx($,{size:"sm",color:"secondary",variant:"flat",onPress:w,isDisabled:!t.latitude||!t.longitude,className:"h-10",children:"Set Location"})]}),e.jsx("p",{className:"text-xs mt-2",style:{color:"var(--theme-foreground-600)"},children:"Click on the map or enter coordinates manually to set the punch location."})]})})]})},Ie=({open:b,closeModal:d,selectedDate:c,allUsers:p,refreshTimeSheet:F,currentUser:o=null})=>{const{props:{auth:x}}=J(),t=()=>{var s;if(typeof window>"u")return"lg";const n=((s=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:s.trim())||"12px",a=parseInt(n);return a===0?"none":a<=4?"sm":a<=8?"md":a<=16?"lg":"full"},[i,y]=l.useState({user_id:"",date:c,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Manually marked present by admin",coordinates:null}),[j,w]=l.useState({}),[I,r]=l.useState(!1);l.useEffect(()=>{y(o?u=>({...u,user_id:o.id,date:c}):u=>({...u,user_id:"",date:c,punch_in_time:"09:00",punch_out_time:""}))},[o,c]);const h=l.useCallback(u=>{y(n=>({...n,coordinates:u,location:u.source==="manual"?`Manual: ${u.latitude.toFixed(6)}, ${u.longitude.toFixed(6)}`:`GPS: ${u.latitude.toFixed(6)}, ${u.longitude.toFixed(6)} (±${Math.round(u.accuracy)}m)`}))},[]),v=l.useMemo(()=>(p==null?void 0:p.filter(u=>{var n;return(n=u.roles)==null?void 0:n.some(a=>a.name==="Employee")}))||[],[p]),g=(u,n)=>{y(a=>({...a,[u]:n})),j[u]&&w(a=>({...a,[u]:void 0}))},f=l.useMemo(()=>{if(i.punch_in_time&&i.punch_out_time){const u=R(`${i.date} ${i.punch_in_time}`),n=R(`${i.date} ${i.punch_out_time}`);if(n.isAfter(u)){const a=n.diff(u,"minute"),s=Math.floor(a/60),m=a%60;return`${s}h ${m}m`}}return null},[i.punch_in_time,i.punch_out_time,i.date]),C=async u=>{var n,a,s,m;u.preventDefault(),r(!0),w({});try{if(!i.coordinates){E.error("Please select a location on the map before submitting."),r(!1);return}const _={user_id:parseInt(i.user_id),date:i.date,punch_in_time:i.punch_in_time,punch_out_time:i.punch_out_time||null,lat:i.coordinates.latitude,lng:i.coordinates.longitude,address:i.location||`Manually marked present by ${((n=x.user)==null?void 0:n.name)||"Administrator"}`},k=await X.post(route("attendance.mark-as-present"),_);k.status===200&&(E.success(k.data.message||"User marked as present successfully!"),F(),d())}catch(_){((a=_.response)==null?void 0:a.status)===422?(w(_.response.data.errors||{}),E.error(_.response.data.message||"Please check the form for errors")):E.error(((m=(s=_.response)==null?void 0:s.data)==null?void 0:m.message)||"Failed to mark user as present")}finally{r(!1)}},S=o||v.find(u=>u.id==i.user_id);return e.jsx(U,{isOpen:b,onClose:d,size:"2xl",radius:t(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-4 max-h-[90vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider flex-shrink-0",body:"overflow-y-auto max-h-[calc(90vh-8rem)]",footer:"border-t border-divider flex-shrink-0",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ee,{children:u=>e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Mark Employee as Present"})]})}),e.jsxs("form",{onSubmit:C,children:[e.jsx(te,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Employee Selection"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[o?e.jsx("div",{className:"p-3 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 8px)"},children:e.jsx(L,{avatarProps:{size:"sm",src:o.profile_image_url,showFallback:!0,name:o.name},description:`Employee ID: ${o.employee_id}`,name:o.name})}):e.jsx(oe,{label:"Select Employee",placeholder:"Choose an employee to mark as present",selectedKeys:i.user_id?new Set([i.user_id.toString()]):new Set,onSelectionChange:n=>{const a=Array.from(n)[0];g("user_id",a||"")},isInvalid:!!j.user_id,errorMessage:j.user_id,variant:"bordered",size:"sm",radius:t(),classNames:{trigger:"min-h-unit-12",value:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'},renderValue:n=>n.map(a=>{const s=v.find(m=>m.id.toString()===a.key);return s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),e.jsxs("span",{className:"text-xs text-default-500",children:["(",s.employee_id,")"]})]},a.key):null}),children:v.map(n=>e.jsx(le,{value:n.id.toString(),textValue:`${n.name} (${n.employee_id})`,children:e.jsx(L,{avatarProps:{size:"sm",src:n.profile_image_url,showFallback:!0,name:n.name},description:`ID: ${n.employee_id}`,name:n.name})},n.id.toString()))}),e.jsx(M,{label:"Date",type:"date",value:i.date,onValueChange:n=>g("date",n),isInvalid:!!j.date,errorMessage:j.date,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(O,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),e.jsx(T,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Working Hours"})]}),f&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",f]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(M,{label:"Punch In Time",type:"time",value:i.punch_in_time,onValueChange:n=>g("punch_in_time",n),isInvalid:!!j.punch_in_time,errorMessage:j.punch_in_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(P,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(M,{label:"Punch Out Time (Optional)",type:"time",value:i.punch_out_time,onValueChange:n=>g("punch_out_time",n),isInvalid:!!j.punch_out_time,errorMessage:j.punch_out_time,variant:"bordered",size:"sm",radius:t(),startContent:e.jsx(P,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employee is still working"})]})]}),e.jsx(T,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Location & Security Information"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsx(Fe,{onLocationChange:h,initialLocation:i.coordinates})})]}),S&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm",style:{color:"var(--theme-foreground)"},children:"Preview"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--theme-foreground-600)"},children:[S.name," will be marked present for"," ",R(i.date).format("MMM D, YYYY")," from"," ",i.punch_in_time," ",i.punch_out_time&&`to ${i.punch_out_time}`,f&&` (${f})`]})]})]})})]})}),e.jsxs(re,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx($,{color:"default",variant:"bordered",onPress:u,radius:t(),size:"sm",isDisabled:I,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx($,{type:"submit",color:"primary",variant:"solid",isLoading:I,isDisabled:I||!i.user_id,radius:t(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:I?"Marking Present...":"Mark as Present"})]})]})]})})})},Ce=({open:b,closeModal:d,selectedDate:c,allUsers:p,refreshTimeSheet:F,selectedUsers:o=[]})=>{const x=()=>{var _;if(typeof window>"u")return"lg";const s=((_=getComputedStyle(document.documentElement).getPropertyValue("--borderRadius"))==null?void 0:_.trim())||"12px",m=parseInt(s);return m===0?"none":m<=4?"sm":m<=8?"md":m<=16?"lg":"full"},[t,i]=l.useState({user_ids:[],date:c,punch_in_time:"09:00",punch_out_time:"",reason:"",location:"Office - Bulk marked present by admin"}),[y,j]=l.useState({}),[w,I]=l.useState(!1),[r,h]=l.useState(!1),v=l.useMemo(()=>(p==null?void 0:p.filter(a=>{var s;return(s=a.roles)==null?void 0:s.some(m=>m.name==="Employee")}))||[],[p]);l.useEffect(()=>{const a=o.map(s=>s.id.toString());i(s=>({...s,user_ids:a,date:c})),h(a.length===v.length),j({})},[o,c,b,v.length]);const g=(a,s)=>{i(m=>({...m,[a]:s})),y[a]&&j(m=>({...m,[a]:void 0}))},f=(a,s)=>{const m=a.toString();i(_=>({..._,user_ids:s?[..._.user_ids,m]:_.user_ids.filter(k=>k!==m)}))},C=a=>{h(a),i(s=>({...s,user_ids:a?v.map(m=>m.id.toString()):[]}))},S=l.useMemo(()=>{if(t.punch_in_time&&t.punch_out_time){const a=R(`${t.date} ${t.punch_in_time}`),s=R(`${t.date} ${t.punch_out_time}`);if(s.isAfter(a)){const m=s.diff(a,"minute"),_=Math.floor(m/60),k=m%60;return`${_}h ${k}m`}}return null},[t.punch_in_time,t.punch_out_time,t.date]),u=async a=>{var s,m,_;a.preventDefault(),I(!0),j({});try{const k={user_ids:t.user_ids.map(H=>parseInt(H)),date:t.date,punch_in_time:t.punch_in_time,punch_out_time:t.punch_out_time||null,reason:t.reason||"Bulk marked present by administrator",location:t.location},A=await X.post(route("attendance.bulk-mark-as-present"),k);if(A.status===200){const{data:H}=A.data,{summary:D}=A.data;D.successful>0&&E.success(`Successfully marked ${D.successful} employees as present!`),D.failed>0&&E.warning(`${D.failed} employees failed to be marked present.`),D.skipped>0&&E.info(`${D.skipped} employees were skipped (already have attendance).`),F(),d()}}catch(k){((s=k.response)==null?void 0:s.status)===422?(j(k.response.data.errors||{}),E.error(k.response.data.message||"Please check the form for errors")):E.error(((_=(m=k.response)==null?void 0:m.data)==null?void 0:_.message)||"Failed to bulk mark users as present")}finally{I(!1)}},n=v.filter(a=>t.user_ids.includes(a.id.toString()));return e.jsx(U,{isOpen:b,onClose:d,size:"4xl",radius:x(),scrollBehavior:"inside",classNames:{base:"backdrop-blur-md mx-2 my-2 sm:mx-4 sm:my-8 max-h-[95vh]",backdrop:"bg-black/50 backdrop-blur-sm",header:"border-b border-divider",body:"overflow-y-auto",footer:"border-t border-divider",closeButton:"hover:bg-white/5 active:bg-white/10"},style:{border:"var(--borderWidth, 2px) solid var(--theme-divider, #E4E4E7)",borderRadius:"var(--borderRadius, 12px)",fontFamily:'var(--fontFamily, "Inter")',transform:"scale(var(--scale, 1))"},children:e.jsx(ee,{children:a=>e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"flex flex-col gap-1",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("span",{className:"text-lg font-semibold",style:{fontFamily:'var(--fontFamily, "Inter")'},children:"Bulk Mark as Present"})]}),e.jsxs(V,{variant:"bordered",size:"sm",style:{borderColor:"var(--theme-primary)",color:"var(--theme-primary)"},children:[t.user_ids.length," selected"]})]})}),e.jsxs("form",{onSubmit:u,children:[e.jsx(te,{className:"py-4 px-4 sm:py-6 sm:px-6",style:{fontFamily:'var(--fontFamily, "Inter")'},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Date & Time Configuration"})]}),S&&e.jsxs("span",{className:"text-sm px-2 py-1 rounded-md bg-success/10 text-success",children:["Duration: ",S]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(M,{label:"Date",type:"date",value:t.date,onValueChange:s=>g("date",s),isInvalid:!!y.date,errorMessage:y.date,variant:"bordered",size:"sm",radius:x(),startContent:e.jsx(O,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(M,{label:"Punch In Time",type:"time",value:t.punch_in_time,onValueChange:s=>g("punch_in_time",s),isInvalid:!!y.punch_in_time,errorMessage:y.punch_in_time,variant:"bordered",size:"sm",radius:x(),startContent:e.jsx(P,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(M,{label:"Punch Out Time (Optional)",type:"time",value:t.punch_out_time,onValueChange:s=>g("punch_out_time",s),isInvalid:!!y.punch_out_time,errorMessage:y.punch_out_time,variant:"bordered",size:"sm",radius:x(),startContent:e.jsx(P,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'},description:"Leave empty if employees are still working"})]})]}),e.jsx(T,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsxs("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:["Select Employees (",t.user_ids.length," of ",v.length,")"]})]}),e.jsx(Z,{isSelected:r,onValueChange:C,color:"primary",size:"sm",children:"Select All"})]}),e.jsx(z,{children:e.jsx(B,{className:"p-4",children:e.jsx(de,{className:"max-h-64",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:v.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg hover:bg-default-50",children:[e.jsx(Z,{isSelected:t.user_ids.includes(s.id.toString()),onValueChange:m=>f(s.id,m),color:"primary",size:"sm"}),e.jsx(L,{avatarProps:{size:"sm",src:s.profile_image_url,showFallback:!0,name:s.name},description:`ID: ${s.employee_id}`,name:s.name,classNames:{name:"text-sm",description:"text-xs"}})]},s.id))})})})}),y.user_ids&&e.jsx("p",{className:"text-danger text-sm",children:y.user_ids})]}),e.jsx(T,{style:{background:"var(--theme-divider)"}}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5",style:{color:"var(--theme-primary)"}}),e.jsx("h3",{className:"text-base font-semibold",style:{color:"var(--theme-foreground)"},children:"Additional Information"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(M,{label:"Location",value:t.location,onValueChange:s=>g("location",s),isInvalid:!!y.location,errorMessage:y.location,variant:"bordered",size:"sm",radius:x(),startContent:e.jsx(G,{className:"w-4 h-4 text-default-400"}),classNames:{input:"text-small",inputWrapper:"min-h-unit-10"},style:{fontFamily:'var(--fontFamily, "Inter")'}}),e.jsx(je,{label:"Reason (Optional)",placeholder:"Reason for bulk marking employees as present...",value:t.reason,onValueChange:s=>g("reason",s),isInvalid:!!y.reason,errorMessage:y.reason,variant:"bordered",size:"sm",radius:x(),minRows:3,maxRows:5,classNames:{input:"text-small"},style:{fontFamily:'var(--fontFamily, "Inter")'}})]})]}),n.length>0&&e.jsx("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--theme-content2)",borderColor:"var(--theme-divider)",borderRadius:"var(--borderRadius, 12px)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(W,{className:"w-5 h-5 mt-0.5",style:{color:"var(--theme-primary)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2",style:{color:"var(--theme-foreground)"},children:["Preview - ",n.length," employee",n.length!==1?"s":""," will be marked present"]}),e.jsxs("p",{className:"text-xs mb-3",style:{color:"var(--theme-foreground-600)"},children:["Date: ",R(t.date).format("MMM D, YYYY")," | Time: ",t.punch_in_time,t.punch_out_time&&` to ${t.punch_out_time}`,S&&` (${S})`]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[n.slice(0,10).map(s=>e.jsx(V,{size:"sm",variant:"flat",color:"primary",children:s.name},s.id)),n.length>10&&e.jsxs(V,{size:"sm",variant:"flat",color:"default",children:["+",n.length-10," more"]})]})]})]})})]})}),e.jsxs(re,{className:"flex flex-col sm:flex-row justify-center gap-2 px-4 sm:px-6 py-3 sm:py-4",style:{borderColor:"var(--theme-divider, #E4E4E7)",fontFamily:'var(--fontFamily, "Inter")'},children:[e.jsx($,{color:"default",variant:"bordered",onPress:a,radius:x(),size:"sm",isDisabled:w,style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:"Cancel"}),e.jsx($,{type:"submit",color:"primary",variant:"solid",isLoading:w,isDisabled:w||t.user_ids.length===0,radius:x(),size:"sm",style:{borderRadius:"var(--borderRadius, 8px)",fontFamily:'var(--fontFamily, "Inter")'},children:w?"Processing...":`Mark ${t.user_ids.length} Employee${t.user_ids.length!==1?"s":""} as Present`})]})]})]})})})},Se=({title:b,allUsers:d})=>{var g;const{auth:c}=J().props;q("(max-width: 768px)"),q("(max-width: 640px)");const[p,F]=l.useState(R().format("YYYY-MM-DD")),[o,x]=l.useState({type:null,selectedUsers:[],currentUser:null}),[t,i]=l.useState(0),[y,j]=l.useState({currentMonth:R().format("YYYY-MM")});l.useCallback((f,C=[],S=null)=>{x({type:f,selectedUsers:C,currentUser:S})},[]);const w=l.useCallback(()=>{x({type:null,selectedUsers:[],currentUser:null})},[]),I=l.useCallback(f=>{const C=f.target.value;F(C)},[]),r=l.useCallback(()=>{i(f=>f+1)},[]),h=l.useCallback((f,C)=>{x({type:"mark_as_present",selectedUsers:[],currentUser:f,selectedDate:C})},[]);l.useMemo(()=>{const f=R(p);return[{title:"Present Today",value:0,icon:e.jsx(_e,{className:"w-5 h-5"}),color:"text-green-400",iconBg:"bg-green-500/20",description:"Employees present"},{title:"Absent Today",value:0,icon:e.jsx(Y,{className:"w-5 h-5"}),color:"text-red-400",iconBg:"bg-red-500/20",description:"Employees absent"},{title:"Total Employees",value:(d==null?void 0:d.length)||0,icon:e.jsx(Ne,{className:"w-5 h-5"}),color:"text-blue-400",iconBg:"bg-blue-500/20",description:"Active employees"},{title:"Date",value:f.format("MMM D"),icon:e.jsx(ce,{className:"w-5 h-5"}),color:"text-purple-400",iconBg:"bg-purple-500/20",description:f.format("dddd")}]},[p,d]);const v=l.useMemo(()=>({open:!!o.type,closeModal:w,selectedDate:o.selectedDate||p,allUsers:d,refreshTimeSheet:r,selectedUsers:o.selectedUsers,currentUser:o.currentUser}),[o.type,w,o.selectedDate,p,d,r,o.selectedUsers,o.currentUser]);return(g=c.permissions)!=null&&g.includes("attendance.view"),e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:b}),o.type==="mark_as_present"&&e.jsx(Ie,{...v}),o.type==="bulk_mark_as_present"&&e.jsx(Ce,{...v}),e.jsx(ue,{handleDateChange:I,selectedDate:p,updateTimeSheet:t,externalFilterData:y,externalEmployee:"",onMarkAsPresent:h})]})};Se.layout=b=>e.jsx(me,{children:b});export{Se as default};
